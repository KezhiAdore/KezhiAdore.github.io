<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2023毕业快乐</title>
    <url>/null.html</url>
    <content><![CDATA[<p>年纪越大，感到时光流逝的就越快。转眼间，就已经到了2023年。比我大一届的师兄师姐们就要毕业了。这篇博客主要放照片用，没有什么太多的文字内容。</p>
<p>祝各位毕业的师兄师姐前程似锦，生活精彩。🎉🎉🎉</p>
<p><img src="https://download.kezhi.tech/img/202306131047631.jpg?x-oss-process=style/webp" style="width:33%;" /></p>
<span id="more"></span>
<p>先放一首未来再见在这里作为BGM，建议边听边看。^_^</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1480344409&amp;auto=1&amp;height=66">
</iframe>
<h2 id="先是毕业晚会">先是毕业晚会</h2>
<p><img
src="https://download.kezhi.tech/img/202306131019051.jpg?x-oss-process=style/webp" /></p>
<center>
毕业晚会现场
</center>
<p><img
src="https://download.kezhi.tech/img/202306131021079.jpg?x-oss-process=style/webp" /></p>
<center>
一个人完成七个人的业绩罢了
</center>
<p><img
src="https://download.kezhi.tech/img/202306131022653.jpg?x-oss-process=style/webp" /></p>
<center>
我一直觉得泓理楼作为显示设备效果会很不错，确实很惊艳
</center>
<h2 id="再是师兄师姐">再是师兄师姐</h2>
<p><img
src="https://download.kezhi.tech/img/202306131026431.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131027348.jpg?x-oss-process=style/webp" /></p>
<center>
可爱捏~
</center>
<p><img
src="https://download.kezhi.tech/img/202306131028272.png?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131029459.png?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131030337.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131030062.jpg?x-oss-process=style/webp" /></p>
<p>再就是说，谁不想和明星合影呢。</p>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306131032143.jpg?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306131032204.jpg?x-oss-process=style/webp">
</td>
</tr>
</table>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306131033772.jpg?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306131033428.jpg?x-oss-process=style/webp">
</td>
</tr>
</table>
<h2 id="最后是两位好友的毕业拍摄">最后是两位好友的毕业拍摄</h2>
<blockquote class="blockquote-center">
<p>愿时光永驻此刻，愿明日如黄金般闪耀</p>

</blockquote>
<blockquote>
<p>以下全是直出图，欸嘿</p>
</blockquote>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306131035561.jpg?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306131036370.jpg?x-oss-process=style/webp">
</td>
</tr>
</table>
<p><img src="https://download.kezhi.tech/img/202306131036538.jpg?x-oss-process=style/webp" alt="IMG_20230612_122623" style="width:33%;" /></p>
<center>
准备了两束花和几根芍药
</center>
<p><img src="https://download.kezhi.tech/img/202306131039400.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306141501108.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141450455.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141451789.JPG?x-oss-process=style/webp">
</td>
</tr>
</table>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306141454583.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141458146.JPG?x-oss-process=style/webp">
</td>
</tr>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306141456892.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141453547.JPG?x-oss-process=style/webp">
</td>
</tr>
</table>
<p><img
src="https://download.kezhi.tech/img/202306141455475.JPG?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306141459684.JPG?x-oss-process=style/webp" /></p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>毕业</tag>
      </tags>
  </entry>
  <entry>
    <title>BP神经网络</title>
    <url>/4f98a72.html</url>
    <content><![CDATA[<h2 id="bp神经网络概述">BP神经网络概述</h2>
<p>BP神经网络是神经网络中最基础也是应用最多的神经网络，它由三层节点组成，分别为输入层，隐含层和输出层。BP神经网络的实现比较简单，主要分为正向传递输出和反向传递误差两部分。</p>
<p>神经网络的万能逼近定律：一维阶梯函数的线性组合可以逼近任何一维连续函数；sigmoid函数可以逼近阶梯函数，因此一维sigmoid函数的线性组合能够逼近任何连续函数。（1989年，Robert
Hecht-Nielsen）这为神经网络的应用提供了理论依据。</p>
<span id="more"></span>
<p>神经网络的优点就在于，很多我们很难去求解的函数映射关系，可以通过对多个一维阶梯函数组合得到，那么如何对这些一维函数进行组合就成了神经网络建立的主要问题和难点。</p>
<h2 id="bp神经网络认识">BP神经网络认识</h2>
<p>BP神经网络可以看做是一个多输入多输出的函数，如果不考虑内部结构，它的黑盒模型如下：</p>
<figure>
<img
src="https://download.kezhi.tech/20200422003115.png?x-oss-process=style/webp"
alt="BP神经网络的黑盒模型" />
<figcaption aria-hidden="true">BP神经网络的黑盒模型</figcaption>
</figure>
<p>在该BP神经网络中，输入为<span
class="math inline">\(m\)</span>个，输出为<span
class="math inline">\(n\)</span>个，我们知道输入和输出之间应当还有一层隐含层，那么隐含层的节点个数应当如何选取。一般来说，隐含层的确定由如下的经验公式所决定：
<span class="math display">\[
h=\sqrt{m+n}+a
\]</span> 其中<span
class="math inline">\(h\)</span>为隐含层节点数目，<span
class="math inline">\(m\)</span>为输入层节点数目，<span
class="math inline">\(n\)</span>为输出层节点数目，<span
class="math inline">\(a\)</span>为之间的调节常数</p>
<p>那么根据输入和输出的节点数，我们就可以构造一个简单地BP神经网络模型了，它的内部结构如下（以<span
class="math inline">\(m=3,n=3,h=3\)</span>为例）：</p>
<figure>
<img
src="https://download.kezhi.tech/20200422003733.png?x-oss-process=style/webp"
alt="image-20200422003732195" />
<figcaption aria-hidden="true">image-20200422003732195</figcaption>
</figure>
<p>这样的一个三层的神经网络就可以通过一维函数的组合来实现任意的3维到3维的映射，那么如何建立这种映射呢？，这个问题其实就是如何对BP神经网络进行训练。训练的过程主要分为两部分：前向传递结果，反向传递残差。</p>
<h2 id="前向传递">前向传递</h2>
<p>对于BP神经网络中的任何一个节点，其输入为上一层节点输出的加权和，以隐含层为例，设输入层节点的输出为<span
class="math inline">\(x_i\)</span>，隐含层节点的输入为<span
class="math inline">\(net_j\)</span>，输入层的节点<span
class="math inline">\(i\)</span>连接到隐含层节点<span
class="math inline">\(j\)</span>的权值为<span
class="math inline">\(w_{ij}\)</span>，常数项为<span
class="math inline">\(b_j\)</span>则隐含层节点的输入为： <span
class="math display">\[
net_j=\sum_{i=1}^m w_{ij}x_i+b_j
\]</span>
在BP神经网络中，为了保证激活函数处处可导，选用sigmoid函数作为激活函数，那么节点输出为：
<span class="math display">\[
f(net_j)=\frac1{1+e^{-net_j}}
\]</span></p>
<blockquote>
<p>使用sigmoid的优点：</p>
<ol type="1">
<li>相比于阶梯函数，它在定义域上处处可导</li>
<li>令<span
class="math inline">\(y=sigmoid(x)，则y^,=y(1-y)\)</span>。可以看出sigmoid函数的导数可以用自身来表示。这样，一旦计算出sigmoid函数的值，计算它的导数的值就非常方便。这为后面反向传播时使用梯度下降法提供了便利。</li>
</ol>
<p>Sigmoid 函数的主要缺陷：</p>
<ol type="1">
<li><p>梯度消失： 注意：Sigmoid 函数趋近 0 和 1
的时候变化率会变得平坦，也就是说，Sigmoid 的梯度趋近于 0。神经网络使用
Sigmoid 激活函数进行反向传播时，输出接近 0 或 1 的神经元其梯度趋近于
0。这些神经元叫作饱和神经元。因此，这些神经元的权重不会更新。此外，与此类神经元相连的神经元的权重也更新得很慢。该问题叫作梯度消失。因此，想象一下，如果一个大型神经网络包含
Sigmoid
神经元，而其中很多个都处于饱和状态，那么该网络无法执行反向传播；</p></li>
<li><p>不以零为中心： Sigmoid 输出不以零为中心的；</p></li>
<li><p>计算成本高昂： exp()
函数与其他非线性激活函数相比，计算成本高昂。</p></li>
</ol>
<figure>
<img
src="https://download.kezhi.tech/20200422005253.png?x-oss-process=style/webp"
alt="sigmoidal函数" />
<figcaption aria-hidden="true">sigmoidal函数</figcaption>
</figure>
</blockquote>
<p>每个神经元进行这样独立的运算，那么对于一组输入，神经网络就可以进行运算得到相应的输出。这就是前向传递的过程。</p>
<h2 id="反向传递">反向传递</h2>
<p>在初始时，系统中的所有权值时随机确定的。因此要通过学习训练数据，不断地修正节点中的权值来使得模型趋向于我们希望的结果。反向传递的基本算法思想是非线性规划中的梯度下降算法，规划的目标为最小化损失函数。大体流程如下：</p>
<ul>
<li>设定损失函数，假设输出层的所有结果为<span
class="math inline">\(d_j\)</span>，则损失函数如下：</li>
</ul>
<p><span class="math display">\[
E(w,b)=\frac12\sum_{j=0}^{n-1}(d_j-y_j)^2
\]</span></p>
<ul>
<li>通过损失函数修正隐层到输出层的<span
class="math inline">\(w、b\)</span>进行修正。对于隐层的节点<span
class="math inline">\(i\)</span>到输出层节点<span
class="math inline">\(j\)</span>的权值<span
class="math inline">\(w_{ij}\)</span>，进行如下修正（其中<span
class="math inline">\(\eta\)</span>为学习率）：</li>
</ul>
<p><span class="math display">\[
\Delta w=-\eta\frac{\partial E}{\partial w_{ij}}
\]</span></p>
<ul>
<li>同样的，对于<span class="math inline">\(b\)</span>的修正为：</li>
</ul>
<p><span class="math display">\[
\Delta b=-\eta\frac{\partial E}{\partial b_{i}}
\]</span></p>
<p>基本上就是这么个思路，求偏导的过程比较复杂这里就不展开说了，记住梯度下降法最小化损失函数的思想就可以了。</p>
<h2 id="参考文献">参考文献</h2>
<p>[1]ACdreamers. BP神经网络[G/OL]. CSDN: 2015.03.26[2020.04.22].
https://blog.csdn.net/acdreamers/article/details/44657439</p>
<p>[2]东皇Amrzs. [整理] BP神经网络讲解——最好的版本[G/OL]. 简书:
2017.02.28[2020.04.22]. https://www.jianshu.com/p/3d96dbf3f764</p>
<p>[3]lx青萍之末. BP神经网络[G]. CSDN: 2018.07.20[2020.04.22].
https://blog.csdn.net/daaikuaichuan/article/details/81135802</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>神经网络</tag>
        <tag>BP</tag>
      </tags>
  </entry>
  <entry>
    <title>2024毕业快乐</title>
    <url>/35956731.html</url>
    <content><![CDATA[<p>转眼间，从我步入大学校园到现在已经有七年之久。三年前也经历过一次毕业，不过那时身边的朋友们大多选择继续在学校读研，所以并未有太多伤感。而今年，读研的人也大多取得了硕士学位，走向天南海北的社会岗位。自此一别，今后恐再难相见。谨以此文为念，祝今年毕业的朋友们前程似锦。</p>
<p><img src="https://download.kezhi.tech/img/202406241051402.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="婚礼上的再聚首">婚礼上的再聚首</h2>
<p>24年6月9日，嵩哥大婚。他们两位从本科开始恋爱，至今修成正果。大家也都放下手头的事情，从天南海北回到西安参加嵩哥的婚礼。</p>
<p><img src="https://download.kezhi.tech/img/202406241014924.jpg?x-oss-process=style/webp" style="width:75%;" /></p>
<p>晚上，趁着参加完婚礼大家都在，就在兴庆的烧烤摊上再聚首，从白天喝到晚上。自此，朱佬以一己之力奠定了《嘉宾》在自动化大会上的地位。<del>也留下了珍贵的影像资料</del></p>
<p><img
src="https://download.kezhi.tech/img/202406241018827.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241018505.jpg?x-oss-process=style/webp" /></p>
<h2 id="毕业照">毕业照</h2>
<p>接下来是喜闻乐见的毕业照环节，小雪和建建在外地实习，故打了两张照片一起合影（建议下次整个等身立牌）</p>
<p><img src="https://download.kezhi.tech/img/202406241025616.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>课题组毕业了两位同门，祝未来工作顺利，升学顺利。</p>
<p><img
src="https://download.kezhi.tech/img/202406241026893.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241028403.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241027982.jpg?x-oss-process=style/webp" /></p>
<p>本科室友也基本毕业了（除了某个二战的小学弟hhhhh）</p>
<p><img
src="https://download.kezhi.tech/img/202406241029748.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241029272.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241029458.jpg?x-oss-process=style/webp" /></p>
<p>假装自己也毕业，沾沾喜气😀</p>
<p><img src="https://download.kezhi.tech/img/202406241030462.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<h2 id="毕业晚会">毕业晚会</h2>
<p>今年毕业典礼和毕业晚会是在一天举行的，白天毕业典礼晚上毕业晚会。换了校长对毕业典礼就少了一个期待环节，毕竟领导发言确实大都没什么好听的。不过今年多了个放鸽子的环节，飞了好多只。</p>
<p><img
src="https://download.kezhi.tech/img/202406241036158.jpg?x-oss-process=style/webp" /></p>
<p>虽然我不毕业，但学校发的文创雪糕搞到了三款✌</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241019765.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241021141.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241021156.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>毕业晚会</p>
<p><img
src="https://download.kezhi.tech/img/202406241036310.jpg?x-oss-process=style/webp" /></p>
<p>彩排的时候打出来的校训和西迁，正式表演的时候么的了</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241039263.jpg?x-oss-process=style/webp" />
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241039053.jpg?x-oss-process=style/webp" />
</center>
</td>
</tr>
</table>
<p>最后是合影</p>
<p><img
src="https://download.kezhi.tech/img/202406241040796.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241040961.jpg?x-oss-process=style/webp" /></p>
<p>希望大家都能一直充满朝气。</p>
<h2 id="自动化的晚餐">自动化的晚餐</h2>
<p>毕业典礼结束后的第二天，按照之前的约定，本科自动化的朋友们尽可能回来聚在一起吃饭道别。</p>
<p><img
src="https://download.kezhi.tech/img/202406241044954.jpg?x-oss-process=style/webp" /></p>
<p>对于这个没有到场的同志，我们也没有让他们孤单。</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241045135.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241045842.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>不得不说富士的直出真有质感</p>
<p><img
src="https://download.kezhi.tech/img/202406241047584.jpg?x-oss-process=style/webp" /></p>
<p>世界名画：《翔哥在喝汤》</p>
<p><img
src="https://download.kezhi.tech/img/202406241046620.jpg?x-oss-process=style/webp" /></p>
<p>最后，祝毕业了工作了的朋友们前程似锦，在读的博士们早点毕业，即将毕业的小学弟找个好工作。</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>毕业</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker-VNC桌面配置</title>
    <url>/d97606bd.html</url>
    <content><![CDATA[<p>在使用公共服务器时，通常用户只有普通权限账户，无法按照自己的想法任意对服务器进行配置。为满足这种需求，常使用docker来实现在容器内使用root权限来自由配置环境。VNC是一种常用的远程桌面，可以通过端口通信实现服务器渲染画面的回传。这在进行一些有界面的实验（如mujoco，habitat,
igibson环境）时非常有用。本文将主要介绍如何在docker中配置vnc桌面，并给出了一个打包好的镜像：<a
href="https://hub.docker.com/r/kezhiadore/ubuntu-vnc">kezhiadore/ubuntu-vnc
- Docker Image | Docker Hub</a></p>
<p><img src="https://download.kezhi.tech/img/202311032138787.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<center>
是可爱的垃圾呀
</center>
<span id="more"></span>
<p>首先，从一个初始的Ubuntu18.04镜像开始，下载，启动并进入容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull ubuntu:bionic</span><br><span class="line">docker run -itd --name ubuntu-vnc ubuntu:bionic</span><br><span class="line">docker exec -it ubuntu-vnc</span><br></pre></td></tr></table></figure>
<p>这个容器是没有桌面，因此先安装一个xfce4桌面</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt install xfce4 xfce4-goodies xorg dbus-x11 x11-xserver-utils</span><br></pre></td></tr></table></figure>
<p>进入之后下载安装vncserver</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install tigervnc-standalone-server tigervnc-common</span><br></pre></td></tr></table></figure>
<p>在用户目录下配置启动文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt insall vim</span><br><span class="line">vim ~/.vnc/xstartup</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 添加以下脚本</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">unset SESSION_MANAGER </span><br><span class="line">unset DBUS_SESSION_BUS_ADDRESS </span><br><span class="line">startxfce4 &amp;</span><br><span class="line">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup </span><br><span class="line">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources </span><br><span class="line">xsetroot -solid grey</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">保存并关闭文件。无论何时启动或者重启TigerVNC服务器，都将会自动执行上述命令</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改文件权限</span></span><br><span class="line">chmod +x ~/.vnc/xstartup</span><br></pre></td></tr></table></figure>
<p>启动vncserver</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vncserver :1</span><br></pre></td></tr></table></figure>
<p>vncserver初次启动需要配置密码，密码配置完成后，使用vnc客户端访问端口5091即可连接到远程桌面。</p>
<h2 id="tips">Tips</h2>
<ul>
<li>进入桌面后，部分应用如google
chrome是无法在root用户模式下运行的，可以创建一个用户以该用户身份启动远程桌面即可</li>
<li>出现终端打不开情况时，更改<code>application-&gt;settings-&gt;preference</code>中的<code>terminal</code>即可</li>
<li>中文显示乱码的问题是字体和编码问题导致的，可参考以下教程解决：
<ul>
<li><a
href="https://blog.csdn.net/qq_40927409/article/details/120030704">xfce桌面汉化（命令）_xfce4设置中文-CSDN博客</a></li>
<li><a
href="https://blog.csdn.net/weixin_42937217/article/details/121970539">xfce中文字符方块乱码问题解决_xfce
中文乱码-CSDN博客</a></li>
<li><a
href="https://learningsky.io/xfce-desktop-environment-display-chinese/">【
Tools 】於 Xfce 桌面環境顯示中文 (learningsky.io)</a></li>
</ul></li>
</ul>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a
href="https://blog.csdn.net/qq_31638535/article/details/131016239">docker容器内部配置VNC和novnc，主机或者外部可访问_docker
novnc-CSDN博客</a></li>
<li><a
href="https://blog.csdn.net/Robert_Q/article/details/127376171">使用VNC可视化Docker容器_docker
vnc-CSDN博客</a></li>
<li><a
href="https://www.pimspeak.com/ubuntu-docker-vnc-desktop.html">Ubuntu
Docker容器开启VNC桌面-小果冻之家 (pimspeak.com)</a></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>DDPG算法中AC学习率设置对训练效果的影响</title>
    <url>/46493a5d.html</url>
    <content><![CDATA[<p>深度强化学习算法相比于深度学习，有更多的超参数需要调节，本文主要对DDPG算法中的actor网络和critic网络学习率的设置对学习效果的影响进行了探讨。</p>
<p><img src="https://download.kezhi.tech/img/202312071724061.png?x-oss-process=style/webp" width="33%"></p>
<span id="more"></span>
<p>最近在复现DDPG算法时，首先根据论文的算法流程进行复现，完成后在连续环境<code>Pendulum-v1</code>上进行测试，但是总是训练效果不好，算法的收敛结构很差，如图1所示。</p>
<p><img
src="https://download.kezhi.tech/img/202309202043247.png?x-oss-process=style/webp" /></p>
<center>
图1 actor和critic的lr均为3e-4的训练结果，左图为critic loss,
右图为reward曲线
</center>
<p>于是找了很多该算法的复现来对比到底是哪里出了问题。花了大量的时间确认了复现的DDPG算法的决策和更新流程都没有问题之后，我把目光转向了超参数的设定上，最终发现<code>critic</code>的学习率通常需要设置的比<code>actor</code>大一点。在将<code>critic net</code>的学习率改大之后，DDPG算法终于表现出很好的性能，得到了漂亮的<code>reward</code>曲线，如图2所示。</p>
<p><img
src="https://download.kezhi.tech/img/202309202044469.png?x-oss-process=style/webp" /></p>
<center>
图2 修改critic lr之后的学习效果，左图为critic loss，右图为reward曲线
</center>
<p>在解决了该问题后，引出了一个问题，DDPG算法中的<code>actor</code>和<code>critic</code>的学习率为什么需要不同才可我使该算法很好的work。为此我也在网上找到了关于该问题的探讨。总结下来大概有如下几种解释：</p>
<ul>
<li><code>actor</code>和<code>critic</code>的学习率是两个需要调整的超参数，这样设置是在实践中发现比较好的结果</li>
<li>如果<code>actor</code>比<code>critic</code>更新的更快，那么估计的Q值不能够真实反映动作的价值，因为<code>critic</code>的Q值函数是基于过去的策略估计出的</li>
<li>因为<code>actor</code>输出的是具体动作，通常是<code>bounded</code>，因此学习率可以小一点，而<code>critic</code>学习的目标是折扣奖励的期望，通常是无界的，需要学习率大一点。</li>
</ul>
<p><img
src="https://download.kezhi.tech/img/202309202032388.png?x-oss-process=style/webp" /></p>
<p>source: <a
href="https://www.reddit.com/r/reinforcementlearning/comments/lsza9m/why_different_learning_rates_for_actor_and_critic/">Why
different learning rates for actor and critic : r/reinforcementlearning
(reddit.com)</a></p>
<p>为了进一步探究这两个参数的设置对于学习的影响，我用DDPG算法在<code>Pendulum-v1</code>进行了一系列的实验。</p>
<ol type="1">
<li><p>固定<code>actor</code>的学习率为<code>3e-4</code>，改变<code>critic</code>的学习率，得到实验结果如下图：</p>
<p><img
src="https://download.kezhi.tech/img/202309202109275.png?x-oss-process=style/webp" /></p></li>
<li><p>固定<code>critic</code>的学习率为<code>3e-4</code>，改变<code>actor</code>的学习率，得到实验结果如下图：</p>
<p><img
src="https://download.kezhi.tech/img/202309202115148.png?x-oss-process=style/webp" /></p></li>
<li><p>保持<code>actor</code>和<code>critic</code>的学习率相同，同时改变两者的学习率，得到实验结果如下图：</p>
<p><img
src="https://download.kezhi.tech/img/202309202117300.png?x-oss-process=style/webp" /></p></li>
</ol>
<p>由以上实验结果可以得出以下结论：</p>
<ul>
<li>在<code>actor</code>学习率不变的情况下，<code>critic</code>的学习率适当增大可以加快收敛速度，<code>critic</code>如果设置过小可能会导致收敛较慢甚至学习不收敛。</li>
<li>在<code>critic</code>学习率过小导致网络很难收敛时，只调整<code>actor</code>的学习率无法使网络收敛</li>
<li><code>actor</code>和<code>critic</code>的学习率在一致的情况下也是可以收敛的，但需要选择合适的参数才可以得到较好的学习效果。</li>
</ul>
<p>因此，在使用DDPG算法时，<code>critic</code>网络相比于<code>actor</code>网络的学习率可以适当调大，可以得到一个较好的收敛效果。</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>强化学习</tag>
        <tag>Reinforcement Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Git commit message 规范</title>
    <url>/58877bc8.html</url>
    <content><![CDATA[<h2 id="git-commit-message-规范">Git commit message 规范</h2>
<h3 id="commit-message-格式">commit message 格式</h3>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h3 id="type">type</h3>
<p>用于说明git commit的类别，只允许使用下面的标识。</p>
<p>feat：新功能（feature）。</p>
<p>fix/to：修复bug，可以是QA发现的BUG，也可以是研发自己发现的BUG。</p>
<ul>
<li>fix：产生diff并自动修复此问题。适合于一次提交直接修复问题</li>
<li>to：只产生diff不自动修复此问题。适合于多次提交。最终修复问题提交时使用fix</li>
</ul>
<p>docs：文档（documentation）。</p>
<p>style：格式（不影响代码运行的变动）。</p>
<p>refactor：重构（即不是新增功能，也不是修改bug的代码变动）。</p>
<p>perf：优化相关，比如提升性能、体验。</p>
<p>test：增加测试。</p>
<p>chore：构建过程或辅助工具的变动。</p>
<p>revert：回滚到上一个版本。</p>
<p>merge：代码合并。</p>
<p>sync：同步主线或分支的Bug。</p>
<h3 id="scope可选">scope(可选)</h3>
<p>scope用于说明 commit
影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p>
<p>例如在Angular，可以是location，browser，compile，compile，rootScope，
ngHref，ngClick，ngView等。如果你的修改影响了不止一个scope，你可以使用*代替。</p>
<h3 id="subject必须">subject(必须)</h3>
<p>subject是commit目的的简短描述，不超过50个字符。</p>
<p>建议使用中文（感觉中国人用中文描述问题能更清楚一些）。</p>
<ul>
<li>结尾不加句号或其他标点符号。</li>
<li>根据以上规范git commit message将是如下的格式：</li>
</ul>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">fix(DAO):用户查询缺少username属性 </span><br><span class="line">feat(Controller):用户查询接口开发</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>语法规范</tag>
      </tags>
  </entry>
  <entry>
    <title>GITM:LLM和RL的一次交融</title>
    <url>/b222cfe2.html</url>
    <content><![CDATA[<p>最近，清华大学和商汤发表了一篇名为《Ghost in the Minecraft: Generally
Capable Agents for Open-World Environments via Large Language Models
with Text-based Knowledge and
Memory》的文章，简称GITM。很有意思，感兴趣的朋友可以读一下原文。</p>
<p><img
src="https://download.kezhi.tech/img/202306041618232.png?x-oss-process=style/webp" /></p>
<span id="more"></span>
<p>在该文中，作者使用大语言模型来指导智能体的行为，并以语言为交互媒介对智能体进行训练。从而在使用1个32核CPU训练两天的情况下在我的世界环境中达到了非常好的实验效果。并且在训练过程中解锁了<em>我的世界</em>这个游戏中的所有科技树。</p>
<p><img src="https://download.kezhi.tech/img/202306041625148.png?x-oss-process=style/webp" style="width:50%;" /></p>
<center>
GITM与其他模型在挖钻石挑战上的结果对比
</center>
<p><img src="https://download.kezhi.tech/img/202306041627612.png?x-oss-process=style/webp" style="width:80%;" /></p>
<center>
GITM与其他模型在科技树解锁率上的对比
</center>
<h2 id="问题背景">问题背景</h2>
<p>首先来介绍一下GITM做的工作的背景。该工作要解决的问题是在我的世界游戏环境中，从游戏初始化开始，不断学习达到挖到钻石的目标。在我的世界这个游戏中
，钻石通常埋在一定深度的地下。而想要挖到一块钻石矿，至少需要带一个铁镐。而铁镐的制作需要用到铁，那么就需要先挖到铁矿并掌握冶铁的科技。挖铁矿需要用到石稿，石稿的制作需要石头，而石头需要木稿，木稿的值作需要木头和合成台。</p>
<p>而这只是采矿工具上的科技树。在我的世界这个游戏中，还需要不断补充食物来回血和防止饥饿，制造武器和护甲来保护自己的安全，这就给智能体的各方面能力都提出了很高的要求。</p>
<p>强化学习的思路在于，智能体观测环境，根据观测到的数据产生动作，智能体执行动作之后，环境发生相应的变化并给智能体反馈一个奖励信号。然而，在我的世界的环境中，由于其极高的自由度和较深的科技树，导致强化学习在该环境下的表现一直差强人意。</p>
<h2 id="gitm">GITM</h2>
<p>GITM在解决这个问题时，没有采用强化学习这一奖励指导动作的思路，而是用语言大模型来进行任务分解和规划，最后通过一个接口来与环境进行交互。具体来说，GITM由三部分构成：LLM
Decomposer, LLM Planner, LLM Interface.
接下来分别对这三部分进行介绍。</p>
<h3 id="llm-decomposer">LLM Decomposer</h3>
<p>LLM Decomposer
的作用在于对目标进行分解。首先，对目标进行定义，在我的世界里面，每个目标可以被定义为如下五元组：
<span class="math display">\[
(Object, Count, Material, Tool, Info)
\]</span> 其中 <span class="math inline">\(Object\)</span>
指目标物品，<span class="math inline">\(Count\)</span>
指具体的数量，<span class="math inline">\(Material\)</span> 和 <span
class="math inline">\(Tool\)</span>
表明了获得该物品需要的前置条件，<span
class="math inline">\(Info\)</span>
中描述了与该目标物品相关的文本知识。LLM Decomposer
在收到一个目标输入之后，便可以根据其前置条件对该目标进行分解，即生成以
<span class="math inline">\(Material\)</span> 和 <span
class="math inline">\(Tool\)</span> 为 <span
class="math inline">\(Object\)</span>
的子任务。这个分解的过程是可以递归进行的，直到分解的出的子目标没有前置条件为止。</p>
<p>这一部分可以使用语言大模型来实现，文章中也给出了具体的prompt，感兴趣的朋友可以用chatGPT尝试一下，效果还不错：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SYSTEM: </span><br><span class="line">You are an assistant for the game Minecraft. </span><br><span class="line">I will give you some target object and some knowledge related to the object. </span><br><span class="line">Please write the obtaining of the object as a goal in the standard form. </span><br><span class="line">The standard form of the goal is as follows: </span><br><span class="line">&#123; </span><br><span class="line">    &quot;object&quot;: &quot;the name of the target object&quot;, </span><br><span class="line">    &quot;count&quot;: &quot;the target quantity&quot;, </span><br><span class="line">    &quot;material&quot;: &quot;the materials required for this goal, a dictionary in the form &#123;material_name: material_quantity&#125;. If no material is required, set it to None&quot;, </span><br><span class="line">    &quot;tool&quot;: &quot;the tool used for this goal. If multiple tools can be used for this goal, only write the most basic one. If no tool is required, set it to None&quot;, </span><br><span class="line">    &quot;info&quot;: &quot;the knowledge related to this goal&quot; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">The information I will give you: </span><br><span class="line">Target object: the name and the quantity of the target object </span><br><span class="line">Knowledge: some knowledge related to the object. </span><br><span class="line"></span><br><span class="line">Requirements: </span><br><span class="line">1. You must generate the goal based on the provided knowledge instead of purely depending on your own knowledge. </span><br><span class="line">2. The &quot;info&quot; should be as compact as possible, at most 3 sentences. The knowledge I give you may be raw texts from Wiki documents. Please extract and summarize important information instead of directly copying all the texts. </span><br><span class="line"></span><br><span class="line">Goal Example: </span><br><span class="line">&#123;</span><br><span class="line">    &quot;object&quot;: &quot;iron_ore&quot;,</span><br><span class="line">    &quot;count&quot;: 1,</span><br><span class="line">    &quot;material&quot;: None,</span><br><span class="line">    &quot;tool&quot;: &quot;stone_pickaxe&quot;,</span><br><span class="line">    &quot;info&quot;: &quot;iron ore is obtained by mining iron ore. iron ore is most found in level 53. iron ore can only be mined with a stone pickaxe or better; using a wooden or gold pickaxe will yield nothing.&quot; </span><br><span class="line">&#125; </span><br><span class="line">&#123; </span><br><span class="line">    &quot;object&quot;: &quot;wooden_pickaxe&quot;,</span><br><span class="line">    &quot;count&quot;: 1,</span><br><span class="line">    &quot;material&quot;: &#123;&quot;planks&quot;: 3, &quot;stick&quot;: 2&#125;,</span><br><span class="line">    &quot;tool&quot;: &quot;crafting_table&quot;,</span><br><span class="line">    &quot;info&quot;: &quot;wooden pickaxe can be crafted with 3 planks and 2 stick as the material and crafting table as the tool.&quot; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">USER: </span><br><span class="line">Target object: &#123;object quantity&#125; &#123;object name&#125; </span><br><span class="line">Knowledge: &#123;related knowledge&#125;</span><br></pre></td></tr></table></figure>
<h3 id="llm-planner">LLM Planner</h3>
<p>LLM Planner
的作用在于根据一个给出的任务，将其分解为结构化动作的组合，结构化动作是具有良好定义的在我的世界中的一些较为基本，容易通过脚本实现的动作。每个动作由三部分组成：
<span class="math display">\[
(Name, Arguements, Description)
\]</span> 结构化动作列表如下表所示：</p>
<p><img
src="https://download.kezhi.tech/img/202306061434297.png?x-oss-process=style/webp" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SYSTEM: </span><br><span class="line">You serve as an assistant that helps me play the game Minecraft. </span><br><span class="line">I will give you a goal in the game. Please think of a plan to achieve the goal, and then write a sequence of actions to realize the plan. The requirements and instructions are as follows: </span><br><span class="line"></span><br><span class="line">1. You can only use the following functions. Don’t make plans purely based on your experience, think about how to use these functions. </span><br><span class="line"></span><br><span class="line">explore(object, strategy) </span><br><span class="line">Move around to find the object with the strategy: used to find objects including block items and entities. This action is finished once the object is visible (maybe at the distance). </span><br><span class="line">Augments: </span><br><span class="line">- object: a string, the object to explore. </span><br><span class="line">- strategy: a string, the strategy for exploration. </span><br><span class="line"></span><br><span class="line">approach(object) </span><br><span class="line">Move close to a visible object: used to approach the object you want to attack or mine. It may fail if the target object is not accessible. </span><br><span class="line">Augments:</span><br><span class="line">- object: a string, the object to approach. </span><br><span class="line"></span><br><span class="line">craft(object, materials, tool) </span><br><span class="line">Craft the object with the materials and tool: used for crafting new object that is not in the inventory or is not enough. The required materials must be in the inventory and will be consumed, and the newly crafted objects will be added to the inventory. The tools like the crafting table and furnace should be in the inventory and this action will directly use them. Don’t try to place or approach the crafting table or furnace, you will get failed since this action does not support using tools placed on the ground. You don’t need to collect the items after crafting. If the quantity you require is more than a unit, this action will craft the objects one unit by one unit. If the materials run out halfway through, this action will stop, and you will only get part of the objects you want that have been crafted. </span><br><span class="line">Augments: </span><br><span class="line">- object: a dict, whose key is the name of the object and value is the object quantity. </span><br><span class="line">- materials: a dict, whose keys are the names of the materials and values are the quantities. </span><br><span class="line">- tool: a string, the tool used for crafting. Set to null if no tool is required. </span><br><span class="line"></span><br><span class="line">mine(object, tool) </span><br><span class="line">Mine the object with the tool: can only mine the object within reach, cannot mine object from a distance. If there are enough objects within reach, this action will mine as many as you specify. The obtained objects will be added to the inventory. </span><br><span class="line">Augments: </span><br><span class="line">- object: a string, the object to mine. </span><br><span class="line">- tool: a string, the tool used for mining. Set to null if no tool is required.</span><br><span class="line"></span><br><span class="line">attack(object, tool) </span><br><span class="line">Attack the object with the tool: used to attack the object within reach. This action will keep track of and attack the object until it is killed. </span><br><span class="line">Augments: </span><br><span class="line">- object: a string, the object to attack. </span><br><span class="line">- tool: a string, the tool used for mining. Set to null if no tool is required.</span><br><span class="line"></span><br><span class="line">equip(object) </span><br><span class="line">Equip the object from the inventory: used to equip equipment, including tools, weapons, and armor. The object must be in the inventory and belong to the items for equipping. </span><br><span class="line">Augments: </span><br><span class="line">- object: a string, the object to equip. </span><br><span class="line"></span><br><span class="line">digdown(object, tool) </span><br><span class="line">Dig down to the y-level with the tool: the only action you can take if you want to go underground for mining some ore. </span><br><span class="line">Augments: </span><br><span class="line">- object: an int, the y-level (absolute y coordinate) to dig to. </span><br><span class="line">- tool: a string, the tool used for digging. Set to null if no tool is required.</span><br><span class="line"></span><br><span class="line">go_back_to_ground(tool) </span><br><span class="line">Go back to the ground from underground: the only action you can take for going back to the ground if you are underground. </span><br><span class="line">Augments: </span><br><span class="line">- tool: a string, the tool used for digging. Set to null if no tool is required. </span><br><span class="line"></span><br><span class="line">apply(object, tool) </span><br><span class="line">Apply the tool on the object: used for fetching water, milk, lava with the tool bucket, pooling water or lava to the object with the tool water bucket or lava bucket, shearing sheep with the tool shears, blocking attacks with the tool shield. </span><br><span class="line">Augments: </span><br><span class="line">- object: a string, the object to apply to. </span><br><span class="line">- tool: a string, the tool used to apply. </span><br><span class="line"></span><br><span class="line">2. You cannot define any new function. Note that the &quot;Generated structures&quot; world creation option is turned off. </span><br><span class="line"></span><br><span class="line">3. There is an inventory that stores all the objects I have. It is not an entity, but objects can be added to it or retrieved from it anytime at anywhere without specific actions. The mined or crafted objects will be added to this inventory, and the materials and tools to use are also from this inventory. Objects in the inventory can be directly used. Don’t write the code to obtain them. If you plan to use some object not in the inventory, you should first plan to obtain it. You can view the inventory as one of my states, and it is written in form of a dictionary whose keys are the name of the objects I have and the values are their quantities. </span><br><span class="line"></span><br><span class="line">4. You will get the following information about my current state:</span><br><span class="line">- inventory: a dict representing the inventory mentioned above, whose keys are the name of the objects and the values are their quantities </span><br><span class="line">- environment: a string including my surrounding biome, the y-level of my current location, and whether I am on the ground or underground </span><br><span class="line">Pay attention to this information. Choose the easiest way to achieve the goal conditioned on my current state. Do not provide options, always make the final decision. </span><br><span class="line"></span><br><span class="line">5. You must describe your thoughts on the plan in natural language at the beginning. After that, you should write all the actions together. The response should follow the format: </span><br><span class="line">&#123; </span><br><span class="line">    &quot;explanation&quot;: &quot;explain why the last action failed, set to null for the first planning&quot;, </span><br><span class="line">    &quot;thoughts&quot;: &quot;Your thoughts on the plan in natural languag&quot;, </span><br><span class="line">    &quot;action_list&quot;: [ </span><br><span class="line">        &#123;&quot;name&quot;: &quot;action name&quot;, &quot;args&quot;: &#123;&quot;arg name&quot;: value&#125;, &quot;expectation&quot;: &quot;describe the expected results of this action&quot;&#125;, </span><br><span class="line">        &#123;&quot;name&quot;: &quot;action name&quot;, &quot;args&quot;: &#123;&quot;arg name&quot;: value&#125;, &quot;expectation&quot;: &quot;describe the expected results of this action&quot;&#125;, </span><br><span class="line">        &#123;&quot;name&quot;: &quot;action name&quot;, &quot;args&quot;: &#123;&quot;arg name&quot;: value&#125;, &quot;expectation&quot;: &quot;describe the expected results of this action&quot;&#125; </span><br><span class="line">    ] </span><br><span class="line">&#125; </span><br><span class="line">The action_list can contain arbitrary number of actions. The args of each action should correspond to the type mentioned in the Arguments part. Remember to add “‘dict“‘ at the beginning and the end of the dict. Ensure that you response can be parsed by Python json.loads </span><br><span class="line"></span><br><span class="line">6. I will execute your code step by step and give you feedback. If some action fails, I will stop at that action and will not execute its following actions. The feedback will include error messages about the failed action. At that time, you should replan and write the new code just starting from that failed action.</span><br></pre></td></tr></table></figure>
<h3 id="llm-interface">LLM Interface</h3>
<p>LLM Interface 的主要作用是把 Planner
下发的基于文本的动作转换为可以与环境交互的动作。主要有两种方式可以实现：人为写的脚本和RL学习的模型。由于在我的世界中结构化动作都有着很好的定义，从而采用了人写脚本的方式来进行控制。</p>
<p>在这一层级，也用到了语言大模型来进行动作分解。首先，在拿到一个目标后（例如
"find material and craft a iron
pickaxe"），让语言模型将其分解为一个深度最多为2的树状的规划。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SYSTEM: </span><br><span class="line">You serve as an assistant that helps me play Minecraft. </span><br><span class="line">I will give you my goal in the game, please break it down as a tree-structure plan to achieve this goal. </span><br><span class="line">The requirements of the tree-structure plan are: </span><br><span class="line">1. The plan tree should be exactly of depth 2. </span><br><span class="line">2. Describe each step in one line. </span><br><span class="line">3. You should index the two levels like ’1.’, ’1.1.’, ’1.2.’, ’2.’, ’2.1.’, etc. </span><br><span class="line">4. The sub-goals at the bottom level should be basic actions so that I can easily execute them in the game. </span><br><span class="line"></span><br><span class="line">USER: </span><br><span class="line">The goal is to &#123;goal description&#125;. Generate the plan according to the requirements.</span><br></pre></td></tr></table></figure>
<p>在此之后，对于树状规划上的每个叶子节点，将其通过语言模型转换为特定的行为描述（'verb',
'object', 'tools', 'materials'）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SYSTEM: </span><br><span class="line">You serve as an assistant that helps me play Minecraft. </span><br><span class="line">I will give you a sentence. </span><br><span class="line">Please convert this sentence into one or several actions according to the following instructions. </span><br><span class="line">Each action should be a tuple of four items, written in the form (’verb’, ’object’, ’tools’, ’materials’) </span><br><span class="line">’verb’ is the verb of this action. </span><br><span class="line">’object’ refers to the target object of the action. </span><br><span class="line">’tools’ specifies the tools required for the action. </span><br><span class="line">’material’ specifies the materials required for the action. </span><br><span class="line">If some of the items are not required, set them to be ’None’. </span><br><span class="line"></span><br><span class="line">USER: </span><br><span class="line">The sentence is &#123;sentence&#125;. Generate the action tuple according to the requirements.</span><br></pre></td></tr></table></figure>
<h2 id="关于智能的讨论">关于智能的讨论</h2>
<p>在我的世界的环境中，该文章中提出的方法取得了非常好的效果：</p>
<p><img
src="https://download.kezhi.tech/img/202306061437232.png?x-oss-process=style/webp" /></p>
<p>相比于目前SOTA的强化学习算法，GITM几乎以碾压的姿态出现在Minecraft的世界中。它的整个流程都如此的合理，以至于即便是如此夸张的性能对比也不会让人过分怀疑。GITM的性能表现说明了一件事：在人类已经攻略的事情上，GPT有潜力通过“查攻略”的方式来达到极高的智能水准。而我们人类的大量知识与技术都是以文本为载体呈现的。因此，这条道路的潜力是巨大的。</p>
<p>尽管如此，我依然认为我们离真正的智能很远。GPT真的太大了，相比于其能力来说，它所需要的训练数据和计算量实在过于庞大。不得不承认Chat
GPT在GAI这条路上大幅迈进了一步，不过相比于真正的智能，它更像是一个不太一样的搜索引擎，攻略手册，并且直到今天它依然无法保证较大范围的可靠性。但它确实也让我们仿佛窥到了通用人工智能的一些影子。最后，希望在我们的有生之年，可以看到真正的智能出现。</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>GPT</tag>
        <tag>RL</tag>
        <tag>Minecraft</tag>
      </tags>
  </entry>
  <entry>
    <title>Git常用命令</title>
    <url>/caff8000.html</url>
    <content><![CDATA[<h2 id="git文件管理系统">Git文件管理系统</h2>
<blockquote>
<p>本博客为转载，原文地址<a
href="https://www.cnblogs.com/chenwolong/p/GIT.html">https://www.cnblogs.com/chenwolong/p/GIT.html</a></p>
</blockquote>
<p><img
src="https://download.kezhi.tech/img/20200424230007.png?x-oss-process=style/webp" /></p>
<span id="more"></span>
<blockquote>
<ul>
<li>Workspace：工作区</li>
<li>Index / Stage：暂存区</li>
<li>Repository：仓库区（或本地仓库）</li>
<li>Remote：远程仓库</li>
</ul>
</blockquote>
<h2 id="新建代码仓库">新建代码仓库</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">$ git clone [url]</span><br></pre></td></tr></table></figure>
<h2 id="配置">配置</h2>
<p>Git的设置文件为<code>.gitconfig</code>，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示当前的Git配置</span></span><br><span class="line">$ git config --<span class="built_in">list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Git配置文件</span></span><br><span class="line">$ git config -e [--<span class="keyword">global</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">$ git config [--<span class="keyword">global</span>] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--<span class="keyword">global</span>] user.email <span class="string">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="增加删除文件">增加/删除文件</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">$ git add [<span class="built_in">dir</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>
<h2 id="代码提交">代码提交</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区的指定文件到仓库区</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>
<h2 id="分支">分支</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支和远程分支</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向指定commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个commit，合并进当前分支</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地存在一个分支，名称叫：develop_chen，但远程没有怎么办？</span></span><br><span class="line">$ git push origin develop_chen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这样就在远程建立一个和本地一样的分支</span></span><br><span class="line"></span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream-to=origin/develop  develop  本地分支和远程分支简历跟踪关系</span><br></pre></td></tr></table></figure>
<h2 id="标签">标签</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列出所有tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在当前commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在指定commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看tag信息</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交指定tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向某个tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>
<h2 id="查看信息">查看信息</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">$ git log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">$ git log --stat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索提交历史，根据关键词</span></span><br><span class="line">$ git log -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line">$ git log [tag] HEAD --pretty=<span class="built_in">format</span>:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class="line">$ git log [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">$ git log --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">$ git log -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示过去5次提交</span></span><br><span class="line">$ git log -<span class="number">5</span> --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和工作区的代码差异</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和上一个commit的差异</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两次提交之间的差异</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示今天你写了多少行代码</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交的元数据和内容变化</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交发生变化的文件</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交时，某个文件的内容</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的最近几次提交</span></span><br><span class="line">$ git reflog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从本地master拉取代码更新当前分支：branch 一般为master</span></span><br><span class="line">$ git rebase [branch]</span><br></pre></td></tr></table></figure>
<h2 id="远程同步">远程同步</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git remote update  --更新远程仓储</span><br><span class="line"><span class="comment"># 下载远程仓库的所有变动</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有远程仓库</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个远程仓库的信息</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个新的远程仓库，并命名</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支到远程仓库</span></span><br><span class="line">$ git push [remote] --<span class="built_in">all</span></span><br></pre></td></tr></table></figure>
<h2 id="撤销">撤销</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的所有文件到工作区</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个commit，用来撤销指定commit</span></span><br><span class="line"><span class="comment"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>
<h2 id="其他">其他</h2>
<ol type="1">
<li>将开发分支代码合入到master中</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git checkout dev           <span class="comment">#切换到dev开发分支</span></span><br><span class="line">$ git pull</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git merge dev              <span class="comment">#合并dev分支到master上</span></span><br><span class="line">$ git push origin master     <span class="comment">#将代码推到master上</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>将master的代码同步更新到开发分支中。merge方法：保证主干提交线干净(可以安全回溯)</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git checkout dev           <span class="comment">#切换到dev开发分支</span></span><br><span class="line">$ git pull</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git merge dev              <span class="comment">#合并dev分支到master上</span></span><br><span class="line">$ git push origin master     <span class="comment">#将代码推到master上</span></span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>生成可被发布的压缩包</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成一个可供发布的压缩包</span></span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>命令行</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo本地写作环境配置</title>
    <url>/315fc17e.html</url>
    <content><![CDATA[<h2 id="写作缘由">写作缘由</h2>
<p>由于经常换电脑设备，每次更换设备时都需要重新配置Hexo环境，故对配置流程进行记录，以供后续使用。</p>
<span id="more"></span>
<h2 id="本地环境搭建">本地环境搭建</h2>
<ol type="1">
<li><p>安装node.js （这里最好安装版本 v12
否则可能出现部署不成功的情况）</p>
<p>window 安装：<a href="https://nodejs.org/en/download/">Download |
Node.js (nodejs.org)</a></p>
<p>Linux 安装：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install nodejs</span><br><span class="line">$ sudo apt-get install npm</span><br></pre></td></tr></table></figure>
<p>安装完成后输入以下命令检查是否安装成功：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">$ npm -v</span><br></pre></td></tr></table></figure></li>
<li><p>安装Hexo</p>
<p>首先修改 npm 到国内源：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm config <span class="built_in">set</span> registry http://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<p>输入以下命令进行确认：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$npm</span> get registry</span><br></pre></td></tr></table></figure>
<p>在 Blog 所在文件夹根目录打开命令行，输入以下命令强制安装Hexo：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$npm</span> install -g hexo-cli --force</span><br></pre></td></tr></table></figure>
<p>安装完成后输入以下命令检查是否安装成功：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$hexo</span> -v</span><br></pre></td></tr></table></figure>
<p>如果使用的是已有环境，则可以通过以下命令来自动安装环境所需包：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$npm</span> install --force</span><br></pre></td></tr></table></figure></li>
<li><p>安装pandoc
<code>typora</code>写作导出和<code>hexo</code>使用<code>pandoc</code>渲染时均需要使用<code>pandoc</code>（使用默认渲染引擎可以跳过这一步</p>
<p><code>pandoc</code>下载地址为：https://pandoc.org/installing.html</p></li>
</ol>
<h2 id="插件">插件</h2>
<h3 id="steam-展示">steam 展示</h3>
<p>项目链接：https://github.com/HCLonely/hexo-steam-games</p>
<ol type="1">
<li><p>安装插件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-steam-games --save</span><br></pre></td></tr></table></figure></li>
<li><p>配置<code>hexo</code>的<code>_config.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">steam:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">steamId:</span> <span class="string">&#x27;*****&#x27;</span> <span class="comment">#steam 64位Id</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Steam游戏库</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;人人都是头号玩家&#x27;</span></span><br><span class="line">  <span class="attr">tab:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">imgUrl:</span> <span class="string">&#x27;*****&#x27;</span></span><br><span class="line">  <span class="attr">proxy:</span></span><br><span class="line">    <span class="attr">host:</span></span><br><span class="line">    <span class="attr">port:</span></span><br><span class="line">  <span class="attr">extra_options:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">value</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>enable</strong>: 是否启用</li>
<li><strong>steamId</strong>: steam
64位Id(需要放在引号里面，不然会有BUG),
<strong><em>需要将steam库设置为公开！</em></strong></li>
<li><strong>path</strong>:
页面路径，默认<code>steamgames/index.html</code></li>
<li><strong>title</strong>: 该页面的标题</li>
<li><strong>quote</strong>: 写在页面开头的一段话,支持html语法</li>
<li><strong>tab</strong>: <code>all</code>或<code>recent</code>,
<code>all: 所有游戏</code>, <code>recent: 最近游玩的游戏</code></li>
<li><strong>length</strong>:
要显示游戏的数量，游戏太多的话可以限制一下</li>
<li><strong>imgUrl</strong>:
图片链接，在<code>quote</code>下面放一张图片，图片链接到Steam个人资料，可留空</li>
<li>proxy: 如果无法访问steam社区的话请使用代理
<ul>
<li><strong>host</strong>: 代理ip或域名</li>
<li><strong>port</strong>: 代理端口</li>
</ul></li>
<li><strong>extra_options</strong>:
此配置会扩展到Hexo的<code>page</code>变量中</li>
</ul></li>
<li><p>使用</p>
<ol type="1">
<li>在<code>hexo generate</code>或<code>hexo deploy</code>之前使用<code>hexo steam -u</code>命令更新steam游戏库数据！</li>
<li>删除游戏库数据指令:<code>hexo steam -d</code></li>
</ol></li>
</ol>
<h3 id="添加-bilibili-追番追剧列表">添加 Bilibili 追番/追剧列表</h3>
<p>参考自：https://opensourcelibs.com/lib/hexo-bilibili-bangumi</p>
<ol type="1">
<li><p>安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-bilibili-bangumi --save</span><br></pre></td></tr></table></figure></li>
<li><p>配置<code>hexo</code>的<code>_config.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 追番设置</span></span><br><span class="line"><span class="attr">bangumi:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">  <span class="attr">vmid:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;追番列表&#x27;</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;生命不息，追番不止！&#x27;</span></span><br><span class="line">  <span class="attr">show:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">loading:</span></span><br><span class="line">  <span class="attr">metaColor:</span></span><br><span class="line">  <span class="attr">color:</span></span><br><span class="line">  <span class="attr">webp:</span></span><br><span class="line">  <span class="attr">progress:</span></span><br><span class="line">  <span class="attr">extra_options:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">value</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追剧设置</span></span><br><span class="line"><span class="attr">cinema:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">  <span class="attr">vmid:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;追剧列表&#x27;</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;生命不息，追剧不止！&#x27;</span></span><br><span class="line">  <span class="attr">show:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">loading:</span></span><br><span class="line">  <span class="attr">metaColor:</span></span><br><span class="line">  <span class="attr">color:</span></span><br><span class="line">  <span class="attr">webp:</span></span><br><span class="line">  <span class="attr">progress:</span></span><br><span class="line">  <span class="attr">extra_options:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">value</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>enable</strong>: 是否启用</li>
<li><strong>path</strong>:
页面路径，默认<code>bangumis/index.html</code>,
<code>cinemas/index.html</code></li>
<li><strong>vmid</strong>: 哔哩哔哩的 <code>vmid(uid)</code>,<a
href="https://opensourcelibs.com/lib/hexo-bilibili-bangumi#获取uid">如何获取？</a></li>
<li><strong>title</strong>: 该页面的标题</li>
<li><strong>quote</strong>: 写在页面开头的一段话，支持 html
语法，可留空。</li>
<li><strong>show</strong>: 初始显示页面：<code>0: 想看</code>,
<code>1: 在看</code>, <code>2: 看过</code>，默认为<code>1</code></li>
<li><strong>lazyload</strong>:
是否启用图片懒加载，如果与主题的懒加载冲突请关闭，默认<code>true</code></li>
<li><strong>loading</strong>: 图片加载完成前的 loading
图片，需启用图片懒加载</li>
<li><strong>metaColor</strong>: meta 部分(简介上方)字体颜色</li>
<li><strong>color</strong>: 简介字体颜色</li>
<li><strong>webp</strong>:
番剧封面使用<code>webp</code>格式(此格式在<code>safari</code>浏览器下不显示，但是图片大小可以缩小
100 倍左右), 默认<code>true</code></li>
<li><strong>progress</strong>:
获取番剧数据时是否显示进度条，默认<code>true</code></li>
<li><strong>extra_options</strong>:
此配置会扩展到Hexo<code>page</code>变量中</li>
</ul></li>
<li><p>使用</p>
<ol type="1">
<li>在<code>hexo generate</code>或<code>hexo deploy</code>之前使用<code>hexo bangumi -u</code>命令更新追番数据，使用<code>hexo cinema -u</code>命令更新追剧数据！</li>
<li>删除数据命令:<code>hexo bangumi -d</code>/<code>hexo cinema -d</code></li>
</ol></li>
</ol>
<h2 id="小结">小结</h2>
<p>以上步骤结束后一般即可以进行写作和部署，若依然存在问题可以访问<a
href="https://hexo.io/docs/troubleshooting.html">Troubleshooting |
Hexo</a>进行错误排查。</p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>node.js</tag>
      </tags>
  </entry>
  <entry>
    <title>Policy Optimization</title>
    <url>/309dbe23.html</url>
    <content><![CDATA[<p>本文主要对基于策略优化定理的强化学习算法及相关变体进行一个梳理和总结。</p>
<p><img src="https://download.kezhi.tech/img/202312181919546.jpg?x-oss-process=style/webp" style="width:66%;" /></p>
<span id="more"></span>
<h2 id="preliminaries">Preliminaries</h2>
<p>一个马尔可夫决策过程（Markov decision process, MDP）可以由五元组
<span
class="math inline">\(&lt;\mathcal{S},\mathcal{A},\mathcal{R},\mathcal{T},\gamma,\rho_0&gt;\)</span>
定义，其中：</p>
<ul>
<li><span class="math inline">\(\mathcal{S}\)</span>
表示状态空间，是由状态构成的集合</li>
<li><span class="math inline">\(\mathcal{A}\)</span>
表示动作空间，是由动作构成的集合</li>
<li><span
class="math inline">\(\mathcal{R}:\mathcal{S}\times\mathcal{A}\rightarrow
\mathbb{R}\)</span> 表示奖励函数，<span
class="math inline">\(\mathcal{R} (s,a)\)</span> 表示在状态 <span
class="math inline">\(s\)</span> 下执行动作 <span
class="math inline">\(a\)</span> 获得的奖励</li>
<li><span class="math inline">\(\mathcal{T}:
\mathcal{S}\times\mathcal{A}\times\mathcal{S}\rightarrow[0,1]\)</span>
表示状态转移概率函数，<span
class="math inline">\(\mathcal{T}(s&#39;|s,a)\)</span> 表示在状态 <span
class="math inline">\(s\)</span> 下执行动作 <span
class="math inline">\(a\)</span> 到达状态<span
class="math inline">\(s&#39;\)</span> 的概率</li>
<li><span class="math inline">\(\gamma\)</span> 表示折扣因子</li>
<li><span
class="math inline">\(\rho_0:\mathcal{S}\rightarrow[0,1]\)</span>
表示状态初始分布</li>
</ul>
<p>Agent 的决策过程由一个随机策略 <span
class="math inline">\(\pi:\mathcal{S}\times\mathcal{A}\rightarrow[0,1]\)</span>
表示，<span class="math inline">\(\pi(a|s)\)</span> 表示 agent 在状态
<span class="math inline">\(s\)</span> 下选择动作 <span
class="math inline">\(a\)</span> 的概率。基于策略 <span
class="math inline">\(\pi\)</span> 可以定义出状态价值函数： <span
class="math display">\[
\begin{equation} \label{v}
V_\pi(s)=\mathbb{E}\left[\sum_{t=0}^\infty
\gamma^t\mathcal{R}(s_t,a_t)|\pi,s\right]
\end{equation}
\]</span> 状态动作价值函数： <span class="math display">\[
\begin{equation}    \label{q}
Q_\pi(s,a) =
\mathcal{R}(s,a)+\gamma\mathbb{E}_{s&#39;\sim\mathcal{T}(\cdot|s,a)}[V_\pi(s&#39;)]
\end{equation}
\]</span></p>
<p>优势函数： <span class="math display">\[
\begin{equation}    \label{adv}
A_\pi(s,a) = Q_\pi(s,a)-V_\pi(s)
\end{equation}
\]</span> Agent 的优化目标通常为最大化在初始状态分布上的折扣汇报，即：
<span class="math display">\[
\begin{equation} \label{eta}
\eta(\pi) = \mathbb{E}_{s\sim\rho_0}[V_\pi(s)]
\end{equation}
\]</span> 状态的折扣访问频率表示为： <span class="math display">\[
\begin{equation}    \label{rho-pi}
\rho_\pi(s)=(P(s_0=s)+\gamma P(s_1=s)+\gamma^2 P(s_2=s)+...)
\end{equation}
\]</span></p>
<p>策略梯度定理： <span class="math display">\[
\begin{equation} \label{policy-gradient}
\nabla \eta(\pi) = \sum_{s,a}\rho_\pi(s)\nabla \pi(a|s)Q_\pi(s,a)
\end{equation}
\]</span></p>
<h2
id="approximately-optimal-approximate-reinforcement-learning">Approximately
Optimal Approximate Reinforcement Learning</h2>
<p>Kakade, S. &amp; Langford, J. Approximately Optimal Approximate
Reinforcement Learning. in <em>Proceedings of the Nineteenth
International Conference on Machine Learning</em> 267–274 (Morgan
Kaufmann Publishers Inc., 2002).</p>
<p>本文提出了三个想要回答的问题：</p>
<ol type="1">
<li>是否存在性能度量可以保证每一步更新都有提升？</li>
<li>验证某个更新提升该性能度量有多么困难？</li>
<li>在一定合理的次数的策略更新后，策略性能能达到什么样的水平？</li>
</ol>
<p>考虑如下保守策略更新规则： <span class="math display">\[
\begin{equation}
\pi_{new}(a|s)=(1-\alpha)\pi(a|s)+\alpha\pi&#39;(a|s)
\end{equation}
\]</span> 其中，<span
class="math inline">\(\alpha\in[0,1]\)</span>，如果要在 <span
class="math inline">\(\alpha=1\)</span> 时保证策略提升，那么 <span
class="math inline">\(\pi&#39;\)</span> 需要在每个状态下都采取比 <span
class="math inline">\(\pi\)</span> 更好的动作。考虑 <span
class="math inline">\(0&lt;\alpha &lt;1\)</span> 时，策略提升只需要
<span class="math inline">\(\pi&#39;\)</span>
在大部分而非全部状态选择更好的动作。定义策略优势 <span
class="math inline">\(\mathbb{A}_{\pi,\rho_0}(\pi&#39;)\)</span> 为
<span class="math display">\[
\mathbb{A}_{\pi,\rho_0}(\pi&#39;)=\mathbb{E}_{s\sim\rho_\pi}\left[\mathbb{E}_{a\sim\pi&#39;(\cdot|s)}[A_\pi(s,a)]\right]
\]</span> 该策略优势函数衡量了在状态初始分布为 <span
class="math inline">\(\rho_0\)</span>，行动策略为 <span
class="math inline">\(\pi\)</span> 时，<span
class="math inline">\(\pi&#39;\)</span> 选择具有更大优势动作的程度。对于
<span class="math inline">\(\alpha=0\)</span> 时，显然有 <span
class="math inline">\(\frac{\partial \eta}{\partial
\alpha}\big|_{\alpha=0}=\frac{1}{1-\gamma}\mathbb{A}_{\pi,\rho_0}\)</span></p>
<p>to be continue......</p>
<h2 id="trpo">TRPO</h2>
<p>Schulman, J., Levine, S., Moritz, P., Jordan, M. &amp; Abbeel, P.
Trust region policy optimization. in <em>Proceedings of the 32nd
International Conference on International Conference on Machine Learning
- Volume 37</em> 1889–1897 (JMLR.org, 2015).</p>
<p>策略优势定理： <span class="math display">\[
\begin{equation} \label{policy-improve}
\eta(\tilde\pi)=\eta(\pi)+\mathbb{E}_{s_0\sim\rho_0,a\sim\tilde\pi(\cdot|s),s&#39;\sim\mathcal{T}(\cdot|s,a)}\left[\sum_{t=1}^{\infty}\gamma^tA_\pi(s_t,a_t)\right]
\end{equation}
\]</span> 证明如下（为方便书写，省略期望下标中的 <span
class="math inline">\(s_0\sim\rho_0,s&#39;\sim\mathcal{T}(\cdot|s,a)\)</span>，<span
class="math inline">\(a\sim\pi(\cdot|s)\)</span> 简写为 <span
class="math inline">\(a\sim\pi\)</span>）： <span
class="math display">\[
\begin{align}   \label{proof-policy-improve}
&amp;\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^tA_\pi(s_t,a_t)\right]\\    \notag
&amp;=\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t\left[Q_\pi(s_t,a_t)-V_\pi(s_t)\right]\right]\\   \notag
&amp;=
\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t\left[r_t+\gamma
V_\pi(s_{t+1})-V_\pi(s_t)\right]\right]\\   \notag
&amp;= \mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t
r_t\right]+\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^{t+1}
V_\pi(s_{t+1})\right]-\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t
V_\pi(s_t)\right]\\  \notag
&amp;=\eta(\tilde\pi)-\mathbb{E}_{a\sim\tilde\pi}[V_\pi(s_0)]\\ \notag
&amp;=\eta(\tilde\pi)-\eta(\pi)
\end{align}
\]</span></p>
<p>根据式 <span class="math inline">\(\ref{rho-pi}\)</span> ，式 <span
class="math inline">\(\ref{policy-improve}\)</span>
表明也可以写为以下形式： <span class="math display">\[
\begin{equation}    \label{policy-improve-2}
\eta(\tilde\pi)=\eta(\pi)+\sum_s\rho_{\tilde\pi}(s)\sum_a\tilde\pi(a|s)A_\pi(s,a)
\end{equation}
\]</span> 根据式 <span
class="math inline">\(\ref{policy-improve-2}\)</span>，如果对于每一个状态
<span class="math inline">\(s\)</span>，使 <span
class="math inline">\(\sum_a\tilde\pi(a|s)A_\pi(s,a)\geq
0\)</span>，那么就保证了新策略是比旧策略好的。然而，式 <span
class="math inline">\(\ref{policy-improve-2}\)</span> 对于 <span
class="math inline">\(\rho_{\tilde\pi}\)</span>
的依赖导致在实际优化过程中无法直接计算，由此，考虑下面对 <span
class="math inline">\(\eta\)</span> 的局部估计： <span
class="math display">\[
\begin{equation} \label{surrogate-improve}
L_\pi(\tilde\pi)
=\eta(\pi)+\sum_s\rho_{\pi}(s)\sum_a\tilde\pi(a|s)A_\pi(s,a)
\end{equation}
\]</span> <span class="math inline">\(L_\pi(\tilde\pi)\)</span> 和 <span
class="math inline">\(\eta(\tilde\pi)\)</span> 唯一的区别在于把 <span
class="math inline">\(\rho_{\tilde\pi}\)</span> 换为了 <span
class="math inline">\(\rho_{\pi}\)</span>，接下来对 <span
class="math inline">\(L_\pi(\tilde\pi)\)</span>
进行分析。若有一参数化的策略<span
class="math inline">\(\pi_\theta\)</span> 且对 <span
class="math inline">\(\theta\)</span> 可微，则有： <span
class="math display">\[
L_{\pi_{\theta_0}}(\pi_{\theta_0})=\eta(\pi_{\theta_0})\\
\nabla_\theta
L_{\pi_{\theta_0}}(\pi_{\theta})\big|_{\theta=\theta_0}=\nabla_\theta\eta(\pi_{\theta})\big|_{\theta=\theta_0}
\]</span> 因此，如果 <span class="math inline">\(\pi\)</span>
更新的足够小，则提升 <span class="math inline">\(L_\pi\)</span> 也会提升
<span class="math inline">\(\eta\)</span>，考虑如下策略更新： <span
class="math display">\[
\tilde\pi(a|s)=(1-\alpha)\pi(a|s)+\alpha\pi&#39;(a|s)
\]</span> 其中，<span
class="math inline">\(\pi&#39;=\arg\max_{\pi&#39;}L_\pi(\tilde\pi)\)</span>，从而有（证明见
<a
href="https://people.eecs.berkeley.edu/~pabbeel/cs287-fa09/readings/KakadeLangford-icml2002.pdf"
title="Approximately Optimal Approximate Reinforcement Learning">(Kakade
&amp; Langford, 2002)</a>）： <span class="math display">\[
\eta(\tilde\pi)\geq
L_{\pi}(\tilde\pi)-\frac{2\epsilon\gamma}{(1-\gamma(1-\alpha))(1-\gamma)}\alpha^2
\]</span> 其中 <span class="math inline">\(\epsilon =
\max_s|\mathbb{E}_{a\sim\tilde\pi(\cdot|s)}A_\pi(s,a)|\)</span></p>
<p>当 <span class="math inline">\(\alpha\)</span> 足够小的时候则有：
<span class="math display">\[
\begin{equation} \label{surrogate-bound}
\eta(\tilde\pi)\geq
L_{\pi}(\tilde\pi)-\frac{2\epsilon\gamma}{(1-\gamma)^2}\alpha^2
\end{equation}
\]</span> 令 <span class="math inline">\(\alpha =
D_{TV}^\max(\pi,\tilde\pi)\)</span>，<span
class="math inline">\(\epsilon = \max_s\max_aA_\pi(s,a)\)</span>，则式
<span class="math inline">\(\ref{surrogate-bound}\)</span>
依然成立，证明见 <a href="trpo">(Schulman et al., 2015)</a>。考虑到
<span class="math inline">\(D_{TV}(p||q)^2\leq
D_{KL}(p||q)\)</span>，则有： <span class="math display">\[
\begin{equation} \label{}
\eta(\tilde\pi)\geq L_{\pi}(\tilde\pi)-CD_{KL}^\max(\pi,\tilde\pi)
\end{equation}
\]</span> 令 <span class="math inline">\(M_i(\pi) =
L_{\pi_i}(\pi)-CD_{KL}^\max(\pi,\tilde\pi)\)</span>，则有： <span
class="math display">\[
M_i(\pi_i)=\eta(\pi_i)\\
M_i(\pi_{i+1})\leq \eta(\pi_{i+1})\\
M_i(\pi_{i+1})-M_i(\pi_i)\leq \eta(\pi_{i+1})-\eta(\pi_i)
\]</span> 因此，如果最大化 <span
class="math inline">\(M_i(\pi)\)</span>，则 <span
class="math inline">\(\eta(\pi)\)</span>
也会随之不断提升，对于参数化的策略 <span
class="math inline">\(\pi_\theta\)</span>，策略优化问题便可以转换为下面的优化问题：
<span class="math display">\[
\max_\theta\left[L_{\theta_{old}}(\theta)-CD_{KL}^\max(\theta_{old},\theta)\right]
\]</span> 转换为信赖域约束的形式为： <span class="math display">\[
\begin{align}
&amp; \max_\theta L_{\theta_{old}}(\theta)\\
&amp;s.t.   D_{KL}^\max(\theta_{old},\theta)\leq \delta
\end{align}
\]</span></p>
<p>上述优化稳定的约束很难进行技术员，可以使用平均 <span
class="math inline">\(KL\)</span> 散度作为对该约束启发式的估计： <span
class="math display">\[
\bar D^\rho_{KL}(\theta_{1},\theta_2) =
\mathbb{E}_{s\sim\rho}[D_{KL}(\pi_{\theta_1}(\cdot|s)||\pi_{\theta_2}(\cdot|s))]
\]</span> 在采样估计时有如下形式： <span class="math display">\[
\begin{align}
&amp;\max_\theta \sum_s \rho_{\theta_{old}}\sum_a
\pi_\theta(a|s)A_{\theta_{old}}(s,a)\\
&amp;s.t. \bar D^{\rho_{\theta_{old}}}_{KL}(\theta_{old},\theta)\leq
\delta
\end{align}
\]</span> 使用重要性采样（Importance Samping）可得： <span
class="math display">\[
\sum_a \pi_\theta(a|s)A_{\theta_{old}}(s,a) =
\mathbb{E}_{a\sim\pi_{\theta_{old}}}\left[\frac{\pi_\theta(a|s)}{\pi_{\theta_{old}}(a|s)}A_{\theta_{old}}(s,a)\right]
\]</span> 从而得到TRPO的优化目标： <span class="math display">\[
\begin{align}
&amp;\max_\theta \mathbb{E}_{s\sim
\rho_{\theta_{old}},\  a\sim\pi_{\theta_{old}}}\left[\frac{\pi_\theta(a|s)}{\pi_{\theta_{old}}(a|s)}A_{\theta_{old}}(s,a)\right]\\
&amp;s.t.\mathbb{E}_{s\sim
\rho_{\theta_{old}}}[D_{KL}(\pi_{\theta_{old}}(\cdot|s)||\pi_\theta(\cdot|s))]
\end{align}
\]</span></p>
<h2 id="ppo">PPO</h2>
<p>Schulman, J., Wolski, F., Dhariwal, P., Radford, A. &amp; Klimov, O.
Proximal Policy Optimization Algorithms. Preprint at
http://arxiv.org/abs/1707.06347 (2017).</p>
<p>TRPO的优化目标为： <span class="math display">\[
\begin{align}
&amp;\max_\theta \mathbb{E}_{s\sim
\rho_{\theta_{old}},\  a\sim\pi_{\theta_{old}}}\left[\frac{\pi_\theta(a|s)}{\pi_{\theta_{old}}(a|s)}A_{\theta_{old}}(s,a)\right]\\
&amp;s.t.\mathbb{E}_{s\sim
\rho_{\theta_{old}}}[D_{KL}(\pi_{\theta_{old}}(\cdot|s)||\pi_\theta(\cdot|s))]
\end{align}
\]</span> 将约束转换为一个惩罚项，即可将该优化问题转换为无约束优化 <span
class="math display">\[
\max_\theta \mathbb{E}_{s\sim
\rho_{\theta_{old}},\  a\sim\pi_{\theta_{old}}}\left[\frac{\pi_\theta(a|s)}{\pi_{\theta_{old}}(a|s)}A_{\theta_{old}}(s,a)-\beta
D_{KL}(\pi_{\theta_{old}}(\cdot|s)||\pi_\theta(\cdot|s))\right]
\]</span> 令 <span
class="math inline">\(r_t(\theta)=\frac{\pi_\theta(a_t|s_t)}{\pi_{\theta_{old}}(a_t|s_t)}\)</span>，则<span
class="math inline">\(r_t(\theta_{old})=1\)</span>，TRPO的近似优化目标为：
<span class="math display">\[
L^{CPI}(\theta) =\mathbb{E}_t\left[r_t(\theta)\hat A_t\right]
\]</span> 在无约束的情况下，<span class="math inline">\(L^{CPI}\)</span>
可能会导致一次优化产生很大的策略更新，为此，约束 <span
class="math inline">\(r_t(\theta)\)</span> 在 1 附近来限制优化幅度：
<span class="math display">\[
L^{CLIP}(\theta) =\mathbb{E}_t\left[\min(r_t(\theta)\hat
A_t,\text{clip}(r_t(\theta),1-\epsilon,1+\epsilon)\hat A_t\right]
\]</span></p>
<h2 id="impala">IMPALA</h2>
<p>Espeholt, L. <em>et al.</em> IMPALA: Scalable Distributed Deep-RL
with Importance Weighted Actor-Learner Architectures. in <em>Proceedings
of the 35th International Conference on Machine Learning</em> 1407–1416
(PMLR, 2018).</p>
<p>IMPALA 采用异步收集经验的方式来提高采样效率，使用 V-trace
解决采样策略和更新策略不一致的问题。</p>
<p><img src="https://download.kezhi.tech/img/202312181717935.png" /></p>
<h3 id="v-trace-target">V-trace Target</h3>
<p><span class="math display">\[
v_t=V(s_t)+\sum_{\tau=t}^{t+n-1}\gamma^{\tau-t}(\prod_{i=t}^{\tau-1}c_i)\delta_\tau
V
\]</span></p>
<p>其中，<span class="math inline">\(\delta_\tau
V=\rho_\tau(r_\tau+\gamma V(s_{\tau+1})-V(s_\tau))\)</span>，<span
class="math inline">\(\rho_\tau=\min(\bar\rho,\frac{\pi(a_\tau|s_\tau)}{\mu(a_\tau|s_\tau)})\)</span>，<span
class="math inline">\(c_i=\min(\bar
c,\frac{\pi(a_i|s_i)}{\mu(a_i|s_i)})\)</span>，规定当<span
class="math inline">\(t=\tau\)</span>时，<span
class="math inline">\(\prod_{i=t}^{\tau-1}c_i=1\)</span>，此外<span
class="math inline">\(\bar\rho\geq\bar c\)</span>，当<span
class="math inline">\(\pi=\mu\)</span>时，<span
class="math inline">\(\rho_\tau=1\)</span>且<span
class="math inline">\(c_i=1\)</span>，则上式转变为 on-policy n-step
<span class="math inline">\(TD\)</span>的形式： <span
class="math display">\[
\begin{align} \notag
v_t
&amp;=V(s_t)+\sum_{\tau=t}^{t+n-1}\gamma^{\tau-t}(r_\tau+\gamma
V(s_{\tau+1})-V(s_\tau)) \notag\\
&amp;=\sum_{\tau=t}^{t+n-1}\gamma^{\tau-t}r_\tau+\gamma^nV(s_{t+n})
\end{align}
\]</span></p>
<p>V-trace 可以由如下递归形式计算： <span class="math display">\[
v_t=V(s_t)+\delta_tV+\gamma c_t(v_{t+1}-V(s_{t+1}))
\]</span> 可以考虑给 <span class="math inline">\(c_i\)</span>
的计算中加入类似 <span class="math inline">\(Retrace(\lambda)\)</span>
的折扣系数 <span class="math inline">\(\lambda\in[0,1]\)</span>，得到
<span class="math inline">\(c_i=\lambda\min(\bar
c,\frac{\pi(a_i|s_i)}{\mu(a_i|s_i)})\)</span>，在 on-policy 场景下，当
<span class="math inline">\(n=\infty\)</span> 时，V-trace 变为 <span
class="math inline">\(TD(\lambda)\)</span></p>
<h2 id="off-policy-trpo">Off-Policy TRPO</h2>
<p>Meng, W., Zheng, Q., Shi, Y. &amp; Pan, G. An Off-Policy Trust Region
Policy Optimization Method With Monotonic Improvement Guarantee for Deep
Reinforcement Learning. <em>IEEE Transactions on Neural Networks and
Learning Systems</em> <strong>33</strong>, 2223–2235 (2022).</p>
<p>策略优势定理为<span
class="math inline">\(\ref{policy-improve}\)</span>，在 TRPO 中使用其
on-policy 的近似形式 <span
class="math inline">\(\ref{surrogate-improve}\)</span>，两者的区别在于
TRPO 使用了近似状态分布 <span class="math inline">\(\rho_\pi\)</span>
替代策略分布 <span
class="math inline">\(\rho_{\tilde\pi}\)</span>。Off-policy TRPO
更进一步，采用行为策略 <span class="math inline">\(\mu\)</span>
来进行经验收集更新策略 <span
class="math inline">\(\pi\)</span>，从而提出新的近似形式： <span
class="math display">\[
\begin{equation}
L_{\pi,\mu}(\tilde\pi)=\eta(\pi)+\sum_s\rho_\mu(s)\sum_a\tilde\pi(a|s)A_\pi(s,a)
\end{equation}
\]</span> 由该近似推出 off-policy 的优化目标： <span
class="math display">\[
\begin{align} \notag
&amp; \max_\theta
\mathbb{E}_{s\sim\rho_\mu,a\sim\mu}\left[\frac{\pi_\theta(a|s)}{\mu(a|s)}A_{\pi_{\theta_{old}}}(s,a)\right]\\
&amp; s.t.\bar
D_{KL}^{\rho_\mu,sqrt}(\mu,\theta_{old})D_{KL}^{\rho_\mu,sqrt}(\theta_{old},\theta)+D_{KL}^{\rho_\mu}(\theta_{old},\theta)\leq
\delta
\end{align}
\]</span> 详细证明见<a
href="https://ieeexplore.ieee.org/document/9334437"
title="An Off-Policy Trust Region Policy Optimization Method With Monotonic Improvement Guarantee for Deep Reinforcement Learning">(Meng
et al., 2022)</a></p>
<h2 id="off-policy-ppo">Off-Policy PPO</h2>
<p>Meng, W., Zheng, Q., Pan, G. &amp; Yin, Y. Off-Policy Proximal Policy
Optimization. <em>Proceedings of the AAAI Conference on Artificial
Intelligence</em> <strong>37</strong>, 9162–9170 (2023).</p>
<p>off-policy trpo 的 clip 近似形式，使用如下 clipped surrogate object：
<span class="math display">\[
L^{\text{CLIP}}_{\text{Off-Policy}}=\mathbb{E}_{s\sim\rho_\mu,a\sim\mu}\left[\min[r(s,a)A_{\pi_{old}}(s,a),
\text{clip}(r(s,a),l(s,a),h(s,a)),\hat A_{\pi_{old}}(s,a)]\right]
\]</span> 其中 <span
class="math inline">\(r(s,a)=\frac{\pi(a|s)}{\mu(a|s)}\)</span>，<span
class="math inline">\(l(s,a)=\frac{\pi_{old}(a|s)}{\mu(a|s)}(1-\epsilon)\)</span>，<span
class="math inline">\(h(s,a)=\frac{\pi_{old}(a|s)}{\mu(a|s)}(1+\epsilon)\)</span></p>
<p>详见<a href="https://ojs.aaai.org/index.php/AAAI/article/view/26099"
title="Off-Policy Proximal Policy Optimization">(Meng et al.,
2023)</a></p>
<h2 id="behavior-ppo">Behavior PPO</h2>
<p>Zhuang, Z., Lei, K., Liu, J., Wang, D. &amp; Guo, Y. Behavior
Proximal Policy Optimization. in <em>Proceedings of the eleventh
International Conference on Learning Representation</em> (2023).</p>
<blockquote>
<p>在线同策略算法天然可以解决离线强化学习问题</p>
</blockquote>
<p>该工作的架构为 BC（行为克隆）+RL（强化学习），RL部分通过保守更新和
<span class="math inline">\(\epsilon\)</span> 来实现在 offline dataset
上的多步更新。</p>
<p>根据 <span class="math inline">\(\ref{policy-improve}\)</span>
策略优势可写为： <span class="math display">\[
J_\Delta
(\pi,\hat\pi_\beta)=\mathbb{E}_{s\sim\rho_{\pi},a\sim\pi(\cdot|s)}[A_{\hat\pi_\beta}(s,a)]
\]</span> 其中，<span class="math inline">\(\hat \pi_\beta\)</span>
为行为策略（behavior policy，可以从 dataset 通过行为克隆学习）</p>
<p>提出其在 offline dataset <span
class="math inline">\(\mathcal{D}\)</span> 上的近似形式为： <span
class="math display">\[
\hat J_\Delta
(\pi,\hat\pi_\beta)=\mathbb{E}_{s\sim\rho_{\mathcal{D}},a\sim\pi(\cdot|s)}[A_{\hat\pi_\beta}(s,a)]
\]</span> 两者之间的差距为： <span class="math display">\[
\begin{align} \notag
J_\Delta (\pi,\hat\pi_\beta)\geq &amp;\hat J_\Delta
(\pi,\hat\pi_\beta)\\ \notag
&amp;-4\gamma\mathbb{A}_{\hat\pi_\beta}\cdot\max_s
D_{TV}(\pi||\hat\pi_\beta)[s]\cdot\mathbb{E}_{s\sim\rho_{\hat\pi_\beta}(\cdot)}[D_{TV}(\pi||\hat\pi_\beta)[s]]
\\ \label{behavior-theorem-1}
&amp;-2\gamma\mathbb{A}_{\hat\pi_\beta}\cdot\max_s
D_{TV}(\pi||\hat\pi_\beta)[s]\cdot\mathbb{E}_{s\sim\rho_{\mathcal{D}}(\cdot)}[1-\hat\pi_\beta(a|s)]
\end{align}
\]</span> 其中，<span
class="math inline">\(\mathbb{A}_{\hat\pi_\beta}=\max_{s,a}|A_{\hat\pi_\beta}(s,a)|\)</span>，详细证明见<a
href="https://openreview.net/forum?id=3c13LptpIph"
title="Behavior Proximal Policy Optimization">(Zhuang et al.,
2023)</a>。由式 <span
class="math inline">\(\ref{behavior-theorem-1}\)</span>
可知，要保证优化目标 <span class="math inline">\(J_\Delta
(\pi,\hat\pi_\beta)\)</span> 不下降，应该在最大化 <span
class="math inline">\(\mathbb{E}_{s\sim\rho_{\mathcal{D}},a\sim\pi(\cdot|s)}[A_{\hat\pi_\beta}(s,a)]\)</span>
的同时最小化 <span class="math inline">\(\max_s
D_{TV}(\pi||\hat\pi_\beta)[s]\)</span>，由此便得到了从 <span
class="math inline">\(\hat\pi_\beta\)</span> 出发的单步更新。</p>
<p>考虑在离线数据集 <span class="math inline">\(\mathcal{D}\)</span>
上进行多步更新，即在 <span class="math inline">\(\pi_k\)</span>
的基础上优化得到 <span class="math inline">\(\pi_{k+1}\)</span>
，根据策略优势定理，优化目标为： <span class="math display">\[
J_\Delta(\pi,\pi_k)=\mathbb{E}_{s\sim\rho_{\pi},a\sim\pi(\cdot|s)}[A_{\pi_k}(s,a)]
\]</span></p>
<p>考虑状态从离线数据集 <span class="math inline">\(\mathcal{D}\)</span>
进行采样的如下近似形式： <span class="math display">\[
\hat
J_\Delta(\pi,\pi_k)=\mathbb{E}_{s\sim\rho_{\mathcal{D}},a\sim\pi(\cdot|s)}[A_{\pi_k}(s,a)]
\]</span> 两者之间的差距为： <span class="math display">\[
\begin{align} \notag
J_\Delta(\pi,\pi_k)\geq&amp;\hat J_\Delta(\pi,\pi_k)\\  \notag
&amp;-4\gamma\mathbb{A}_{k}\cdot\max_s
D_{TV}(\pi||\pi_k)[s]\cdot\mathbb{E}_{s\sim\rho_{\pi_k}(\cdot)}[D_{TV}(\pi||\pi_k)[s]]
\\ \notag
&amp;-4\gamma\mathbb{A}_{k}\cdot\max_s
D_{TV}(\pi||\pi_k)[s]\cdot\mathbb{E}_{s\sim\rho_{\hat\pi_\beta}(\cdot)}[D_{TV}(\pi_k||\hat\pi_\beta)[s]]
\\ \label{behavior-theorem-2}
&amp;-2\gamma\mathbb{A}_{\pi_k}\cdot\max_s
D_{TV}(\pi||\pi_k)[s]\cdot\mathbb{E}_{s\sim\rho_{\mathcal{D}}(\cdot)}[1-\hat\pi_\beta(a|s)]
\end{align}
\]</span> 其中，<span
class="math inline">\(\mathbb{A}_{\pi_k}=\max_{s,a}|A_{\pi_k}(s,a)|\)</span>，详细证明见<a
href="https://openreview.net/forum?id=3c13LptpIph"
title="Behavior Proximal Policy Optimization">(Zhuang et al.,
2023)</a>。由式 <span
class="math inline">\(\ref{behavior-theorem-2}\)</span> 可知，若保证
<span class="math inline">\(J_\Delta(\pi,\pi_k)\)</span>
非降，则需要在最大化 <span
class="math inline">\(\mathbb{E}_{s\sim\rho_{\mathcal{D}},a\sim\pi(\cdot|s)}[A_{\pi_k}(s,a)]\)</span>
的同时最小化 <span class="math inline">\(\mathbb{A}_{k}\cdot\max_s
D_{TV}(\pi||\pi_k)[s]\)</span>，从而实现在离线数据集 <span
class="math inline">\(\mathcal{D}\)</span> 上的多步更新。</p>
<p>上述结论可写为： <span class="math display">\[
\begin{align} \notag
&amp;\max_\pi
\mathbb{E}_{s\sim\rho_{\mathcal{D}},a\sim\pi(\cdot|s)}[A_{\pi_k}(s,a)]\\
\notag
&amp;s.t.\max_s D_{TV}(\pi||\pi_k)\leq \epsilon
\end{align}
\]</span> 经过一系列推导之后得到 clip 形式的无约束优化目标为： <span
class="math display">\[
L_k=\mathbb{E}_{s\sim\rho_{\mathcal{D}},a\sim\pi_k(\cdot|s)}\left[\min\left(\frac{\pi(a|s)}{\pi_k(a|s)}A_{\pi_k}(s,a),\text{clip}\left(\frac{\pi(a|s)}{\pi_k(a|s)},1-2\epsilon,
1+2\epsilon\right)A_{\pi_k}(s,a)\right)\right]
\]</span></p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>Policy Optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>PyTorch中的CrossEntropyLoss与交叉熵计算不一致</title>
    <url>/e295e676.html</url>
    <content><![CDATA[<p>本文主要对于交叉熵的手动计算和<code>PyTorch</code>中的<code>CrossEntropyLoss</code>模块计算结果不一致的问题展开讨论，查阅了<code>PyTorch</code>的官方文档，最终发现是<code>CrossEntropyLoss</code>在计算交叉熵之前会对输入的概率分布进行一次<code>SoftMax</code>操作导致的。</p>
<p><img src="https://download.kezhi.tech/img/202303041402037.jpg?x-oss-process=style/webp" width=61.8% /></p>
<span id="more"></span>
<p>在强化学习中，策略学习常用到一个损失函数为<span
class="math inline">\(l=-\ln\pi_\theta(a|s)\cdot g\)</span>，其中<span
class="math inline">\(\pi_\theta\)</span>在状态<span
class="math inline">\(s\)</span>下是关于动作的一个概率分布，而动作<span
class="math inline">\(a\)</span>是经验中记录的，在状态<span
class="math inline">\(s\)</span>下选择的确定动作。因此有： <span
class="math display">\[
-\ln\pi_\theta(a|s) = -\sum_{a&#39;\in A}p(a&#39;)\cdot \ln q(a&#39;)
\]</span> <span class="math display">\[
p(a&#39;) = \left\{
             \begin{array}{lr}
             1 &amp;&amp;&amp; a&#39;=a\\
             0 &amp;&amp;&amp; otherwise
             \end{array}
\right.
\]</span></p>
<p><span class="math display">\[
q(a&#39;) = \pi_\theta(a&#39;|s)
\]</span></p>
<p>因此，该损失函数便被转换为了计算两个概率分布之间交叉熵的计算形式。从而可以想到，在使用<code>PyTorch</code>计算损失函数时，使用内置的<code>torch.nn.functional.cross_entropy</code>函数（下文简称为<code>F.cross_entropy</code>函数）来进行计算。然而，在实践过程中，发现使用该函数计算出的结果与手动计算出的结果不一致，由此展开了一系列调研。</p>
<h2 id="不一致的计算结果">不一致的计算结果</h2>
<p>首先，我们使用<code>Python</code>分别以手动计算和使用<code>F.cross_entropy</code>函数计算两组数据的交叉熵，代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">x = torch.FloatTensor([[<span class="number">0.4</span>, <span class="number">0.6</span>],</span><br><span class="line">                       [<span class="number">0.7</span>, <span class="number">0.3</span>]])</span><br><span class="line">y = torch.LongTensor([<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">loss_1 = -torch.log(x.gather(<span class="number">1</span>, y.view(-<span class="number">1</span>,<span class="number">1</span>)))</span><br><span class="line">loss_2 = F.cross_entropy(x, y, reduction = <span class="string">&quot;none&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;手动计算出的交叉熵：\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_1.squeeze(<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CrossEntropyLoss计算出的交叉熵：\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_2))</span><br></pre></td></tr></table></figure>
<p>运行上述代码，得到的计算结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">手动计算出的交叉熵：</span><br><span class="line">tensor([0.9163, 1.2040])</span><br><span class="line"></span><br><span class="line">CrossEntropyLoss计算出的交叉熵：</span><br><span class="line">tensor([0.7981, 0.9130])</span><br></pre></td></tr></table></figure>
<p>从运行结果可以看出，两者的计算结果并不一致，由此，我查阅了PyTorch官方文档来了解<code>F.cross_entropy</code>的实现。</p>
<h2 id="pytorch-文档描述">PyTorch 文档描述</h2>
<p>文档中关于<code>F.cross_entropy</code>函数的描述中并没有包含具体的计算过程，只对输入数据和输出结果的维度对应关系作了解释<a
href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>。不过在该函数的介绍中有这么一句话：</p>
<blockquote>
<p>See <a
href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html#torch.nn.CrossEntropyLoss"><code>CrossEntropyLoss</code></a>
for details.</p>
</blockquote>
<p>于是便转而查找<code>CrossEntropyLoss</code>的文档<a href="#fn2"
class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a>，终于找到了<code>Pytorch</code>计算交叉熵的计算过程：</p>
<p><img
src="https://download.kezhi.tech/img/202303041333317.png?x-oss-process=style/webp" /></p>
<p>可以看到，官方文档关于交叉熵的计算方式阐述的十分清楚。概括来说就是，<code>F.cross_entropy</code>至少需要两个参数，一个是预测出的概率分布，一个是目标真实类别索引。比较重要的一点在于，<code>F.cross_entropy</code>这个函数是没有要求的，即不要求和等于1，也不要求每一项大于0。这是因为该函数在计算交叉熵之间，会先对输入的概率分布进行一次<code>SoftMax</code>操作。</p>
<p>在计算交叉熵之前进行<code>SoftMax</code>操作提高对输入的宽容度，但是若在构建神经网络时，已经在输出之前进行了<code>SoftMax</code>操作就会导致两次<code>SoftMax</code>使<code>loss</code>的计算失真，也就是上一节的计算结果不一致。</p>
<h2 id="实验验证">实验验证</h2>
<p>根据<code>PyTorch</code>的官方文档，如果我们在手动计算交叉熵之间，加一个<code>SoftMax</code>操作，那么便可以得到和函数<code>F.cross_entropy</code>一样的计算结果，使用如下代码进行验证：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">x = torch.FloatTensor([[<span class="number">0.4</span>, <span class="number">0.6</span>],</span><br><span class="line">                       [<span class="number">0.7</span>, <span class="number">0.3</span>]])</span><br><span class="line">y = torch.LongTensor([<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">loss_1 = -torch.log(F.softmax(x, dim=-<span class="number">1</span>).gather(<span class="number">1</span>, y.view(-<span class="number">1</span>,<span class="number">1</span>)))</span><br><span class="line">loss_2 = F.cross_entropy(x, y, reduction = <span class="string">&quot;none&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;手动计算出的交叉熵：\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_1.squeeze(<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CrossEntropyLoss计算出的交叉熵：\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_2))</span><br></pre></td></tr></table></figure>
<p>运行上述代码，得到的输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">手动计算出的交叉熵：</span><br><span class="line">tensor([0.7981, 0.9130])</span><br><span class="line"></span><br><span class="line">CrossEntropyLoss计算出的交叉熵：</span><br><span class="line">tensor([0.7981, 0.9130])</span><br></pre></td></tr></table></figure>
<h2 id="reference">Reference</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a
href="https://pytorch.org/docs/stable/generated/torch.nn.functional.cross_entropy.html">torch.nn.functional.cross_entropy
— PyTorch 1.13 documentation</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a
href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html#torch.nn.CrossEntropyLoss">CrossEntropyLoss
— PyTorch 1.13 documentation</a><a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>PyTorch</tag>
        <tag>Deep Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Python脚本+企业微信通知实验结果</title>
    <url>/4d54863.html</url>
    <content><![CDATA[<p>深度学习的实验通常都需要跑很久，如果没有主动推送的手段，那么就会出现以下两种情况：</p>
<ul>
<li>过一段时间检查一下实验结果，无法专心干别的事情。</li>
<li>撇下不管，实验跑g了也不知道，跑完了也不知道。</li>
</ul>
<p>为解决以上问题，就需要给实验程序加上监控进程，在实验结束后进行通知并发送实验结果。本文的脚本主要包含三部分内容：进程监控，tensorboard
数据提取，企业微信机器人通知。</p>
<p><img src="https://download.kezhi.tech/img/202312071711241.png?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="进程监控">进程监控</h2>
<p>通常来说，实验放在后台跑会比较安全，不会因为<code>terminal</code>关闭而停止，放后台跑的命令为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nohup your_command &gt;log_name.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>进程监控的作用有两个：</p>
<ul>
<li>当实验异常结束时及时通知</li>
<li>当实验正常结束时通知结果</li>
</ul>
<p>实现起来比较简单，只要监控进程是否结束就行，代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> utils.wechat_bot <span class="keyword">import</span> research_bot</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_num</span>(<span class="params">key_words=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">    num_process = <span class="built_in">int</span>(os.popen(<span class="string">f&quot;ps -ef |grep -v grep|grep <span class="subst">&#123;key_words&#125;</span>|wc -l&quot;</span>).read())</span><br><span class="line">    <span class="keyword">return</span> num_process</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> process_num() == <span class="number">0</span>:</span><br><span class="line">        now = datetime.datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        send_report_text(<span class="string">&quot;实验结束，正在分析结果...&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    time.sleep(<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># do something</span></span><br></pre></td></tr></table></figure>
<h2 id="tensorboard-数据提取">Tensorboard 数据提取</h2>
<p>深度学习的学习过程数据通常由 <code>tensorboard</code>
记录到日志文件中，使用 <code>tensorboard</code>
可以很方便的查看训练数据，但这也降低了对训练数据进行其他操作的便捷性。下面这个脚本可以用来提取
<code>tensorboard</code> 产生的日志数据，并将其写入到 <code>excel</code>
文件中 。</p>
<p>使用时只需调用 <code>tb_to_excel</code> 函数即可，输入格式为：</p>
<ul>
<li>path_list：字符串构成的列表，每一项为一个日志的路径，如
<code>['logs/0','logs/1']</code></li>
<li>excel_path：导出的 <code>excel</code> 路径，如
<code>'export.xlsx'</code></li>
<li>one_sheet(default: False)：是否将所有数据合并到一个 excel sheet
中</li>
</ul>
<p>执行结果：path_list 中的日志文件导出到目标 excel 文件中，path_list
中的每一项对应 excel 文件中的每个 sheet。若
<code>on_sheet=True</code>，则所有数据将通过 <code>pd.concat</code>
合并到一个 sheet中。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> tensorboard.backend.event_processing <span class="keyword">import</span> event_accumulator</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_tb_data</span>(<span class="params">path</span>):</span><br><span class="line">    tb_data = event_accumulator.EventAccumulator(path)</span><br><span class="line">    tb_data.Reload()</span><br><span class="line">    <span class="keyword">return</span> tb_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_to_df</span>(<span class="params">tb_data: event_accumulator.EventAccumulator</span>):</span><br><span class="line">    keys = tb_data.scalars.Keys()</span><br><span class="line">    df = pd.DataFrame(columns=keys)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">        data = tb_data.scalars.Items(key)</span><br><span class="line">        df[key] = pd.Series([item.value <span class="keyword">for</span> item <span class="keyword">in</span> data])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;step&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">            df[<span class="string">&#x27;step&#x27;</span>] = pd.Series([item.step <span class="keyword">for</span> item <span class="keyword">in</span> data])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wall_time&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">            df[<span class="string">&#x27;wall_time&#x27;</span>] = pd.Series([item.wall_time <span class="keyword">for</span> item <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line">    order = [<span class="string">&#x27;step&#x27;</span>, <span class="string">&#x27;wall_time&#x27;</span>] + keys</span><br><span class="line">    df = df[order]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_tb_df</span>(<span class="params">path</span>):</span><br><span class="line">    tb_data = get_tb_data(path)</span><br><span class="line">    df = tb_to_df(tb_data)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_all_data</span>(<span class="params">path_list:<span class="built_in">list</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, pd.DataFrame]:</span><br><span class="line">    data_dict = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> filepath <span class="keyword">in</span> path_list:</span><br><span class="line">        fn = filepath.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(filepath):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;读取并处理：&quot;</span>, filepath)</span><br><span class="line">            sheet_name = fn</span><br><span class="line">            df = get_tb_df(filepath)</span><br><span class="line">            data_dict[sheet_name] = df</span><br><span class="line">    <span class="keyword">return</span> data_dict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">df_to_excel</span>(<span class="params">df_dict, path, one_sheet=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> one_sheet:</span><br><span class="line">        df_all = pd.DataFrame()</span><br><span class="line">        <span class="keyword">for</span> df <span class="keyword">in</span> df_dict.values():</span><br><span class="line">            df_all = pd.concat([df_all, df], ignore_index=<span class="literal">True</span>)</span><br><span class="line">        df_all.to_excel(path, index=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> pd.ExcelWriter(path) <span class="keyword">as</span> writer:</span><br><span class="line">            <span class="keyword">for</span> sheet_name, df <span class="keyword">in</span> df_dict.items():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;写入表：&quot;</span>, sheet_name)</span><br><span class="line">                df.to_excel(writer, sheet_name, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_to_excel</span>(<span class="params">path_list, excel_path, one_sheet=<span class="literal">False</span></span>):</span><br><span class="line">    df_dict = extract_all_data(path_list)</span><br><span class="line">    df_to_excel(df_dict, excel_path, one_sheet)</span><br></pre></td></tr></table></figure>
<h2 id="企业微信机器人通知">企业微信机器人通知</h2>
<p>主动推送有很多方式可以选择，我个人之前了解过的包括但不限于：</p>
<ul>
<li>SMTP 发送邮件</li>
<li>Server 酱之类的 Push 服务</li>
<li>QQ 机器人</li>
<li>微信机器人</li>
<li>企业微信应用</li>
<li>企业微信群机器人</li>
</ul>
<p>这些方式各有其优缺点。实验结果推送的需求为：</p>
<ul>
<li>实时性好：发送后能立即接受并通知</li>
<li>无响应：只需单向通知，无需设置回复</li>
</ul>
<p>因此，在衡量了上述需求，以及考虑实现的便捷性，选用企业微信群机器人来作为信息推送的方式。</p>
<p>首先，创建一个企业微信群机器人：</p>
<ol type="1">
<li>创建一个企业微信群聊（&gt;=3人即可）</li>
<li>把无关的人都踢了</li>
<li>添加一个群机器人</li>
<li>查看机器人信息，在<code>Webhook</code>地址中找到<code>key</code>值并记录</li>
</ol>
<p>然后把<code>key</code>填入下面脚本中即可使用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.util.retry <span class="keyword">import</span> Retry</span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SLEEP_INTERVAL = <span class="number">0.1</span> <span class="comment"># sleep time between retries</span></span><br><span class="line">MAX_RETRIES = <span class="number">1</span> <span class="comment"># Number of times to retry a request</span></span><br><span class="line"></span><br><span class="line">retries=Retry(</span><br><span class="line">    total=MAX_RETRIES,</span><br><span class="line">    backoff_factor=SLEEP_INTERVAL,</span><br><span class="line">    status_forcelist=[<span class="number">403</span>, <span class="number">500</span>, <span class="number">502</span>, <span class="number">503</span>, <span class="number">504</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">default_headers=&#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 Edg/98.0.1108.62&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client = requests.Session()</span><br><span class="line">client.mount(<span class="string">&quot;http://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line">client.mount(<span class="string">&quot;https://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line">client.headers=default_headers</span><br><span class="line"></span><br><span class="line">BotList = &#123;</span><br><span class="line">    <span class="string">&quot;实验小助手&quot;</span>:<span class="string">&quot;XXX&quot;</span> <span class="comment"># 这里填群聊机器人key</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bot</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._base_url = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send&quot;</span></span><br><span class="line">        self._key = key</span><br><span class="line">        self._url = <span class="string">f&quot;<span class="subst">&#123;self._base_url&#125;</span>?key=<span class="subst">&#123;self._key&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_msg</span>(<span class="params">self, msg</span>):</span><br><span class="line">        response = client.post(self._url, json=msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_text</span>(<span class="params">self, content</span>):</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: content</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_image</span>(<span class="params">self, image_path</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># encode an image to base64</span></span><br><span class="line">            image = f.read()</span><br><span class="line">            base64_bytes = <span class="built_in">str</span>(base64.b64encode(image))[<span class="number">2</span>:-<span class="number">1</span>]</span><br><span class="line">            md5 = hashlib.md5(image).hexdigest()</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">            <span class="string">&quot;image&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;base64&quot;</span>: base64_bytes,</span><br><span class="line">                <span class="string">&quot;md5&quot;</span>: md5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_markdown</span>(<span class="params">self, content</span>):</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">            <span class="string">&quot;markdown&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: content</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_news</span>(<span class="params">self, articles</span>):</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">            <span class="string">&quot;news&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;articles&quot;</span>: articles</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line"></span><br><span class="line">research_bot = Bot(BotList[<span class="string">&quot;实验小助手&quot;</span>])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    research_bot.send_text(<span class="string">&quot;Hello I&#x27;m your research assistant&quot;</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Script</tag>
      </tags>
  </entry>
  <entry>
    <title>Python高性能编程</title>
    <url>/411c70cb.html</url>
    <content><![CDATA[<h1 id="python-高性能编程">Python 高性能编程</h1>
<span id="more"></span>
<h2 id="性能分析">性能分析</h2>
<h3 id="时间分析">时间分析</h3>
<ol type="1">
<li><p>使用修饰器来自动测量时间</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timefn</span>(<span class="params">fn</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">fn</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">measure_time</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        t1=time.time()</span><br><span class="line">        result=fn(*args, **kwargs)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;@timefn:&quot;</span>+fn.__name__+<span class="string">&quot; took &quot;</span>+<span class="built_in">str</span>(t2-t1)+<span class="string">&quot; seconds&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> measure_time</span><br></pre></td></tr></table></figure>
<p>在 IPython 内部，可以使用 %timeit 魔法函数来对函数运行进行计时</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%timeit &lt;function&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>使用 UNIX 的 time 命令进行计时</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/time -p (--verbose) python &lt;script-name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>使用 cProfile 模块</p>
<p>cProfile 是一个标准库内建的分析工具。它钩入 CPython
的虚拟机来测量每一个函数运行花费的时间。在要分析的函数前加上
<code>@profile</code>装饰器，运行以下命令进行性能分析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m cProfile -s cumulative &lt;script-name&gt; &lt;options&gt;</span><br></pre></td></tr></table></figure>
<p>也可以将分析结果保存到一个统计文件中使用其他工具进行分析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m cProfile -o &lt;outputfilename&gt; &lt;script-name&gt; &lt;options&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>使用 line_profiler 进行逐行分析</p>
<p>安装：<code>pip install line_profiler</code></p>
<p>在要分析的函数前加上
<code>@profile</code>装饰器，运行以下命令进行性能分析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kernprof -l -v &lt;script-name&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="空间分析">空间分析</h3>
<ol type="1">
<li><p>使用memory_profiler 分析内存使用量</p>
<p>安装：<code>pip install memory_profiler</code></p>
<p>在要分析的函数前加上
<code>@profile</code>装饰器，运行以下命令进行性能分析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m memory_profiler &lt;script-name&gt;</span><br></pre></td></tr></table></figure>
<p>使用 <code>mprof</code>
可以绘图查看内存使用量，分为以下两个步骤：</p>
<p>使用 <code>mprof</code> 运行程序，运行后在目录下会生成一个
<code>mprof*.dat</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mprof run &lt;script-name&gt;</span><br></pre></td></tr></table></figure>
<p>绘图</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mprof plot</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="列表和元组">列表和元组</h2>
<p>列表和元组之类的数据结构被称为数组，一个数组是数据在某种内在次序下的扁平列表。</p>
<p>列表和元组的主要区别如下：</p>
<ul>
<li>列表是动态的数组，可变且可以重设长度。元组是静态的数组，其不可变且内部数据一旦创建便无法改变。</li>
<li>元组缓存于Python运行时的环境中，这意味着每次使用元组时无需访问内核来分配内存。</li>
<li>列表相比于元组需要更多的内存开销。</li>
</ul>
<h3 id="列表">列表</h3>
<p>列表的查询操作是 O(1) 的。</p>
<p>列表的搜索操作默认方法 (<code>list.index()</code>)
为线性操作，最差情况下为 O(n)。通过对列表进行排序可以将搜索时间降至
O(log n) (采用二分查找)。</p>
<p>Python 列表有一个内建的排序算法使用了 Tim 排序。Tim
排序在最佳的情况下以 O(n) (最差情况下为 O(n log n))
的复杂度进行排序。其混用了插入排序和归并排序来达到这样的性能(对于给定数据通过探测法来猜测哪个算法性能更优)。</p>
<p><code>bisect</code> 模块可以在列表进行插入操作时，保持列表的顺序不变
(默认从小到大)。<code>bisect</code> 的部分文档说明如下[2]：</p>
<blockquote>
<ul>
<li><p><code>bisect.bisect_left(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>在列表 a 中找到 x 的左侧插入点</p></li>
<li><p><code>bisect.bisect_right(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>在列表 a 中找到 x 的右侧插入点</p></li>
<li><p><code>bisect.bisect(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>同 <code>bisect.bisect_left</code></p></li>
<li><p><code>bisect.insort_left(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>按照排序顺序将 x 插入到列表 a
中，插入位置由<code>bisect.bisect_left</code>决定</p></li>
<li><p><code>bisect.insort_right(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>按照排序顺序将 x 插入到列表 a
中，插入位置由<code>bisect.bisect_right</code>决定</p></li>
<li><p><code>bisect.insort(a, x, lo=0, hi=len(a), ***, key=None)</code></p>
<p>同<code>bisect.insort_right</code></p></li>
</ul>
<p><strong>性能说明</strong></p>
<p>当使用 <code>bisect()</code> 和 <code>insort()</code>
编写时间敏感的代码时，请记住以下概念。</p>
<ul>
<li>二分法对于搜索一定范围的值是很高效的。
对于定位特定的值，则字典的性能更好。</li>
<li><code>insort()</code> 函数的时间复杂度为 O(n)
因为对数时间的搜索步骤被线性时间的插入步骤所主导。</li>
<li>这些搜索函数都是无状态的并且会在它们被使用后丢弃键函数的结果。
因此，如果在一个循环中使用搜索函数，则键函数可能会在同一个数据元素上被反复调用。
如果键函数速度不快，请考虑用 <a
href="https://docs.python.org/zh-cn/3/library/functools.html#functools.cache"><code>functools.cache()</code></a>
来包装它以避免重复计算。
另外，也可以考虑搜索一个预先计算好的键数组来定位插入点（如下面的示例节所演示的）。</li>
</ul>
</blockquote>
<p>列表在分配内存时会添加一定的预留空间。当一个大小为 N
的列表需要添加新的元素时，Python
会创建一个新的列表，足够存放原来的N个元素以及额外添加的元素。在实际分配时，分配的大小并不是
N+1，而是 N+M 个。其中，M 的计算公式如下：</p>
<p>M = (N &gt;&gt; 3) + (N &lt; 9 ? 3 : 6) + 1</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">N</th>
<th style="text-align: center;">0</th>
<th style="text-align: center;">1-4</th>
<th style="text-align: center;">5-8</th>
<th style="text-align: center;">9-16</th>
<th style="text-align: center;">17-25</th>
<th style="text-align: center;">26-35</th>
<th style="text-align: center;">...</th>
<th style="text-align: center;">991-1120</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">N+M</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">1120</td>
</tr>
</tbody>
</table>
<p>当一个list长度为8时，发生append操作后：</p>
<ol type="1">
<li>new_size = 原有的size ＋ append一个对象 = 8 + 1 = 9</li>
<li>new_size为9，二进制是1001，9 &gt;&gt; 3 = 1</li>
<li>new_allocated = 9 &gt;&gt; 3 + 6 = 7</li>
<li>new_allocated += new_size，为9 + 7 ＝ 16</li>
<li>列表的最终大小为16</li>
</ol>
<h3 id="元组">元组</h3>
<p>元组固定且不可变，其一旦被创建，内容便无法被修改，大小也不可被改变。</p>
<p>元组的静态特性的一个好处是占用了更少的内存。</p>
<p>元组的静态特性的另一个好处体现在一些会发生在 Python
后台的事：资源缓存。Python
是一门垃圾收集语言，这意味着当一个变量不再被使用时，Python
会将该变量使用的内存释放回操作系统。然而，对于长度为1-20的元组，即使它们不再被使用，其空间也不会立即返回给系统，而是留待未来使用。这意味着新建元组时可以直接在预留内存中存放数据，避免与操作系统进行交互。</p>
<h2 id="字典与集合">字典与集合</h2>
<p>字典是 key 和 value 的组合</p>
<p>集合是 key 的组合</p>
<ul>
<li>字典和集合基于 key 的查询速度是 O(1)
的，但是相应的，字典和集合会占用更多的内存。</li>
<li>字典和集合的插入和查询操作依赖于散列函数，因此实际的计算速度取决于其使用的散列函数</li>
<li>字典和集合的默认最小长度为8，每次改变大小时，桶的个数增加到原来的4倍，直到5000个元素之后，每次增加到原来的2倍。</li>
</ul>
<p>Python 的命名空间使用字典来进行管理。当Python
访问一个变量，函数或模块时，有一个体系决定去哪里寻找。</p>
<ul>
<li>首先，Python 查找 <code>locals()</code>
数组，其内部保存了所有本地变量的条目。Python
对本地变量的查询做了很多优化，同时这也是整个查询过程中唯一不需要进行字典查询的部分。</li>
<li>如果不在本地数组里，那么就会查找 <code>globals()</code>
字典。如果找不到则会搜索 <code>__buildin__</code>对象（模块对象，在搜索
<code>__buildin__</code>的一个属性时，其实是在搜索它的
<code>locals()</code>字典）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sin</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    %timeit f1(10)</span></span><br><span class="line"><span class="string">    154 ns ± 3.93 ns per loop</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> math.sin(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    %timeit f2(10)</span></span><br><span class="line"><span class="string">    126 ns ± 0.974 ns per loop</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> sin(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f3</span>(<span class="params">x,sin=sin</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    %timeit f3(10)</span></span><br><span class="line"><span class="string">    138 ns ± 1.85 ns per loop</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> sin(x)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>将 sin 函数作为本地函数慢于直接调用 global 中的 sin。此处存疑！</p>
</blockquote>
<h2 id="迭代器和生成器">迭代器和生成器</h2>
<p>Python 中的 for 循环要求被循环的对象支持迭代。使用 Python 内建的
<code>iter()</code>
函数便可以生成迭代器。对于列表，元组，字典这些对象，其会返回一个由元素或者
key 组成的迭代器。对于复杂的对象，则返回对象内部的 <code>__iter__</code>
属性。</p>
<p>对于一个迭代器，可以调用 <code>__next__()</code> 来获取新值，直到
<code>StopIteration</code> 异常被抛出。</p>
<p>迭代器只有在被调用时才会进行计算，因此在对大量数据流处理时可以显著节省内存。标准库中的
<code>itertools</code> 库提供了很多便于迭代器使用的工具：</p>
<ul>
<li><code>imap, ireduce, ifilter, izip</code></li>
<li><code>islice</code> 允许对一个无穷生成器切片</li>
<li><code>chain</code> 将多个生成器链接在一起</li>
<li><code>takewhile</code> 给生成器添加一个终止条件</li>
<li><code>cycle</code> 通过不断重复将一个有穷生成器变为无穷</li>
</ul>
<h2 id="参考文献">参考文献</h2>
<p>[1]M. Micha, I. Ozsvald, S. Hu, and X. Xu, <em>Python高性能编程 /
Python gao xing neng bian cheng</em>. 人民邮电出版社, Beijing: Ren Min
You Dian Chu Ban She, 2017.</p>
<p>[2]“bisect --- 数组二分查找算法 — Python 3.10.4 文档,”
<em>docs.python.org</em>.
https://docs.python.org/zh-cn/3/library/bisect.html (accessed Apr. 07,
2022).</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Cython</tag>
        <tag>Numpy</tag>
      </tags>
  </entry>
  <entry>
    <title>Pytorch网络构造Tips</title>
    <url>/a7298e70.html</url>
    <content><![CDATA[<h2 id="关于网络的parameters">关于网络的parameters</h2>
<p>Pytorch中，每一个网络继承于<code>nn.Module</code>类，当实例化之后，是通过维护一下8个字典来实现各种网络功能的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_parameters</span><br><span class="line">_buffers</span><br><span class="line">_backward_hooks</span><br><span class="line">_forward_hooks</span><br><span class="line">_forward_pre_hooks</span><br><span class="line">_state_dict_hooks</span><br><span class="line">_load_state_dict_pre_hooks</span><br><span class="line">_modules</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>在网络初始化<code>__init__</code>过程中，所有类内变量的定义都会通过<code>__setattr__</code>方法在<code>__dict__</code>中进行注册，而<code>nn.Module</code>重写了注册方法，将所有类内变量中，类型派生于<code>Parameter</code>的变量归属到<code>_parameters</code>字典中，这就解释了为什么使用一个<code>list</code>来存放网络的每一层会导致网络中的<code>parameters</code>为空。</p>
<p>此外，在获取参数时，<code>nn.Module</code>是通过遍历整个<code>_modules</code>字典来实现的，因此在定义时可以使用<code>nn.ModuleList</code>类型来替代<code>list</code>类型存放多个网络层。</p>
<h2 id="修改一个实例化后的网络">修改一个实例化后的网络</h2>
<p>在拿到别人预训练好的模型后，有时需要对网络进行修改，例如重置参数或替换网络中的某些模块重新训练，就需要对一个已经实例化之后的网络进行修改。一个很直接的思路就是，在类中找到对应的属性直接进行赋值替换即可。</p>
<p>首先是修改参数，这里有两种思路，由于修改参数不改变网络结构，所以可以直接利用<code>pytorch</code>提供的网络参数字典和导入方法来完成，即：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">state_dict = model.state_dict()</span><br><span class="line"><span class="comment"># change some parameters in state_dict</span></span><br><span class="line">model.load_state_dict(state_dict)</span><br></pre></td></tr></table></figure>
<p>还有一种思路就是通过<code>named_parameters()</code>来进行对应修改：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> name, params <span class="keyword">in</span> model.named_parameters():</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;需要修改参数的层的名字&quot;</span>:</span><br><span class="line">    	params.data=torch.zeros(params.data.shape)</span><br></pre></td></tr></table></figure>
<p>以上是修改参数的方法，相对来说，修改参数比较简单，<code>pytorch</code>也提供了一些方法来进行便捷的参数替换。而对于修改模型，实现思路就比较直接了，在<code>model</code>中找到层所在的位置，对其进行替换即可，这里使用到了<code>named_modules()</code>方法。以开源大语言模型<code>llama-2-13b</code>为例，在模型加载完成后，先查看各层的命名：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> name,layer <span class="keyword">in</span> model.named_modules():</span><br><span class="line">    <span class="built_in">print</span>(name, layer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果对网络结构熟悉的话也可以只看名字</span></span><br><span class="line"><span class="built_in">print</span>([name <span class="keyword">for</span> (name,module) <span class="keyword">in</span> model.named_modules()])</span><br></pre></td></tr></table></figure>
<p><img
src="https://download.kezhi.tech/img/202311041104052.png?x-oss-process=style/webp" /></p>
<p>然后在其中找到需要替换的层的名字，对其进行替换即可，以<code>embeding</code>层为例</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line">model.model.embed_tokens = nn.Linear(<span class="number">32000</span>, <span class="number">5120</span>)</span><br></pre></td></tr></table></figure>
<p><img
src="https://download.kezhi.tech/img/202311041108163.png?x-oss-process=style/webp" /></p>
<p>可以看出，<code>embedding</code>层被成功替换为了一个全连接层。其他层的修改以此类推。</p>
<h2 id="reference">Reference</h2>
<p>[1]Gemfield, “详解Pytorch中的网络构造,” <em>知乎专栏</em>, Jan. 04,
2019. https://zhuanlan.zhihu.com/p/53927068 (accessed Sep. 26,
2022).</p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pytorch</tag>
        <tag>Neural Network</tag>
      </tags>
  </entry>
  <entry>
    <title>Vanilla Policy Gradient关于loss mean与sum的探讨</title>
    <url>/b69f94c6.html</url>
    <content><![CDATA[<p>最近在逐一复现RL算法过程中，策略梯度算法的收敛性一直有问题。经过一番探究和对比实验，学习了网上和书本上的很多实验代码之后，发现了代码实现中的一个小问题，即Policy
Gradient在计算最终loss时求平均和求和对于网络训练的影响，本文将对此进行展开讨论。</p>
<p>先说结论：</p>
<blockquote>
<p>在进行策略梯度下降优化策略时，可以对每个动作的loss逐一（for操作）进行反向传播后进行梯度下降，也可以对每个动作的loss求和（sum操作）之后进行反向传播后梯度下降，但尽量避免对所有动作的loss求平均（mean操作）之后进行反向传播后梯度下降，这会导致收敛速度较慢，甚至无法收敛。</p>
</blockquote>
<p>具体的论证和实验过程见下文。</p>
<span id="more"></span>
<h2 id="vanilla-policy-gradient简介">Vanilla Policy Gradient简介</h2>
<p>Vanilla Policy Gradient(VPG, i.e.
REINFORCE)，中文译为策略梯度算法。是策略优化的经典算法。首先进行一些符号说明：</p>
<ul>
<li><span class="math inline">\(s_t\)</span>: 环境在<span
class="math inline">\(t\)</span>时刻的状态</li>
<li><span class="math inline">\(a_t\)</span>: 智能体在<span
class="math inline">\(t\)</span>时刻选择的动作</li>
<li><span class="math inline">\(\pi_\theta\)</span>:
智能体的策略，在这里由参数为<span
class="math inline">\(\theta\)</span>的神经网络表示</li>
<li><span class="math inline">\(\pi_\theta(a|s)\)</span>:
智能体在状态<span class="math inline">\(s\)</span>时选择动作<span
class="math inline">\(a\)</span>的概率</li>
<li><span class="math inline">\(r_t\)</span>: 环境在<span
class="math inline">\(t\)</span>时刻给出的奖励</li>
<li><span class="math inline">\(\gamma\)</span>: 折扣因子</li>
<li><span class="math inline">\(g_t\)</span>: 累计折扣奖励，<span
class="math inline">\(g_t=\sum_{t&#39;=t}^T
\gamma^{t&#39;-t}r_t\)</span></li>
</ul>
<p>VPG的大致分为两步：收集经验和优化策略。两部分的具体实现如下：</p>
<ol type="1">
<li>智能体与环境进行交互，直到一个episode终止，获得一系列轨迹<span
class="math inline">\(s_1,a_1,r_1,s_2,a_2,r_2...s_n,a_n,r_n\)</span></li>
<li>对<span class="math inline">\(\theta\)</span>进行更新：<span
class="math inline">\(\theta =\theta +\alpha\nabla_\theta
\pi_\theta(a_t|s_t) g_t\)</span></li>
</ol>
<h2 id="为何要对loss使用sum和mean">为何要对loss使用sum和mean</h2>
<p>策略梯度算法是一个梯度上升算法，为了便于使用当前的梯度下降框架，采用<span
class="math inline">\(loss = -\nabla_\theta
\pi_\theta(a_t|s_t)g_t\)</span>即可。</p>
<p>在VPG算法实现过程中，神经网络的训练部分使用了<code>pytorch</code>框架来进行实现。在该框架中，进行反向传播的<code>loss</code>必须是一个标量。而策略梯度算法对每一时刻的<span
class="math inline">\((s_t,a_t,g_t)\)</span>三元组都会进行一次梯度下降的更新。也就是需要产生多次反向传播，对于该问题主要有三种解决方案：</p>
<ol type="1">
<li><p>对每个时刻的<span
class="math inline">\((s_t,a_t,g_t)\)</span>三元组逐一进行反向传播，最后进行梯度下降，实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">batch = self._buffer.sample(<span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">G = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">self._optimizer.zero_grad()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(reward))):</span><br><span class="line">    r = reward[i]</span><br><span class="line">    state = torch.FloatTensor([batch[<span class="string">&quot;obs&quot;</span>][i]]).to(self.device)</span><br><span class="line">    action = torch.LongTensor([batch[<span class="string">&quot;act&quot;</span>][i]]).view(-<span class="number">1</span>,<span class="number">1</span>).to(self.device)</span><br><span class="line">    log_prob = torch.log(self._network(state)).gather(<span class="number">1</span>,action)</span><br><span class="line">    G = self._gamma * G + r</span><br><span class="line">    loss = -log_prob * G</span><br><span class="line">    loss.backward()</span><br><span class="line">self._optimizer.step()</span><br></pre></td></tr></table></figure></li>
<li><p>对所有计算出的<span
class="math inline">\(loss\)</span>进行求和再反向传播，实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">batch = self._buffer.sample(<span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">state = torch.FloatTensor(batch[<span class="string">&#x27;obs&#x27;</span>]).to(self.device)</span><br><span class="line">action = torch.LongTensor(batch[<span class="string">&#x27;act&#x27;</span>]).to(self.device)</span><br><span class="line">reward = torch.FloatTensor(batch[<span class="string">&#x27;rew&#x27;</span>]).to(self.device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># clean gradient</span></span><br><span class="line">self.optimizer.zero_grad()</span><br><span class="line"><span class="comment"># computing discount reward</span></span><br><span class="line">discount_reward=torch.zeros_like(reward)</span><br><span class="line">discount_reward[-<span class="number">1</span>]=reward[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(reward)-<span class="number">1</span>)):</span><br><span class="line">    discount_reward[t]=reward[t]+self._gamma*discount_reward[t+<span class="number">1</span>]</span><br><span class="line"><span class="comment"># forward computing</span></span><br><span class="line">action_probs=self._network(state)</span><br><span class="line"><span class="comment"># computing loss</span></span><br><span class="line">loss = -torch.log(action_probs.gather(<span class="number">1</span>, action.view(-<span class="number">1</span>,<span class="number">1</span>)))</span><br><span class="line">loss = torch.<span class="built_in">sum</span>(loss*discount_reward.unsqueeze(-<span class="number">1</span>))</span><br><span class="line"><span class="comment"># back propagation</span></span><br><span class="line">self.optimizer.step()</span><br></pre></td></tr></table></figure></li>
<li><p>对所有计算出的<span
class="math inline">\(loss\)</span>进行平均再反向传播，实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">batch = self._buffer.sample(<span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">state = torch.FloatTensor(batch[<span class="string">&#x27;obs&#x27;</span>]).to(self.device)</span><br><span class="line">action = torch.LongTensor(batch[<span class="string">&#x27;act&#x27;</span>]).to(self.device)</span><br><span class="line">reward = torch.FloatTensor(batch[<span class="string">&#x27;rew&#x27;</span>]).to(self.device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># clean gradient</span></span><br><span class="line">self.optimizer.zero_grad()</span><br><span class="line"><span class="comment"># computing discount reward</span></span><br><span class="line">discount_reward=torch.zeros_like(reward)</span><br><span class="line">discount_reward[-<span class="number">1</span>]=reward[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(reward)-<span class="number">1</span>)):</span><br><span class="line">    discount_reward[t]=reward[t]+self._gamma*discount_reward[t+<span class="number">1</span>]</span><br><span class="line"><span class="comment"># forward computing</span></span><br><span class="line">action_probs=self._network(state)</span><br><span class="line"><span class="comment"># computing loss</span></span><br><span class="line">loss = -torch.log(action_probs.gather(<span class="number">1</span>, action.view(-<span class="number">1</span>,<span class="number">1</span>)))</span><br><span class="line">loss = torch.mean(loss*discount_reward.unsqueeze(-<span class="number">1</span>))</span><br><span class="line"><span class="comment"># back propagation</span></span><br><span class="line">self.optimizer.step()</span><br></pre></td></tr></table></figure></li>
</ol>
<h2
id="为何对loss使用sum和mean会导致结果不同">为何对loss使用sum和mean会导致结果不同</h2>
<p>假设一个episode的长度为<span
class="math inline">\(n\)</span>，则会产生<span
class="math inline">\(n\)</span>个经验三元组<span
class="math inline">\((s_1,a_1,g_1),(s_2,a_2,g_2),...,(s_n,a_n,g_n)\)</span>，记每个经验三元组计算出的<span
class="math inline">\(loss\)</span>分别为<span
class="math inline">\(l_1,l_2,...,l_n\)</span>。下面分别对sum和mean对loss反向传播的影响进行分析。</p>
<p>若对<span class="math inline">\(loss\)</span>进行求和，即<span
class="math inline">\(l_{tot}=l_1+l_2+...+l_n\)</span>，根据链导法则可得：
<span class="math display">\[
\frac{\partial l_{tot}}{\partial \theta}=\frac{\partial l_1}{\partial
\theta}+\frac{\partial l_2}{\partial \theta}+...+\frac{\partial
l_n}{\partial \theta}
\]</span> 因此，使用<span
class="math inline">\(l_{tot}\)</span>求梯度并进行反向传播相当于每个<span
class="math inline">\(loss\)</span>分别求梯度的累计。</p>
<hr />
<p>若对<span class="math inline">\(loss\)</span>进行求平均，即<span
class="math inline">\(\bar l=\frac 1n
(l_1+l_2+...+l_n)\)</span>，根据链导法则可得： <span
class="math display">\[
\frac{\partial \bar l}{\partial \theta}=\frac 1n \bigg(\frac{\partial
l_1}{\partial \theta}+\frac{\partial l_2}{\partial
\theta}+...+\frac{\partial l_n}{\partial \theta}\bigg)
\]</span> 相比于求和，对<span
class="math inline">\(loss\)</span>求平均相当于在梯度传播时多了一个大小为<span
class="math inline">\(\frac 1n\)</span>的常数。</p>
<hr />
<p>乍一看，对<span
class="math inline">\(loss\)</span>进行求和和求平均操作对梯度反向传播带来的影响只有一个常数项。两者相差不大。然而，问题在于，VPG的每个episode的长度是不固定的。假设进行了<span
class="math inline">\(m\)</span>场episode，长度分别为<span
class="math inline">\(n_1,n_2,n_3,...,n_m\)</span>，那么如果每个episode结束时对<span
class="math inline">\(loss\)</span>求平均，则带来的常数项分别为<span
class="math inline">\(\frac 1{n_1},\frac 1{n_2},\frac 1{n_3},...,\frac
1{n_m}\)</span>。从而给神经网络的训练造成不平稳。</p>
<h2 id="实验对比">实验对比</h2>
<p>实验采用<code>gym</code>中的<code>CartPole-v1</code>环境作为训练环境，训练网络及学习超参数如下：</p>
<ul>
<li>隐层大小：[128, 128]</li>
<li>优化器：Adam</li>
<li>学习率：3e-4</li>
</ul>
<p>按照上述参数对<span
class="math inline">\(loss\)</span>循环反向传播，求和反向传播，平均反向传播进行实验，每种传播方式训练10次，训练得到的reward曲线以0.7的系数进行平滑，得到的实验结果如下：</p>
<p><img src="https://download.kezhi.tech/img/202303021520335.png?x-oss-process=style/webp"  width=60%></p>
<center>
图1 loss循环反向传播，求和反向传播，平均反向传播训练结果对比
</center>
<p>总结：由上述实验结果可知，若对<span
class="math inline">\(loss\)</span>求平均之后再进行反向传播，神经网络可能不会收敛到一个好的策略。因此在进行策略梯度算法计算时要尽量避免对<span
class="math inline">\(loss\)</span>取平均的操作。</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>Deep Learning</tag>
        <tag>Neural Network</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习笔记</title>
    <url>/71513ccb.html</url>
    <content><![CDATA[<h2 id="vue">Vue</h2>
<h3 id="与flask一起使用时的注意事项">与Flask一起使用时的注意事项</h3>
<p>Vue与Flask一起使用时会出现冲突，更改配置即可解决。</p>
<ul>
<li>Flask</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.jinja_env.variable_start_string = <span class="string">&#x27;[[&#x27;</span></span><br><span class="line">    app.jinja_env.variable_end_string = <span class="string">&#x27;]]&#x27;</span></span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Vue</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">delimiters</span>: [<span class="string">&#x27;[[&#x27;</span>,<span class="string">&#x27;]]&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="指令">指令</h3>
<table>
<thead>
<tr class="header">
<th>指令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v-model</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>v-once</td>
<td>一次性插入数据，当数据改变时，插值处内容不会改变</td>
</tr>
<tr class="even">
<td>v-html</td>
<td>以HTML代码的形式插入数据</td>
</tr>
<tr class="odd">
<td>v-bind (:)</td>
<td>用于在HTML <code>attribute</code>中绑定<code>property</code></td>
</tr>
<tr class="even">
<td>v-on (@)</td>
<td>将DOM事件与方法绑定</td>
</tr>
<tr class="odd">
<td>v-for</td>
<td></td>
</tr>
<tr class="even">
<td>v-if</td>
<td>根据表达式的值的真假来插入/移除对应的HTML元素。</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="javascript">JavaScript</h2>
<h3 id="truthy真值和falsy虚值"><a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/Truthy">Truthy</a>（真值）和<a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">Falsy</a>（虚值）</h3>
<p>在 <a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/JavaScript">JavaScript</a>
中，<strong>truthy</strong>（真值）指的是在<a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/Boolean">布尔值</a>上下文中，转换后的值为
<code>true</code> 的值。被定义为<a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">假值</a>以外的任何值都为真值。（即所有除
<code>false</code>、<code>0</code>、<code>-0</code>、<code>0n</code>、<code>""</code>、<code>null</code>、<code>undefined</code>
和 <code>NaN</code> 以外的皆为真值）。</p>
<p>JavaScript 中的<em>真值</em>示例如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>)</span><br><span class="line"><span class="keyword">if</span> (&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> ([])</span><br><span class="line"><span class="keyword">if</span> (<span class="number">42</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;0&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;false&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line"><span class="keyword">if</span> (-<span class="number">42</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="number">12n</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="number">3.14</span>)</span><br><span class="line"><span class="keyword">if</span> (-<span class="number">3.14</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Infinity</span>)</span><br><span class="line"><span class="keyword">if</span> (-<span class="title class_">Infinity</span>)</span><br></pre></td></tr></table></figure>
<p>JavaScript的逻辑与运算中，如果第一个操作数为真值，则逻辑与运算返回第二个操作数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="literal">true</span> &amp;&amp; <span class="string">&quot;dog&quot;</span></span><br><span class="line"><span class="comment">// returns &quot;dog&quot;</span></span><br><span class="line"></span><br><span class="line">[] &amp;&amp; <span class="string">&quot;dog&quot;</span></span><br><span class="line"><span class="comment">// returns &quot;dog&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>falsy</strong> 值（虚值）是在 <a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/Boolean">Boolean</a>
上下文中认定为 false 的值。</p>
<p><a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/JavaScript">JavaScript</a>
在需要用到布尔类型值的上下文中使用强制类型转换 (<a
href="https://developer.mozilla.org/zh-CN/docs/Glossary/Type_Conversion">Type
Conversion</a> ) 将值转换为布尔值，例如<a
href="https://developer.mozilla.org/zh-CN/docs/learn/JavaScript/Building_blocks/conditionals">条件语句</a>和循环语句。</p>
<p>在 JavaScript 中只有 8 个 <strong>falsy</strong> 值。</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>false</code></td>
<td>false 关键字</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td>数值 zero</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0</td>
<td>数值 负 zero</td>
</tr>
<tr class="even">
<td style="text-align: center;">0n</td>
<td>当 BigInt 作为布尔值使用时，遵从其作为数值的规则. <code>0n</code> 是
<em>falsy</em> 值。</td>
</tr>
<tr class="odd">
<td style="text-align: center;">"", '',
`<code>| 这是一个空字符串 (字符串的长度为零). JavaScript 中的字符串可用双引号 **</code>""<code>**, 单引号</code>''`,
或 <a
href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals">模板字面量</a>
<strong>````</strong> 定义。</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: center;">null</td>
<td>null - 缺少值</td>
</tr>
<tr class="odd">
<td style="text-align: center;">undefined</td>
<td>undefined - 原始值</td>
</tr>
<tr class="even">
<td style="text-align: center;">NaN</td>
<td>NaN - 非数值</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>XJTU System Optimization and Scheduling Course Assignments</title>
    <url>/7d0182be.html</url>
    <content><![CDATA[<p>西安交通大学研究生《系统优化与调度》课程作业</p>
<p><img src="https://download.kezhi.tech/img/202211291608420.png?x-oss-process=style/webp" style="width:30%;" /></p>
<span id="more"></span>
<h1 id="assignment-1">Assignment 1</h1>
<h2 id="section">(1)1.1.2</h2>
<h3 id="a">(a)</h3>
<p><span class="math display">\[
f(x,y)=(x^2-4)^2+y^2\\\\
\nabla f(x,y)=(4x^3-16,2y)\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
12x^2-16 &amp; 0\\
0 &amp; 2
\end{pmatrix}
\]</span></p>
<p>so there are three stationary points: (2, 0) (-2, 0) and (0, 0)</p>
<p>the Hesse Matrix is positive semi-definite only when <span
class="math inline">\(|x|&gt;\frac43\)</span></p>
<p>so points (2, 0) (-2, 0) are local minimum points, point (0, 0) is
not a local minimum. <span class="math display">\[
f(2,0)=f(-2,0)=0
\]</span> so (2,0) and (-2,0) are global minimum points of f</p>
<p>let <span
class="math inline">\(g(x,y)=-f(x,y)=-(x^2-4)^2-y^2\)</span>, it is easy
to know that Hesse matrix is not positive semi-definite when <span
class="math inline">\(x=0,y=0\)</span>. So the point(0,0) is not the
minimum of <span class="math inline">\(g(x,y)\)</span>, which means it
is also not the local maximum of <span
class="math inline">\(f(x,y)\)</span>.</p>
<h3 id="b">(b)</h3>
<p><span class="math display">\[
f(x,y)=\frac12x^2+xcos\ y\\\\
\nabla f(x,y)=(x+cos\ y,-xsin\ y)
\]</span></p>
<p><span class="math inline">\(-xsin\ y=0\)</span> only if <span
class="math inline">\(x=0\)</span> or <span
class="math inline">\(y=k\pi\ (k\in Z)\)</span></p>
<p>if <span class="math inline">\(x=0\)</span>, <span
class="math inline">\(x+cos\ y=0\)</span> only if <span
class="math inline">\(y=\frac\pi2+k\pi\ (k\in Z)\)</span></p>
<p>if <span class="math inline">\(y=k\pi\ (k\in Z)\)</span>, <span
class="math inline">\(x+cos\ y=0\)</span> only if <span
class="math inline">\(x=-(-1)^k\)</span></p>
<p>so the stationary points of <span
class="math inline">\(f(x,y)\)</span> are <span
class="math inline">\((0, \frac\pi2+k\pi)\)</span> and <span
class="math inline">\((-(-1)^k,k\pi)\)</span> <span
class="math inline">\((k\in Z)\)</span> <span class="math display">\[
\nabla^2f(x,y)=
\begin{pmatrix}
1 &amp; -sin\ y\\
-sin\ y &amp; -xcos\ y
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
|(1)|&gt;0\\
|\nabla^2f(x,y)|=-xcos\ y-sin^2\ y
\]</span></p>
<p>for points <span class="math inline">\((0, \frac\pi2+k\pi)\)</span>,
<span class="math display">\[
|\nabla^2f(x,y)|=0-1=-1&lt;0
\]</span> for points <span
class="math inline">\((-(-1)^k,k\pi)\)</span>, <span
class="math display">\[
|\nabla^2f(x,y)|=-1-0=-1&lt;0
\]</span> so all the stationary points are not local minimum points.</p>
<p>function <span class="math inline">\(f(x,y)\)</span> have no local
minima</p>
<h3 id="c">(c)</h3>
<p><span class="math display">\[
f(x,y)=sin\ x+sin\ y+sin\ (x+y)\\\\
\nabla f(x,y)=(cos\ x+cos\ (x+y),cos\ y+cos\ (x+y))\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
-sin\ x-sin(x+y) &amp; -sin(x+y)\\
-sin\ (x+y) &amp; -sin\ y-sin(x+y)
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
let \left\{
    \begin{array}{**lr**}
    cos\ x+cos\ (x+y)=0&amp;(1)\\
    cos\ y+cos\ (x+y)=0&amp;(2)
    \end{array}
\right.
\]</span></p>
<p>(1)-(2): <span class="math inline">\(cos\ x-cos\ y=0\)</span>, so
<span class="math inline">\(y=x\ or\ y=2\pi-x\)</span></p>
<p>if <span class="math inline">\(y=x\)</span>, (1) equals to <span
class="math inline">\(cos\ x+cos\ 2x=0\)</span>,</p>
<p>using double angle formula: <span class="math inline">\(cos\
x+2cos^2\ x-1=0\)</span></p>
<p>solution: <span class="math inline">\(cos\ x=\frac12\ ,\ -1\)</span>,
<span class="math inline">\(x=\frac\pi3,\pi,\frac53\pi\)</span></p>
<p>if <span class="math inline">\(y=2\pi-x\)</span>, (1) equals to <span
class="math inline">\(cos\ x+1=0\)</span></p>
<p>solution: <span class="math inline">\(cos\ x=-1\)</span>, <span
class="math inline">\(x=\pi\)</span></p>
<p>The stationary points are <span
class="math inline">\((\frac\pi3,\frac\pi3),(\pi,\pi),(\frac53\pi,\frac53\pi)\)</span>.
<span class="math display">\[
|\nabla^2f(x,y)|=sin\ xsin\ y+(sin\ x+sin\ y)sin\ (x+y)
\]</span></p>
<p>for point <span class="math inline">\((\frac\pi3,\frac\pi3)\)</span>:
<span class="math display">\[
|(-sin\ x-sin(x+y))|=-\sqrt 3\\
|\nabla^2f(x,y)|=\frac94
\]</span> its Hesse Matrix is negative definite, so point <span
class="math inline">\((\frac\pi3,\frac\pi3)\)</span> is a local maximum
point, max value is <span
class="math inline">\(\frac32\sqrt3\)</span></p>
<p>for point <span class="math inline">\((\pi,\pi)\)</span>: <span
class="math display">\[
|(-sin\ x-sin(x+y))|=0\\
|\nabla^2f(x,y)|=0
\]</span> this point is neither a local maximum nor a local minimum.</p>
<p>for point <span
class="math inline">\((\frac53\pi,\frac53\pi)\)</span>: <span
class="math display">\[
|(-sin\ x-sin(x+y))|=\sqrt3\\
|\nabla^2f(x,y)|=-\frac34
\]</span> this point is neither a local maximum nor a local minimum.</p>
<h3 id="d">(d)</h3>
<p><span class="math display">\[
f(x,y)=(y-x^2)^2-x^2\\\\
\nabla f(x,y)=(4x^3-4xy-2x,-2x^2+2y)\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
12x^2-4y-2 &amp; -4x\\
-4x &amp; 2
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
let \left\{
    \begin{array}{**lr**}
    4x^3-4xy-2x=0\\
    -2x^2+2y=0
    \end{array}
\right.
\]</span></p>
<p>Thus the stationary point is <span
class="math inline">\((0,0)\)</span>, for this point: <span
class="math display">\[
|(12x^2-4y-2)|=-2\\
|\nabla^2f(x,y)|=-4
\]</span> its Hesse Matrix is neither positive definite nor negative
definite, so this stationary point is neither a local maximum nor a
local minimum.</p>
<h3 id="e">(e)</h3>
<p>Since the conclusion of (d)——the stationary point is neither a local
maximum nor a local minimum, so the minimum point could only exist on
the boundary.</p>
<p>Consider <span class="math inline">\(y=-1\)</span>, then <span
class="math inline">\(f(x,y)=(-1-x^2)^2-x^2=x^4+x^2+1\)</span>.</p>
<p>In this case, the minimum point is <span
class="math inline">\((0,-1)\)</span> and the minimum is 1</p>
<p>Consider <span class="math inline">\(y=1\)</span>, then <span
class="math inline">\(f(x,y)=(1-x^2)^2-x^2=x^4-3x^2+1\)</span></p>
<p>In this case, the minimum points are <span
class="math inline">\((\frac{\sqrt6}2,1), (-\frac{\sqrt6}2,1)\)</span>,
and the minimum is <span class="math inline">\(-\frac54\)</span>.</p>
<p>Summarizing, with the constraint <span class="math inline">\(-1\leq
y\leq 1\)</span> on <span class="math inline">\(y\)</span>, there exists
global minimum and the global minimum points are <span
class="math inline">\((\frac{\sqrt6}2,1), (-\frac{\sqrt6}2,1)\)</span>,
the global minimum is <span class="math inline">\(-\frac54\)</span>.</p>
<h2 id="section-1">(2)1.1.6</h2>
<p>suppose <span class="math inline">\(x=(a,b),y_i=(a_i,b_i)\)</span>,
then the problem could transform to: <span class="math display">\[
min\  \sum_{i=1}^mw_i\sqrt{(a-a_i)^2+(b-b^i)^2}
\]</span> suppose <span
class="math inline">\(f(a,b)=\sum_{i=1}^mw_i\sqrt{(a-a_i)^2+(b-b^i)^2}\)</span>,
then: <span class="math display">\[
\nabla
f(x,y)=(\sum_{i=1}^mw_i\frac{a-a_i}{\sqrt{(a-a_i)^2+(b-b^i)^2}},\sum_{i=1}^mw_i\frac{b-b_i}{\sqrt{(a-a_i)^2+(b-b^i)^2}})\\\\
\nabla^2f(a,b)=
\begin{pmatrix}
\sum_{i=1}^mw_i\frac{2(b-b_i)^2}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}} &amp;
\sum_{i=1}^mw_i\frac{-2(a-a_i)(b-b_i)}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}}\\
\sum_{i=1}^mw_i\frac{-2(a-a_i)(b-b_i)}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}}
&amp;
\sum_{i=1}^mw_i\frac{2(a-a_i)^2}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}}
\end{pmatrix}
\]</span> let <span class="math inline">\(\nabla f(a,b)=0\)</span>, then
the stationary point is <span
class="math inline">\((\frac{\sum_{i=1}^mw_ia_i}{\sum_{i=1}^mwi},\frac{\sum_{i=1}^mw_ib_i}{\sum_{i=1}^mwi})\)</span></p>
<p>and <span class="math inline">\(\nabla^2 f(a,b)\)</span> is positive
definite in the point, so it is the global minimum.</p>
<h3 id="b-1">(b)</h3>
<p>there is only one stationary point in this question, so the solution
is unique</p>
<h3 id="c-1">(C)</h3>
<p>let the plane points on be the reference level</p>
<p>suppose the length of string in weight <span
class="math inline">\(i\)</span> is <span
class="math inline">\(l_i\)</span>, so the problem is: <span
class="math display">\[
min\
\sum_{i=1}^mw_i(||x-y||-l_i)=\sum_{i=1}^mw_i||x-y||-\sum_{i=1}^mw_i·l_i
\]</span> and we can see that <span
class="math inline">\(\sum_{i=1}^mw_i·l_i\)</span> is constant, so the
problem could transform to: <span class="math display">\[
\sum_{i=1}^mw_i||x-y||
\]</span> which is same as the problem in (a).</p>
<h2 id="section-2">(3) 1.2.1</h2>
<h3 id="a-1">(a)</h3>
<p><span class="math display">\[
f(x,y)=3x^2+y^4\\\\
\nabla f(x,y)=(6x,4y^3)
\]</span></p>
<p>the start point is <span class="math inline">\((1,-2)\)</span>, so
the descend direction is <span
class="math inline">\((-6,32)&#39;\)</span>. Then choose <span
class="math inline">\(m\)</span></p>
<p>at first, <span class="math inline">\(m=0,\alpha=s=1\)</span> <span
class="math display">\[
f(1,2)-f(-5,30)=19-810075=-810056\leq-0.1*1*-1060=106
\]</span></p>
<p>then <span
class="math inline">\(m=1，\alpha=\alpha*\beta=0.5\)</span> <span
class="math display">\[
f(1,-2)-f(-2,14)=19-38428=-38409\leq -0.1*0.5*-1060=53
\]</span> then <span
class="math inline">\(m=2,\alpha=\alpha*\beta=0.25\)</span> <span
class="math display">\[
f(1,-2)-f(-0.5,6)=19-1296.75=-1277.75\leq -0.1*0.25*-1060=26.5
\]</span> then <span
class="math inline">\(m=2,\alpha=\alpha*\beta=0.125\)</span> <span
class="math display">\[
f(1,-2)-f(0.25,2)=19-16.1875\leq -0.1*0.125*-1060=13.25
\]</span> then <span
class="math inline">\(m=3,\alpha=\alpha*\beta=0.0625\)</span> <span
class="math display">\[
f(1,-2)-f(0.625,0)=19-1.171875=17.828\geq -0.1*0.0625*-1060=6.625
\]</span></p>
<p>so the first stepsize is 0.0625, after the iteration, the point
changes to <span class="math inline">\((0.625, 0)\)</span></p>
<h3 id="b-2">(b)</h3>
<p>when <span class="math inline">\(m=0,\alpha=s=1\)</span>, the result
is above.</p>
<p>then <span
class="math inline">\(m=1，\alpha=\alpha*\beta=0.1\)</span> <span
class="math display">\[
f(1,-2)-f(0.4,1.2)=19-2.5536=16.4464\geq -0.1*0.1*1060=-10.6
\]</span> so the first stepsize is 0.1, after the iteration, the point
changes to <span class="math inline">\((0.4, 1.2)\)</span></p>
<h3 id="c-2">(c)</h3>
<p><span class="math display">\[
\nabla^2f(x,y)=
\begin{pmatrix}
6&amp;0\\
0&amp;12y^2
\end{pmatrix}
\]</span></p>
<p>at point <span class="math inline">\((1,-2)\)</span>, the Hesse
Matrix is: <span class="math display">\[
\begin{pmatrix}
6&amp;0\\
0&amp;48
\end{pmatrix}
\]</span> its inverse matrix is: <span class="math display">\[
\begin{pmatrix}
\frac16&amp;0\\
0&amp;\frac1{48}
\end{pmatrix}
\]</span> so the descend direction is: <span class="math display">\[
d=-\begin{pmatrix}
\frac16&amp;0\\
0&amp;\frac1{48}
\end{pmatrix}\begin{pmatrix}
6\\-32
\end{pmatrix}=\begin{pmatrix}
-1\\\frac23
\end{pmatrix}
\]</span> then choose the stepsize:</p>
<p>at first, <span class="math inline">\(m=0,\alpha=s=1\)</span> <span
class="math display">\[
f(1,-2)-f(0,-\frac43)=19-3.16=15.84\geq -0.1*1*1060=-106
\]</span> so the first stepsize is 1, and the point changes to <span
class="math inline">\((0,-\frac43)\)</span></p>
<p>Comparing with (a), the computing cost of Newton's method is less</p>
<h2 id="section-3">(4) 1.2.6</h2>
<h3 id="a-2">(a)</h3>
<p>PROOF: <span class="math display">\[
\nabla f(x)=Qx-b&#39;\\\\
||\nabla f(x)-\nabla f(y)||=||Qx-Qy||\leq ||Q||·||x-y||=L·||x-y||
\]</span> (b)</p>
<p>PROOF: <span class="math display">\[
x^{k+1}=x^k-sD\nabla f(x^k)=x^k-sD(Qx^k-b&#39;)\\
x^{k+1}=(I-sDQ)x^k+sDb&#39;
\]</span> ICBS: <span class="math display">\[
x^{k+1}+C=A(x^k+C)\\where\ \ A=I-sDQ,B=sDb&#39;, C=(A-I)^{-1}B
\]</span> by iteration: <span class="math display">\[
x^{k+1}+C=A(x^k+C)=A^{k+1}(x^0+C)\\
x^{k+1}=A(x^k+C)=A^{k+1}(x^0+C)-C
\]</span> then: <span class="math display">\[
x^{k+1}=(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)+Q^{-1}b&#39;\\
x^{k+1}-x^*=(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)+Q^{-1}b&#39;-Q^{-1}b&#39;\\
x^{k+1}-x^*=(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)\\
\]</span> so: <span class="math display">\[
\lim_{k\rightarrow\infty}(x^{k+1}-x^*)=\lim_{k\rightarrow\infty}(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)
\]</span></p>
<p><span class="math display">\[
\forall s\in(0,2/L),\quad (I-sDQ)&lt;1
\]</span></p>
<p>then: <span class="math display">\[
\lim_{k\rightarrow\infty}(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)=0\\
\lim_{k\rightarrow\infty}(x^{k+1}-x^*)=0
\]</span> Summarizing, the method converges to <span
class="math inline">\(x^*=Q^{-1}b&#39;\)</span> for every starting point
<span class="math inline">\(x^0\)</span> if and only if <span
class="math inline">\(s\in(0,2/L)\)</span>.</p>
<h2 id="section-4">(5) 1.3.1</h2>
<p><span class="math display">\[
Q=\begin{pmatrix}
1&amp;0.9995\\
0.9995&amp;1
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
M=largest\ eigenvalue\ of\ Q= 1.9995\\\\
m=smallest\ eigenvalue\ of\ Q= 0.0005\\\\
\frac{f(x^{k+1})}{f(x^{k})}\leq (\frac{M-m}{M+m})^2= 0.999
\]</span></p>
<p>Let <span class="math inline">\(v_m\)</span>and <span
class="math inline">\(v_M\)</span> be the normalized eigenvectors of Q
corresponding</p>
<p>to m and M, respectively, and let <span class="math display">\[
x^0=\frac smv_m\pm\frac sMv_M, s\in R
\]</span> Then after the first iteration using the line minimization
stepsize</p>
<p>rule,（i.e., a stepsize<span
class="math inline">\(\alpha=\frac2{M+m}\)</span> ), we get <span
class="math display">\[
x^1=\frac{M-m}{M+m}(\frac smv_m\mp\frac sMv_M)=\frac{M-m}{M+m}x^0
\]</span> Therefore, starting the iterations with<span
class="math inline">\(x^0\)</span> , we have for all k <span
class="math display">\[
\frac{f(x^{k+1})}{f(x^{k})}= (\frac{M-m}{M+m})^2
\]</span></p>
<h2 id="section-5">(6) 1.3.4</h2>
<p><span class="math display">\[
f(x)=\frac12(x-x^*)&#39;Q(x-x^*)\\\\
\nabla f(x)=Q(x-x^*)
\]</span></p>
<p>then: <span class="math display">\[
x^{k+1}=x^k-s(Q(x^k-x^*)+e^k)\\
x^{k+1}=x^k(I-sQ)+sQx^*+se^k\\
x^{k+1}-x^*=(x^k-x^*)(I-sQ)+se^k
\]</span> since for any <span class="math inline">\(A B,
||A·B||\leq||A||·||B||\)</span> <span class="math display">\[
||x^{k+1}-x^*||\leq ||(x^k-x^*)(I-sQ)||+s||e^k||
\]</span> then: <span class="math display">\[
||x^{k+1}-x^*||\leq ||x^k-x^*||·q+s\delta
\]</span> by the iteration, <span class="math display">\[
||x^k-x^0||\leq q^k||x0-x^k||+s\delta(1+q+q^2+...+q^{k-1})
\]</span> so: <span class="math display">\[
||x^k-x^0||\leq q^k||x0-x^k||+\frac{s\delta}{1-q}
\]</span> i.e. <span class="math display">\[
||x^k-x^0||\leq \frac{s\delta}{1-q}+q^k||x0-x^k||
\]</span></p>
<h2 id="section-6">(7) 1.4.1</h2>
<p>In Newton's Method, we have: <span class="math display">\[
x^{k+1}=x^k-\alpha^k(\nabla^2f(x^k))^{-1}\nabla f(x^k)
\]</span> consider <span class="math inline">\(x=Sy\)</span>, then:
<span class="math display">\[
Sy^{k+1}=Sy^k-S^{-2}\alpha^k(\nabla^2f(Sy^k))^{-1}S\nabla f(Sy^k)\\\\
y^{k+1}=y^k-S^{-1}\alpha^k(\nabla^2f(Sy^k))^{-1}\nabla f(Sy^k)
\]</span> since <span class="math inline">\(y=S^{-1}x\)</span>, consider
<span class="math inline">\(y^0=S^{-1}x^0\)</span>, then: <span
class="math display">\[
y^{1}=y^0-S^{-1}\alpha^0(\nabla^2f(Sy^0))^{-1}\nabla f(Sy^0)\\
y^{1}=S^{-1}x^0-S^{-1}\alpha^0(\nabla^2f(x^0))^{-1}\nabla f(x^0)
\]</span> so <span class="math inline">\(y^1=S^{-1}x^1\)</span>, for
<span class="math inline">\(y^k=S^{-1}x^k\)</span>: <span
class="math display">\[
y^{k+1}=y^k-S^{-1}\alpha^k(\nabla^2f(Sy^k))^{-1}\nabla f(Sy^k)\\
y^{k+1}=S^{-1}x^k-S^{-1}\alpha^k(\nabla^2f(Sy^k))^{-1}\nabla f(Sy^k)\\
y^{k+1}=S^{-1}x^{k+1}
\]</span> summarizing, the sequence made by Newton's Method <span
class="math inline">\(y^k=S^{-1}x^k\)</span>.</p>
<p>## (8)</p>
<p>PROOF:</p>
<p>Since <span class="math inline">\(f(x)\)</span> is convex, <span
class="math display">\[
\forall x_1,x_2\in \Omega,\lambda\in(0,1)\quad \lambda f(x_1)+(1-\lambda
)f(x_2)\geq f(\lambda x_1+(1-\lambda )x_2)
\]</span> Since <span class="math inline">\(\gamma(x)\)</span> is a
monotone nondecreasing function, <span class="math display">\[
\gamma(\lambda f(x_1)+(1-\lambda )f(x_2))\geq \gamma (f(\lambda
x_1+(1-\lambda )x_2))
\]</span> Since <span class="math inline">\(\gamma(x)\)</span> is
convex, <span class="math display">\[
\lambda\gamma( f(x_1))+(1-\lambda )\gamma(f(x_2)) \geq \gamma(\lambda
f(x_1)+(1-\lambda )f(x_2))
\]</span> Therefore, <span class="math display">\[
\lambda\gamma( f(x_1))+(1-\lambda )\gamma(f(x_2)) \geq \gamma (f(\lambda
x_1+(1-\lambda )x_2))
\]</span> This implies that <span
class="math inline">\(\gamma(f)(x)\)</span> is convex.</p>
<h2 id="section-7">(9)</h2>
<h3 id="a-3">(a)</h3>
<p><span class="math display">\[
f(x,y)=5x^2+5y^2-xy-11x+11y+11\\\\
\nabla f(x,y)=(10x-y-11,10y-x+11)
\]</span></p>
<p><span class="math display">\[
let\left\{
    \begin{array}{**lr**}
    10x-y-11=0\\
    10y-x+11=0
    \end{array}
\right.
\]</span></p>
<p>the solution of the equation set above is <span
class="math inline">\((1,-1)\)</span>,</p>
<p>it is the point satisfying the first-order necessary conditions</p>
<h3 id="b-3">(b)</h3>
<p><span class="math display">\[
\nabla^2 f(x,y)=
\begin{pmatrix}
10&amp;-1\\
-1&amp;10
\end{pmatrix}
\]</span></p>
<p>it is easy to know the Hessian Matrix is always positive definite, so
the point<span class="math inline">\((1,-1)\)</span> is a global minimum
point, and the global minimum is 0</p>
<h3 id="c-3">(c)</h3>
<p>for the steepest decent method, <span
class="math inline">\(D^k=I\)</span> <span class="math display">\[
(D^k)^{\frac12}\nabla^2f(x,y)(D^k)^{\frac12}=\nabla^2f(x,y)=\begin{pmatrix}
10&amp;-1\\
-1&amp;10
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
M=11,\quad m=9\\
\frac{f(x^{k+1})-f(x^*)}{f(x^{k})-f(x^*)}\leq(\frac{M-m}{M+m})^2=0.01
\]</span></p>
<h2 id="section-8">(10)</h2>
<h3 id="a-4">(a)</h3>
<p><span class="math display">\[
f(x,y)=x^2+y^2+xy-3x\\\\
\nabla f(x,y)=(2x+y-3,x+2y)\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
2&amp;1\\
1&amp;2
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
let\left\{
    \begin{array}{**lr**}
    2x+y-3=0\\
    x+2y=0
    \end{array}
\right.
\]</span></p>
<p>the solution of the equation set above is <span
class="math inline">\((2,-1)\)</span>, and the Hessian Matrix is always
positive definite,</p>
<p>so point <span class="math inline">\((2,-1)\)</span> is unconstrained
local minimum point.</p>
<h3 id="b-4">(b)</h3>
<p>Because Hessian Matrix is always positive definite, the function
<span class="math inline">\(f(x,y)\)</span> is convex for all point in
the real space.</p>
<h3 id="c-4">(c)</h3>
<p>the minimum points must on the boundary of the constraint.</p>
<p>consider <span class="math inline">\(x=0\)</span>, then <span
class="math inline">\(f(x,y)=y^2\)</span>, the minimum point is <span
class="math inline">\((0,0)\)</span> and the minimum is <span
class="math inline">\(0\)</span></p>
<p>consider <span class="math inline">\(y=0\)</span>, then <span
class="math inline">\(f(x,y)=x^2-3x\)</span>, the minimum point is <span
class="math inline">\((\frac32,0)\)</span> and the minimum is <span
class="math inline">\(-\frac94\)</span></p>
<p>therefore, the minimum point of f subject to <span
class="math inline">\(x\geq 0,y\geq 0\)</span> is <span
class="math inline">\((\frac32,0)\)</span> and the minimum is <span
class="math inline">\(-\frac94\)</span></p>
<h3 id="d-1">(d)</h3>
<p>for the steepest decent method, <span
class="math inline">\(D^k=I\)</span> <span class="math display">\[
(D^k)^{\frac12}\nabla^2f(x,y)(D^k)^{\frac12}=\nabla^2f(x,y)=\begin{pmatrix}
2&amp;1\\
1&amp;2
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
M=3,\quad m=1\\
\frac{f(x^{k+1})-f(x^*)}{f(x^{k})-f(x^*)}\leq(\frac{M-m}{M+m})^2=\frac14
\]</span></p>
<h1 id="assignment-2">Assignment 2</h1>
<h2 id="section-9">(1)</h2>
<blockquote>
<p>Q: Consider the quadratic program <span class="math display">\[
min\  0.5x^TQx-b^Tx\\
s.t.\ Ax=c
\]</span> Prove that <span class="math inline">\(x^*\)</span> is a local
minimum point if and only if it is a global minimum point.(No convexity
is assumed)</p>
</blockquote>
<p>Proof:</p>
<p>Since no convexity is assumed, we consider two cases:</p>
<ol type="a">
<li><p>If Q is a positive definitive matrix. It’s obvious that <span
class="math inline">\(x^*\)</span> is a local minimum point if and only
if it is a global minimum point.</p></li>
<li><p>If Q is not a positive definitive matrix.</p></li>
</ol>
<p>Assume <span class="math inline">\(x^*\)</span> is a local minimum
point, set <span class="math inline">\(x^*+d\)</span> as the global
minimum point.</p>
<p>so <span class="math inline">\(A(x^*+d)=c\)</span></p>
<p>and because <span class="math inline">\(A(x^*)=c\)</span></p>
<p>so <span class="math inline">\(Ad=0\)</span></p>
<p>so we have <span class="math inline">\(A(x*+2d)=c\)</span></p>
<p>then according to the optimality condition, we have <span
class="math display">\[
\nabla f(x^*+d)&#39;((x^*+2d)-(x^*+d))\geq0\\
(Q(x^*+d)-b&#39;)d\geq0
\]</span> and we have <span class="math display">\[
\begin{align}
f(x^*+d)&amp;=0.5(x^*+d)&#39;Q(x^*+d)-b&#39;(x^*+d)\\
&amp;=0.5x^{*&#39;}Qx^*-bx^*+(Q(x^*+d)-b&#39;)d-0.5d&#39;Qd\\
&amp;=f(x^*)+(Q(x^*+d)-b&#39;)d-0.5d&#39;Qd\\
\end{align}
\]</span> as <span
class="math inline">\((Q(x^*+d)-b&#39;)d\geq0\)</span> and <span
class="math inline">\(-0.5d&#39;Qd\geq0\)</span></p>
<p>then <span class="math inline">\(f(x^*+d)\geq f(x^*)\)</span></p>
<p>and because <span class="math inline">\(f(x^*+d)\)</span> is the
global minimum, so we can get that <span
class="math inline">\(f(x^*+d)=f(x^*)\)</span>. and then we can conclude
that the local minimum is the global minimum.</p>
<h2 id="section-10">(2)</h2>
<blockquote>
<p>Suppose that the projected negative nablaient d is calculated
satisfying <span class="math display">\[
-g=d+A_q^T\lambda
\]</span> and that some component <span
class="math inline">\(\lambda_i\)</span> of <span
class="math inline">\(\lambda\)</span>, corresponding to an inequality,
is negative. Show that if the <span class="math inline">\(i\)</span>th
inequality is dropped, the projection <span
class="math inline">\(d_i\)</span> of the negative nablaient onto the
remaining constraints is a feasible direction of decent</p>
</blockquote>
<p>Proof:</p>
<p>Let the new direction vector <span class="math inline">\(d_i\)</span>
by relaxing the <span class="math inline">\(i\)</span>th constraint and
projecting the negative nablaient onto the subspace determined by
remaining <span class="math inline">\(q-1\)</span> active
constraints.</p>
<p>Let <span class="math inline">\(A_\bar q\)</span> denote the matrix
<span class="math inline">\(A_q\)</span> with row <span
class="math inline">\(a_j\)</span> deleted.</p>
<p>We know that <span class="math inline">\(g^Td_i&lt;0\)</span> .</p>
<p>Multiplying the equation <span class="math inline">\(-g=d_i+A^T_\bar
q\lambda_i\)</span> by <span class="math inline">\(d_i\)</span> and
using <span class="math inline">\(A_\bar q d_i=0\)</span> we obtain:
<span class="math display">\[
0&gt;g^Td_i=-\lambda_ia_i^Td_i
\]</span> Since <span class="math inline">\(\lambda_i&lt;0\)</span> , we
conclude that <span class="math inline">\(d_i^Td_i&lt;0\)</span> .</p>
<p>So the vector <span class="math inline">\(d_i\)</span> is a direction
of descent, but it is a feasible direction.</p>
<h2 id="section-11">(3) 3.1.9</h2>
<h3 id="a-5">(a)</h3>
<p><span class="math display">\[
min\ x+y+z\\
s.t. xyz=\rho^2(x+y+z)
\]</span></p>
<p>consider the Lagrangian Relaxation: <span class="math display">\[
L(x,y,z,\lambda)=x+y+z+\lambda(xyz-\rho^2(x+y+z))
\]</span> let <span class="math inline">\(\nabla L=0\)</span>, then we
have <span class="math display">\[
\left\{
    \begin{array}{**lr**}
    1+\lambda(yz-\rho^2)=0\\
    1+\lambda(xz-\rho^2)=0\\
    1+\lambda(xy-\rho^2)=0\\
    xyz=\rho^2(x+y+z)
    \end{array}
\right.
\]</span> then we have: <span class="math display">\[
\frac{y+z}x=\frac{x+z}y=\frac{x+y}z
\]</span> so <span class="math inline">\(x=y=z\)</span></p>
<h3 id="b-5">(b)</h3>
<p>consider all lines parallel to the line that passes through <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span> and</p>
<p>intersect the circle.</p>
<p>the maximal area appears only if the point <span
class="math inline">\(x\)</span> is the point of tangency between the
parallel line and the circle.</p>
<p>and we can see that the line through <span
class="math inline">\(x\)</span> and <span class="math inline">\(\hat
x\)</span> is also the line perpendicular to the tangent line and
through point <span class="math inline">\(x\)</span>.</p>
<p>so this line must passes through the center of the circle.</p>
<h3 id="c-5">(c)</h3>
<p>Fix two vertices and the corresponding side of the corresponding side
of the triangle and optimize vertex and the vertex of the circle should
be orthogonal to the fixed side. Hence, the optimal is obtained when the
two remaining side are equal. Repeating this argument, fixing each side
of the triangle in turn, we see that all sides should be equal.</p>
<h3 id="d-2">(d)</h3>
<p>Similar line of argument as in (c).</p>
<h2 id="section-12">(4) 3.3.5</h2>
<h3 id="a-6">(a)</h3>
<p>Let <span class="math inline">\(d\in \bar F(x^*)\)</span>, so <span
class="math inline">\(\exists \{d^k\}\subset F(x^*)\)</span>, so that
<span class="math inline">\(d^k\rightarrow d\)</span>.</p>
<p>And we have: <span class="math display">\[
\nabla f(x^*)&#39;d^k=lim_{\alpha\rightarrow0}\frac{f(x^*+\alpha
d^k)-f(x^*)}\alpha
\]</span></p>
<p>Because <span class="math inline">\(x^*\)</span> is a constrained
local minimum, so<span class="math inline">\(\frac{f(x^*+\alpha
d^k)-f(x^*)}\alpha\geq0\)</span> .</p>
<p>So, <span class="math inline">\(\nabla
f(x^*)&#39;d^k\geq0\)</span>.</p>
<h3 id="b-6">(b)</h3>
<p>If x* is a constrained local minimum, from (a) we can get <span
class="math display">\[
\nabla f(x^*)&#39;d^k\geq0,\ \forall d\ with\ \nabla
g_j(x^*)&#39;d\leq0,\ \forall j\in A(x^*)
\]</span> According to Farkas’Lemma, it is true iff there exists <span
class="math inline">\(u^*\)</span> such that <span
class="math display">\[
-\nabla f(x^*)=\sum_{j\in A(x^*)}u_j\nabla g_j(x^*),\ u_j^*\geq0
\]</span> Setting <span class="math inline">\(u_j^*=0\)</span> for <span
class="math inline">\(j\notin A(x^*)\)</span> .</p>
<p>we have the desired result.</p>
<h3 id="c-6">(c)</h3>
<p>We want to show that <span class="math inline">\(\bar
F(x^*)=V(x)\)</span>, where <span class="math inline">\(V(x^*)\)</span>
is the cone of first order feasible variations given by <span
class="math inline">\(V(x^*)=\{d|\nabla g_j(x^*)&#39;d\leq0,\ \forall
j\in A(x^*\}\)</span>.</p>
<p>From Mean Value Theorem, for each <span class="math inline">\(j \in
A(x^*)\)</span> and for any <span class="math inline">\(d\in
F(x^*)\)</span> there exist <span
class="math inline">\(\varepsilon\in[0,1]\)</span> such that <span
class="math inline">\(g_j(x^*+\alpha d)=g_j(x^*)+\alpha\nabla
g_j(x^*+\varepsilon\alpha d)&#39;d\)</span>.</p>
<p>Because <span class="math inline">\(g_j(x^*+\alpha d)\leq0\)</span>,
so <span class="math display">\[
\lim_{\alpha\rightarrow0}\alpha\nabla g_j(x^*+\varepsilon\alpha
d)&#39;d\leq0
\]</span> And that implies that $g_j(x^<em>)d,jA(x^</em> $, so that
<span class="math inline">\(d\in V(x^*)\)</span>. Therefore <span
class="math inline">\(F(x^*)\subset V(x)\)</span>, since <span
class="math inline">\(V(x^*)\)</span> is closed, so <span
class="math inline">\(\bar F(x^*)\subset V(x)\)</span>.</p>
<p>From each of 1-4, we can also prove that <span
class="math inline">\(\bar F(x^*)\supset V(x)\)</span>.</p>
<p>So we can get that $ F(x^*)=V(x)$.</p>
<h3 id="d-3">(d)</h3>
<p>We can easily get the local minimum is <span
class="math inline">\(x^*= (0,0)\)</span>. So we have <span
class="math display">\[
\nabla g_1(0,0)=(0,1)^T\\
\nabla g_2(0,0)=(0,-1)^T
\]</span> Obviously g1 and g2 are not linear, so the condition(1) is
violated. Furthermore, there is no vector <span class="math inline">\(d=
(d1,d2)’\)</span> such that <span class="math display">\[
\nabla g_1(0,0)&#39;d=d_2&lt;0,\ \nabla g_1(0,0)&#39;d=-d_2&lt;0
\]</span></p>
<p>So the condition2 is violated. Similarly, condition3 is violated. The
vectors <span class="math inline">\(\nabla g_1(0,0)\)</span> and <span
class="math inline">\(\nabla g_2(0,0)\)</span> are linearly dependent
since <span class="math inline">\(\nabla g_1(0,0)=-\nabla
g_2(0,0)\)</span>, so the condition4 is violated.</p>
<p>Assume <span class="math inline">\(u_0\nabla f(x^*)+u_1\nabla
g_1(x^*)+u_2\nabla g_2(x^*)=0\)</span>, so we have: <span
class="math display">\[
(u_0,u_0)&#39;+(0,u_1)&#39;+(0,u_2)&#39;=(0,0)&#39;
\]</span> It follows that <span class="math inline">\(u_0=0\)</span>. So
there is no Lagrange multiplier.</p>
<h3 id="e-1">(e)</h3>
<p>From the description we know that <span
class="math inline">\(x^*\)</span> is also a local minimum for the
modified problem.</p>
<p>The modified problem has a single constraint <span
class="math inline">\(g_1(x)=||h(x)||^2\)</span>, which is active at
<span class="math inline">\(x^*\)</span>.</p>
<p>Since <span class="math inline">\(g_1\)</span> is not linear, the
condition 1 is violated.</p>
<p>Because <span class="math inline">\(\nabla g_1(x^*)=2\nabla
h(x^*)\nabla h(x^*)=0\)</span>, the conditions 2 and 4 are violated. If
condition 3 holds, we can prove that condition 2 is hold too, so
condition 3 is violated, too. From <span
class="math inline">\(u_0^*\nabla g(x^*=-u_1^*\nabla g_1(x^*))\)</span>
and <span class="math inline">\(\nabla g_1(x^*)=0\)</span>, it follows
that <span class="math inline">\(u_0^*=0\)</span>, so there is no
Lagrange multiplier.</p>
<h2 id="section-13">(5) 5.1.7</h2>
<h3 id="a-7">(a)</h3>
<p><span class="math display">\[
let \ x_i=\left\{
    \begin{array}{**lr**}
    0 &amp; if\ the\ object\ is\ included\ in\ the\ subset\\
    1 &amp; otherwise
    \end{array}
\right.
\]</span></p>
<p>Then the total weight and value of objects included is <span
class="math inline">\(\sum_iw_ix_i\)</span> and <em>iv_ix_i,
respectively, and the problem can be written as $$
max f(x)=</em>{i=1}^nv_ix_i\</p>
<ol start="19" type="a">
<li>t._{i=1}^nw_ix_iA, xi ∈ {0, 1}, i= 1, . . . , n. $$</li>
</ol>
<h3 id="b-7">(b)</h3>
<p>Let <span class="math inline">\(\hat f(x)=-f(x)\)</span> and consider
the equivalent problem of minimizing <span class="math inline">\(\hat
f(x)\)</span> subject to the constraints given above. Then <span
class="math display">\[
L(x,\mu)=-\sum_{i=1}^nv_ix_i+\mu(\sum_{i=1}^nw_ix_i-A)
\]</span> and <span class="math display">\[
\hat q(u)=\inf_{x_i\in\{0,1\}}\{\sum_{i=1}^n(\mu w_i-v_i)x_i-\mu A\}
\]</span> Note that the minimization above is a separable problem, and
the minimum is attained at <span class="math display">\[
\hat x_i(\mu)=
\left\{
    \begin{array}{**lr**}
    0&amp; if\ \mu&lt;v_i/w_i\\
    1&amp; if\ \mu&gt;v_i/w_i\\
    o\ or\ 1 &amp; otherwise
    \end{array}
\right.
\]</span> Without loss of generality, assume that the objects are
ordered such that: <span class="math display">\[
\frac{v_1}{w_1}\leq\frac{v_2}{w_2}\leq...\leq\frac{v_n}{w_n}
\]</span> When<span
class="math inline">\(\mu\in(\frac{v_{j-1}}{w_{j-1}},\frac{v_j}{w_j}]\)</span>
for some <span class="math inline">\(j\)</span> with <span
class="math inline">\(1≤j ≤n\)</span>, then <span
class="math inline">\(\hat x_i=1\)</span> for all <span
class="math inline">\(i≥j\)</span>.</p>
<p>And $ x_i() = 0$ otherwise, and <span class="math display">\[
\hat q(\mu)=u(\sum_{i=1}^nw_i-A)-\sum_{i=1}^nv_i
\]</span> From this relation, we see that, as μ increases, the slope of
<span class="math inline">\(\hat q(u)\)</span> decreases from <span
class="math inline">\(\sum_{i=1}^nw_i-A\)</span> to <span
class="math inline">\(−A\)</span>. Therefore, if $ _{i=1}^nw_i-A&gt; 0$,
<span class="math inline">\(\hat q(u)\)</span> is maximized when the
slope of the curve goes from positive to negative. In this case, the
dual optimal value <span class="math inline">\(\hat q^*\)</span> is
attained at <span
class="math inline">\(u^*=\frac{v_i^*}{w_i^*}\)</span>, where<span
class="math inline">\(i^*\)</span>is the largest <span
class="math inline">\(i\)</span> such that <span class="math display">\[
w_1+w_2+...+w_n\geq A
\]</span></p>
<p>If <span class="math inline">\(\sum_{i=1}^nw_i-A ≤ 0\)</span>, then
the dual optimal value <span class="math inline">\(\hat q^*\)</span>is
attained at <span class="math inline">\(u^* = 0\)</span>.</p>
<h3 id="c-7">(c)</h3>
<p>Consider a relaxed version of the problem of minimizing <span
class="math inline">\(\hat f\)</span>: $$
max f_R(x)=-_{i=1}^nv_ix_i\</p>
<ol start="19" type="a">
<li>t._{i=1}^nw_ix_iA, xi ∈ [0, 1], i= 1, . . . , n. $$ Let <span
class="math inline">\(f_R^*\)</span> and <span
class="math inline">\(q_R^*\)</span> be the optimal values of the
relaxed problem and its dual, respectively.</li>
</ol>
<p>In the relaxed problem, the cost function is convex over <span
class="math inline">\(R^n\)</span>(in fact it is linear), and the
constraint set is polyhedral.</p>
<p>Thus, according to Prop. 5.2.1, there is no duality gap, and <span
class="math inline">\(f_R^*=q_R^*\)</span> . The dual function of the
relaxed problem is: <span class="math display">\[
q_R(\mu)=\inf_{x_i\in\{0,1\}}\{\sum_{i=1}^n(\mu w_i-v_i)x_i-\mu A\}
\]</span></p>
<p>Again, <span class="math inline">\(q_R(x)\)</span>is separable and
the minimum is attained at <span class="math display">\[
\hat x_i(\mu)=
\left\{
    \begin{array}{**lr**}
    0&amp; if\ \mu&lt;v_i/w_i\\
    1&amp; if\ \mu&gt;v_i/w_i\\
    o\ or\ 1 &amp; otherwise
    \end{array}
\right.
\]</span> Thus the solution is the same as the <span
class="math inline">\(\{0, 1\}\)</span> constrained problem for all
<span class="math inline">\(i\)</span> with <span
class="math inline">\(\mu\neq\frac{v_i}{w_i}\)</span>. For <span
class="math inline">\(i\)</span> with<span
class="math inline">\(\mu=\frac{v_i}{w_i}\)</span>, the value of <span
class="math inline">\(x_i\)</span> is irrelevant to the dual function
value. Therefore, <span class="math inline">\(\hat
q(u)=q_R(\mu)\)</span> for all μ, and thus <span
class="math inline">\(\hat q^*=q_R^*\)</span>.</p>
<p>Following Example 5.1.2, it can be seen that the optimal primal and
dual solution pair <span class="math inline">\((x^∗, μ^∗)\)</span> of
the relaxed problem satisfies $$ μ∗ w_i = v_i ,  if 0 &lt;x_i^*&lt;
1,\</p>
<p>μ∗ w_i v_i ,  if x_i^*=0,\</p>
<p>μ∗ w_i v_i ,  if x_i^*= 1, $$</p>
<p>In fact, it is straightforward to show that there is an optimal
solution of the relaxed problem such that at most one <span
class="math inline">\(x^*_i\)</span> satisfies <span
class="math inline">\(0 &lt; x_i^*  &lt; 1\)</span>. Consider a solution
equivalent to this optimal solution with the exception that = 0 if 0
&lt; &lt; 1. This solution is clearly feasible for the {0, 1}
constrained problem, so that we have <span class="math display">\[
\hat f^*\leq \hat f(\hat x)\leq f_R^*+\max_{i\leq i\leq n}v_i
\]</span> Combining with earlier results, <span class="math display">\[
\hat f^*\leq q_R^*+\max_{i\leq i\leq n}v_i=\hat q^*+\max_{i\leq i\leq
n}v_i
\]</span> Since <span class="math inline">\(\hat f^*=-f\)</span> and
<span class="math inline">\(\hat q^*=-q^*\)</span> we have the desired
result.</p>
<h3 id="d-4">(d)</h3>
<p>Since the object weights and values remain the same we have from (c)
that <span class="math inline">\(0\leq q^*(k)-f^*(k)\leq \max_{i\leq
i\leq n}v_i\)</span>. By including in the subset each replica of an
object assembled in the optimal solution to the original problem, we see
that <span class="math inline">\(f^*(k)\geq kf^*\)</span> . It then
follows that <span class="math display">\[
\lim_{k\rightarrow\infty}(q^*(k)-f^*(k))=0
\]</span></p>
<h1 id="assignment-3">Assignment 3</h1>
<h2 id="section-14">5.5.2</h2>
<p><span class="math display">\[
min\ \ f(x)=10x_1+3x_2\\
s.t.\ \ 5x_1+x_2\geq4\ \ x_1,x_2\in\{0,1\}
\]</span></p>
<p>Using Lagrangian relaxiation:</p>
<p>the Lagrangian funcion is <span class="math display">\[
L(x,\mu)=10x_1+3x_2+\mu(4-5x_1-x_2)=(10-5\mu)x_1+(3-\mu)x_2+4\mu
\]</span> the dual problem is: <span class="math display">\[
max\ \ q(\mu)=\min_{x\in\{0,1\}}L(x,\mu)\\
s.t.\ \ \mu\geq0
\]</span> the solution is <span class="math inline">\(\mu=2,
q^*=8\)</span></p>
<p>Using constraint relaxation:</p>
<p>the releaxed problem is: <span class="math display">\[
min\ \ f(x)=10x_1+3x_2\\
s.t.\ \ 5x_1+x_2\geq4\ \ x_1,x_2\in[0,1]
\]</span> (a) when <span class="math inline">\(x_1=0\)</span>, the
prolem is: <span class="math display">\[
min\ \ f(x)=3x_2\\
s.t.\ \ x_2\geq4\ \ x_2\in[0,1]
\]</span> this problem is infeasible.</p>
<ol start="2" type="a">
<li>when <span class="math inline">\(x_1=1\)</span>, the problem is:
<span class="math display">\[
min\ \ f(x)=10+3x_2\\
s.t.\ \ 5+x_2\geq4\ \ x_2\in [0,1]
\]</span> when <span class="math inline">\(x_2=0\)</span>, the value of
object function is minimization. so the solution is <span
class="math inline">\((1,0)\)</span>, it is also integer solution, so
the point <span class="math inline">\((1,0)\)</span> is the optimal
point of the primal problem, minimization is 10</li>
</ol>
<p>so the lower bound of Lagrangian relaxiation is less than constraint
relaxation.</p>
<h2 id="section-15">5.5.10</h2>
<ol type="a">
<li><p><span class="math display">\[
\begin{align*}
\bar q&amp;=\inf_{x\in \bar X}\{f(x)+\sum_{j=0}^{\bar r}\mu_jg_j(x)\}\\
   &amp;=\inf_{\ \ \ \ \ \ \ \ \ \ x\in X\\g_{\bar
r+1}(x)\leq0...g_r(x)\leq0}\{f(x)+\sum_{j=1}^{\bar r}\mu_jg_j(x)\}\\
   &amp;\geq \inf_{\ \ \ \ \ \ \ \ \ \ x\in X\\g_{\bar
r+1}(x)\leq0...g_r(x)\leq0}\{f(x)+\sum_{j=1}^{r}\mu_jg_j(x)\}\\
   &amp;\geq \inf_{x\in X}\{f(x)+\sum_{j=1}^{r}\mu_jg_j(x)\}\\
   &amp;=q
\end{align*}
\]</span> so we have <span class="math inline">\(\bar q^*\geq
q^*\)</span>, and we have <span class="math inline">\(\bar q^*\leq
f^*\)</span> by the weak duality theorem, so <span
class="math inline">\(q^*\leq\bar q^*\leq f^*\)</span></p></li>
<li></li>
</ol>
<p>if <span class="math inline">\(q^*=f^*\)</span>, and we have<span
class="math inline">\(q^*\leq\bar q^*\leq f^*\)</span></p>
<p>so we can get <span class="math inline">\(q^*=\bar
q^*=f^*\)</span></p>
<ol start="3" type="a">
<li><span class="math display">\[
min\ \  f(x)=e^{-x_1x_2}\\
s.t.\ \ x_1=0,\ x_1-1\leq0,\ x\in X=\{x|x\geq0\}
\]</span></li>
</ol>
<p><span class="math display">\[
\bar X=\{x|x\geq0, x_1=0\}
\]</span></p>
<p>and we can get <span class="math inline">\(q^*=0,\bar
q^*=f^*=1\)</span>, so <span class="math inline">\(q^*&lt;\bar
q^*=f^*\)</span></p>
<h2 id="section-16">6.3.1</h2>
<ol type="a">
<li></li>
</ol>
<p>Let <span class="math inline">\(\mu^∗\)</span> be a dual optimal
solution, we obtain: <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-2s^k(q^*-q(u^k))+(s^k)^2||g^k||^2
\]</span> where <span class="math inline">\(q^*=q(\mu^*)\)</span>, <span
class="math inline">\(s^k=\frac{q^*-q(\mu^k)}{||g^k||^2}\)</span>, and
we have: <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-\frac{q^*-q(\mu^k)}{||g^k||^2}
\]</span> So <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq ||\mu^{k}-\mu^*||^2,\ \ \forall k
\]</span> implying that <span class="math inline">\(\{\mu^k\}\)</span>
is bounded.</p>
<ol start="2" type="a">
<li></li>
</ol>
<p>Let <span class="math inline">\(C\)</span> be a positive constant
such that <span class="math inline">\(||g^k|| ≤ C\)</span> for all <span
class="math inline">\(k\)</span>, then <span class="math display">\[
||\mu^{k+1}-\mu^*||^2+\frac{q^*-q(\mu^k)}{C^2}\leq ||\mu^{k}-\mu^*||^2
\]</span> By summing these inequalities over all <span
class="math inline">\(k\)</span>, we obtain <span
class="math display">\[
\frac1{C^2}\sum_{k=0}^\infty(q^*-q(\mu^k))^2\leq||\mu^0-\mu^*||^2
\]</span> so <span class="math inline">\(\lim_{k\rightarrow
\infty}q(\mu^k)=q^*\)</span></p>
<p>Since <span class="math inline">\({\mu^k}\)</span> is bounded, there
exist a vector <span class="math inline">\(\hat \mu\)</span> and a
subsequence ${^k}_{kK} {^k} $converging to <span
class="math inline">\(\hat\mu ∈ M\)</span>. By using the
upper-semicontinuity of q, we have <span class="math display">\[
\lim_{k\rightarrow\infty}\sup_{k\in\mathcal K}q(\mu^k)\leq q(\hat
\mu)\leq q^*
\]</span> Now we show that <span
class="math inline">\(\{\mu^k\}\)</span> actually converges. Let <span
class="math inline">\(M^∗\)</span> denote the set of all dual optimal
solutions. Note that <span class="math inline">\(M^∗\)</span> is convex
(by concavity of <span class="math inline">\(q\)</span>) and closed (by
upper-semicontinuity of <span class="math inline">\(q\)</span>). Suppose
that <span class="math inline">\(\{\mu^k\}\)</span> has two distinct
limit points, say <span class="math inline">\(\hat\mu \in M^∗\)</span>
and <span class="math inline">\(\widetilde\mu \in M^∗\)</span>. As seen
in (a), for any <span class="math inline">\(\mu^* \in M^∗\)</span>, the
sequence <span class="math inline">\(\{||\mu^k − \mu^∗||\}\)</span>
decreases monotonically, and therefore it converges. Hence <span
class="math inline">\(||\hat\mu − \mu^∗|| = ||\widetilde\mu  −
\mu^∗||\)</span> for all <span class="math inline">\(\mu^* \in
M^∗\)</span>, implying that <span class="math inline">\(\hat
\mu=\widetilde \mu\)</span>.</p>
<ol start="3" type="a">
<li></li>
</ol>
<p>Let <span class="math inline">\(q\)</span> be real-valued and concave
over the entire space <span class="math inline">\(\mathbb{R}^r\)</span>.
According to Prop. B.24 of Appendix B, since <span
class="math inline">\(\{\mu^k\}\)</span> is bounded, the set <span
class="math inline">\(∪_{k≥0}∂q(\mu^k)\)</span> is bounded, and so is
<span class="math inline">\(\{g^k\}\)</span>.</p>
<h2 id="section-17">6.3.3</h2>
<ol type="a">
<li></li>
</ol>
<p>Suppose that <span
class="math inline">\(\lim_{k\rightarrow\infty}\inf\sqrt{k}(q^*-q(\mu^k))&gt;0\)</span>,
Then there is an <span class="math inline">\(\epsilon&gt;0\)</span> and
large enough <span class="math inline">\(\bar k\)</span> such that <span
class="math inline">\(\sqrt{k}(q^*-q(\mu^k))\geq\epsilon\)</span> for
all <span class="math inline">\(k\geq \bar k\)</span>, so <span
class="math display">\[
(q^*-q(\mu^k))^2\geq\frac{\epsilon^2}{k},\ \ \ \ \forall k\geq \bar k
\]</span> implying that <span class="math display">\[
\sum_{k=\bar k}^\infty(q^*-q(\mu^k))^2\geq \epsilon^2\sum_{k=\bar
k}^\infty\frac1k=\infty
\]</span> which contradicts the relation <span class="math display">\[
\sum_{k=0}^\infty(q^*-q(\mu^k))^2&lt;\infty
\]</span> (b)</p>
<p>As seen in 6.3.1, we have for all dual optimal solutions <span
class="math inline">\(\mu^*\)</span> and all <span
class="math inline">\(k\)</span> <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-\frac{q^*-q(\mu^k)}{||g^k||^2}
\]</span> This relation and the inequality <span
class="math inline">\(q(\mu^∗) − q(\mu^k) ≥ a||\mu^∗ − \mu^k||\)</span>
yield for all <span class="math inline">\(k\)</span> <span
class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-\frac{a^2||\mu^k-\mu^*||^2}{||g^k||^2}
\]</span> from which, by using <span class="math inline">\(\sup_{k≥0}
||g^k||≤ b\)</span>, we obtain <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq (1-\frac{a^2}{b^2})||\mu^{k}-\mu^*||^2
\]</span> and the desired relation follows.</p>
<h1 id="assignment-4">Assignment 4</h1>
<h2 id="section-18">2.1</h2>
<h3 id="a-8">(a)</h3>
<figure>
<img
src="https://download.kezhi.tech/img/20220105160426.png?x-oss-process=style/webp"
alt="the precedence constraints graph" />
<figcaption aria-hidden="true">the precedence constraints
graph</figcaption>
</figure>
<h3 id="b-8">(b)</h3>
<p>We cloud use dynamic program to solve this question, the
computational process is following:</p>
<figure>
<img
src="https://download.kezhi.tech/img/20220105161308.png?x-oss-process=style/webp"
alt="computational process of dp" />
<figcaption aria-hidden="true">computational process of dp</figcaption>
</figure>
<p>and the makespan of this project is 39 weeks</p>
<h3 id="c-8">(c)</h3>
<figure>
<img
src="https://download.kezhi.tech/img/20220105161505.png?x-oss-process=style/webp"
alt="Most cost trace" />
<figcaption aria-hidden="true">Most cost trace</figcaption>
</figure>
<p>This is the most cost trace of the project, shorting each of them
could save a week time.</p>
<p>job 7 (Walls) should be shorten most since it cost 10 weeks and all
the following work must wait for its finishing.</p>
<h2 id="section-19">2.4</h2>
<h3 id="a-9">(a)</h3>
<p>The processor sharing is a service discipline where a number of jobs
are processed simultaneously, it can be seen that the processing could
be interrupt any time. For CPU, the processing already done on the
preempted job is not lost, so the model of the processor sharing concept
on CPU is <em>Preemptive-Resume</em> form.</p>
<h3 id="b-9">(b)</h3>
<p>Assume that the switch of job takes no time, there are <span
class="math inline">\(n\)</span> jobs need to be processed, each job has
a weight <span class="math inline">\(w_j\)</span> and process time <span
class="math inline">\(c_j\)</span>. Function <span
class="math inline">\(g(j,t)\)</span> shows if the job <span
class="math inline">\(j\)</span> has been finished on time <span
class="math inline">\(t\)</span>, if finished, <span
class="math inline">\(g(j,t)=0\)</span>; else <span
class="math inline">\(g(j,t)=1\)</span>. Function <span
class="math inline">\(f(j,t)=1\)</span> shows that job <span
class="math inline">\(j\)</span> are processed on time t, <span
class="math inline">\(f(j,t)=0\)</span> shows that job <span
class="math inline">\(j\)</span> are not processed on time t</p>
<p>We would like the cpu process the job with high weight as quickly as
possible, so we get the following objective optimization problem: <span
class="math display">\[
min\ \ \sum_{j=1}^n\int_0^{+\infty}g(j,t)w_j\\
s.t.\ \ \sum_{j=1}^nf(j,t)\leq 1\\
\ \ \ \ g(j,t)=\left\{
    \begin{array}{**lr**}
    1 &amp; if \int_0^tf(j,\tau)d\tau\geq c_j\\
    0 &amp; otherwise
    \end{array}
\right.\\
\int_0^{+\infty}f(j,\tau)d\tau=c_j
\]</span></p>
<h2 id="section-20">2.9</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">jobs</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(p_{1j}\)</span></td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">12</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(p_{2j}\)</span></td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">6</td>
</tr>
</tbody>
</table>
<p>Consider the instance of O2 || Cmax with 4 jobs. The processing times
of the four jobs on the two machines are above. Find all optimal
schedules and compute the makespan under an optimal schedule.</p>
<p>we could easily find that the sum of processing time of job 1 and job
4 on machine 1 is similiar as the sum of processing time of job 2 and
job 3 on machine 2; and the sum of processing time of job 1 and job 4 on
machine 21 is same as the sum of processing time of job 2 and job 3 on
machine 1. so all the optimial schedule is following:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">machine 1</th>
<th style="text-align: center;">machine 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1-&gt;4-&gt;2-&gt;3</td>
<td style="text-align: center;">2-&gt;3-&gt;1-&gt;4</td>
</tr>
<tr class="even">
<td style="text-align: center;">1-&gt;4-&gt;2-&gt;3</td>
<td style="text-align: center;">3-&gt;2-&gt;1-&gt;4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4-&gt;1-&gt;2-&gt;3</td>
<td style="text-align: center;">2-&gt;3-&gt;4-&gt;1</td>
</tr>
<tr class="even">
<td style="text-align: center;">4-&gt;1-&gt;2-&gt;3</td>
<td style="text-align: center;">3-&gt;2-&gt;4-&gt;1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(2-&gt;3 or 3-&gt;2)-&gt;(1-&gt;4 or
4-&gt;1)</td>
<td style="text-align: center;">(1-&gt;4 or 4-&gt;1)-&gt;(2-&gt;3 or
3-&gt;2)</td>
</tr>
</tbody>
</table>
<p>and the minimum cost time is 30</p>
<h2 id="a-10">a</h2>
<p>Find the optimal sequence for the following <span
class="math inline">\(1|| \sum_iw_iT_i\)</span> problem:</p>
<p><em>Jobs</em> 1 2 3 4 5 6 7</p>
<p><em>pi</em> 6 18 12 10 10 17 16</p>
<p><em>wi</em> 1 5 2 4 1 4 2</p>
<p><em>di</em> 8 42 44 24 90 85 68</p>
<p>For this problem, <span
class="math inline">\(T_i=max(C_i-d_i,0)\)</span>, if we would like to
minimum <span class="math inline">\(\sum_iw_iT_i\)</span>, we should try
to make <span class="math inline">\(C_i&lt;d_i\)</span>.</p>
<p>so we firstly choose the job 1 and job 4, the sequence now is
1-&gt;4, then the problem change to:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">jobs</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(p_i\)</span></td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">16</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(w_i\)</span></td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(d_i\)</span></td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">28</td>
<td style="text-align: center;">74</td>
<td style="text-align: center;">69</td>
<td style="text-align: center;">52</td>
</tr>
</tbody>
</table>
<p>then we choose job 2 and job 3, and we can see that <span
class="math inline">\(w_2=5&gt;w_3=1\)</span> and <span
class="math inline">\(p_2+p_3=30&gt;28&gt;26\)</span>. In order to less
the objective function, job 2 should be done befor job 3, so the
sequence now is 1-&gt;4-&gt;2-&gt;3, the problem change to:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">jobs</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(p_i\)</span></td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">16</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(w_i\)</span></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(d_i\)</span></td>
<td style="text-align: center;">44</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">22</td>
</tr>
</tbody>
</table>
<p>then we could get the fianl sequence:
1-&gt;4-&gt;2-&gt;3-&gt;7-&gt;6-&gt;5。</p>
<p>and the minimum of the objective funciton <span
class="math inline">\(\sum_iw_iT_{i}=4\)</span></p>
<h2 id="b-10">b</h2>
<p>For the above problem, what is the optimal schedule if there are two
identical machines?</p>
<p>the schedual changes to:</p>
<p>machine 1: 1-&gt;2-&gt;7-&gt;5</p>
<p>machine 2: 4-&gt;3-&gt;6</p>
<h2 id="c-9">c</h2>
<p>In applying Lagrangian relaxation to parallel machine scheduling
problems, what will happen when ALL the parts are identical, i.e., have
the same processing time and the same due date? Examine the problem from
both the primal aspect and the dual aspect. What can be done to improve
algorithm performance?</p>
<p>We can separate the problem to sub-problems, no matter in primal or
dual aspect, if all the parts are identical. We also can consider all
the parts as a whole and so do the machines and simplify the
parallel-machine problem to one machine problem.</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Optimal</tag>
        <tag>Schedule</tag>
      </tags>
  </entry>
  <entry>
    <title>XJTU System Optimization and Scheduling Final Report</title>
    <url>/a7067052.html</url>
    <content><![CDATA[<h1 id="分支定界法在背包问题中的应用">分支定界法在背包问题中的应用</h1>
<p>西安交通大学《系统优化与调度》课程期末报告</p>
<p><img src="https://download.kezhi.tech/img/202211291638345.jpg?x-oss-process=style/webp" style="width:30%;" /></p>
<span id="more"></span>
<h2 id="背景简介">1 背景简介</h2>
<p>背包问题（Knapsack
problem）是一种组合优化的NP完全（NP-Complete，NPC）问题。问题可以描述为：给定一组物品，每种物品都有自己的重量和价格，在限定的总重量内，我们如何选择，才能使得物品的总价格最高。问题的名称来源于如何选择最合适的物品放置于给定背包中。相似问题经常出现在商业、组合数学，计算复杂性理论、密码学和应用数学等领域中。</p>
<h2 id="数学描述">2 数学描述</h2>
<p>背包问题根据物品数量限制的不同分为以下三类：0-1背包问题，完全背包问题和多重背包问题。0-1背包问题是指每样物品只有一件，即每件物品只有未放入背包和放入背包（0和1）两种状态；而在完全背包问题中，每样物品的数量没有限制，即可以向背包中放入任意多个任意物品；多重背包问题则是指每样物品有一定的数量限制，即在背包中放入的某样物品数量不能超过其数量限制。下文将分别介绍这三类背包问题的数学描述。</p>
<h3 id="背包问题">2.1 0-1 背包问题</h3>
<p>最基本的背包问题，其数学描述为：有 <span
class="math inline">\(n\)</span> 件物品，物品 <span
class="math inline">\(i\)</span>
的体积（有时也被称为代价，重量等。后文均使用体积作为代表）为 <span
class="math inline">\(w_i\)</span>，价值为 <span
class="math inline">\(v_i\)</span>。背包的容积（预算，最大承受重量等。后文均使用体积作为代表）为
<span
class="math inline">\(W\)</span>。限定每个物品最多只能往背包中放入1个，求将那些物品装入背包可以使装入物品的总体积不超过背包的容积并且总价值最大。即：
<span class="math display">\[
\max \sum_{i=1}^nv_ix_i\\
s.t.\left\{
    \begin{array}{**lr**}
    \sum_{i=1}^nw_ix_i\leq W\\
    x_i\in\{0,1\}
    \end{array}
\right.
\]</span></p>
<h3 id="完全背包问题">2.2 完全背包问题</h3>
<p>完全背包问题的数学描述为：有 <span class="math inline">\(n\)</span>
件物品，物品 <span class="math inline">\(i\)</span> 的体积为 <span
class="math inline">\(w_i\)</span>，价值为 <span
class="math inline">\(v_i\)</span>。背包的容积为 <span
class="math inline">\(W\)</span>。每件物品有无穷多个，求如何将物品装入背包可以使装入物品的总体积不超过背包的容积并且总价值最大。即：
<span class="math display">\[
\max \sum_{i=1}^nv_ix_i\\
s.t.\left\{
    \begin{array}{**lr**}
    \sum_{i=1}^nw_ix_i\leq W\\
    x_i\in N_+
    \end{array}
\right.
\]</span></p>
<h3 id="多重背包问题">2.3 多重背包问题</h3>
<p>多重背包问题的数学描述为：有 <span class="math inline">\(n\)</span>
件物品，物品 <span class="math inline">\(i\)</span> 的体积为 <span
class="math inline">\(w_i\)</span>，价值为 <span
class="math inline">\(v_i\)</span>，数量为<span
class="math inline">\(b_i\)</span>。背包的容积为 <span
class="math inline">\(W\)</span>。求如何将物品装入背包可以使装入物品的总体积不超过背包的容积并且总价值最大。即：
<span class="math display">\[
\max \sum_{i=1}^nv_ix_i\\
s.t.\left\{
    \begin{array}{**lr**}
    \sum_{i=1}^nw_ix_i\leq W\\
    x_i\leq m_i\\
    x_i\in N_+\\
    \end{array}
\right.
\]</span></p>
<h2 id="求解算法">3 求解算法</h2>
<h3 id="分支定界算法">3.1 分支定界算法</h3>
<p>分支定界法（branch and
bound）是一种求解整数规划问题的最常用算法。这种方法不但可以求解纯整数规划，还可以求解混合整数规划问题。分支定界法是一种搜索与迭代的方法，选择不同的分支变量和子问题进行分支。通常，把全部可行解空间反复地分割为越来越小的子集，称为分支；并且对每个子集内的解集计算一个目标下界（对于最小值问题），这称为定界。在每次分枝后，凡是界限超出已知可行解集目标值的那些子集不再进一步分枝，这样，许多子集可不予考虑，这称剪枝。这就是分枝定界法的主要思路。分支定界算法的步骤如下：</p>
<blockquote>
<ol type="1">
<li>对于最小化问题，设定初始最优解的值为 <span
class="math inline">\(best=+\infty\)</span>;</li>
<li>根据分枝法则（Branching
rule），从尚未被洞悉（Fathomed）的节点（局部解）中选择一个节点，并在此节点的下一阶层中分为几个新的节点；</li>
<li>根据下界函数计算出每个节点的下界值（Lower Bound，LB）；</li>
<li>若节点的下限值大于当前最优值 <span
class="math inline">\(best\)</span>，则其之后的节点中不包含可行解，因此该节点在后续计算中将不再被考虑；若已找到在此节点中，具最小下限值的可行解，则停止向下搜索；否则将该节点作为未洞悉节点继续向下搜索；</li>
<li>判断是否仍有尚未被洞悉的节点，如果有，则进行步骤二，如果已无尚未被洞悉的节点，则演算停止，并得到最优解。</li>
</ol>
</blockquote>
<p>分支定界算法的关键在于分支规则和下界函数的选取。对于不同的问题，有着不同的选取方式。在背包问题中，将每件物品放入的数量作为分支依据，每件物品的不同选取方式产生搜索树的不同层。下界函数可以通过松弛放入物品个数为整数这个约束来进行计算。具体算法见后文。</p>
<h3 id="求解0-1背包问题">3.2 求解0-1背包问题</h3>
<p>在此问题中，节点的Lower Bound 的计算方法如下：</p>
<blockquote>
<ol type="1">
<li>计算每件物品的单位体积价值，即 <span
class="math inline">\(p_i=v_i/w_i\)</span>；</li>
<li>计算已经确定状态（装入/不装入）物品的总体积 <span
class="math inline">\(w_{sum}\)</span> 和总价值 <span
class="math inline">\(v_{sum}\)</span>；</li>
<li>若 <span
class="math inline">\(w_{sum}&gt;W\)</span>，则节点无效；否则从未确定状态的物品中挑选单位体积价值最高的物品依次装入背包，直到将背包装满（此时可以装入浮点数个物品，如6/7个物品2，松弛条件在这里生效）。再次计算背包中物品的总价值
<span class="math inline">\(v_{sum}\)</span>，即为该节点的 Lower
Bound。</li>
</ol>
</blockquote>
<p>分支定界算法过程如下：</p>
<blockquote>
<ol type="1">
<li>创建空队列，将根节点放入队列中；</li>
<li>从队列中选取一个节点，生成该节点的子节点。若无子节点说明该节点为可行解，与当前最优解进行比较，若小于最优解则替换当前最优解；若子节点存在，则计算每个子节点的Lower
Bound，若子节点不合法或者Lower
Bound大于当前最优解则将该节点舍去，否则将该节点加入队列中。</li>
<li>重复步骤2直到队列为空，此时保留下来的最优解即为该问题最优解。</li>
</ol>
</blockquote>
<p>节点生成算法如下：</p>
<blockquote>
<ol type="1">
<li>找出所有未确定状态的物品；</li>
<li>选出这些物品中单位体积价值最大的物品；</li>
<li>生成两个节点分别为放入该物品和不放入该物品之后的状态节点。</li>
</ol>
</blockquote>
<p>在分支定界过程中，从队列中选取节点方法主要有以下两种：</p>
<ul>
<li>FIFO
选取，即先入先出，依照队列的顺序进行节点的选取。优点为存储空间需求较小；缺点为搜索方式类似BFS，需要大量的运算后才能搜索到可行解从而更新最优解和剪枝，运算量较大。</li>
<li>优先队列选取，每次从队列中选取Lower
Bound最小的节点进行探索。优点为运算量小，快速向下探索更新可行最优解便于更有效的剪枝；缺点为需要更多的存储空间。</li>
</ul>
<p>以一个简单的0-1背包问题为例：</p>
<p>背包容量为10，物品个数为5，其体积和价值如下表所示：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">cost</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">value</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">6</td>
</tr>
</tbody>
</table>
<p>通过以上两种不同节点选取方式计算出的结果均为：</p>
<p>选取物品1, 2,
5，最大价值为15。其中，采用FIFO选取算法循环运算46次，采用优先队列选取算法循环运算13次。</p>
<h3 id="求解多维背包问题">3.3 求解多维背包问题</h3>
<p>多维背包问题与0-1背包问题的区别在于，每件物品可以放入背包一定数量以内个而非只有一个，即物品
<span class="math inline">\(i\)</span> 最多可以在背包中放入 <span
class="math inline">\(b_i\)</span>
个。通过对0-1背包问题的分支定界求解算法作出一部分调整即可进行求解。改动如下：</p>
<p>在此问题中，节点的Lower Bound 的计算方法如下：</p>
<blockquote>
<ol type="1">
<li>计算每件物品的单位体积价值，即 <span
class="math inline">\(p_i=v_i/w_i\)</span>；</li>
<li>计算已经确定装入数量物品的总体积 <span
class="math inline">\(w_{sum}\)</span> 和总价值 <span
class="math inline">\(v_{sum}\)</span>；</li>
<li>若 <span
class="math inline">\(w_{sum}&gt;W\)</span>，则节点无效；否则从未确定状态的物品中挑选单位体积价值最高的物品依次装入背包，直到将背包装满（此时可以装入浮点数个物品，如1.5个物品2，松弛条件在这里生效）。再次计算背包中物品的总价值
<span class="math inline">\(v_{sum}\)</span>，即为该节点的 Lower
Bound。</li>
</ol>
</blockquote>
<p>子节点生成的计算方法如下：</p>
<blockquote>
<ol type="1">
<li>找出所有未确定状态的物品；</li>
<li>选出这些物品中单位体积价值最大的物品；</li>
<li>根据该物品的数量限制 <span class="math inline">\(b_i\)</span> 生成
<span class="math inline">\(b_{i}+1\)</span>
个子节点，每个子节点分别放入该物品 <span
class="math inline">\(0,1,...,b_{i}\)</span>个</li>
</ol>
</blockquote>
<p>其余部分的计算方法与0-1背包问题相同。通过多次迭代即可得到最优解。</p>
<h3 id="求解完全背包问题">3.4 求解完全背包问题</h3>
<p>分支定界算法的核心部分为剪枝搜索，而完全背包问题每一件物品没有数量限制。这就导致每一个搜索树中的非叶节点有无穷个子节点。采用该算法无法构建与之对应的搜索树。因此，对于完全背包问题，分支定界算法并不适用。</p>
<h2 id="数值运算">4 数值运算</h2>
<h3 id="背包问题数值运算">4.1 0-1 背包问题数值运算</h3>
<p>选取多个背包问题对上述算法进行测试（具体测试数据见附录），测试结果如下：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">物品个数</th>
<th style="text-align: center;">背包大小</th>
<th style="text-align: center;">最大价值</th>
<th style="text-align: center;">循环次数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">133</td>
<td style="text-align: center;">10</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">334</td>
<td style="text-align: center;">14</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">383</td>
<td style="text-align: center;">20</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">2614</td>
<td style="text-align: center;">276</td>
</tr>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">2541</td>
<td style="text-align: center;">287</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">2617</td>
<td style="text-align: center;">244</td>
</tr>
</tbody>
</table>
<p>上述计算结果均使用优先队列选取方式，其运算速度相较于队列选取计算速度要快上很多。此外，动态规划也常用来求解背包问题。但动态规划求解的复杂度对数据敏感，在同样大小，不同内容的数据上的复杂度不同。而分支定界法在一般情况下计算时间复杂度较为稳定，基本不会受到数据内容的影响。</p>
<h3 id="多重背包问题数值运算">4.2 多重背包问题数值运算</h3>
<p>其余数据与上述0-1背包相同，增加每件物品的数量限制，将每件物品的数量上限均设置为2个，得到计算结果如下</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">物品个数</th>
<th style="text-align: center;">背包大小</th>
<th style="text-align: center;">最大价值</th>
<th style="text-align: center;">循环次数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">196</td>
<td style="text-align: center;">16</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">481</td>
<td style="text-align: center;">38</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">559</td>
<td style="text-align: center;">44</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">3645</td>
<td style="text-align: center;">12580</td>
</tr>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">3766</td>
<td style="text-align: center;">14216</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">3440</td>
<td style="text-align: center;">9490</td>
</tr>
</tbody>
</table>
<p>上述计算结果均使用优先队列选取方式，可以看出，相较于0-1背包问题，计算多重背包问题需要更长的时间。这是因为增加物品数量会指数级提升搜索树的节点个数。从而大大提升计算所需要的循环次数。因此，分支定界算对于大规模的多重背包问题并不适用。</p>
<h2 id="小结">5 小结</h2>
<p>分支定界算法是一种剪枝搜索算法，其核心思想在于通过松弛部分约束条件来快速求得每种状态下的Lower
Bound，通过Lower
Bound和Best比较来进行剪枝。从而快速去除大量不存在可行解的区域，最终快速求得最优解。</p>
<p>但是，分支定界算法也有其固有的局限性。首先，分支定界算法在计算时需要在搜索树中进行搜索。这在面对多维大规模的问题时，虽然通过剪枝可以减少很多不必要的搜索过程，但剩余的搜索规模依然很大，特别是在搜索树很深时，增加一点宽度就可能会增加大量的计算量；其次，分支定界算法在数学上是不稳定的，其剪枝过程依赖的
Lower Bound
是下届而非下确界，因此完全可以构造一组数据使得分支定界算法无法完成剪枝操作从而使其需要搜索树中的每个节点，大大增加算法的复杂度。</p>
<h2 id="附录">6 附录</h2>
<h3 id="数值计算代码">数值计算代码</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># simple example</span></span><br><span class="line">N=<span class="number">5</span></span><br><span class="line">W=<span class="number">20</span></span><br><span class="line">w=np.array([<span class="number">2</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>])</span><br><span class="line">v=-np.array([<span class="number">6</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>])</span><br><span class="line">b=np.array([<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># read data from file</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;temp.txt&#x27;</span>,<span class="string">&#x27;r+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    w=[]</span><br><span class="line">    v=[]</span><br><span class="line">    text=f.readline()[:-<span class="number">1</span>]</span><br><span class="line">    data=text.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    N=<span class="built_in">int</span>(data[<span class="number">0</span>])</span><br><span class="line">    W=<span class="built_in">int</span>(data[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        text=f.readline()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> text:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        text=text[:-<span class="number">1</span>]</span><br><span class="line">        data=text.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        w.append(<span class="built_in">int</span>(data[<span class="number">0</span>]))</span><br><span class="line">        v.append(<span class="built_in">int</span>(data[<span class="number">1</span>]))</span><br><span class="line">    w=np.array(w)</span><br><span class="line">    v=-np.array(v)</span><br><span class="line"></span><br><span class="line">b=np.array([<span class="number">2</span>]*<span class="number">100</span>)</span><br><span class="line">root_state=[-<span class="number">1</span>]*N</span><br><span class="line"></span><br><span class="line">v_per_w=v/w</span><br><span class="line">sort_index=np.argsort(v_per_w)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_min_good</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sort_index:</span><br><span class="line">        <span class="keyword">if</span> state[i]&lt;<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lower_bound</span>(<span class="params">state</span>):</span><br><span class="line">    w_sum=<span class="number">0</span></span><br><span class="line">    v_sum=<span class="number">0</span></span><br><span class="line">    state=<span class="built_in">list</span>(state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i,s <span class="keyword">in</span> <span class="built_in">enumerate</span>(state):</span><br><span class="line">        <span class="keyword">if</span> s&gt;=<span class="number">0</span>:</span><br><span class="line">            w_sum+=w[i]*s</span><br><span class="line">            v_sum+=v[i]*s</span><br><span class="line">    <span class="keyword">if</span> w_sum&gt;W:</span><br><span class="line">        <span class="keyword">return</span> math.inf</span><br><span class="line">    <span class="keyword">while</span> w_sum&lt;W:</span><br><span class="line">        w_free=W-w_sum</span><br><span class="line">        selected_good=get_min_good(state)</span><br><span class="line">        <span class="keyword">if</span> selected_good <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> w[selected_good]&lt;w_free*b[selected_good]:</span><br><span class="line">            w_sum+=w[selected_good]*b[selected_good]</span><br><span class="line">            v_sum+=v[selected_good]*b[selected_good]</span><br><span class="line">            state[selected_good]=b[selected_good]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            w_sum=W</span><br><span class="line">            v_sum+=v[selected_good]*w_free/w[selected_good]</span><br><span class="line">    <span class="keyword">return</span> v_sum</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_children</span>(<span class="params">state</span>):</span><br><span class="line">    selected_good=get_min_good(state)</span><br><span class="line">    <span class="keyword">if</span> selected_good <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    state_list=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(b[selected_good]+<span class="number">1</span>):</span><br><span class="line">        child=<span class="built_in">list</span>(state)</span><br><span class="line">        child[selected_good]=i</span><br><span class="line">        state_list.append(child)</span><br><span class="line">    <span class="keyword">return</span> state_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># calculate the accurate value of state</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">state</span>):</span><br><span class="line">    w_sum=<span class="number">0</span></span><br><span class="line">    v_sum=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i,s <span class="keyword">in</span> <span class="built_in">enumerate</span>(state):</span><br><span class="line">        <span class="keyword">if</span> s&gt;=<span class="number">0</span>:</span><br><span class="line">            w_sum+=w[i]*s</span><br><span class="line">            v_sum+=v[i]*s</span><br><span class="line">    <span class="keyword">if</span> w_sum&gt;W:</span><br><span class="line">        <span class="keyword">return</span> math.inf</span><br><span class="line">    <span class="keyword">return</span> v_sum</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">queue_search</span>(<span class="params">state</span>):</span><br><span class="line">    best=math.inf</span><br><span class="line">    best_state=<span class="literal">None</span></span><br><span class="line">    temporal_cost=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    search_queue=queue.SimpleQueue()</span><br><span class="line">    search_queue.put(state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> search_queue.empty():</span><br><span class="line">        temporal_cost+=<span class="number">1</span></span><br><span class="line">        state_now=search_queue.get()</span><br><span class="line">        state_list=get_children(state_now)</span><br><span class="line">        <span class="keyword">if</span> state_list <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> best&gt;func(state_now):</span><br><span class="line">                best=func(state_now)</span><br><span class="line">                best_state=state_now</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            bound=lower_bound(state)</span><br><span class="line">            <span class="keyword">if</span> bound == math.inf <span class="keyword">or</span> bound&gt;best:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            search_queue.put(state)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;FIFO Search\n    Temporal Cost:&#x27;</span>,temporal_cost,<span class="string">&#x27;Optimal Result:&#x27;</span>,best_state,<span class="string">&#x27;Optimal Value:&#x27;</span>,best)</span><br><span class="line">    <span class="keyword">return</span> best,best_state</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,state</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.state=state</span><br><span class="line">        self.bound=lower_bound(state)</span><br><span class="line"></span><br><span class="line"><span class="comment"># find the node with the lowest lower bound</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_lowest_node</span>(<span class="params">search_queue</span>):</span><br><span class="line">    lowest_bound=math.inf</span><br><span class="line">    lowest_node=<span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> search_queue:</span><br><span class="line">        <span class="keyword">if</span> node.bound&lt;lowest_bound:</span><br><span class="line">            lowest_bound=node.bound</span><br><span class="line">            lowest_node=node</span><br><span class="line">    <span class="keyword">return</span> lowest_node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">priority_search</span>(<span class="params">state</span>):</span><br><span class="line">    best=math.inf</span><br><span class="line">    best_state=<span class="literal">None</span></span><br><span class="line">    temporal_cost=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    search_queue=[]</span><br><span class="line">    search_queue.append(Node(state))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> search_queue!=[]:</span><br><span class="line">        temporal_cost+=<span class="number">1</span></span><br><span class="line">        node_selected=get_lowest_node(search_queue)</span><br><span class="line">        search_queue.remove(node_selected)</span><br><span class="line">        <span class="keyword">if</span> node_selected <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        state_now=node_selected.state</span><br><span class="line">        state_list=get_children(state_now)</span><br><span class="line">        <span class="keyword">if</span> state_list <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> best&gt;func(state_now):</span><br><span class="line">                best=func(state_now)</span><br><span class="line">                best_state=state_now</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            bound=lower_bound(state)</span><br><span class="line">            <span class="keyword">if</span> bound == math.inf <span class="keyword">or</span> bound&gt;best:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            search_queue.append(Node(state))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Priority Search\n    Temporal Cost:&#x27;</span>,temporal_cost,<span class="string">&#x27;Optimal Result:&#x27;</span>,best_state,<span class="string">&#x27;Optimal Value:&#x27;</span>,best)</span><br><span class="line">    <span class="keyword">return</span> best,best_state</span><br><span class="line"></span><br><span class="line">priority_search(root_state)</span><br><span class="line"><span class="comment"># queue_search(root_state)</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Optimal</tag>
        <tag>背包问题</tag>
        <tag>branch-and-bound</tag>
      </tags>
  </entry>
  <entry>
    <title>XJTU System Optimization and Scheduling Midterm Report</title>
    <url>/f95f8ff4.html</url>
    <content><![CDATA[<h1 id="midterm-report">Midterm Report</h1>
<p>西安交通大学《系统优化与调度》课程中期报告</p>
<p><img src="https://download.kezhi.tech/img/202211291631791.jpg?x-oss-process=style/webp" alt="" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="problem">Problem</h2>
<p><span class="math display">\[
min\ \ x_1^3+x_2^3-2x_1^2x_2+5x_1x_2^2+10x_1x_2+7x_1-x_2\\
s.t.\left\{
    \begin{array}{**lr**}
    -x_1+x_2\leq0\\
    -2x_1-5x_2-10\leq0\\
    x_1-100\leq 0
    \end{array}
\right.
\]</span></p>
<p>The graph of the object function is shown below:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202112211558169.png?x-oss-process=style/webp"
alt="object function" />
<figcaption aria-hidden="true">object function</figcaption>
</figure>
<p>The feasible region by the constraint is shown blow:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202112211600017.png?x-oss-process=style/webp"
alt="constraint" />
<figcaption aria-hidden="true">constraint</figcaption>
</figure>
<h2 id="method">Method</h2>
<p>For this problem, we can see that the feasible region is a convex
set, and the object function is not convex. Considering the feasible
region, the constraint works only when searching out the boundary. Using
projection method could let the searched point outing the boundary move
to the boundary. So the method I using is below:</p>
<blockquote>
<ol type="1">
<li>choose the start point <span class="math inline">\(x^0\)</span></li>
<li>replace point with the projection<span
class="math inline">\([x^0]^+\)</span></li>
<li>get the projection of next direction point <span
class="math inline">\(\bar x_k=[x^k-\nabla f(x^k)]^+\)</span></li>
<li>get the search direction <span class="math inline">\(d^k=\bar
x^k-x^k\)</span></li>
<li>calculate the next point <span
class="math inline">\(x^{k+1}=x^k+\alpha^kd^k\)</span></li>
<li>if the terminal condition is satisficed, stop the search and output
the result, else go to the step 3</li>
</ol>
</blockquote>
<p>In this project, I choose Armjio rule to control the step size.</p>
<p>The parameters of the method is following: <span
class="math display">\[
s=1\ \ \beta=0.5\ \ \sigma=1e-5
\]</span></p>
<h2 id="solution">Solution</h2>
<p>Considering the floating error of computers, stipulate <span
class="math inline">\(a=b\)</span> when <span
class="math inline">\(|a-b|&lt;\varepsilon\)</span>, and <span
class="math inline">\(a=0\)</span> if <span
class="math inline">\(|a|&lt;\varepsilon\)</span>. In this project,
<span class="math inline">\(\varepsilon=1e-19\)</span>.</p>
<p>choose the start point (0,0), we could get the following answer:</p>
<table style="width:100%;">
<colgroup>
<col style="width: 6%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 16%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><span
class="math inline">\(x^k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(f(x^k)\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\alpha^k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(d^k\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">（0,0）</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">(-1.42857,-1.42857)</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">(-1.42857,-1.42857)</td>
<td style="text-align: center;">-2.74052</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">(1.71358,-0.68543)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">(0.28501,-2.11400)</td>
<td style="text-align: center;">-4.62839</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">(-1.71358,0.68543)</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">(-0.57178,-1.77129)</td>
<td style="text-align: center;">-5.65909</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">(2.55462,-1.02185)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">(0.06688,-2.02675)</td>
<td style="text-align: center;">-5.79388</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">(-1.49545,0.59818)</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">(-0.30699,-1.87721)</td>
<td style="text-align: center;">-6.20808</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.86671,-0.34668)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">(-0.19865,-1.92054)</td>
<td style="text-align: center;">-6.25856</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(-0.08902,0.03561)</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">(-0.20977,-1.91609)</td>
<td style="text-align: center;">-6.25903</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.01624,-0.00649)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">(-0.20775,-1.91690)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(-0.00284,0.00114)</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">(-0.20810,-1.91676)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.00050,-0.00020)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">(-0.20804,-1.91679)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(-0.00009,0.00004)</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">(-0.20805,-1.91678)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.00002,-0.00001)</td>
</tr>
</tbody>
</table>
<p>The final result is <span class="math inline">\(x^*=[-0.20805,
-1.91678],f(x^*)=-6.25904\)</span>.</p>
<p>same as the result solved by the python package
<code>scipy.optimize.minimize</code>:</p>
<figure>
<img
src="https://download.kezhi.tech/img/20211222010041.png?x-oss-process=style/webp"
alt="image-20211222010030267" />
<figcaption aria-hidden="true">image-20211222010030267</figcaption>
</figure>
<p>Change the start point to (5,-8), and the answer following:</p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 31%" />
<col style="width: 15%" />
<col style="width: 16%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><span
class="math inline">\(x^k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(f(x^k)\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\alpha^k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(d^k\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">(6.37931,-4.55172)</td>
<td style="text-align: center;">955.45385</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">(-7.80788,3.12315)</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">(-1.42857,-1.42857)</td>
<td style="text-align: center;">-2.74052</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">(1.71358,-0.68543)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">(0.28501,-2.11400)</td>
<td style="text-align: center;">-4.62839</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">(-1.71358,0.68543)</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">(-0.57178,-1.77129)</td>
<td style="text-align: center;">-5.65909</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">(2.55462,-1.02185)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">(0.06688,-2.02675)</td>
<td style="text-align: center;">-5.79388</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">(-1.49545,0.59818)</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">(-0.30699,-1.87721)</td>
<td style="text-align: center;">-6.20808</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.86671,-0.34668)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">(-0.19865,-1.92054)</td>
<td style="text-align: center;">-6.25856</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(-0.08902,0.03561)</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">(-0.20977,-1.91609)</td>
<td style="text-align: center;">-6.25903</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.01624,-0.00649)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">(-0.20775,-1.91690)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(-0.00284,0.00114)</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">(-0.20810,-1.91676)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.00050,-0.00020)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">(-0.20804,-1.91679)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(-0.00009,0.00004)</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">(-0.20805,-1.91678)</td>
<td style="text-align: center;">-6.25904</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">(0.00002,-0.00001)</td>
</tr>
</tbody>
</table>
<p>We can see that the searching point went to the boundary quickly, and
then the trajectory of the searching is same as ahead.</p>
<h2 id="appendix">Appendix</h2>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">language<span class="punctuation">:</span> python</span><br><span class="line">package<span class="punctuation">:</span> numpy<span class="punctuation">,</span> matplotlib<span class="punctuation">,</span> scipy</span><br></pre></td></tr></table></figure>
<p>The source code is following:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> minimize</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小于该数则判断为0</span></span><br><span class="line">epsilon=<span class="number">1e-19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动求梯度</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">autograd</span>(<span class="params">f,*args</span>):</span><br><span class="line">    delta=<span class="number">1e-9</span></span><br><span class="line">    var_num=<span class="built_in">len</span>(args)</span><br><span class="line">    grads=[]</span><br><span class="line">    <span class="comment"># 计算当前函数值</span></span><br><span class="line">    func_value=f(args)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(var_num):</span><br><span class="line">        <span class="comment"># 计算偏移后的变量</span></span><br><span class="line">        args_new=<span class="built_in">list</span>(args)</span><br><span class="line">        args_new[i]+=delta</span><br><span class="line">        args_new=<span class="built_in">tuple</span>(args_new)</span><br><span class="line">        <span class="comment"># 计算偏移后函数值</span></span><br><span class="line">        delta_func_value=f(args_new)</span><br><span class="line">        <span class="comment"># 求偏导</span></span><br><span class="line">        partial=(delta_func_value-func_value)/delta</span><br><span class="line">        grads.append(partial)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(grads)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数</span></span><br><span class="line">f=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]**<span class="number">3</span>+x[<span class="number">1</span>]**<span class="number">3</span>-<span class="number">2</span>*x[<span class="number">0</span>]**<span class="number">2</span>*x[<span class="number">1</span>]+<span class="number">5</span>*x[<span class="number">0</span>]*x[<span class="number">1</span>]**<span class="number">2</span>+<span class="number">10</span>*x[<span class="number">0</span>]*x[<span class="number">1</span>]+<span class="number">7</span>*x[<span class="number">0</span>]-x[<span class="number">1</span>]</span><br><span class="line">g1=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]-x[<span class="number">1</span>]</span><br><span class="line">g2=<span class="keyword">lambda</span> x: <span class="number">2</span>*x[<span class="number">0</span>]+<span class="number">5</span>*x[<span class="number">1</span>]+<span class="number">10</span></span><br><span class="line">g3=<span class="keyword">lambda</span> x: -x[<span class="number">0</span>]+<span class="number">10</span></span><br><span class="line"></span><br><span class="line">line1=[(<span class="number">10</span>,-<span class="number">6</span>),(<span class="number">10</span>,<span class="number">10</span>)]</span><br><span class="line">line2=[(-<span class="number">2</span>/<span class="number">1.4</span>,-<span class="number">2</span>/<span class="number">1.4</span>),(<span class="number">10</span>,<span class="number">10</span>)]</span><br><span class="line">line3=[(-<span class="number">2</span>/<span class="number">1.4</span>,-<span class="number">2</span>/<span class="number">1.4</span>),(<span class="number">10</span>,-<span class="number">6</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算凸包上的最近距离点</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_closest_point</span>(<span class="params">x,y,line</span>):</span><br><span class="line">    <span class="keyword">if</span> line[<span class="number">0</span>][<span class="number">0</span>]==line[<span class="number">1</span>][<span class="number">0</span>]:</span><br><span class="line">        px=line[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        py=y</span><br><span class="line">        <span class="keyword">if</span> py&gt;line[<span class="number">1</span>][<span class="number">1</span>]:</span><br><span class="line">            py=line[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> py&lt;line[<span class="number">0</span>][<span class="number">1</span>]:</span><br><span class="line">            py=line[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k=(line[<span class="number">0</span>][<span class="number">1</span>]-line[<span class="number">1</span>][<span class="number">1</span>])/(line[<span class="number">0</span>][<span class="number">0</span>]-line[<span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line">        b=line[<span class="number">0</span>][<span class="number">1</span>]-k*line[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        px=(y+x/k-b)/(k+<span class="number">1</span>/k)</span><br><span class="line">        py=k*px+b</span><br><span class="line">        <span class="keyword">if</span> px&lt;line[<span class="number">0</span>][<span class="number">0</span>]:</span><br><span class="line">            px=line[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            py=line[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> px&gt;line[<span class="number">1</span>][<span class="number">0</span>]:</span><br><span class="line">            px=line[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">            py=line[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    distance=sqrt((x-px)**<span class="number">2</span>+(y-py)**<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> distance,(px,py)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算点(x,y)在凸包上的投影</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">project</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">if</span> g1([x,y])&gt;=<span class="number">0</span> <span class="keyword">and</span> g2([x,y])&gt;=<span class="number">0</span> <span class="keyword">and</span> g3([x,y])&gt;=<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (x,y)</span><br><span class="line">    d1,p1=get_closest_point(x,y,line1)</span><br><span class="line">    d2,p2=get_closest_point(x,y,line2)</span><br><span class="line">    d3,p3=get_closest_point(x,y,line3)</span><br><span class="line">    <span class="keyword">if</span> d1==<span class="built_in">min</span>(d1,d2,d3):</span><br><span class="line">        <span class="keyword">return</span> p1</span><br><span class="line">    <span class="keyword">if</span> d2==<span class="built_in">min</span>(d1,d2,d3):</span><br><span class="line">        <span class="keyword">return</span> p2</span><br><span class="line">    <span class="keyword">if</span> d3==<span class="built_in">min</span>(d1,d2,d3):</span><br><span class="line">        <span class="keyword">return</span> p3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 投影最速下降法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">steepest_method</span>(<span class="params">f,*start_point</span>):</span><br><span class="line">    s=<span class="number">1</span></span><br><span class="line">    beta=<span class="number">0.5</span></span><br><span class="line">    m=<span class="number">0</span></span><br><span class="line">    sigma=<span class="number">1e-5</span></span><br><span class="line">    point=np.array(project(*start_point))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        last_point=point</span><br><span class="line">        <span class="comment"># 计算函数值</span></span><br><span class="line">        value=f(point)</span><br><span class="line">        <span class="comment"># 计算梯度</span></span><br><span class="line">        grad_f=autograd(f,*point)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否达到终止条件</span></span><br><span class="line">        is_solve=<span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> grad <span class="keyword">in</span> grad_f:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(grad)&gt;epsilon:</span><br><span class="line">                is_solve=<span class="literal">False</span></span><br><span class="line">        <span class="comment"># 如果精度达到终止条件，则停止并返回当前点</span></span><br><span class="line">        <span class="keyword">if</span> is_solve:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 否则继续向下运算</span></span><br><span class="line">        point=point-grad_f</span><br><span class="line">        <span class="comment"># 对点进行投影</span></span><br><span class="line">        point=project(*point)</span><br><span class="line">        <span class="comment"># 计算更新方向</span></span><br><span class="line">        direction=point-last_point</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算下一个搜索点</span></span><br><span class="line">        point=last_point</span><br><span class="line">        <span class="comment"># Armijo准则选择步长</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            alpha=beta**m*s</span><br><span class="line">            new_point=point+alpha*direction</span><br><span class="line">            d_sum=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i,d <span class="keyword">in</span> <span class="built_in">enumerate</span>(direction):</span><br><span class="line">                d_sum+=grad_f[i]*d</span><br><span class="line">            <span class="keyword">if</span> f(point)-f(new_point)&gt;=-sigma*alpha*d_sum:</span><br><span class="line">                point=new_point</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            m+=<span class="number">1</span></span><br><span class="line">        <span class="comment"># 打印日志</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;x_k:(&#123;:.5f&#125;,&#123;:.5f&#125;) f: &#123;:.5f&#125; a: &#123;:.5f&#125; d: (&#123;:.5f&#125;,&#123;:.5f&#125;)&#x27;</span>.<span class="built_in">format</span>(last_point[<span class="number">0</span>],last_point[<span class="number">1</span>],f(last_point),alpha,direction[<span class="number">0</span>],direction[<span class="number">1</span>]))</span><br><span class="line">        point=last_point+alpha*direction</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果迭代步长很小，则停止迭代</span></span><br><span class="line">        err=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(point)):</span><br><span class="line">            err+=<span class="built_in">abs</span>(point[i]-last_point[i])</span><br><span class="line">        <span class="keyword">if</span> err&lt;<span class="number">1e-5</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 对结果保留5位小数</span></span><br><span class="line">    ans=[]</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> point:</span><br><span class="line">        ans.append(<span class="built_in">round</span>(p,<span class="number">5</span>))</span><br><span class="line">    <span class="keyword">return</span> ans,f(ans)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(steepest_method(f,<span class="number">5</span>,-<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line"><span class="comment"># 绘图</span></span><br><span class="line">x=np.arange(-<span class="number">5</span>,<span class="number">15</span>,<span class="number">0.1</span>)</span><br><span class="line">y1=x</span><br><span class="line">y2=-<span class="number">0.4</span>*x-<span class="number">2</span></span><br><span class="line"></span><br><span class="line">plt.plot(x,y1)</span><br><span class="line">plt.plot(x,y2)</span><br><span class="line">plt.plot([<span class="number">10</span>,<span class="number">10</span>],[-<span class="number">10</span>,<span class="number">15</span>])</span><br><span class="line">plt.fill_between(x,y1,y2,where=(x&lt;<span class="number">10</span>)&amp;(y1&gt;y2),alpha=<span class="number">0.5</span>)</span><br><span class="line">plt.savefig(<span class="string">&#x27;constraint.png?x-oss-process=style/webp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">figure = plt.figure()</span><br><span class="line">ax = Axes3D(figure)<span class="comment">#设置图像为三维格式</span></span><br><span class="line">X = np.arange(-<span class="number">1.5</span>,<span class="number">10</span>,<span class="number">0.1</span>)</span><br><span class="line">Y = np.arange(-<span class="number">6</span>,<span class="number">10</span>,<span class="number">0.1</span>)<span class="comment">#X,Y的范围</span></span><br><span class="line">X,Y = np.meshgrid(X,Y)<span class="comment">#绘制网格</span></span><br><span class="line">Z=f([X,Y])</span><br><span class="line">ax.plot_surface(X,Y,Z,rstride=<span class="number">1</span>,cstride=<span class="number">1</span>,cmap=<span class="string">&#x27;rainbow&#x27;</span>)</span><br><span class="line"><span class="comment">#绘制3D图，后面的参数为调节图像的格式</span></span><br><span class="line">plt.savefig(<span class="string">&#x27;obj_func.png?x-oss-process=style/webp&#x27;</span>)</span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># scipy求解验证结果正确性</span></span><br><span class="line"></span><br><span class="line">cons=(&#123;<span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;ineq&#x27;</span>,<span class="string">&#x27;fun&#x27;</span>:g1&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;ineq&#x27;</span>,<span class="string">&#x27;fun&#x27;</span>:g2&#125;,</span><br><span class="line">      &#123;<span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;ineq&#x27;</span>,<span class="string">&#x27;fun&#x27;</span>:g3&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x0 = np.asarray((<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">res=minimize(f,x0,method=<span class="string">&#x27;SLSQP&#x27;</span>,constraints=cons)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Optimal</tag>
      </tags>
  </entry>
  <entry>
    <title>Zotero插件推荐及下载</title>
    <url>/b2344ef.html</url>
    <content><![CDATA[<p>Zotero
是一款非常好用的开源文献管理软件，在对比了Endnote，Mendeley，Zotero之后最终我选择了Zotero作为我自己的文献管理软件，选择其的主要原因有：</p>
<ul>
<li>支持webdav同步文献记录及pdf附件</li>
<li>丰富的扩展插件</li>
<li>支持markdown笔记</li>
</ul>
<p>本文主要介绍部分常用的Zotero插件，并附上其下载链接，同时谈谈使用感受。顺序按照我个人认为的好用程度排序。</p>
<p><img src="https://download.kezhi.tech/img/202303021529700.png?x-oss-process=style/webp" width=33% /></p>
<span id="more"></span>
<h2 id="zotero-style">zotero-style</h2>
<p>下载地址：<a class="btn" href="https://server.kezhi.tech:9160/f/93275aa01d0f4e32acbd/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-style</a></p>
<p>插件文档：<a
href="https://www.notion.so/Zotero-Style-bc2aebbbb6df4b7baa858e376e4fc5be">Notion
– The all-in-one workspace for your notes, tasks, wikis, and
databases.</a></p>
<p>一款融合了很多功能的插件，包含但不限于以下功能：</p>
<ul>
<li>#tag：在tag前面加上符号<code>#</code>即可触发，可以解决zotero不显示标签文字的问题</li>
<li>期刊标签：可以在easyscholar上获取期刊信息并显示</li>
<li>进度：显示阅读进度和标注进度</li>
<li>自定义作者列显示格式</li>
<li>pdf底色修改</li>
</ul>
<p>具体的使用说明详见上面的文档</p>
<h2 id="zotero-night">zotero-night</h2>
<p>下载地址：<a class="btn" href="https://server.kezhi.tech:9160/f/10a094e6e76a4439a039/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-night</a></p>
<p>Zotero的深色模式插件，基本是我用过的最好的pdf深色模式，深色支持两种颜色模式，一种是
类似于Dracula深紫色背景，还有一种是纯黑模式。pdf中的文字和图片配色在深色模式下都会改变。效果如下：</p>
<figure>
<img
src="https://download.kezhi.tech/img/image-20230228160125727.png?x-oss-process=style/webp"
alt="默认白色模式" />
<figcaption aria-hidden="true">默认白色模式</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/image-20230228160150549.png?x-oss-process=style/webp"
alt="Dracula 模式" />
<figcaption aria-hidden="true">Dracula 模式</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/image-20230228160215515.png?x-oss-process=style/webp"
alt="纯黑色模式" />
<figcaption aria-hidden="true">纯黑色模式</figcaption>
</figure>
<p>（总之就是非常好用）</p>
<h2 id="zotero-gpt">zotero-gpt</h2>
<p>项目链接：<a
href="https://github.com/MuiseDestiny/zotero-gpt">MuiseDestiny/zotero-gpt:
GPT Meet Zotero. (github.com)</a></p>
<p>下载地址：<a class="btn" href="https://server.kezhi.tech:9160/f/3a3d24ab756c409186fa/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-gpt</a></p>
<p>zotero 的 gpt 插件，支持 gpt-3.5 turbo 和
gpt-4。具备提问pdf，翻译，提升写作等功能。</p>
<p>使用步骤如下：</p>
<ol type="1">
<li><p>像安装别的插件一样安装zotero-gpt插件</p></li>
<li><p>快捷键<code>Ctrl+/</code>唤醒</p></li>
<li><p>输入<code>/secretKey sk-&lt;你的gpt密钥&gt;</code>，如下图所示</p>
<p><img
src="https://download.kezhi.tech/img/202305231540402.png?x-oss-process=style/webp" /></p></li>
<li><p>享用你的gpt即可。</p></li>
</ol>
<h2 id="zotero-better-notes">zotero-better-notes</h2>
<p>下载地址：<a class="btn" href="https://server.kezhi.tech:9160/f/68ad39f67c23470b91df/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-better-notes</a></p>
<p>Zotero笔记增强软件，开辟一个专用区来进行笔记记录。有着更好的markdown语法兼容性。支持双向引用。功能还是很强大的，不过后来用了笔记软件<code>joplin</code>之后就很少用这个了。</p>
<h2 id="zotero-pdf-translate">zotero-pdf-translate</h2>
<p>下载地址：<a class="btn" href="https://server.kezhi.tech:9160/f/c53fd1d987444e568791/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-pdf-translate</a></p>
<p>Zotero翻译插件，内置了很多翻译引擎可以自由选择。也可以接入一些云服务商提供的专业翻译引擎来获得更好的翻译效果。虽然我没怎么用过这个功能，但是给用户高自由度的选择就是好文明。</p>
<h2 id="jasminum">jasminum</h2>
<p>下载地址：<a class="btn" href="https://server.kezhi.tech:9160/f/593cb18ec4c74a0baa3b/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>jasminum</a></p>
<p>大名鼎鼎的中文文献管理插件，但是使用的频次不多，因此不做评价。</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Zotero</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>NLP工具NLTK的安装及使用</title>
    <url>/3300cce2.html</url>
    <content><![CDATA[<h2 id="nltk简介">nltk简介</h2>
<p>NLTK是构建Python程序以使用人类语言数据的领先平台。它为50多种语料库和词汇资源（如WordNet）提供了易于使用的界面，还提供了一套用于分类，标记化，词干化，标记，解析和语义推理的文本处理库。NLTK是Python上著名的⾃然语⾔处理库
⾃带语料库，具有词性分类库 ⾃带分类，分词，等等功能。</p>
<span id="more"></span>
<h2 id="package安装">package安装</h2>
<p>首先使用pip安装nltk包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install nltk</span><br></pre></td></tr></table></figure>
<p>可以使用清华源对其加速</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install nltk -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<h2 id="nltk-data下载">nltk-data下载</h2>
<p>安装好的nltk包是不能拿来直接使用的，还需要下载相关数据模型才可以使用。下载方法如下。</p>
<p>nltk包安装完成后打开python命令行运行以下命令（也可以新建python文件写入以下命令并运行）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download()</span><br></pre></td></tr></table></figure>
<p>会出现以下界面：</p>
<p><img
src="https://download.kezhi.tech/img/202110212046568.png?x-oss-process=style/webp" /></p>
<p>最开始这个列表是空白的，点击右下方<code>refresh</code>后出现nltk-data的列表。</p>
<p>点击左下角的<code>Download</code>开始下载数据，等下载完成后即可正常使用</p>
<h2 id="国内加速下载">国内加速下载</h2>
<p>在国内下载可能会出现找不到DNS或者下载到一半出错的情况。遇到该情况最便捷的解决思路如下：</p>
<ul>
<li><p>执行以下命令之一下载nltk-data到本地，大小700M左右</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/nltk/nltk_data.git</span><br><span class="line"><span class="comment"># 无法链接到GitHub的也可以使用如下链接之一进行clone</span></span><br><span class="line">git <span class="built_in">clone</span> http://gitclone.com/github.com/nltk/nltk_data.git</span><br><span class="line">git <span class="built_in">clone</span> https://hub.fastgit.org/nltk/nltk_data.git</span><br></pre></td></tr></table></figure></li>
<li><p>进入下载到本地的nltk-data目录，修改nltk_data目录下的index.xml文件，将所有的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">s://raw.githubusercontent.com/nltk/nltk_data/gh-pages</span><br></pre></td></tr></table></figure>
<p>替换为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">://localhost:8000</span><br></pre></td></tr></table></figure></li>
<li><p>在该目录下运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -m http.server 8000</span><br></pre></td></tr></table></figure>
<p>这个时候我们会在本机提供nltk_data数据下载服务的服务器。nltk下载器通过访问本地地址既可以获取到需要的文件。</p></li>
<li><p>重新在python中执行如下语句：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download()</span><br></pre></td></tr></table></figure></li>
<li><p>将server
index中的地址替换为<code>http://localhost:8000/index.xml</code>如下图:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202110212123817.png?x-oss-process=style/webp"
alt="image-20211021212307774" />
<figcaption aria-hidden="true">image-20211021212307774</figcaption>
</figure>
<p>依次点击<code>refresh</code>和<code>Download</code>即可开始安装。</p></li>
</ul>
<h2 id="reference">Reference</h2>
<p>[1] <a
href="https://zhuanlan.zhihu.com/p/347931749">国内下载GITHUB库加速方法及快速安装NLTK
- 知乎 (zhihu.com)</a></p>
<p>[2] <a
href="https://blog.csdn.net/qiang12qiang12/article/details/81254595">直接快速下载NLTK数据_今春一别难相逢-CSDN博客_nltk下载</a></p>
<p>[3] <a href="https://github.com/nltk/nltk_data">nltk/nltk_data: NLTK
Data (github.com)</a></p>
<p>[4] <a href="https://www.jianshu.com/p/a3cb9f986e69">自然语言处理|
NLTK - 简书 (jianshu.com)</a></p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>NLP</tag>
        <tag>NLTK</tag>
      </tags>
  </entry>
  <entry>
    <title>Scrapy爬虫相关</title>
    <url>/68a55fd7.html</url>
    <content><![CDATA[<h2 id="请求伪装">请求伪装</h2>
<p>在爬取腾讯天气时，发现无法成功爬取到天气数据，经过尝试发现是请求头除了问题。爬虫在爬取网页时的默认请求头为：</p>
<p><img
src="https://download.kezhi.tech/img/20201024223544.png?x-oss-process=style/webp" /></p>
<p>这种默认的请求头在爬取很多网站时会被禁止，无法获取到网页数据，因此需要使用请求头伪装，让网站认为是浏览器在访问。操作步骤如下：</p>
<span id="more"></span>
<ol type="1">
<li>在项目目录下新建文件<code>HeaderMidWare.py</code>，写入如下代码：</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> scrapy.utils.project <span class="keyword">import</span> get_project_settings</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">settings = get_project_settings()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProcessHeaderMidware</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;process request add request info&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        随机从列表中获得header， 并传给user_agent进行使用</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ua = random.choice(settings.get(<span class="string">&#x27;USER_AGENT_LIST&#x27;</span>))</span><br><span class="line">        spider.logger.info(msg=<span class="string">&#x27;now entring download midware&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> ua:</span><br><span class="line">            request.headers[<span class="string">&#x27;User-Agent&#x27;</span>] = ua</span><br><span class="line">            <span class="comment"># Add desired logging message here.</span></span><br><span class="line">            spider.logger.info(<span class="string">u&#x27;User-Agent is : &#123;&#125; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(request.headers.get(<span class="string">&#x27;User-Agent&#x27;</span>), request))</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>向<code>setting.py</code>添加如下代码</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">USER_AGENT_LIST=[</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (X11; CrOS i686 2268.111.0) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1092.0 Safari/536.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1090.0 Safari/536.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/19.77.34.5 Safari/537.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.9 Safari/536.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.0) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.36 Safari/536.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SE 2.X MetaSr 1.0; SE 2.X MetaSr 1.0; .NET CLR 2.0.50727; SE 2.X MetaSr 1.0)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">&#x27;projectname.HeaderMidWare.ProcessHeaderMidware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加完毕后重新运行爬虫，其便可以自动选择user_agent进行伪装，成功爬取到网页上的内容。</p>
<p><img
src="https://download.kezhi.tech/img/20201024224545.png?x-oss-process=style/webp" /></p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Scrapy</tag>
        <tag>Crawler</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode编译Latex配置</title>
    <url>/26b82930.html</url>
    <content><![CDATA[<p>原本是不想写 latex
本地环境配置的文章的，因为网上已经有很多相关的博客和文章。但是师妹在配置
vscode 时复制了网上错误的配置导致 <code>bib</code>
半天编译不过，并难以定位问题。因此，写下本篇配置说明来维护一个正确的配置，避免未来再出现类似的问题。</p>
<p><img src="https://download.kezhi.tech/img/202407101818114.jpg?x-oss-process=style/webp" style="width:66%;" /></p>
<center>
放一盆王八在这
</center>
<span id="more"></span>
<h2 id="latex-环境配置">Latex 环境配置</h2>
<ol type="1">
<li><p>下载 latex 编译工具，这里建议使用 <a
href="https://tug.org/texlive/">texlive</a></p></li>
<li><p>安装包下载完成后点击安装即可</p></li>
<li><p>确认安装，在 texlive 安装完成后，在命令行里输入
<code>tex</code>，得到结果如下，则说明系统环境变量配置成功</p>
<p><img
src="https://download.kezhi.tech/img/202407101802066.png?x-oss-process=style/webp" /></p></li>
</ol>
<h2 id="vscode-配置">vscode 配置</h2>
<ol type="1">
<li><p>安装插件 <code>latex-workshop</code></p></li>
<li><p><code>Ctrl+Shift+P</code> 输入 <code>open user settings</code>
打开用户配置文件 <code>settings.json</code></p></li>
<li><p>向用户配置文件 <code>settings.json</code> 中添加如下内容</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;latex-workshop.latex.tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-pdf&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 这里是xelatex工具的定义 </span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">//设置编译链的时候使用xelatex作为默认的第一个首选编译</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.recipes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; biber -&gt; pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;latexmk&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        </span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex -&gt; bibtex -&gt; xelatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></li>
<li><p>打开一个 <code>*.tex</code> 文件，左侧出现 <code>TEX</code>
图标说明配置成功</p>
<p><img
src="https://download.kezhi.tech/img/202407101807402.png?x-oss-process=style/webp" /></p></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>latex</tag>
      </tags>
  </entry>
  <entry>
    <title>一个用单片机放视频的小项目</title>
    <url>/d9a2f421.html</url>
    <content><![CDATA[<h2 id="总体设计思路">总体设计思路</h2>
<p>视频的播放实际上就是一系列的图片按照一定的顺序，以一定的时间间隔连续播放所产生的视觉效果。因此，使用单片机驱动LCD去播放视频实际上就是让单片机以一定的时间间隔向LCD的缓存推送图片，让其不断刷新屏幕去切换图片即可。在文章的最后我放入了这个项目的源工程文件供大家参考。</p>
<span id="more"></span>
<blockquote>
<p>如果要同时播放音频那么就给单片机的管脚连入一个功放，单片机以音频电压不断给功放上电即可。由于单片机的频率只有1MHz，并且产生的也是方波信号，protues仿真效果不好，所以这里就没有加入声音的播放。</p>
</blockquote>
<p>演示视频如下：</p>
<iframe src="//player.bilibili.com/player.html?aid=74949672&amp;bvid=BV1bE411q7YA&amp;cid=128219853&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<p>因此整个项目可以拆分成如下几部：</p>
<ul>
<li>将视频剪裁缩放到该显示器大小，并且对视频内容进行二值化</li>
<li>将二值化后的视频流按照帧的顺序写入.h文件中方便读取</li>
<li>在protues仿真平台上连接电路</li>
<li>编写程序控制单片机不断向LCD写入图像。</li>
</ul>
<h2 id="处理视频">1.处理视频</h2>
<p>这里采用python进行视频的处理，使用了OpenCV对python支持的库对于视频进行操作，参考了一本关于OpenCV-python教程的书，我将该书的电子版放在这里，需要的同学可以自取。<a class="btn" href="https://download.kezhi.tech/document/OpenCV%E5%AE%98%E6%96%B9%E6%95%99%E7%A8%8B%E4%B8%AD%E6%96%87%E7%89%88%EF%BC%88For%20Python%EF%BC%89.pdf"><i class="fa fa-download fa-lg fa-fw"></i>点击下载</a></p>
<p>这里将视频读入</p>
<p>源代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">video=cv2.VideoCapture(<span class="string">&quot;1.flv&quot;</span>)</span><br><span class="line">writename=<span class="string">&quot;picture.csv&quot;</span></span><br><span class="line">file=<span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>,mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">fourcc=cv2.VideoWriter_fourcc(*<span class="string">&#x27;XVID&#x27;</span>)</span><br><span class="line">outvideo=cv2.VideoWriter(<span class="string">&quot;2.avi&quot;</span>,fourcc,<span class="number">25.0</span>,(<span class="number">128</span>,<span class="number">64</span>),<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">h,g,f,e,d,c,b,a</span>): <span class="comment">#将8位像素拼接成一个uint8</span></span><br><span class="line">        high_num=<span class="number">0</span></span><br><span class="line">        low_num=<span class="number">0</span></span><br><span class="line">        high_num=((((((high_num+a)&lt;&lt;<span class="number">1</span>)+b)&lt;&lt;<span class="number">1</span>)+c)&lt;&lt;<span class="number">1</span>)+d</span><br><span class="line">        low_num=((((((low_num+e)&lt;&lt;<span class="number">1</span>)+f)&lt;&lt;<span class="number">1</span>)+g)&lt;&lt;<span class="number">1</span>)+h</span><br><span class="line">        num=(high_num&lt;&lt;<span class="number">4</span>)+low_num</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(num)</span><br><span class="line"><span class="comment">#不断循环对每一帧进行二值化，该帧的输出保存在程序同目录的&quot;picture.csv&quot;中，按住q可以不断快进，在需要截取帧暂停并复制&quot;picture.csv&quot;中的数据即可。</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):	</span><br><span class="line">    ret,frame=video.read()</span><br><span class="line">    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    result=cv2.resize(gray,(<span class="number">128</span>,<span class="number">64</span>),interpolation=cv2.INTER_AREA)</span><br><span class="line">    ret,result=cv2.threshold(result,<span class="number">150</span>,<span class="number">255</span>,cv2.THRESH_BINARY)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    cv2.HoughLinesP</span><br><span class="line">    cv2.namedWindow(<span class="string">&quot;frame&quot;</span>,cv2.WINDOW_NORMAL)</span><br><span class="line">    cv2.resizeWindow(<span class="string">&quot;frame&quot;</span>,<span class="number">640</span>,<span class="number">320</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;frame&#x27;</span>,result)</span><br><span class="line">    outvideo.write(result)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">            <span class="keyword">if</span> result[i,j]:</span><br><span class="line">                result[i,j]=<span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result[i,j]=<span class="number">1</span></span><br><span class="line">    bl=result.astype(numpy.<span class="built_in">int</span>)</span><br><span class="line">    r0x=numpy.zeros((<span class="number">8</span>,<span class="number">128</span>),dtype=numpy.<span class="built_in">object</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">            r0x[i,j]=trans(bl[i*<span class="number">8</span>,j],bl[i*<span class="number">8</span>+<span class="number">1</span>,j],bl[i*<span class="number">8</span>+<span class="number">2</span>,j],bl[i*<span class="number">8</span>+<span class="number">3</span>,j],bl[i*<span class="number">8</span>+<span class="number">4</span>,j],bl[i*<span class="number">8</span>+<span class="number">5</span>,j],bl[i*<span class="number">8</span>+<span class="number">6</span>,j],bl[i*<span class="number">8</span>+<span class="number">7</span>,j])</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(writename,<span class="string">&#x27;w&#x27;</span>,newline=<span class="string">&#x27;&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        csv_write=csv.writer(f)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> r0x:</span><br><span class="line">            csv_write.writerow(i)</span><br><span class="line">    <span class="keyword">if</span> cv2.waitKey(<span class="number">1</span>) &amp; <span class="number">0xFF</span> == <span class="built_in">ord</span>(<span class="string">&#x27;q&#x27;</span>):</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">video.release()</span><br><span class="line">outvideo.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<h2 id="将帧数据写入.h文件">2.将帧数据写入.h文件</h2>
<p>我们将上一步获取到的一些帧数据进行顺序排列并用','分隔即构成了我们需要显示视频的数据集。</p>
<p>接下了建立一个image.h文件，将所有数据粘贴到静态数组中：</p>
<figure>
<img
src="https://download.kezhi.tech/img/image-20200324202341272.png?x-oss-process=style/webp"
alt=".h文件的编写" />
<figcaption aria-hidden="true">.h文件的编写</figcaption>
</figure>
<blockquote>
<p>这里要注意，我们采用的显示器分辨率为64 *
128共计8192个像素，每个像素的像素值为0/1，使用状态压缩将8个像素压缩到1B之后，每一帧占用的内存大小为8
*
128=1024B=1K。而protues仿真软件中，RAM最大为64K，考虑到还需要一部分空间来存放其他代码，所以这里最多可以存放62~63帧，视其他代码占用空间决定。</p>
</blockquote>
<h2 id="在protues上连接电路">3.在protues上连接电路</h2>
<p>选取的单片机为经典的AT89C51，显示器型号为AMPIPR128*64</p>
<p>这里连线采用标号的方式，方便连接和查看：</p>
<figure>
<img
src="https://download.kezhi.tech/img/image-20200324203135152.png?x-oss-process=style/webp"
alt="LCD部分" />
<figcaption aria-hidden="true">LCD部分</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/image-20200324203205683.png?x-oss-process=style/webp"
alt="单片机部分" />
<figcaption aria-hidden="true">单片机部分</figcaption>
</figure>
<blockquote>
<p>有关单片机管脚的含义和使用方法以及该LCD各个引脚的意义大家可以自行搜索学习，网上有很多相关的资料。</p>
</blockquote>
<h2 id="编写单片机的程序">4.编写单片机的程序</h2>
<p>要编写单片机驱动LCD的程序，我们需要了解该LCD各个引脚的作用和如何驱动它显示图像，同上，网上有很多相关的手册供大家自行查询。那么这里我们直接使用一个已经封装好的驱动文件对该显示器进行底层操作，我们只关注应用层面的逻辑即可。</p>
<p>源代码：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;lcd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;image.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line">sbit power=P2^<span class="number">0</span>;</span><br><span class="line">sbit pause=P2^<span class="number">1</span>;</span><br><span class="line">sbit clear=P2^<span class="number">1</span>;</span><br><span class="line">bit is_off=<span class="number">1</span>;</span><br><span class="line">bit is_pause=<span class="number">1</span>;</span><br><span class="line">bit is_clear=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">delay</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (a--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	uchar i,j,k;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">63</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">vShowGraph</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">8</span>,image[i]);</span><br><span class="line">		<span class="built_in">delay</span>(<span class="number">5000</span>);</span><br><span class="line">		<span class="keyword">if</span> (i==<span class="number">20</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			j=<span class="number">3</span>;</span><br><span class="line">			<span class="keyword">while</span> (j--)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (k=i;k&lt;<span class="number">25</span>;k++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">vShowGraph</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">8</span>,image[k]);</span><br><span class="line">					<span class="built_in">delay</span>(<span class="number">5000</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (i==<span class="number">41</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			j=<span class="number">3</span>;</span><br><span class="line">			<span class="keyword">while</span> (j--)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (k=i;k&lt;<span class="number">45</span>;k++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">vShowGraph</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">8</span>,image[k]);</span><br><span class="line">					<span class="built_in">delay</span>(<span class="number">5000</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>封装好的显示驱动.h文件</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;at89x51.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RST P1_2   <span class="comment">/*复位信号，低电平复位*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> E P1_5  <span class="comment">/*E 使能信号，为H或1时表示DRAM数据读到DB7~DB0，为L或0表示锁存DB7~DB0*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RW P1_4 <span class="comment">/* RW 为1  E 为1时数据被读到DB7~DB0，为0 且E为下降沿时DB7~DB0的数据被写入到IR（指令寄存器）或DR（数据寄存器）*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RS P1_3  <span class="comment">/* DI为1表示DB7~DB0为显示数据，为0表示DB7~DB0为显示指令数据*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CS1 P1_0   <span class="comment">/*CS1为1表示选择该芯片（右半屏）信号*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CS2 P1_1   <span class="comment">/*CS2为1表示选择该芯片（左半屏）信号*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCDPORT P3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUSYSTATUS P3_7      <span class="comment">//忙状态位。//</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DISONSTATUS P3_5     <span class="comment">//显示开关状态位。//</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RSTSTATUS P3_4     <span class="comment">//复位状态位。</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCDSTARTROW 0xC0     <span class="comment">//设置起始行指令。</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCDPAGE 0xB8      <span class="comment">//设置页指令。</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCDLINE 0x40      <span class="comment">//设置列指令。</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">bit <span class="title">bCheckBusy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCDPORT=<span class="number">0x00</span>;</span><br><span class="line">	RW=<span class="number">1</span>;</span><br><span class="line">	RS=<span class="number">0</span>;</span><br><span class="line">	E=<span class="number">1</span>;</span><br><span class="line">	E=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> BUSYSTATUS; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vWriteData</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ucData)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">bCheckBusy</span>());</span><br><span class="line">	LCDPORT=<span class="number">0xFF</span>;</span><br><span class="line">	RW=<span class="number">0</span>;</span><br><span class="line">	RS=<span class="number">1</span>;</span><br><span class="line">	LCDPORT=ucData;</span><br><span class="line">	E=<span class="number">1</span>;</span><br><span class="line">	E=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vWriteCMD</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ucCMD)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">bCheckBusy</span>());</span><br><span class="line">	LCDPORT=<span class="number">0xFF</span>;</span><br><span class="line">	RW=<span class="number">0</span>;</span><br><span class="line">	RS=<span class="number">0</span>;</span><br><span class="line">	LCDPORT=ucCMD;</span><br><span class="line">	E=<span class="number">1</span>;</span><br><span class="line">	E=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vLCDInitialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CS1=<span class="number">1</span>;</span><br><span class="line">	CS2=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">vWriteCMD</span>(<span class="number">0x38</span>);   <span class="comment">//8位形式，两行字符。</span></span><br><span class="line">	<span class="built_in">vWriteCMD</span>(<span class="number">0x0F</span>);   <span class="comment">//开显示。</span></span><br><span class="line">	<span class="built_in">vWriteCMD</span>(<span class="number">0x01</span>);   <span class="comment">//清屏。</span></span><br><span class="line">	<span class="built_in">vWriteCMD</span>(<span class="number">0x06</span>);   <span class="comment">//画面不动，光标右移。</span></span><br><span class="line">	<span class="built_in">vWriteCMD</span>(LCDSTARTROW); <span class="comment">//设置起始行。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vShowCustomRow</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ucPage,<span class="type">unsigned</span> <span class="type">char</span> ucLine,<span class="type">unsigned</span> <span class="type">char</span> ucWidth,<span class="type">unsigned</span> <span class="type">char</span> *ucaRow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> ucCount;       <span class="comment">//取值范围：ucPage:0～7；ucLine:0～127；</span></span><br><span class="line">	<span class="keyword">if</span>(ucLine&lt;<span class="number">64</span>)         <span class="comment">//ucWidth:0～127；ucLine+ucWidth&lt;1128。   </span></span><br><span class="line">	&#123;   </span><br><span class="line">		CS1=<span class="number">0</span>;   </span><br><span class="line">		CS2=<span class="number">1</span>;   </span><br><span class="line">		<span class="built_in">vWriteCMD</span>(LCDPAGE+ucPage);   </span><br><span class="line">		<span class="built_in">vWriteCMD</span>(LCDLINE+ucLine);   </span><br><span class="line">		<span class="keyword">if</span>((ucLine+ucWidth)&lt;<span class="number">64</span>)    </span><br><span class="line">		&#123;</span><br><span class="line">		    <span class="keyword">for</span>(ucCount=<span class="number">0</span>;ucCount&lt;ucWidth;ucCount++)     </span><br><span class="line">			<span class="built_in">vWriteData</span>(*(ucaRow+ucCount));    </span><br><span class="line">		&#125;   </span><br><span class="line">		<span class="keyword">else</span>    </span><br><span class="line">		&#123;</span><br><span class="line">		    <span class="keyword">for</span>(ucCount=<span class="number">0</span>;ucCount&lt;<span class="number">64</span>-ucLine;ucCount++)     </span><br><span class="line">			<span class="built_in">vWriteData</span>(*(ucaRow+ucCount));</span><br><span class="line">    		CS1=<span class="number">1</span>;    </span><br><span class="line">			CS2=<span class="number">0</span>;    </span><br><span class="line">			<span class="built_in">vWriteCMD</span>(LCDPAGE+ucPage);    </span><br><span class="line">			<span class="built_in">vWriteCMD</span>(LCDLINE);    </span><br><span class="line">			<span class="keyword">for</span>(ucCount=<span class="number">64</span>-ucLine;ucCount&lt;ucWidth;ucCount++)     </span><br><span class="line">				<span class="built_in">vWriteData</span>(*(ucaRow+ucCount));    </span><br><span class="line">		&#125;  </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>   </span><br><span class="line">	&#123;</span><br><span class="line">	   CS1=<span class="number">1</span>;</span><br><span class="line">	   CS2=<span class="number">0</span>;   </span><br><span class="line">	   <span class="built_in">vWriteCMD</span>(LCDPAGE+ucPage);   </span><br><span class="line">	   <span class="built_in">vWriteCMD</span>(LCDLINE+ucLine<span class="number">-64</span>);   </span><br><span class="line">	   <span class="keyword">for</span>(ucCount=<span class="number">0</span>;ucCount&lt;ucWidth;ucCount++)</span><br><span class="line">	       <span class="built_in">vWriteData</span>(*(ucaRow+ucCount));   </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vShowOneChin</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ucPage,<span class="type">unsigned</span> <span class="type">char</span> ucLine,<span class="type">unsigned</span> <span class="type">char</span> *ucaChinMap)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">vShowCustomRow</span>(ucPage,ucLine,<span class="number">16</span>,ucaChinMap);</span><br><span class="line">	<span class="built_in">vShowCustomRow</span>(ucPage+<span class="number">1</span>,ucLine,<span class="number">16</span>,ucaChinMap+<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vShowOneChar</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ucPage,<span class="type">unsigned</span> <span class="type">char</span> ucLine,<span class="type">unsigned</span> <span class="type">char</span> *ucaCharMap)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">vShowCustomRow</span>(ucPage,ucLine,<span class="number">8</span>,ucaCharMap);</span><br><span class="line">	<span class="built_in">vShowCustomRow</span>(ucPage+<span class="number">1</span>,ucLine,<span class="number">8</span>,ucaCharMap+<span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vShowGraph</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> ucPage,<span class="type">unsigned</span> <span class="type">char</span> ucLine,<span class="type">unsigned</span> <span class="type">char</span> ucWidth,<span class="type">unsigned</span> <span class="type">char</span> ucHigh,<span class="type">unsigned</span> <span class="type">char</span> * ucaGraph)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> ucCount;</span><br><span class="line">	<span class="keyword">for</span>(ucCount=<span class="number">0</span>;ucCount&lt;ucHigh;ucCount++)</span><br><span class="line">	   <span class="built_in">vShowCustomRow</span>(ucPage+ucCount,ucLine,ucWidth,ucaGraph+ucCount*ucWidth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结束语附工程下载链接">5.结束语（附工程下载链接）</h2>
<p>该项目是博主大三时做的一个电子线路设计，给我最大的启发就是我们在生活中看起来复杂的项目，实际上其背后的原理是简单的，就如视频的播放一样。但同时，简单的事情是复杂的，之后在做语音识别的时候，采用自己提取的语音特征去分辨数字0-9，整体的识别率不到30%。因此，判断一件事难易程度不能凭空去想，而是要思考其运行机制和模块构成，分析其实现原理从而对于每个项目有清晰的认知。</p>
<p>工程文件下载：<a class="btn" href="https://download.kezhi.tech/document/cxk_video.zip"><i class="fa fa-download fa-lg fa-fw"></i>点击下载</a></p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Protues</tag>
        <tag>单片机</tag>
      </tags>
  </entry>
  <entry>
    <title>于小鸡历险记（一）</title>
    <url>/32347def.html</url>
    <content><![CDATA[<h2 id="引子">引子</h2>
<p>有时候，生活会带给人一些惊喜。或许是一次翘课偶然碰到的晚霞，亦或是一觉醒来突然开放的花苞。在这个不断向前的工业化时代里，我们每个人都身不由己，裹挟其中。这在我上了研究生，进一步了解这个世界之后，最深的感触。</p>
<p><img src="https://download.kezhi.tech/img/202205102220466.jpg?x-oss-process=style/webp" width=30%></p>
<span id="more"></span>
<p>对此，我的爱人——豆豆给我带来了很多的启发。总结来说主要有两点：①
这个世界真的很大，大到在社会和国家面前我们每个人都如此渺小，尽显无力。而随着经济和技术的不断发展，政府和社会与每个人的距离会越来越近，相应的，个人的无力也会越来越强。②
这个世界的每一寸都弥足珍贵，驻足品味总是会有所收获。花的鲜艳不在于它本身，而在于对其欣赏的目光；作品的高度不在于作者的定义而在于读者的感悟；相册的意义不在于像素的精准而在于其蕴含的回忆。生活缺少的不是美好，而是对于美好的发现与品味。</p>
<h2 id="春约后趣事小记">春约后趣事小记</h2>
<h3 id="section">1</h3>
<p>春约，是港里春夏交际时的盛事。每当此时，陕西省多个高校的单身男女云集于此地，期盼着能够遇见生命中的那个对的人。为保证活动的严肃性，参与者通常需要提前报名并签署单身保证协议，在当天凭入场券进入。</p>
<p>2022年5月8日，百琦与子爻告知我该盛事正在米兰楼进行，出于好奇，便和百琦相约前往一同前往，遗憾的是当天子爻待在家里，未能与我们同行。并且因为疫情的原因，其他高校的学生未能前来，也是一大遗憾。</p>
<p><img
src="https://download.kezhi.tech/img/202205102228785.jpg?x-oss-process=style/webp" /></p>
<p>去的时候已经是下午快吃饭的时间了，天空中飘起了小雨。我们向米兰楼前行，看到从那里往回走的男男女女脸上大多挂着失落的表情，不禁感叹到：这天气就像极了这些男女的心情，来的时候晴空万里，走的时候笼罩了一层阴霾。</p>
<p>进入会场（虽然没有入场券，但是一般活动快要结束时又有谁会关心入场券呢），里面的景象大致可以概括为：大部分男女都与同性待在一起，只有少量男女在与异性接触。回来的路上，我提出明年要拉着朋友一起来参加这项盛事，百琦告诉我说最好一个人来，人多的话可能就只和前来的同伴一起玩了。她说的很对，不只是在这里，在我能接触到的年轻人中也大抵如此。男女之间的接触不知从何时起成为了一项很艰难的事情，或是为了结婚而不得不进行的一项负担。而不是为了与异性交流，玩耍本身能够带来的乐趣。</p>
<p>如果说繁衍所带来的对异性的渴望是人类最自然，最原始的追求。那么目前我们与异性相处时的不自在从某种意义上来说就是一种倒退。我当然不是希望回到那个原始的时代，只是希望，在未来的某个时候，人们可以自由自在的与他人相处，不论同性还是异性，为了精神上的愉悦。</p>
<h3 id="section-1">2</h3>
<p>上个月买了一盆栀子花，送来的时候还都是花苞。这是我第一次养花，对它开花满怀希冀。终于，在我不那么精心的呵护下，某一天早上醒来，它给了我一个惊喜。</p>
<p><img
src="https://download.kezhi.tech/img/202205102250858.jpg?x-oss-process=style/webp" /></p>
<p>它的绽放很突然，也很绚烂。在看到它的那一刻，我感受到了生命的活力。花朵的美丽不止在于它的鲜艳，还在于它绽放的那一刻。以后可以试试用延时摄影记录下花开的时刻。</p>
<p>好景不长，由于种栀子花的盆太小了，里面的营养不够。花朵逐渐枯黄，后面虽然还有新的花朵绽放，但美丽绽放的只有最新的一朵。</p>
<p><img
src="https://download.kezhi.tech/img/202205102253440.jpg?x-oss-process=style/webp" /></p>
<p>花开时令人感到愉悦，花谢时却让人不禁感叹时间的残酷。不过如果换一个更大的盆，再及时施肥，是不是可以让所有的花都有营养开放呢，值得一试。</p>
<h3 id="section-2">3</h3>
<p>有的时候，惊喜也不见得是一件好事。2022年5月9号，我正在工位忙着学习《矿工入门手册》，突然得知明天就要交最优控制课程的作业，还是四次作业一起交。然而我这个人有个毛病，当沉浸在一件事中时，其他的事情再紧急也要先让手头的事情有个结果再说。</p>
<p>就这样，我的矿工学习到了晚上十一点半才结束。终于，电脑可以自己挖矿了。看着屏幕上在跑的
Hash 和手头一打准备用来写作业的空白 A4
纸。我不禁感到自己真他娘的是会找机会折磨自己。</p>
<p>为了更快的学习知识并完成作业，去楼上找了老王一起写作业。走的时候记起晗驰的工位应该在附近，便前去一观。</p>
<p><img
src="https://download.kezhi.tech/img/202205102302265.jpg?x-oss-process=style/webp" /></p>
<p>杰瑞真的蛮可爱的！</p>
<h3 id="section-3">4</h3>
<p>不知道是屏幕看多了，亦或是睡眠不足，还是因为经常揉眼睛。最近常常感到眼睛干涩，发痒。决定去兴华附近的药店买眼药水，有几天都忘记了此时。终于在2022年5月10日下午记起此事，去涵英楼吃饭并购买了眼药水。然而，这个眼药水着实有些神奇，它长这个样子</p>
<p><img
src="https://download.kezhi.tech/img/202205102305766.jpg?x-oss-process=style/webp" /></p>
<p>说实话，这个样子的眼药水我还是第一次见，以前用的都是小瓶装的那种。不过仔细想想，这种眼药水也有好处。一来是一支只用一天，大大降低了眼药水被污染的风险；而来这样的独立包装也可以提醒我及时使用眼药水，而不是像以前一样想起来才滴。总的来说，人体工学在产品设计中必不可少的一环，这样的设计还是多一点比较好。</p>
<h2 id="影视创作后些许小事">影视创作后些许小事</h2>
<h3 id="section-4">1</h3>
<p><em>影视创作</em>，创新港研究生的一门通选课，非常有幸能够在其第一次开课时选到这门课。最开始选这门课的原因是看任课老师长得好看，并且教育经历也让我对她非常好奇（详见<a
href="http://rwxy.xjtu.edu.cn/info/1091/4265.htm">王瑶
-西安交通大学人文社会科学学院 (xjtu.edu.cn)</a>。</p>
<p>这门课的形式是这样的，6-8人组成一个小组，完成一部微电影创作的全流程。关于这部影片的创作过程详见<a
href="https://kezhi.tech/影片《字节跳动》创作阐述/">影片《字节跳动》创作阐述</a>。而我十分有幸，能够担任小组的组长。</p>
<p><img
src="https://download.kezhi.tech/img/202206011656848.jpg?x-oss-process=style/webp" /></p>
<p>长期以来，对于很多事情我都是一个人独自处理，很少与他人进行合作。并且由于在学生时代的课程分组作业往往是在混成绩而非认真完成项目，故对于领导合作这件事没有太多的感触。这次的影视创作则有所不同，通识选修课不存在对于分数的过分追逐，而影视创作这件事本身也与本组部分成员的爱好相吻合。因此，我认为在这部微电影的拍摄中，应当投入些许认真。</p>
<p>任正非曾说过这么一句话：<em>领先很简单，你比别人做的好就行了；领导很难，需要带着大家一起好。</em>领先和领导是完全不同不同的两件事，领先只需要将自己的事情做到好即可，而领导则不同，领导需要让每个人都把自己的事情做好。这其中涉及到能力和任务的匹配，积极性的激发等等和人相关的事情。</p>
<p>首先便是组内成员主观能动性的调动，我认为最好的方法便是让每个人都成为创作的贡献者，这样才能让每个人认真对待后续一切过程的。换句话说，这和我曾经看到的一条关于恋爱的规律有异曲同工之妙：<em>人的感情更多取决于付出了多少，更少取决于得到了多少</em>。正因如此，在剧本创作的过程中，本组所有的成员都有所参与，有所贡献，对剧本有着认同。这样，才不至于在后续的过程中得过且过。</p>
<p>其次，是关于分工的问题。很幸运的是本组的成员基本多才多艺，有摄影选手，养宠物选手，后期剪辑选手，阅片无数选手，热爱学习选手。每个人的能力其实都不足以拍摄出这部内容丰富的影片，而这些能力结合起来，便可以克服种种创作中碰到的困难。此外，合理的任务分配是必要的，这需要考虑到每个人的时间安排以及个人能力。但影视创作中的任务类型是异质的，写剧本，编分镜，拟定拍摄计划，拍摄以及后期，这些任务的工作量必然有所区别，而这就必然会导致个人任务时长不均产生公平性问题。面对这个问题，我认为应当尊重个人意愿，对这部影片十分热爱的选手，即便是熬夜剪辑也十分乐于见到自己的成果，而对于不愿意投入大量个人时间的选手，也没必要对其进行过多的苛责。真正需要注意的，是不能让后者影响到了前者的热情与投入，这是需要时时刻刻注意的。</p>
<p>最后，几个人共同超一个方向努力的感觉是极好的。有人为了拍摄翘了组会，有人积极筹备道具，善用现有条件来解决困难，有人不远万里来到创新港协助我们拍摄，有人为了拍摄当天一切顺利提前用一天的时间到处踩点，有人在百忙之中抽出时间剪辑后期，并且一丝不苟。整个过程是艰辛的，结果是美好的。这段通力合作的经历给我上了生动的一课，合作，是一件很美好的事情。</p>
<p>最后，附上我们的影片：</p>
<iframe src="//player.bilibili.com/player.html?aid=257448226&amp;bvid=BV18Y411K7PV&amp;cid=743040841&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<h3 id="section-5">2</h3>
<p>2022年6月1日，一大早刚起床便听到了电话响起。泰康人寿的，最近给我打了很多次，但是好巧不巧都在我忙的时候便一直没有接过。今天刚好有时间就接电话聊了聊。</p>
<p>电话的内容主要是向我推销他们的一款意外险。关于保险本身的内容按下不表，这次推销让我想起了大概半年前招商信诺向我推销保险的一次经历。这两次推销的销售人员有很大的差别，前者没有过多的废话，在征得我的同意之后便向我详细阐述了保险的具体内容，并且提醒我记录保险条款的关键信息以便于后期考虑，在介绍完之后发送了一份关于该保险计划详情的文件以供我参考。在这次沟通中他并没有提出任何要我立刻办理的要求，而是在介绍完情况后给了我充足的时间来考虑是否需要购买，在过了一天后给我回电并详聊了后续的事宜。今天的这通推销电话，与前者相比就显得不够专业了。首先是推销人员，口齿不够清晰，声音也不够大，我需要十分认真才能听到他说的内容。接着，在大概介绍完保险内容后，他同样让我拿纸笔进行记录，不过记录的不是关于保险的重要信息而是他本人的工号。关于这些的对话结束后，便立即开始确认我的个人信息，包括姓名，年龄等等。然而，显然泰康是根据电话号码的登记信息向我进行推销的，跟我说的信息均是母亲的信息。这与其一开始说的挑选优质客户进行推销明显相悖。在确认基本信息后，便向我索要身份证号，银行卡号等信息欲给我办理业务。</p>
<p>后续就先不说了，这两件不同的推销经历，反映了公司对于推销人员的培训，公司对于推广人员的态度，以及在保险这么一项业务中服务的重要性。就我个人而言，我是更愿意购置前者向我推销的保险业务，其整个过程体现了对我个人意愿的尊重以及对于合同的尊重。并不能说在这种情况下我一定能购置到更好的合同，但作为个人来说，这样的沟通方式让我更相信在出险的时候，这样的公司所培养出的人员能给我更高效的解决问题。而对于后者，即便他的保险内容不错，但他在向我推广过程中表现出的答非所问，急于签约让我会怀疑招收和培养出如此销售人员的公司在我出险时是否能够及时响应。</p>
<p>上面这段话是有失偏颇的，好的销售人员印象并不意味着这家保险公司的业务能力就一定好，而差的销售印象也不代表之后他的服务会不好。但是这就是个人的感觉，是我们这个社会合作时十分重要的一点。这种感觉在很多地方有所体现，老师在招学生时会看感觉，老板在招员工时会看感觉，包括个人在选择产品时会考虑对于品牌的感觉。小时候我一直觉得这种感觉时不重要的，好的东西自然会有人欣赏，而随着年龄的增长，愈发觉得有时候决定事情走向的可能正是这样一种感觉。因此，感觉无小事，如果我以后开公司的话，需要注意这点。</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>日常</tag>
      </tags>
  </entry>
  <entry>
    <title>云南施甸二中支教小记</title>
    <url>/ebd84d05.html</url>
    <content><![CDATA[<h2 id="day-0">Day 0</h2>
<p>硕士研究生时期，需要参与一项社会实践。遂与好友相约前往云南施甸县支教。原本的安排是县里中学一所，村里中学一所以及山里中学一所。起初计划前往山里中学实行采蘑菇计划，然天有不测风云，支教团计划变更，改为前往施甸二中和施甸三中支教。我们二人被安排在施甸二中。</p>
<p>去程，西安途径昆明转机到保山，校方从保山机场接我们到学校。途中经过秦岭山脉，云贵高原。从北方到南方，从平原到山地再到高原。无论是空中的气候，还是地貌，均变化多样。</p>
<figure>
<img
src="https://download.kezhi.tech/img/202208010008630.jpg?x-oss-process=style/webp"
alt="(摄影师: 蔡育倍)" />
<figcaption aria-hidden="true">(摄影师: 蔡育倍)</figcaption>
</figure>
<span id="more"></span>
<p>在飞机降落过程中，从空中俯瞰，发现云南城市中的建筑风格基本上就是国内的标准样式，而在前往学校的路上，县城，乡村的建筑也与我所处的陕西县城，乡村的建筑别无而至。到了校内，学校的门，床铺，建筑风格等等，均为经典样式。这其中有工业化带来的好处，各种物料可以进行标准化从而降低成本可以让更多的人使用。也有我国制度带来的好处，有好的模式就在全国加以推行，从而使更多的人可以获益。然而，这样的统一化未免让人感到有些落寞。中国是一个横纵跨度五千余公里的国家，有各式各样的地貌和气候，有各种口音的方言习俗。然而，随着现代化和城镇化的推进，我们的城市和乡村样貌逐渐变得千篇一律。这不禁让我想问，现代化，城市化，特色社会主义和区域个性化之间，是有必然冲突存在的吗？</p>
<p>首先，现代化（工业化）使得标准化的商品可以以极低的成本被大批量的制造，这为区域个性趋同提供了物质基础，然而，仅仅有工业化是不够的，因为我国幅员辽阔，并且有大量的人口，工业化的进程完全可以在各个地方异步发展，从而使全国各个城市有其相应的工业化特色。</p>
<p>城市化，与工业化是密切联系的，给人带来的不只有物质上的丰富，同样也有着思想上的变更。相对来说，农村人比城市人更加了解和重视地方传统习俗，在方言的掌握上水平也更高。反过来说，城市人相比于农村人与外界的交流与往来更多，在通用语的掌握水平上更高。因此，相对来说，农村人有着更多的地域性，城市人有着更多的通用性。城市化对人的思想有一定的影响。但是无法忽略的一点是，城市也是在农村的基础上发展起来的，并且其发展一般具有一定的连续性，因此很难下结论说城市化抹杀了区域个性化。</p>
<p>最后就是我国的特色制度了。现代化和城市化的两股推动力，从经济上和思想上都带去了工业社会标准，通用的理念。而全国一盘棋的决策，无疑进一步扩大工业化所带来的优势，即低成本。如果把全国的工业品都一起生产，一起采购，相比于每个地方发展自己的工业来说，可以使每个专业门类的工业品成本都进一步降低，从而降低全国的工业生产成本。这是其显著的优势，也是为什么有的产品中国研发出来之后可以以很低的价格售卖（庞大的需求市场+电商抹平了地域特性）。不得不说，在我国工业起步初期，这种方法可以说是最优解。即以最低的成本谋求最快的发展。而现在，随着我国经济增长乏力，产业转型需求迫切。或许我们应该将目光转向区域个性化这方面，九百六十万平方公里的土地上，不应该只有一种宿舍床。</p>
<p>今天进入施甸二中时，看到一块石头，上面写着<em>中国地质大学援建</em>。进入校园后，看着学校里面的各种设施，不禁感慨。大学之所以谓大学，除了有大事之外，更要担起社会之大责任，为社会进步与发展做出贡献。而作为大学生的我们，也应当承担更多的社会责任，努力让这个社会变得更好。</p>
<h2 id="day-1">Day 1</h2>
<p>在施甸二中的第一天。主要任务是和相应的代课老师进行任务对接。带我的常老师是初三教研组的物理老师，接下来我要负责讲授的课程为初三物理。在交流的过程中，常老师谈到当前的教学进度到了内能这一块，接下来的两周教学内容为热机部分。今天刚布置了一套内能的练习题，接下来的两天假期学生完成，回来后先从习题开始讲。</p>
<p>我带的班级为205，206，207三个班，恰巧下午207班有一节物理课。便趁着这个机会与同学们快速熟悉了一下。这节课准备的较为仓促，主要从物理的起源，发展与应用，未来的发展这三个方面对学生进行讲述。晚上在王伟韬班级里也听了一会课。</p>
<p>总的来说，这些学生给我最大的印象就是求知。在我抛出问题，或是讲到一些比较新的知识时，从第一排到最后一排的学生都认真的看着我。而在听别人班级的课时，也同样如此。第二的感想就是年轻。年轻代表着无限的可能，看着这些年轻的同学们，我总归是想给他们多讲一些东西，在我有限的时间里尽最大的可能带给他们一些积极的影响。</p>
<p>下午在办公室听一名高中老师说，在这里对高三进行假期补课十分困难，有的学生举报学校补课，有的家长帮孩子请假避免补课以至于逃避高考，又有家长在学校不补课时来学校闹要求学校补课，情况十分复杂。此外，这里每周上课都是双休（周五下午开始放，其实应该是两天半），而市里的有的学校每个月也就放一天的假。从而导致这里的高中教育面临着较大的困难</p>
<h2 id="day-2">Day 2</h2>
<p>杨善洲书记的精神令人敬仰；</p>
<p>滇西会战的战士们将被世人铭记在心；</p>
<p>南迁，不予评价。</p>
<h2 id="day-3">Day 3</h2>
<p>早晨6点起床，前往保山市，途径707镇，叫这个名字是因为这里以前是一个补给站，距离昆明距离为707公里，因此叫707镇。</p>
<p>在保山市里吃了菌子火锅</p>
<p><img
src="https://download.kezhi.tech/img/202208010010093.jpg?x-oss-process=style/webp" /></p>
<p>下午前往施甸县品尝了手抓饭</p>
<figure>
<img
src="https://download.kezhi.tech/img/202208010010894.jpg?x-oss-process=style/webp"
alt="(摄影师: 康琪)" />
<figcaption aria-hidden="true">(摄影师: 康琪)</figcaption>
</figure>
<p>晚上整了点小烧烤，有烤猪皮，螺狮肉，鸡胗，大肠，排骨......</p>
<p><img
src="https://download.kezhi.tech/img/202208010004053.jpg?x-oss-process=style/webp" /></p>
<p>晚安</p>
<h2 id="day-4">Day 4</h2>
<ul>
<li>无事可做</li>
</ul>
<h2 id="day-5">Day 5</h2>
<p>今天其实是正式授课的第一天，上周常老师布置了物理练习卷给205，206，207三个班级。今天的主要任务就是讲解这张卷子。第一节在206上课，我来上，常老师坐在后面听。</p>
<p>课后，常老师对我提出了一些建议：</p>
<ul>
<li>讲述方式可以更具体一点，在分析比热容的题目时，可以用水和沙子作为例子给学生讲述，使用物质A，物质B这样比较抽象的概念可能会造成学生的理解困难</li>
<li>讲课节奏需要调整，一些简单重复的概念题可以讲快一点。可以留出更多的时间在学生容易出错的计算题上</li>
<li>上课可以抽出一点时间让同学们做题，一般下课之后这里的学生是不做作业的</li>
</ul>
<p>首次上正式的教学内容，由于对学生情况的不了解以及缺乏经验，还是存在很多的不足。中学的教学课程与大学课程，演讲，分享，拓展课程都不同，往往它以学生把题目做对为目的进行设计，引导兴趣，知识扩展在其中非常罕见。</p>
<h2 id="day-6">Day 6</h2>
<p>这里的自习课分为两节，第一节19:00-19:50，持续50分钟，和一般的中学课程时长差不多。第二节20:00-22:00，中间20:50-21:10有20分钟的休息时间，这个时间学生往往去食堂和超市加餐。</p>
<p>今天是205班和206班的自习课，这节课包含三项内容：</p>
<ul>
<li><p>“斯坦福的博弈论课程游戏”</p>
<blockquote>
<p>斯坦福大学博弈论课程引入时的一个小游戏：每位同学写下一个0-100之间的数字，最接近所有同学写下数字平均数的2/3的同学获得游戏准备的奖品</p>
</blockquote></li>
<li><p>送书: <em>迷人的材料</em></p>
<blockquote>
<p>这本书是西安交大一百本必读经典中的推荐书目，介绍了十种生活中常见的材料。全年龄读物</p>
</blockquote></li>
<li><p>提问回答</p>
<blockquote>
<p>支教团孙老师想出来的点子，考虑到直接让学生提问可能会有同学不敢举手，就让他们把问题写在纸上，然后统一收上来当堂回答</p>
</blockquote></li>
</ul>
<p>三个班最后的结果大约为26，30，30。顺着这个游戏结果，我给同学们介绍了博弈这个研究方向，同时也对我现在的研究生生活进行了一点分享。</p>
<p>在问答环节，学生们问的问题主要集中在感情，学习，家庭这三个方面。让我印象深刻的问题有这么几个：</p>
<ul>
<li>如何平衡好友情，爱情，学习和生活？</li>
<li>父母和老师不理解我们怎么办？</li>
<li>为什么我们一定要读书？</li>
<li>合适和感觉哪个更重要？</li>
</ul>
<p>他们所写的问题，我在一一回答完后全部整理好带回西安，之后打算扫描一份留档。</p>
<p>在205班回答的最后一个问题是：“老师，能给我们放个电影吗”？刚好，我就放了之前拍摄的微电影给他们看<del>占用了他们十分钟课间</del>。</p>
<p>最后，也给他们留了我的联系方式，思来想去，留邮箱最合适。</p>
<p>晚上看学校的电脑实在太卡了，就整了波净网行动。高中部200班的电脑实在病入膏肓，从开机到鼠标可以动大约需要20分钟，各种自启动的进程占据了所有的系统资源。打开任务管理器杀掉部分进程后，又很快有新的进程补上来。我亲眼看着随着我结束任务，右下角缓缓浮现了三个内存加速球......</p>
<p>无奈，到最后只得重装系统，这些老旧电脑 (CPU 貌似是i3-2XXX)
装上win10之后，响应速度还是挺不错的。</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202208132156067.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202208132156267.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p><img
src="https://download.kezhi.tech/img/202208132157564.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202208132157879.jpg?x-oss-process=style/webp" /></p>
<h2 id="day-7">Day 7</h2>
<p>今天是207的自习课，授课内容和昨天的差不多，也是同样的环节和内容。不过207的学生相对更加活跃，问的问题有很多都很有趣。</p>
<p>一个内容上很多次，就从精心的准备变成了熟练的表演。时间，节奏和学生的反应把握的会越来越准确。老师这门职业也一样，无他，唯手熟尔。</p>
<p>吃饭的时候，买了个泡泡糖，吹了个泡泡放到了水沟里。</p>
<p><img
src="https://download.kezhi.tech/img/202208132137883.jpg?x-oss-process=style/webp" /></p>
<h2 id="day-8">Day 8</h2>
<p>课表上今天有三节物理课，分别在三个班授课。准备的授课内容主要为热机和能量守恒定律这两节课。在备课时恰好看到阮一峰的科学周报更新了，就在其中挑选了一些内容作为课程的开场环节。同时也将该网站分享给了同学们。</p>
<p><img
src="https://download.kezhi.tech/img/202208132136929.jpg?x-oss-process=style/webp" /></p>
<p>常老师今天也来听我讲新课，课后她跟我说学生很喜欢我和他们分享一些开阔视野的内容，他们对这些非常感兴趣。这里的老师讲了很多年课，上课的内容基本都固定了。给学生讲完物理之后，学生并不知道这些知识能干什么。我讲的一些内容可以让部分同学了解物理学在现代社会中的应用。从而提升学生对这门课的兴趣。不过，相对来说，我的授课更像是一场分享。常老师给我介绍了一般课程需要包含的环节（以物理课为例）：</p>
<ul>
<li>课程引入：从生活中的一些常见的现象，或者一些实验来引入今天要学习的知识</li>
<li>学习目标：要给学生列出这节课的学习目标<del>（我在中学期间貌似确实没看过这种东西）</del>，便于学生检查掌握情况</li>
<li>内容讲述：节奏可以慢一点，一些比较重要的概念需要多次重复强调</li>
<li>内容回顾：最后复习该节课程的所有内容</li>
</ul>
<p>中午支教团的大家一起去滇西饭店，吃了绿林心心念念的小鸡炖蘑菇</p>
<p><img
src="https://download.kezhi.tech/img/202208132134686.jpg?x-oss-process=style/webp" /></p>
<p>今天收获很多，晚上出去吃了烧烤。</p>
<p><img
src="https://download.kezhi.tech/img/202208132134232.jpg?x-oss-process=style/webp" /></p>
<p>他娘的，玩的有点晚了，回来学校门关了，只能发挥一下传统艺能了。</p>
<p><img
src="https://download.kezhi.tech/img/202208132131451.jpg?x-oss-process=style/webp" /></p>
<h2 id="day-9">Day 9</h2>
<p>学校下午放了半天假，208的一名同学邀请几位初中的老师去她家吃饭，说是给我们做当地的特色菜。我也有幸收到了邀请。<del>我还没有给208班带过课，他们班的同学是通过别的老师在课上放我拍摄的电影认识我的。</del></p>
<p>菜品很丰盛，也十分具有当地特色。有腌腊，炒菌子，腊肠等等。家里还有很多当地产的水果，以芒果和红心火龙果居多。据说最便宜时芒果只卖5毛钱一斤。</p>
<p><img
src="https://download.kezhi.tech/img/202208132117872.jpg?x-oss-process=style/webp" /></p>
<p>午饭过后，学生带着我们上山摘菌子。上山背筐的任务自然落在了我身上。</p>
<p><img
src="https://download.kezhi.tech/img/202208132122444.jpg?x-oss-process=style/webp" /></p>
<p>去的路上看到了大片水稻和荷塘，回来时还在荷塘摘了莲蓬吃，十分香甜。</p>
<p><img
src="https://download.kezhi.tech/img/202208132118851.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202208132118296.jpg?x-oss-process=style/webp" /></p>
<p>刚上山没多久，就下起了大雨。云南这个地方，云是自由的，它可以突然飘过来下一场雨，也可以立马飘走让天空放晴。这场意料之外的大雨让我们每个人都浑身湿透。上山是土路，雨一下，就变成了淌水泥路。学生泰然处之，绿林因为她的白鞋近乎破防。</p>
<p>山腰上有个可以避雨的山洞，学生说里面有蝙蝠和蛇，给我们劝退了。就这样淋着雨一步步上了山。快到山顶的时候，天空放晴太阳照在身上非常温暖，由于这里高强度的紫外线，衣服没一会也就干了。不得不说，山上的风景还是很不错的。</p>
<p><img
src="https://download.kezhi.tech/img/202208132130514.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202208132130243.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202208132130125.jpg?x-oss-process=style/webp" /></p>
<p>到了有菌子的海拔，山路也变得愈加陡峭，我们在非山路的地方难以立足，更不用说找菌子了。最后收获的菌子只有路上的扫把菌和一种白色的菌子。收获趋近于0。</p>
<p><img
src="https://download.kezhi.tech/img/202208132122878.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202208132124911.jpg?x-oss-process=style/webp" /></p>
<p>从山上下来，晚上有课的老师陆陆续续回学校了，我和子怡留在那里吃了晚饭。晚饭后，下午的半天假期也结束了，我们和学生一道回学校。路上跟她聊天时了解到，学生宿舍盖的很不错，但这两年学校以没钱运营为由，不在为学生宿舍提供热水，学生每天只能用冷水洗澡；食堂的饭菜这几天因为支教老师的到来品类比较丰富，也相对好吃。平时品种很少，并且存在极端调味（要么过咸，要么没有味道）。说起她自己，她想要初中毕业后，去读五年制的专科学幼教，再进行专升本。她非常喜欢小孩，她姐姐也一样，不过她的姐姐再父母的阻拦下还是去读了高中。</p>
<p>她说她喜欢出去玩，曾经自己攒钱一个人去周边的城市玩，玩到没钱了再回来。每天的生活费除了必须之外都攒下来，加上爷爷奶奶有时给的钱，以及过年时的压岁钱，每年大约能攒出10,000元。姐妹俩打算在中学毕业后去四川，重庆玩。她非常想去重庆吃火锅。此外，在姐姐成人时，她想攒够钱给姐姐买一辆新能源汽车。</p>
<h2 id="day-10">Day 10</h2>
<p>昨晚在小办公室备课，校长开会回来跟我们说，还有一天学校的教师就要离岗了，假期的课程到这里就结束了。相比于之前的计划提前了三天，这让我们有点措手不及。原本计划周三要去给208上一节课，现在就只剩下周一一天的课了。</p>
<p>对于这突入其来的变化，我们支教团连夜和学校的老师联系，协商最后一天学校的课全都由支教团来上。此外，我还和绿林老师商量要了半节晚自习来给208上课。<del>之前去学生家吃饭答应的</del></p>
<p>好巧不巧，带我的物理老师除了当天的三节课之外，早上还和体育老师换过来两节课，共计五节课。加上晚上给208上的自习，一共有6个课时要上。</p>
<p>早上的两节课，帮调研组在班里收集问卷调查的结果。思考了很久下午给学生的最后一节课要讲什么。最后想到之前好多学生在得知我是研究生时好奇我的研究是什么，就决定给他们科普下这方面的知识。中午的两个小时，我找了身边的若干朋友要了他们目前正在做或已经做完的科研或项目的资料，给学生们备好了最后一节课。</p>
<p>尽管我以最简单的方式来讲这些研究内容，但由于介绍的研究包含多个方向。中学生的知识面毕竟有限，可以看出在课上存在部分学生在部分内容中完全听不懂的情况。但同样的，也存在部分学生在部分环节可以听懂并且十分感兴趣的情况。</p>
<p>晚上自习是给208上的第一节课，也是最后一节。我很快的讲完了我的研究生生活分享内容，快速进入到了问答环节，也就是和同学们聊聊天。他们班是初三年级中最活跃的，有问题就直接问，因此也没有采用写在纸上这种方式。</p>
<blockquote>
<p>经过对比，写在纸上这种方式可以收到更多数量以及更高质量的问题，并且给的些问题的时间越长，问出高质量问题的概率就越高。而课上直接提问这种方式，问出的问题都是较为普遍轻松的问题（例如黑历史，感情经历，人生遗憾之类的问题，有点像<code>真心话</code>）。</p>
</blockquote>
<p>每节课下课第一件事就是到办公室里赶紧整点水喝。连着上这么多课的结果就是又困又渴。总的来说，高强度的上课对身体的损伤还是有的。</p>
<p>中午吃了碗这里的饺子，很不错，并且发现自己逐渐喜欢上了吃薄荷。</p>
<p><img
src="https://download.kezhi.tech/img/202208132200274.jpg?x-oss-process=style/webp" /></p>
<h2 id="day-11">Day 11</h2>
<p>这天学生就放假了，早上上两节课之后就打扫卫生放学回家。昨晚和208的小妹约好，今天一起去采芒果寄回家。最近的芒果生产地在旧城乡，需要先坐公交车去施甸县，然后在施甸客运站坐客车前往。比较有意思的是取得五个人中有四人没带身份证，遂一起在施甸县客运站办临时身份证（我们四人都是第一次办身份证）。</p>
<p>从施甸县出发，大约翻过三个山到达旧城乡。</p>
<p><img
src="https://download.kezhi.tech/img/202208132119936.jpg?x-oss-process=style/webp" /></p>
<p>相比于施甸县，旧城乡的海拔较低，气温更高，但紫外线强度不减。晒得有些受不了。还好我搞了一大瓶水可以及时补充流失的水分。</p>
<p><img
src="https://download.kezhi.tech/img/202208132208203.jpg?x-oss-process=style/webp" /></p>
<p>跟着小妹找到了可以摘芒果的地方，说是2元一斤，讲了一会价格没讲下来。在前往芒果地的路上，想到下午16:30之后就没有回施甸县的车了。遂询问包车事宜。带我们采芒果的阿姨领着我们找了一个包车回去的地方。说是按人头算，一人50元，5个人250元回施甸。我们五人合计后决定放弃芒果，坐车回县里逛逛。<del>摘芒果的成本太高了</del></p>
<p>在往返的车上，山路的风景是很好看的。这一趟来回也不算没有收获。在施甸县，小妹带我们去了她最喜欢吃的烤鱼店里吃烤鱼。点了烤五花肉，炸臭豆腐以及烤鱼。</p>
<figure>
<img
src="https://download.kezhi.tech/img/202208132118112.jpg?x-oss-process=style/webp"
alt="摄影师: 康琪" />
<figcaption aria-hidden="true">摄影师: 康琪</figcaption>
</figure>
<p>烤五花肉给的蘸酱主要是腌菜膏，但是比之前我在这里吃到的腌菜膏都要好吃，于是想去问老板买一点带回去。问完得知腌菜膏都是在超市买的一样的，主要是加的配料各家有所不同。一般主要加小米辣，蒜末，盐，味精和酱油。由于腌菜膏很酸，因此需要放很多的味精来中和其的酸味。饭毕，老板留下我们喝了会茶，说我们能够遇到是3k年的缘分。说着说着想起云南这个地方特产茶叶和咖啡，便买了点带回去。</p>
<p>晚上我们打车回学校，来的车是辆比亚迪海豚。由于我们有五个人，如果坐一辆车就超载了。与师傅协商加价15送我们回去。路上小妹对这辆车很好奇，一直问关于这个车的事情，司机师傅顺路带她去五菱的汽车仓库转了一圈。师傅说他跑滴滴，兼职卖车，白天还要干活。要赡养老人，还有两个孩子在上学。属实不易</p>
<h2 id="day-12">Day 12</h2>
<p>今天从保山出发前往昆明，早上吃了最后一顿破酥包，十分遗憾没有火腿馅的了。学校安排车把我们分别送到保山机场和保山火车站。</p>
<p><img
src="https://download.kezhi.tech/img/202208132202897.jpg?x-oss-process=style/webp" /></p>
<p>在火车站附近发现也有卖破酥包的，遂买一个火腿包想品尝一下。结果掰开来后大多都是白糖，含有几颗莲子以及一些红色的火腿。<del>原来前几天绿林买的火腿包老板没拿错，火腿包就是甜的</del></p>
<p><img
src="https://download.kezhi.tech/img/202208132202887.jpg?x-oss-process=style/webp" /></p>
<p>到达昆明后，刚入住民宿外面就下起了倾盆大雨。雨来的快去的也快，大概半个小时之后就停了。</p>
<p><img
src="https://download.kezhi.tech/img/202208132204036.jpg?x-oss-process=style/webp" /></p>
<p>前往东强推荐的正义坊吃饭，但到地方后半天找不到吃饭的地方。于是东强过来与我们回合，带领我们到了吃正餐的地方，没吃晚饭的我们去吃了每种肉都是涮13s的潮汕火锅。吃完后也晚了，在外面转了转就打车回民宿睡觉了。</p>
<p><img
src="https://download.kezhi.tech/img/202208132203252.jpg?x-oss-process=style/webp" /></p>
<h2 id="day-13">Day 13</h2>
<p>原本今天的打算是早上去斗南花卉市场，然后直接去昆明南站坐高铁回西安。从住处打车去地铁站时一位警察叔叔说花卉市场要晚上去，一来早上花农都在采花，现在去就只有一些固定摊位；二来花卉市场到晚上一般比较热闹，有扔花捡花的活动。</p>
<p>于是我们决定改变计划，前往官渡古镇。</p>
<p><img
src="https://download.kezhi.tech/img/202208132205427.jpg?x-oss-process=style/webp" /></p>
<p>在那里转了转，看到了在这里努力学习的小孩。</p>
<p><img
src="https://download.kezhi.tech/img/202208132206589.jpg?x-oss-process=style/webp" /></p>
<p>吃了碗豆花米线。</p>
<p><img
src="https://download.kezhi.tech/img/202208132206510.jpg?x-oss-process=style/webp" /></p>
<p>就提着行李变成回西安一道光去高铁站回西安了。</p>
<p><img
src="https://download.kezhi.tech/img/202208132207415.jpg?x-oss-process=style/webp" /></p>
<h2 id="the-end">The End</h2>
<p><img
src="https://download.kezhi.tech/img/202208132207102.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202208132207835.jpg?x-oss-process=style/webp" /></p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>日常</tag>
        <tag>支教</tag>
        <tag>感悟</tag>
      </tags>
  </entry>
  <entry>
    <title>修改操作系统安装时间</title>
    <url>/629d278e.html</url>
    <content><![CDATA[<p>由于某些不可名状的原因，导致了有修改操作系统安装时间的需求，在此小记。</p>
<p><img src="https://download.kezhi.tech/img/202206231950445.png?x-oss-process=style/webp" width=30%></p>
<span id="more"></span>
<h2 id="windows">Windows</h2>
<p>Windows修改操作系统安装时间主要通过修改注册表实现，步骤如下：</p>
<ol type="1">
<li><code>win</code>+<code>R</code> 输入 <code>regedit</code>
打开注册表</li>
<li>进入路径<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion</code></li>
<li>右侧的<code>InstallData</code>即为系统安装时间</li>
<li>将修改的时间戳值写入十进制格式即可</li>
</ol>
<blockquote>
<p>时间戳的转换可以访问：http://tool.chinaz.com/Tools/unixtime.aspx</p>
</blockquote>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
        <tag>安装时间</tag>
        <tag>系统修改</tag>
      </tags>
  </entry>
  <entry>
    <title>关于影视创作</title>
    <url>/624fe65f.html</url>
    <content><![CDATA[<blockquote class="blockquote-center">
<p>电影是经由极度刻意而达到的自然</p>

</blockquote>
<h2 id="影视创作的基本流程">影视创作的基本流程</h2>
<p><img
src="https://download.kezhi.tech/img/202205251718490.webp" /></p>
<span id="more"></span>
<ol type="1">
<li>剧本创作</li>
<li>将剧本转换为分镜</li>
<li>根据分镜制定拍摄计划（同一场地的排在一起）</li>
<li>寻找演员，拍摄场地</li>
<li>准备服装，化妆，道具</li>
<li>进行拍摄</li>
<li>后期创作</li>
<li>发布</li>
</ol>
<h2 id="影片拍摄过程">影片拍摄过程</h2>
<p>流程：</p>
<ol type="1">
<li>到达拍摄现场之后，首先要进行拍摄的一场戏的正常彩排（保证演员情绪状态完整）。可以在地上贴大力胶（寺冈），帮助演员走位。</li>
<li>注意镜头语言和场面调度，每个机位尽量把所有的戏都演一遍，保证演员情绪连贯。</li>
<li>彩排结束后，摄像机和麦克风进行预演，确认画面拍摄效果。</li>
<li>导演与摄像师，录音师，场记确定是否准备就绪</li>
<li>打开所有的麦克风（相比于影片图像来说，声音文件要小得多，可以多录来进行容错）。</li>
<li>摄像机开始录像。</li>
<li>场记板放在镜头焦点位置（即拍摄主题附近），场记报场记信号：XX场XX镜XX次。打板后退场。</li>
<li>导演喊“三，二，一，开始”，整场人员保持安静，演员开始表演。各部门按照预演动作进行录制。</li>
<li>导演喊“停”，演员停止表演，各部门录制结束。</li>
<li>查看录制回放，若导演通过则继续录制下一条，否则重复4-9过程。</li>
</ol>
<p>注意事项：</p>
<ol type="1">
<li>摄像机录制文件很大，特别是画质很好的摄像机，因此在流程中尽量减少摄像机的无效拍摄时间。</li>
<li>场记板对于后期整理文件真的很重要！真的很重要！真的很重要！</li>
<li>导演在喊“三，二，一”的同时观察场记人员是否已经撤出镜头，根据周围人的活动来调整语速。要保证“开始”说出以后，全场安静，并且画面干净</li>
<li>即使演员台词已经说完，在导演喊停之前也要继续表演（即兴），直到导演喊停为止。</li>
</ol>
<h2 id="拍摄设备">拍摄设备</h2>
<p>麦克风：大型 NTG3，小型 H5</p>
<p>配音：如果需要后期配音，可以考虑用棉被将录制设备和配音演员裹起来录音，以保证声音的干净，没有混响。这样可以给后期调音更大的空间。</p>
<p>反射：如果拍摄过程中遇到玻璃反射，水面反射，天空不够通透等情况，可以给镜头前面加上偏振片来滤除这些反射。</p>
<p>场记板：可以使用实体场记板，也可以用 iPad
或者手机上的应用来作为场记板。拍摄清晰即可。</p>
<h2 id="后期">后期</h2>
<h3 id="声音">声音</h3>
<p>主音量： -12~-6之间</p>
<p>背景音量：-24~-8之间</p>
<p>监听耳机尽量使用有线封闭式耳机。</p>
<p>推荐：森海，HD25SP，SONY7506</p>
<h3 id="画面">画面</h3>
<p>屏幕比例：</p>
<ul>
<li><p>1.85:1 更有电影感</p></li>
<li><p>2.35 : 1
宽银幕（电影院为了和家庭电视对抗），越宽人的观感越好。</p></li>
<li><p>上世纪60年代，3D电影逐渐消失。2D也可以把故事讲好。</p></li>
</ul>
<p>视频格式转换：格式工厂。</p>
<h2 id="一些感悟">一些感悟</h2>
<p>影视创作是十分严谨的工作，其中的每个环节都非常重要。一个环节出问题就会影响最后的成片效果。其中，分镜和拍摄部分尤为重要。一个好的分镜可以让拍摄的过程少走弯路，极大程度提高拍摄效率。我认为一个好的分镜应当具备如下特点：</p>
<ul>
<li>描述准确，看到分镜描述便可以想象到拍摄画面</li>
<li>拍摄可行，根据分镜可以执行可行的拍摄计划</li>
<li>留出冗余，加入一些冗余画面来增加后期的剪辑空间</li>
</ul>
<p>拍摄过程中，最重要的有两点：一是要按照拍摄计划表进行拍摄，二是在每次拍摄过程中严格按照拍摄流程进行。即便是一部微电影，镜头数量和拍摄数量也在十几到几十不等，再加上一个镜头可能要拍摄多次，最后的文件数量大约有几十乃至上百个。严格按照拍摄计划表和拍摄流程进行拍摄，可以保证不漏掉镜头并且给后期带来极大的便利。此外，还有如下几点需要特别注意：</p>
<ul>
<li>每一个镜头拍摄结束时，需要回放拍摄影片来查看拍摄质量是否有问题</li>
<li>每一个镜头都要有场记板，这样对后期整理文件会带来极大便利</li>
<li>拍摄文件命名（个人推荐）：场号_镜号_拍摄次数_设备编号_设备型号</li>
<li>录音文件和拍摄文件的命名要对应，以便于后期剪辑</li>
</ul>
<p>拍摄结束后，根据场号和镜号对拍摄素材进行整理，包括视频文件和音频文件。</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>感悟</tag>
        <tag>拍摄</tag>
        <tag>电影</tag>
        <tag>创作</tag>
      </tags>
  </entry>
  <entry>
    <title>创新港体育场馆自动预定</title>
    <url>/66f3a0f6.html</url>
    <content><![CDATA[<h2 id="项目由来">项目由来</h2>
<p>创新港羽毛球场馆每天的预定需求较大。在线预定系统每天早上 8:40
左右开放，并且开放时间不定。这些因素给手动预定场馆带来了很大的麻烦，因此考虑由脚本自动化实现场馆预定过程。</p>
<p><img
src="https://download.kezhi.tech/img/202203212104191.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h2 id="项目构思">项目构思</h2>
<p>体育场馆预定系统需要通过交大身份认证系统来确认身份。考虑携带登录之后的身份信息来访问体育场馆预定系统。这里的身份认证参考了果果的图书馆订座脚本：</p>
<p><a
href="https://gwyxjtu.github.io/2020/06/02/XJTU图书馆抢座位脚本-requests库/">XJTU图书馆抢座位脚本--requests库
| 果果的博客 (gwyxjtu.github.io)</a></p>
<p>此外，体育场馆预定系统开放时间为
8:40-21:40，并非全天开放。因此需要进行连通性检测来进行预定控制。</p>
<p>项目流程架构如下所示：</p>
<ol type="1">
<li>检测连通性确认体育场馆预定系统是否开放</li>
<li>通过体育场馆查询api获取所有场馆信息</li>
<li>设定一定的条件来筛选出需要预定的场地</li>
<li>通过交大身份认证获得身份信息</li>
<li>向场馆预定系统发送预定post请求来进行预定。</li>
</ol>
<h2 id="项目实现">项目实现</h2>
<h3 id="连通性检测">1. 连通性检测</h3>
<p>使用<code>requests</code>库里的<code>urlopen</code>库来进行连通性检测：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_net</span>(<span class="params">testserver</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ret = request.urlopen(url=testserver, timeout=<span class="number">3.0</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>在主函数里的检测等待代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> check_net(<span class="string">&#x27;http://202.117.17.144/&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="查询场馆信息">2. 查询场馆信息</h3>
<p>首先构建一个<code>session</code>来进行后面的访问，通过<code>session</code>访问可以保证访问的连续型。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.util.retry <span class="keyword">import</span> Retry</span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"></span><br><span class="line">MAX_RETRIES = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">SLEEP_INTERVAL=<span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">retries=Retry(</span><br><span class="line">    total=MAX_RETRIES,</span><br><span class="line">    backoff_factor=SLEEP_INTERVAL,</span><br><span class="line">    status_forcelist=[<span class="number">403</span>, <span class="number">500</span>, <span class="number">502</span>, <span class="number">503</span>, <span class="number">504</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.mount(<span class="string">&quot;http://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line">session.mount(<span class="string">&quot;https://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 Edg/98.0.1108.62&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>接下来就是查询场馆信息了。以创新港乒乓球场馆为例（因为未被预定的场地较多，便于测试
^_^）。</p>
<p><img
src="https://download.kezhi.tech/img/202203211850928.png?x-oss-process=style/webp" /></p>
<p>通过观察链接以及进行测试，可以推测出每个场馆通过一个 <code>id</code>
来进行标识，后续的场馆信息查询和预定申请都需要用到该信息。</p>
<p><img
src="https://download.kezhi.tech/img/202203211904502.png?x-oss-process=style/webp" /></p>
<p>通过查看页面请求，找到向 <code>/findtime.html</code>发送
<code>GET</code> 请求可以查询到需要查询的信息。</p>
<p>但是该请求返回的信息是不完全的，有一个场次 <code>id</code>
没有被返回到，而这个场次 <code>id</code>
在之后的预定中是要用到的，经过多番查找，最终在网球场预定页面找到如下<code>api</code>:</p>
<p><img
src="https://download.kezhi.tech/img/202203211912146.png?x-oss-process=style/webp" /></p>
<p>从该 <code>api</code> 中可以找到三个关键信息:</p>
<ul>
<li>id 每个场地的每个时间场次的标识符</li>
<li>status 场地状态，1为可预订，2为已被预订</li>
<li>stockid 每个场地的标识符</li>
</ul>
<p>由此，便可以通过该 <code>api</code>
查询每个场馆的场地信息。实现如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_avaliable_seats</span>(<span class="params">court_id,date</span>):</span><br><span class="line">    </span><br><span class="line">    params=&#123;<span class="string">&#x27;s_date&#x27;</span>:date,</span><br><span class="line">            <span class="string">&#x27;serviceid&#x27;</span>:court_id&#125;</span><br><span class="line">    response=session.get(<span class="string">&#x27;http://202.117.17.144/product/findOkArea.html&#x27;</span>,params=params,headers=headers).json()</span><br><span class="line">    </span><br><span class="line">    available_court_list=[]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> response[<span class="string">&#x27;object&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> item[<span class="string">&#x27;status&#x27;</span>]==<span class="number">1</span>:</span><br><span class="line">            available_court_list.append(item)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> available_court_list</span><br></pre></td></tr></table></figure>
<h3 id="筛选出需要的场地">3. 筛选出需要的场地</h3>
<p>这一步比较容易，直接在上一步得到的场次进行筛选即可。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_suitable_seats</span>(<span class="params">seat_list,time</span>):</span><br><span class="line">    result=[]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> seat_list:</span><br><span class="line">        <span class="keyword">if</span> item[<span class="string">&#x27;stock&#x27;</span>][<span class="string">&#x27;time_no&#x27;</span>]==time:</span><br><span class="line">            result.append(item)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<h3 id="通过交大认证获得身份信息">4. 通过交大认证获得身份信息</h3>
<p>这里参考了果果的图书馆订座脚本<a
href="https://gwyxjtu.github.io/2020/06/02/XJTU图书馆抢座位脚本-requests库/">XJTU图书馆抢座位脚本--requests库
| 果果的博客
(gwyxjtu.github.io)</a>。唯一不同之处在于，登录身份认证系统后跳转的应用不同。在浏览器中通过体育场馆预定系统跳转到身份认证页面，查询页面cookie即可得到相应的<code>appid</code></p>
<p><img
src="https://download.kezhi.tech/img/202203211921930.png?x-oss-process=style/webp" /></p>
<p>将对应的 <code>appid</code>
填充到相应位置，便可进行登录和跳转。登录部分代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_pwd</span>(<span class="params">raw_pwd, publicKey=<span class="string">&#x27;0725@pwdorgopenp&#x27;</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; AES-ECB encrypt &#x27;&#x27;&#x27;</span></span><br><span class="line">    publicKey = publicKey.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># pkcs7 padding</span></span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + (BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)</span><br><span class="line">    pwd = pad(raw_pwd)</span><br><span class="line">    <span class="comment"># zero padding</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    pwd = raw_pwd</span></span><br><span class="line"><span class="string">    while len(raw_pwd.encode(&#x27;utf-8&#x27;)) % 16 != 0:</span></span><br><span class="line"><span class="string">    pwd += &#x27;\0&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    cipher = AES.new(publicKey, AES.MODE_ECB)</span><br><span class="line">    pwd = cipher.encrypt(pwd.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(base64.b64encode(pwd), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># get cookie route</span></span><br><span class="line">        session.get(<span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get JcaptchaCode and cookie JSESSIONID &amp; sid_code</span></span><br><span class="line">        r_JcaptchaCode = session.post(<span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/g/admin/getJcaptchaCode&#x27;</span>,</span><br><span class="line">                              headers=headers)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># is_JcaptchaCode_show</span></span><br><span class="line">        url = <span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/g/admin/getIsShowJcaptchaCode&#x27;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;userName&#x27;</span>: config[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;_&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        r = session.get(url, params=params, headers=headers)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="comment"># login</span></span><br><span class="line">        url = <span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/g/admin/login&#x27;</span></span><br><span class="line">        cookie = &#123;</span><br><span class="line">            <span class="string">&#x27;cur_appId_&#x27;</span>:<span class="string">&#x27;n0C/SQT28fY=&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;loginType&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: config[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line">            <span class="string">&quot;pwd&quot;</span>: encrypt_pwd(config[<span class="string">&#x27;password&#x27;</span>]),</span><br><span class="line">            <span class="string">&quot;jcaptchaCode&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span></span><br><span class="line">        r = session.post(url, data=json.dumps(data), headers=headers,cookies=cookie)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;身份认证成功，正在跳转...&#x27;</span>)</span><br><span class="line">        token = json.loads(r.text)[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;tokenKey&#x27;</span>]</span><br><span class="line">        memberId=json.loads(r.text)[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;orgInfo&#x27;</span>][<span class="string">&#x27;memberId&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        cookie = &#123;</span><br><span class="line">            <span class="string">&#x27;cur_appId_&#x27;</span>:<span class="string">&#x27;n0C/SQT28fY=&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;open_Platform_User&#x27;</span> : token,</span><br><span class="line">            <span class="string">&#x27;memberId&#x27;</span>: <span class="built_in">str</span>(memberId)</span><br><span class="line">        &#125;</span><br><span class="line">        r=session.get(<span class="string">&#x27;http://org.xjtu.edu.cn/openplatform/oauth/auth/getRedirectUrl?userType=1&amp;personNo=3121154016&amp;_=1590998261976&#x27;</span>,cookies = cookie)</span><br><span class="line">        r=session.get(json.loads(r.text)[<span class="string">&#x27;data&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h3 id="预定场馆">5. 预定场馆</h3>
<p>最后一步就是预定场地了，手动预定场馆的流程如下：</p>
<ol type="1">
<li>选择场地</li>
<li>点击确认场地按钮</li>
<li>跳转到新的页面确认场地信息</li>
<li>点击继续预定按钮弹出验证码</li>
<li>输入验证码并确认</li>
<li>返回预定状态信息（成功或失败）</li>
</ol>
<p>通过对这些流程中的页面请求进行查看和分析，关系到预定成功的只有两个过程：①获取并识别验证码，②带着验证码提交一个预定<code>post</code>。</p>
<p>还是以乒乓球场地的预定页面为例，其验证码生成方式如下：</p>
<p><img
src="https://download.kezhi.tech/img/202203212042773.png?x-oss-process=style/webp" /></p>
<p>也就是访问地址http://202.117.17.144/login/yzm.html?+(任意一个float随机数)即可得到验证码图像。</p>
<p><code>post</code>请求一步步通过函数嵌套即可进行定位：</p>
<p><img
src="https://download.kezhi.tech/img/202203212046298.png?x-oss-process=style/webp" /></p>
<p>可以看出，最终提交的<code>post</code>请求地址为<code>/order/book</code>，参数有两个，一个为预定信息转换成的字符串，一个是验证码。下面分别介绍如何获取这两个参数。</p>
<p>预定信息中有大量的参数，但是大量参数为<code>null</code>
，不用进行考虑。需要构造的有以下几个参数：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">param=<span class="punctuation">&#123;</span><span class="attr">&quot;activityPrice&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span>	<span class="comment">//价格信息，保持不变即可</span></span><br><span class="line">           <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span>&#x27;<span class="number">102</span>&#x27;<span class="punctuation">,</span> <span class="comment">//场馆id </span></span><br><span class="line">           <span class="attr">&quot;extend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span>	<span class="comment">//额外信息，保持不变即可</span></span><br><span class="line">           <span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span>	<span class="comment">//保持不变即可</span></span><br><span class="line">           <span class="attr">&quot;stock&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>&#x27;<span class="number">169111</span>&#x27;<span class="punctuation">:</span>&#x27;<span class="number">1</span>&#x27;<span class="punctuation">&#125;</span><span class="punctuation">,</span>	<span class="comment">//第一个数字为上文提到的场地stockid,第二个数字填1即可</span></span><br><span class="line">           <span class="attr">&quot;stockdetail&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>&#x27;<span class="number">169111</span>&#x27;<span class="punctuation">:</span>&#x27;<span class="number">1711756</span>&#x27;<span class="punctuation">&#125;</span><span class="punctuation">,</span>	<span class="comment">//第二个数字为场次id</span></span><br><span class="line">           <span class="attr">&quot;stockdetailids&quot;</span><span class="punctuation">:</span>&#x27;<span class="number">1711756</span>&#x27;	<span class="comment">//场次id</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>验证码部分通过一些在线识别的 <code>api</code>
进行在线验证即可，这个验证码比较简单，成功率还挺高的，本次项目所用的
<code>api</code> 地址为：https://aicode.my-youth.cn</p>
<p>至此，便可以成功对场馆进行预定，预定代码为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">order</span>(<span class="params">seat_info</span>):</span><br><span class="line">    </span><br><span class="line">    param=&#123;<span class="string">&quot;activityPrice&quot;</span>:<span class="number">0</span>,</span><br><span class="line">           <span class="string">&quot;address&quot;</span>:seat_info[<span class="string">&#x27;stock&#x27;</span>][<span class="string">&#x27;serviceid&#x27;</span>],</span><br><span class="line">           <span class="string">&quot;extend&quot;</span>:&#123;&#125;,</span><br><span class="line">           <span class="string">&quot;flag&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">           <span class="string">&quot;stock&quot;</span>:&#123;<span class="built_in">str</span>(seat_info[<span class="string">&#x27;stockid&#x27;</span>]):<span class="string">&#x27;1&#x27;</span>&#125;,</span><br><span class="line">           <span class="string">&quot;stockdetail&quot;</span>:&#123;<span class="built_in">str</span>(seat_info[<span class="string">&#x27;stockid&#x27;</span>]):<span class="built_in">str</span>(seat_info[<span class="string">&#x27;id&#x27;</span>])&#125;,</span><br><span class="line">           <span class="string">&quot;stockdetailids&quot;</span>:<span class="built_in">str</span>(seat_info[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">           </span><br><span class="line">    <span class="comment"># 获取验证码图片</span></span><br><span class="line">    img=session.get(<span class="string">&#x27;http://202.117.17.144/login/yzm.html?0.16003635332777866&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;yzm.jpg?x-oss-process=style/webp&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(img.content)</span><br><span class="line">        f.close()</span><br><span class="line">    <span class="comment"># 验证码识别</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;yzm.jpg?x-oss-process=style/webp&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        img_base64=<span class="built_in">str</span>(base64.b64encode(f.read()))[<span class="number">2</span>:-<span class="number">1</span>]</span><br><span class="line">        f.close()</span><br><span class="line">        </span><br><span class="line">    headers[<span class="string">&#x27;Content-Type&#x27;</span>]=<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    headers[<span class="string">&#x27;Origin&#x27;</span>]=<span class="string">&#x27;https://aicode.my-youth.cn&#x27;</span></span><br><span class="line">    response=session.post(<span class="string">&#x27;https://aicode.my-youth.cn/base64img&#x27;</span>,data=&#123;<span class="string">&#x27;data&#x27;</span>:<span class="string">&quot;image/jpeg;base64,&quot;</span>+img_base64&#125;,headers=headers)</span><br><span class="line">    yzm=response.json()[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 预定场馆</span></span><br><span class="line">    headers[<span class="string">&#x27;Content-Type&#x27;</span>]=<span class="string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span></span><br><span class="line">    headers[<span class="string">&#x27;Origin&#x27;</span>]=<span class="string">&#x27;http://202.117.17.144&#x27;</span></span><br><span class="line">    response=session.post(<span class="string">&#x27;http://202.117.17.144/order/book.html&#x27;</span>,params=&#123;<span class="string">&#x27;id&#x27;</span>:seat_info[<span class="string">&#x27;stock&#x27;</span>][<span class="string">&#x27;serviceid&#x27;</span>]&#125;,data=&#123;<span class="string">&#x27;param&#x27;</span>:<span class="built_in">str</span>(param),<span class="string">&#x27;yzm&#x27;</span>:yzm&#125;,headers=headers).json()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h2 id="项目小结">项目小结</h2>
<p>在开发过程中也走了不少弯路。例如在预定阶段的实现中，研究了很久页面跳转的逻辑。但实际上只有最后一个页面发送的最后一次请求是有效的。之后在进行脚本编写时要注意以结果为导向而不是过程为导向。从而避免很多不必要的开发。</p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Script</tag>
        <tag>Automation</tag>
      </tags>
  </entry>
  <entry>
    <title>实数六大基本定理的相互证明</title>
    <url>/24a1693.html</url>
    <content><![CDATA[<h2 id="简介">简介</h2>
<p>翟老师的<泛函分析>课程带我重新认识了实数。实数中有一些基本定理，但具体有几个存在着很多不同的观点。本文以六大定理为准，这六大定理分别为</p>
<ul>
<li>确界原理</li>
<li>单调有界原理</li>
<li>Cantor闭区间套定理</li>
<li>致密性定理（聚点定理）</li>
<li>Cauchy收敛准则</li>
<li>有限覆盖定理</li>
</ul>
<p>本文对这六大定理之间进行了循环证明，共计30个证明，如有不正之处，可在评论区指出，我会及时进行修正。</p>
<p><img
src="https://download.kezhi.tech/img/202206301525923.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h2 id="实数六大基本定理">实数六大基本定理</h2>
<h3 id="确界原理">1. 确界原理</h3>
<p>如果非空集合<span class="math inline">\(A\subset
R\)</span>有上（下）界，则<span
class="math inline">\(A\)</span>必有上（下）确界。</p>
<h3 id="单调有界原理">2. 单调有界原理</h3>
<p>如果数列<span
class="math inline">\(\{a_n\}\)</span>单调增且有上界（单调减且有下界），则必有极限<span
class="math inline">\(a=\lim_{n\rightarrow+\infty}a_n\)</span>。</p>
<h3 id="cantor闭区间套定理闭集套定理的特殊形式">3.
Cantor闭区间套定理（闭集套定理的特殊形式）</h3>
<p>如果一列闭区间<span
class="math inline">\([a_n,b_n]\)</span>满足以下条件： <span
class="math display">\[
[a_1,b_1]\supset[a_2,b_2]\supset[a_3,b_3]\supset...\\
\lim_{n\rightarrow +\infty} (b_n-a_n)=0
\]</span> 则存在唯一 <span
class="math inline">\(\xi\in\cap_{n=1}^{+\infty}[a_n,b_n]\)</span>。</p>
<h3 id="bolzano-weierstrass致密性定理r1情形">4.
（Bolzano-Weierstrass）致密性定理（<span
class="math inline">\(R^1\)</span>情形）</h3>
<p>如果数列<span
class="math inline">\(\{a_n\}\)</span>有界（既有上界又有下界），则必存在收敛子数列，即有<span
class="math inline">\(\{a_{n_k}\}\)</span>，使得<span
class="math inline">\(\lim_{k\rightarrow+\infty}a_{n_k}\)</span>存在。</p>
<p>致密性定理与聚点定理等价。聚点定理：直线上的有界无限点集至少有一个聚点。</p>
<h3 id="cauchy收敛准则数列情形">5. Cauchy收敛准则（数列情形）</h3>
<p>数列<span
class="math inline">\(\{a_n\}\)</span>有极限（收敛）的充分必要条件是：
<span class="math display">\[
\forall \epsilon&gt;0\Rightarrow\exists M\in N, 使得\ n,m&gt;M\ 时\
|a_n-a_m|&lt;\epsilon
\]</span></p>
<h3 id="heine-borel有限覆盖定理区间特殊情形">6.
（Heine-Borel）有限覆盖定理（区间特殊情形）</h3>
<p>如果一个有限闭区间<span
class="math inline">\([a,b]\)</span>被一组开区间覆盖，则这组开区间中一定存在有限个开区间，它们也覆盖了闭区间<span
class="math inline">\([a,b]\)</span>。即 <span class="math display">\[
[a,b]\subset
\mathop{\cup}\limits_{\lambda\in\Lambda}(a_\lambda,b_\lambda)\Rightarrow
\\\exists (a_i,b_i)\in
\{(a_\lambda,b_\lambda)|\lambda\in\Lambda\},i=1,2,...n 使得\
[a,b]\subset \mathop{\cup}\limits_{i=1}^n(a_i,b_i)
\]</span></p>
<h2 id="确界原理证明其余定理">确界原理证明其余定理</h2>
<h3 id="确界原理证明单调有界原理">确界原理证明单调有界原理</h3>
<p>设数列<span
class="math inline">\(\{a_n\}\)</span>为单调递增序列且上有界（单调递减且下有界的证明类似）</p>
<p>由确界原理可知，数列<span
class="math inline">\(\{a_n\}\)</span>必有上确界，记上确界为<span
class="math inline">\(a=\sup\{a_n\}\)</span>，接下来证明<span
class="math inline">\(a\)</span>即为数列<span
class="math inline">\(\{a_n\}\)</span>的极限。</p>
<p>对于<span class="math inline">\(\forall
\epsilon&gt;0\)</span>，存在<span class="math inline">\(a_N\in
\{a_n\}\)</span>使得<span
class="math inline">\(a-\epsilon&lt;a_N\)</span>，又因为数列<span
class="math inline">\(\{a_n\}\)</span>为单调递增序列，所以对于<span
class="math inline">\(n\geq N\)</span>都有： <span
class="math display">\[
a-\epsilon&lt;a_N\leq a_n&lt;a&lt;a+\epsilon
\]</span> 因此，<span class="math inline">\(\forall
\epsilon&gt;0\)</span>，存在<span
class="math inline">\(N\)</span>使得<span
class="math inline">\(n&gt;N\)</span>时，<span
class="math inline">\(|a_n-a|&lt;\epsilon\)</span>，即<span
class="math inline">\(\lim_{n\rightarrow+\infty}a_n=a\)</span>。</p>
<h3 id="确界原理证明闭区间套定理">确界原理证明闭区间套定理</h3>
<p>设闭区间<span class="math inline">\([a_n,b_n]\)</span>满足： <span
class="math display">\[
[a_1,b_1]\supset[a_2,b_2]\supset[a_3,b_3]\supset...\\
\lim_{n\rightarrow +\infty} (b_n-a_n)=0
\]</span> 首先证明存在性，即存在实数<span class="math inline">\(\xi\in
[a_n,b_n],n=1,2,3,...\)</span></p>
<p>设<span class="math inline">\(S=\{a_n\}\)</span>，则集合<span
class="math inline">\(S\)</span>非空且有上界（任一<span
class="math inline">\(b_n\)</span>都是其上界），则集合<span
class="math inline">\(S\)</span>有上确界，记为<span
class="math inline">\(\xi=\sup S\)</span>。</p>
<p>接着，证明<span class="math inline">\(\xi \in [a_n,b_n],\forall
n\)</span>。首先，<span class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(\{a_n\}\)</span>的上确界，则有<span
class="math inline">\(\xi \geq a_n, \forall n\)</span>，又<span
class="math inline">\(b_n\)</span>为集合<span
class="math inline">\(\{a_n\}\)</span>的上界，由上确界的定义可得，<span
class="math inline">\(\xi\leq b_n\)</span>，所以<span
class="math inline">\(a_n\leq\xi\leq b_n\)</span>，即<span
class="math inline">\(\xi\in[a_n,b_n],\forall
n\)</span>。由此，证明了存在性。</p>
<p>然后证明唯一性，采用反证法，假设存在<span
class="math inline">\(\xi&#39;\neq \xi\)</span>且<span
class="math inline">\(\xi&#39;\in [a_n,b_n]\)</span>，则<span
class="math inline">\(|\xi&#39;-\xi|\leq|a_n-b_n|\rightarrow0(n\rightarrow
+\infty)\)</span>。故<span
class="math inline">\(\xi&#39;=\xi\)</span>，从而证明唯一性。</p>
<h3 id="确界原理证明聚点定理">确界原理证明聚点定理</h3>
<p>设<span
class="math inline">\(S\)</span>为一有界无限点集，由确界定理可得，<span
class="math inline">\(S\)</span>存在上确界和下确界，记为<span
class="math inline">\(\eta=\sup S,\xi=\inf S\)</span>，则若<span
class="math inline">\(\eta\)</span>和<span
class="math inline">\(\xi\)</span>中有一个不是孤立点，则显然为<span
class="math inline">\(S\)</span>的聚点。</p>
<p>否则构造集合<span
class="math inline">\(E=\{x|S中仅有有限个数小于x\}\)</span>，令<span
class="math inline">\(\eta&#39;=\sup E\)</span>，由<span
class="math inline">\(E\)</span>的定义可知，对于$<span
class="math inline">\(有\)</span>'+E<span
class="math inline">\(，即\)</span>'<span
class="math inline">\(和\)</span>'+<span
class="math inline">\(之间含有无数个\)</span>S<span
class="math inline">\(中的数，则\)</span><span
class="math inline">\(，\)</span>('-,'+)<span
class="math inline">\(之间存在无穷多个\)</span>S<span
class="math inline">\(中的数，即\)</span>'<span
class="math inline">\(为\)</span>S$的一个聚点。</p>
<h3 id="确界原理证明cauchy收敛准则">确界原理证明Cauchy收敛准则</h3>
<p>证明必要性：</p>
<p>若数列<span class="math inline">\(\{a_n\}\)</span>收敛且极限为<span
class="math inline">\(a\)</span>，则<span class="math inline">\(\forall
\epsilon&gt;0,\exists M\in N\)</span>，使得 <span
class="math inline">\(m,n&gt;M\)</span>时 <span class="math display">\[
|a_m-a|&lt;\frac{\epsilon}{2},\ |a_n-a|&lt;\frac{\epsilon}{2}
\]</span> 由三角不等式可得： <span class="math display">\[
|a_m-a_n|\leq|a_m-a|+|a_n-a|&lt;\frac\epsilon2+\frac\epsilon2=\epsilon
\]</span> 必要性证明完毕。</p>
<p>证明充分性：</p>
<p>设数列<span class="math inline">\(\{a_n\}\)</span>满足，对于<span
class="math inline">\(\forall \epsilon&gt;0,\exists M\in
N\)</span>，使得<span class="math inline">\(m,n&gt;M\)</span>时，<span
class="math inline">\(|a_m-a_n|&lt;\epsilon\)</span>。</p>
<p>首先证明数列<span class="math inline">\(\{a_n\}\)</span>有界。取<span
class="math inline">\(\epsilon=1\)</span>，则<span
class="math inline">\(\exists N_0\)</span>，使得<span
class="math inline">\(n&gt;N_0\)</span>时有<span
class="math inline">\(|a_n-a_{N_0+1}|&lt;1\)</span>，则<span
class="math inline">\(\forall
n&gt;N_0,|a_n|\leq|a_{N_0+1}|+1\)</span>。又因为数列的前<span
class="math inline">\(N_0\)</span>项为有限项，因此数列<span
class="math inline">\(\{a_n\}\)</span>有界。</p>
<p>构造非空有界集合<span
class="math inline">\(S=\{a|(-\infty,a)\cap\{a_n\}为空或有限项\}\)</span>，则显然数列<span
class="math inline">\(\{a_n\}\)</span>的上确界<span
class="math inline">\(\eta\)</span>为集合<span
class="math inline">\(S\)</span>的上界，则集合<span
class="math inline">\(S\)</span>上确界存在设为<span
class="math inline">\(\eta&#39;=\sup S\)</span>。</p>
<p>由<span
class="math inline">\(S\)</span>的定义以及上确界的定义可得，<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\((-\infty,\eta&#39;-\epsilon)\)</span>中最多含有限个<span
class="math inline">\(\{a_n\}\)</span>中的点，<span
class="math inline">\((-\infty,\eta&#39;+\epsilon)\)</span>中含无限多个<span
class="math inline">\(\{a_n\}\)</span>中的点，因此<span
class="math inline">\((\eta&#39;-\epsilon,\eta&#39;+\epsilon)\)</span>中含有无限多个<span
class="math inline">\(\{a_n\}\)</span>中的点。</p>
<p><span class="math inline">\(\forall \epsilon&gt;0\)</span>，设<span
class="math inline">\(x_{n_k}\in(\eta&#39;-\frac\epsilon2,\eta&#39;+\frac\epsilon2)\)</span>，且<span
class="math inline">\(n_1&lt;n_2&lt;n_3&lt;...\)</span>，<span
class="math inline">\(\exists M\in N\)</span> 使得 <span
class="math inline">\(n&gt;\max(M,n_1)\)</span>时，总有<span
class="math inline">\(n_k&gt;\max(M,n_1)\)</span>使得 <span
class="math display">\[
|a_n-a_{n_k}|&lt;\frac\epsilon2\\
|a_{n_k}-\eta&#39;|&lt;\frac\epsilon2
\]</span> 则： <span class="math display">\[
|a_n-\eta&#39;|\leq|a_n-a_{n_k}|+|a_{n_k}-\eta&#39;|&lt;\epsilon
\]</span> 因此：<span
class="math inline">\(\lim_{n\rightarrow+\infty}a_n=\eta&#39;\)</span></p>
<h3 id="确界原理证明有限覆盖定理">确界原理证明有限覆盖定理</h3>
<p>设集合<span
class="math inline">\(S=\{x|[a,x]能被H中有限个开区间覆盖\}\)</span>。显然集合<span
class="math inline">\(S\)</span>有上界。取<span
class="math inline">\((\alpha,\beta)\in H\)</span>使得<span
class="math inline">\(a\in (\alpha,\beta)\)</span>，则可以取<span
class="math inline">\(x\in (\alpha,\beta) 且x&gt;a\)</span>使得<span
class="math inline">\([a,x]\subset (\alpha,\beta)\)</span>，即<span
class="math inline">\([a,x]\)</span>可以被H中有限个开区间覆盖，因此集合<span
class="math inline">\(S\)</span>不为空。</p>
<p>集合<span class="math inline">\(S\)</span>有上界且集合<span
class="math inline">\(S\)</span>不为空，由确界定理可知，集合<span
class="math inline">\(S\)</span>上确界存在记为<span
class="math inline">\(\xi=\sup S\)</span>。</p>
<p>现证<span class="math inline">\(\xi=b\)</span>，采用反证法，假设<span
class="math inline">\(\xi \neq b\)</span>，则<span
class="math inline">\(a&lt;\xi&lt;b\)</span>。由<span
class="math inline">\(H\)</span>覆盖区间<span
class="math inline">\([a,b]\)</span>，则存在<span
class="math inline">\((\alpha_1，\beta_1)\in H\)</span>使得<span
class="math inline">\(\xi \in (\alpha_1,\beta_1)\)</span>，任取<span
class="math inline">\(x_1,x_2\)</span>使得<span
class="math inline">\(\alpha_1&lt;x_1&lt;\xi&lt;x_2&lt;\beta_1\)</span>，则<span
class="math inline">\(x_1 \in S\)</span>即区间<span
class="math inline">\([a,x_1]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，通过给该有限覆盖添加区间<span
class="math inline">\((\alpha_1,\beta_1)\)</span>即可覆盖闭区间<span
class="math inline">\([a,x_2]\)</span>，则<span
class="math inline">\(x_2\in S\)</span>，这与<span
class="math inline">\(\xi=\sup S\)</span>相悖，故原假设不成立，<span
class="math inline">\(\xi=b\)</span>，即闭区间<span
class="math inline">\([a,b]\)</span>可以被H中有限个开区间覆盖。</p>
<h2 id="单调有界原理证明其余定理">单调有界原理证明其余定理</h2>
<h3 id="单调有界原理证明确界原理">单调有界原理证明确界原理</h3>
<p>设一非空数集<span
class="math inline">\(S\)</span>有上界，证明其有上确界（下确界证明类似）</p>
<p>取所有不小于<span
class="math inline">\(S\)</span>中任何一个数的实数构成数列<span
class="math inline">\(\{r_n\}\)</span>，令<span
class="math inline">\(\{x_n\}=\min(r_1,r_2,...r_n)\)</span>，则数列<span
class="math inline">\(\{x_n\}\)</span>单调减且下有界（<span
class="math inline">\(S\)</span>中任意一个数都是其下界）。则数列<span
class="math inline">\(\{x_n\}\)</span>极限存在记<span
class="math inline">\(\xi=\lim_{n\rightarrow+\infty}x_n\)</span>。</p>
<p>现证<span class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上确界。采用反证法</p>
<p>首先证明<span class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上界，假设<span
class="math inline">\(\exists a\in S\)</span>使得<span
class="math inline">\(a&gt;\xi\)</span>，取<span
class="math inline">\(\epsilon=\frac{a-\xi}2\)</span>则数列<span
class="math inline">\(\{r_n\}\)</span>存在<span
class="math inline">\(r_N\)</span>使得 <span class="math display">\[
\xi\leq r_N&lt;\xi+\epsilon=\frac{a+\xi}2&lt;\frac{a+a}2=a
\]</span> 故<span class="math inline">\(r_N&lt;a\)</span>，这与<span
class="math inline">\(r_N\)</span>为集合<span
class="math inline">\(S\)</span>的上界矛盾，故假设不成立，<span
class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上界。</p>
<p>然后证明<span class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上确界，假设存在<span
class="math inline">\(\epsilon\)</span>使得<span
class="math inline">\(\forall a\in
S,a&lt;\xi-\epsilon\)</span>，则数列<span
class="math inline">\(\{r_n\}\)</span>中存在<span
class="math inline">\(r_N\)</span>使得 <span class="math display">\[
x&lt;\xi-\epsilon\leq r_N&lt;\xi
\]</span> 又由<span class="math inline">\(\xi\)</span>的定义可知，<span
class="math inline">\(\xi\leq
r_N\)</span>，两者矛盾，故不存在这样的<span
class="math inline">\(\epsilon\)</span>，<span
class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上确界。故集合<span
class="math inline">\(S\)</span>的上确界存在。</p>
<h3 id="单调有界原理证明闭区间套定理">单调有界原理证明闭区间套定理</h3>
<p>设闭区间<span class="math inline">\([a_n,b_n]\)</span>满足： <span
class="math display">\[
[a_1,b_1]\supset[a_2,b_2]\supset[a_3,b_3]\supset...\\
\lim_{n\rightarrow +\infty} (b_n-a_n)=0
\]</span> 首先证明存在性，即存在实数<span class="math inline">\(\xi\in
[a_n,b_n],n=1,2,3,...\)</span></p>
<p>由闭区间套的条件可知，数列<span
class="math inline">\(\{a_n\}\)</span>单调增且上有界，则根据单调有界原理，数列<span
class="math inline">\(\{a_n\}\)</span>极限存在记为<span
class="math inline">\(\xi\)</span>，且有<span
class="math inline">\(a_n\leq \xi\)</span>，</p>
<p>同理，数列<span
class="math inline">\(\{b_n\}\)</span>单调减且下有界，则数列<span
class="math inline">\(\{b_n\}\)</span>极限存在，又<span
class="math inline">\(\lim_{n\rightarrow +\infty}
(b_n-a_n)=0\)</span>，则 <span class="math display">\[
\lim_{n\rightarrow+\infty}b_n=\lim_{n\rightarrow+\infty}a_n+\lim_{n\rightarrow+\infty}(b_n-a_n)=\xi
\]</span> 且由闭区间套的条件可知，<span class="math inline">\(\xi\leq
b_n\)</span>。综上可得，存在实数<span
class="math inline">\(\xi\)</span>使得<span
class="math inline">\(a_n\leq \xi \leq b_n\)</span>，即<span
class="math inline">\(\xi\in [a_n,b_n],n=1,2,3,...\)</span></p>
<p>然后证明唯一性，采用反证法，假设存在<span
class="math inline">\(\xi&#39;\neq \xi\)</span>且<span
class="math inline">\(\xi&#39;\in [a_n,b_n]\)</span>，则<span
class="math inline">\(|\xi&#39;-\xi|\leq|a_n-b_n|\rightarrow0(n\rightarrow
+\infty)\)</span>。故<span
class="math inline">\(\xi&#39;=\xi\)</span>，从而证明唯一性。</p>
<h3 id="单调有界原理证明聚点定理">单调有界原理证明聚点定理</h3>
<p>对于有界数列<span class="math inline">\(\{a_n\}\)</span></p>
<p>若在任一项之后，总存在最大的项。由此构造子列<span
class="math inline">\(\{a_{n_k}\}\)</span>。</p>
<p>设<span class="math inline">\(a_1\)</span>后所有项的最大项为<span
class="math inline">\(a_{n_1}\)</span>，<span
class="math inline">\(a_2\)</span>后所有项的最大项为<span
class="math inline">\(a_{n_2}\)</span>，<span
class="math inline">\(a_k\)</span>后所有项的最大项为<span
class="math inline">\(a_{n_k}\)</span>根据该定义，则有<span
class="math inline">\(a_{n_k}\geq a_{n_{k+1}}\)</span>，故数列<span
class="math inline">\(\{a_{n_k}\}\)</span>单调递减且下有界（<span
class="math inline">\(\{a_n\}\)</span>有界）。因此，根据单调有界原理，数列<span
class="math inline">\(\{a_{n_k}\}\)</span>极限存在。</p>
<p>若在任一项后，不存在最大的项，则取<span
class="math inline">\(a_{n_1}=a_1\)</span>，由于不存在最大的项，因此<span
class="math inline">\(\{a_n\}\)</span>中必存在<span
class="math inline">\(a_{n_2}&gt;a_{n_1}\)</span>，以此类推，可得到<span
class="math inline">\(a_{n_3},...a_{n_k},...\)</span>，从而可以得到一个单调递增的有界数列<span
class="math inline">\(\{a_{n_k}\}\)</span>，由单调有界定理可知，数列<span
class="math inline">\(\{a_{n_k}\}\)</span>极限存在。</p>
<p>综上所述，在两种情况下，数列<span
class="math inline">\(\{a_n\}\)</span>中均存在收敛子列<span
class="math inline">\(\{a_{n_k}\}\)</span>，致密性定理得证。</p>
<h3
id="单调有界原理证明cauchy收敛准则">单调有界原理证明Cauchy收敛准则</h3>
<p>证明必要性：</p>
<p>若数列<span class="math inline">\(\{a_n\}\)</span>收敛且极限为<span
class="math inline">\(a\)</span>，则<span class="math inline">\(\forall
\epsilon&gt;0,\exists M\in N\)</span>，使得 <span
class="math inline">\(m,n&gt;M\)</span>时 <span class="math display">\[
|a_m-a|&lt;\frac{\epsilon}{2},\ |a_n-a|&lt;\frac{\epsilon}{2}
\]</span> 由三角不等式可得： <span class="math display">\[
|a_m-a_n|\leq|a_m-a|+|a_n-a|&lt;\frac\epsilon2+\frac\epsilon2=\epsilon
\]</span> 必要性证明完毕。</p>
<p>证明充分性：</p>
<p>设数列<span class="math inline">\(\{a_n\}\)</span>满足，对于<span
class="math inline">\(\forall \epsilon&gt;0,\exists M\in
N\)</span>，使得<span class="math inline">\(m,n&gt;M\)</span>时，<span
class="math inline">\(|a_m-a_n|&lt;\epsilon\)</span>。</p>
<p>首先证明数列<span class="math inline">\(\{a_n\}\)</span>有界。取<span
class="math inline">\(\epsilon=1\)</span>，则<span
class="math inline">\(\exists N_0\)</span>，使得<span
class="math inline">\(n&gt;N_0\)</span>时有<span
class="math inline">\(|a_n-a_{N_0+1}|&lt;1\)</span>，则<span
class="math inline">\(\forall
n&gt;N_0,|a_n|\leq|a_{N_0+1}|+1\)</span>。又因为数列的前<span
class="math inline">\(N_0\)</span>项为有限项，因此数列<span
class="math inline">\(\{a_n\}\)</span>有界。</p>
<p>不妨设<span
class="math inline">\(a_n\in[a,b]\)</span>，采用如下过程构造子列<span
class="math inline">\(\{a_{n_k}\}\)</span>：</p>
<ol type="1">
<li>在<span class="math inline">\([a,b]\)</span>中取<span
class="math inline">\(a_{n_1}\in \{a_n\}\)</span>使得<span
class="math inline">\((a_{n_1},b]\)</span>中含数列<span
class="math inline">\(\{a_n\}\)</span>中无穷多项</li>
<li>在<span class="math inline">\((a_{n_k},b]\)</span>中取<span
class="math inline">\(a_{n_{k+1}}\)</span>使得<span
class="math inline">\(n_{k+1}&gt;n_k\)</span>且<span
class="math inline">\((a_{k+1},b]\)</span>中含数列<span
class="math inline">\(\{a_n\}\)</span>中无穷多项，则<span
class="math inline">\(a_{n_k}&lt;a_{n_{k+1}}\)</span></li>
</ol>
<p>重复步骤2即可得到<span
class="math inline">\(\{a_n\}\)</span>的单调递增子列<span
class="math inline">\(\{a_{n_k}\}\)</span>。由单调有界原理可知，数列<span
class="math inline">\(\{a_{n_k}\}\)</span>极限存在记<span
class="math inline">\(\lim_{n\rightarrow
+\infty}a_{n_k}=a\)</span>。</p>
<p>然后证数列<span class="math inline">\(\{a_n\}\)</span>的极限为<span
class="math inline">\(a\)</span>，由极限的定义和柯西列的定义可知，<span
class="math inline">\(\forall \epsilon\)</span>，存在<span
class="math inline">\(M_1,M_2\in N\)</span>，使得： <span
class="math display">\[
n_k&gt;M_1\ 时,\ |a_{n_k}-a|&lt;\frac\epsilon2\\
n,n_k&gt;M_2\ 时,\ |a_n-a_{n_k}|&lt;\frac\epsilon2
\]</span> 则<span
class="math inline">\(n,n_k&gt;\max(M_1,M_2)\)</span>时，有<span
class="math inline">\(|a_n-a|&lt;|a_n-a_{n_k}|+|a_{n_k}-a|&lt;\epsilon\)</span>，数列<span
class="math inline">\(\{a_n\}\)</span>收敛到<span
class="math inline">\(a\)</span>。</p>
<h3 id="单调有界原理证明有限覆盖定理">单调有界原理证明有限覆盖定理</h3>
<p>设有理数<span class="math inline">\(r\in (a,b]\)</span>使得区间<span
class="math inline">\([a,r]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，将这样的<span
class="math inline">\(r\)</span>排成一个数列记为<span
class="math inline">\(\{r_n\}\)</span>。由于存在开区间<span
class="math inline">\((\alpha,\beta)\in H\)</span>使得<span
class="math inline">\(a\in (\alpha,\beta)\)</span>，取<span
class="math inline">\(r_n&gt;a且r_n\in(\alpha,\beta)\)</span>，则这样的区间一定可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，故数列<span
class="math inline">\(\{r_n\}\)</span>存在。</p>
<p>取<span
class="math inline">\(x_n=\max(r_1,r_2,...,r_n)\)</span>，则数列<span
class="math inline">\(\{x_n\}\)</span>单调递增，又<span
class="math inline">\(\forall n,r_n\leq b\)</span>，故<span
class="math inline">\(x_n\leq b\)</span>。由单调有界原理可知，数列<span
class="math inline">\(\{x_n\}\)</span>极限存在记<span
class="math inline">\(\xi=\lim_{n\rightarrow+\infty}x_n\)</span>，且<span
class="math inline">\(r_n\leq x_n\leq \xi\)</span>。</p>
<p>由于<span class="math inline">\(x_n\in [a,b]\)</span>，即<span
class="math inline">\(b\)</span>为数列<span
class="math inline">\(\{x_n\}\)</span>的一个上界，则<span
class="math inline">\(\xi\leq b\)</span>，又<span
class="math inline">\(a\leq x_n\leq \xi\)</span>，则有<span
class="math inline">\(a\leq \xi\leq b\)</span>，即<span
class="math inline">\(\xi \in [a,b]\)</span>，故<span
class="math inline">\(\xi\)</span>一定存在于<span
class="math inline">\(H\)</span>中的某个开区间<span
class="math inline">\((\alpha_1,\beta_1)\)</span>中，再由极限的定义可知，存在<span
class="math inline">\(r_N\in \{r_n\}\)</span>使得<span
class="math inline">\(\alpha_1&lt;r_N\leq\xi\)</span>。</p>
<p>由数列<span class="math inline">\(\{r_n\}\)</span>的定义可知，<span
class="math inline">\([a,r_N]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，那么给这个开区间覆盖添加开区间<span
class="math inline">\((\alpha_1,\beta_1)\)</span>即可以覆盖闭区间<span
class="math inline">\([a,\xi]\)</span>，因此，闭区间<span
class="math inline">\([a,\xi]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖。</p>
<p>现证<span class="math inline">\(\xi=b\)</span>，采用反正法，假设<span
class="math inline">\(\xi \neq b\)</span>，则<span
class="math inline">\(a&lt;\xi&lt;b\)</span>。则一定存在有理数<span
class="math inline">\(r&#39;\)</span>使得<span
class="math inline">\(\xi&lt;r&#39;&lt;\min(b,\beta_1)\)</span>，则区间<span
class="math inline">\([a,r&#39;]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，故<span
class="math inline">\(r&#39;\in \{r_n\}\)</span>，<span
class="math inline">\(r&#39;\leq \xi\)</span>，与<span
class="math inline">\(\xi&lt;r&#39;\)</span>矛盾，故假设不成立，因此，<span
class="math inline">\(\xi=b\)</span>。综上，即可得出结论，闭区间<span
class="math inline">\([a,b]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖。</p>
<h2 id="闭区间套定理证明其余定理">闭区间套定理证明其余定理</h2>
<h3 id="闭区间套定理证明确界原理">闭区间套定理证明确界原理</h3>
<p>证明非空有上界集合必有上确界（下确界同理可证）。</p>
<p>设集合<span class="math inline">\(S\)</span>有上界，设一数<span
class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上确界，则<span
class="math inline">\(\xi\)</span>满足：</p>
<ol type="1">
<li>大于<span class="math inline">\(\xi\)</span>的点均不在<span
class="math inline">\(S\)</span>中</li>
<li><span class="math inline">\(\xi\)</span>的任意小邻域中存在集合<span
class="math inline">\(S\)</span>的点</li>
</ol>
<p>如果<span class="math inline">\(\xi\)</span>落在闭区间<span
class="math inline">\([a,b]\)</span>中的充要条件为：</p>
<ol type="1">
<li>任何大于<span class="math inline">\(b\)</span>的点均不在<span
class="math inline">\(S\)</span>中</li>
<li><span class="math inline">\([a,b]\)</span>中至少包含一个<span
class="math inline">\(S\)</span>中的点</li>
</ol>
<p>对<span
class="math inline">\([a,b]\)</span>区间进行等分为两个区间，则两个子区间中必有一个区间<span
class="math inline">\([a_1,b_1]\)</span>符合上述条件。即<span
class="math inline">\(\xi\)</span>在区间<span
class="math inline">\([a_1,b_1]\)</span>中。重复以上等分的过程，即可得到一系列闭区间满足：
<span class="math display">\[
[a,b]\supset[a_1,b_1]\supset[a_2,b_2]\supset...
\]</span> 并且有 <span class="math display">\[
\lim_{n\rightarrow
+\infty}(b_n-a_n)=\lim_{n\rightarrow+\infty}\frac1{2^n}(b-a)=0
\]</span> <span class="math inline">\(\xi\)</span>属于上述所有<span
class="math inline">\([a_n,b_n]\)</span>，由区间套定理可得，存为唯一<span
class="math inline">\(\xi\)</span>使得 <span
class="math inline">\(a_n\leq \xi\leq b_n\)</span>。并且 <span
class="math display">\[
\lim_{n\rightarrow +\infty}b_n=\lim_{n\rightarrow +\infty}a_n=\xi
\]</span></p>
<p><span class="math inline">\(\forall x\in S\)</span>，都有<span
class="math inline">\(x\leq b_n\)</span>，则<span
class="math inline">\(x\leq\lim_{n\rightarrow+\infty}b_n=\xi\)</span>。</p>
<p><span class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(a_M&gt;\xi-\epsilon\)</span>，又区间<span
class="math inline">\([a_n,b_n]\)</span>中至少包含一个<span
class="math inline">\(S\)</span>中的点，则<span
class="math inline">\(\exists x\in S\cap[a_M,b_M]\)</span>使得<span
class="math inline">\(x\geq a_M&gt;\xi-\epsilon\)</span>。从而，<span
class="math inline">\(\xi\)</span>是集合<span
class="math inline">\(S\)</span>的上确界，<span
class="math inline">\(S\)</span>的上确界存在，确界定理得证。</p>
<h3 id="闭区间套定理证明单调有界原理">闭区间套定理证明单调有界原理</h3>
<p>设数列<span
class="math inline">\(\{x_n\}\)</span>单调上有界（单调下有界证明类似），则任取其上界记为<span
class="math inline">\(b\)</span>，在<span
class="math inline">\(\{x_n\}\)</span>中任取一项作为<span
class="math inline">\(a\)</span>，则区间<span
class="math inline">\([a,b]\)</span>中必含有数列<span
class="math inline">\(\{x_n\}\)</span>中无穷多项。</p>
<p>将区间<span
class="math inline">\([a,b]\)</span>进行二等分，得到区间<span
class="math inline">\([a,\frac{a+b}2]\)</span>和区间<span
class="math inline">\([\frac{a+b}2,b]\)</span>，由于数列<span
class="math inline">\(\{x_n\}\)</span>单调递增，则两个子区间中有且仅有一个区间包含数列<span
class="math inline">\(\{x_n\}\)</span>中无穷多项，记该区间为<span
class="math inline">\([a_1,b_1]\)</span>。</p>
<p>重复以上过程得到一系列闭区间<span
class="math inline">\([a_n,b_n],n=1,2,3,...\)</span>，由区间套定理可知，存在唯一实数<span
class="math inline">\(\xi\)</span>使得<span class="math inline">\(\xi
\in [a_n,b_n],n=1,2,3,...\)</span>。</p>
<p>然后证明<span
class="math inline">\(\xi=\lim_{n\rightarrow+\infty}x_n\)</span>，由于<span
class="math inline">\(\lim_{n\rightarrow
+\infty}(b_n-a_n)=\)</span>，则<span class="math inline">\(\forall
\epsilon&gt;0\)</span>，<span class="math inline">\(\exists M_1\in
N\)</span>使得<span class="math inline">\(n&gt;M_1\)</span>时，<span
class="math inline">\(|a_n-b_n|&lt;\epsilon\)</span>，由区间<span
class="math inline">\([a_n,b_n]\)</span>的构造性质可得，<span
class="math inline">\([a_n,b_n]\)</span>中含数列<span
class="math inline">\(\{x_n\}\)</span>中无穷多项，则<span
class="math inline">\(\exists M_2\in N\)</span>使得<span
class="math inline">\(n&gt;M_2\)</span>时，<span
class="math inline">\(x_n\in [a_n,b_n]\)</span>，又由于<span
class="math inline">\(a_n\leq \xi\leq b_n\)</span>，取<span
class="math inline">\(M=\max(M_1,M_2)\)</span>，则当<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(|x_n-\xi|\leq|a_n-b_n|&lt;\epsilon\)</span>，故<span
class="math inline">\(\xi\)</span>为数列<span
class="math inline">\(\{x_n\}\)</span>的极限。</p>
<h3 id="闭区间套定理证明聚点定理">闭区间套定理证明聚点定理</h3>
<p>数列<span class="math inline">\(\{x_n\}\)</span>有界，取<span
class="math inline">\(a,b\)</span>使得<span class="math inline">\(a\leq
x_n\leq b\)</span>，则闭区间<span
class="math inline">\([a,b]\)</span>中包含了数列<span
class="math inline">\(\{x_n\}\)</span>中无穷多项。</p>
<p>将闭区间<span
class="math inline">\([a,b]\)</span>等分为两个子闭区间，则两个闭区间中至少有一个包含<span
class="math inline">\(\{x_n\}\)</span>中无穷多项，记为<span
class="math inline">\([a_1,b_1]\)</span>，重复以上过程得到一系列闭区间<span
class="math inline">\([a_n,b_n],n=1,2,3,...\)</span></p>
<p>由区间套定理可知，存在唯一<span
class="math inline">\(\xi\)</span>使得<span class="math inline">\(\xi\in
[a_n,b_n],n=1,2,3,...\)</span>，即 <span class="math display">\[
\lim_{n\rightarrow +\infty}b_n=\lim_{n\rightarrow +\infty}a_n=\xi
\]</span> 则，<span class="math inline">\(\exists
n_1\)</span>，使得<span class="math inline">\(\xi-1&lt;a_{n_1}\leq
\xi\leq b_{n_1}&lt;\xi+1\)</span>，由于<span
class="math inline">\([a_{n_1},b_{n_1}]\)</span>中含有数列<span
class="math inline">\(\{x_n\}\)</span>中无穷多项，因此任取<span
class="math inline">\(x_{n_1}\in \{x_n\}\cap
[a_{n_1},b_{n_1}]\)</span>。</p>
<p>同理，<span class="math inline">\(\forall k=1,2,3,...\)</span>，<span
class="math inline">\(\exists n_k\)</span>使得<span
class="math inline">\(\xi-\frac1k&lt;a_{n_k}\leq \xi\leq
b_{n_k}&lt;\xi+\frac1k\)</span>，取<span
class="math inline">\(x_{n_k}\in \{x_n\}\cap
[a_{n_k},b_{n_k}]\)</span>。由此构造出数列<span
class="math inline">\(\{x_{n_k}\}\)</span>。</p>
<p>由<span
class="math inline">\(\{x_{n_k}\}\)</span>的构造过程可知，<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists
M=\lceil\frac1\epsilon\rceil\)</span>使得<span
class="math inline">\(k&gt;M\)</span>时，<span
class="math inline">\(|x_{n_k}-\xi|&lt;\epsilon\)</span>，故<span
class="math inline">\(\xi\)</span>是数列<span
class="math inline">\(\{x_{n_k}\}\)</span>的极限。</p>
<p>因此，有界无限数列存在收敛子列，致密性定理得证。</p>
<h3
id="闭区间套定理证明cauchy收敛准则">闭区间套定理证明Cauchy收敛准则</h3>
<p>证明必要性：</p>
<p>若数列<span class="math inline">\(\{x_n\}\)</span>收敛且极限为<span
class="math inline">\(x\)</span>，则<span class="math inline">\(\forall
\epsilon&gt;0,\exists M\in N\)</span>，使得 <span
class="math inline">\(m,n&gt;M\)</span>时 <span class="math display">\[
|x_m-x|&lt;\frac{\epsilon}{2},\ |x_n-x|&lt;\frac{\epsilon}{2}
\]</span> 由三角不等式可得： <span class="math display">\[
|x_m-x_n|\leq|x_m-x|+|x_n-x|&lt;\frac\epsilon2+\frac\epsilon2=\epsilon
\]</span> 必要性证明完毕。</p>
<p>证明充分性：</p>
<p>设数列<span class="math inline">\(\{x_n\}\)</span>满足，对于<span
class="math inline">\(\forall \epsilon&gt;0,\exists M\in
N\)</span>，使得<span class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(|x_n-x_M|&lt;\epsilon\)</span>。即<span
class="math inline">\(x_n\in[x_M-\epsilon,x_M+\epsilon]\)</span>。</p>
<p>取<span class="math inline">\(\epsilon=\frac12\)</span>，则<span
class="math inline">\(\exists M_1\in N\)</span>使得<span
class="math inline">\(n&gt;M_1\)</span>时，<span
class="math inline">\(x_n\in
[x_{M_1}-\epsilon,x_{M_1}+\epsilon]\)</span>，记该区间为<span
class="math inline">\([a_1,b_1]\)</span>，</p>
<p>取<span class="math inline">\(\epsilon=\frac1{2^2}\)</span>，则<span
class="math inline">\(\exists M_2\in N\)</span>使得<span
class="math inline">\(n&gt;M_2\)</span>时，<span
class="math inline">\(x_n\in
[x_{M_2}-\epsilon,x_{M_2}+\epsilon]\)</span>，记该区间为<span
class="math inline">\([a_2,b_2]\)</span>，</p>
<p>取<span class="math inline">\(\epsilon=\frac1{2^3}\)</span>，则<span
class="math inline">\(\exists M_3\in N\)</span>使得<span
class="math inline">\(n&gt;M_3\)</span>时，<span
class="math inline">\(x_n\in
[x_{M_3}-\epsilon,x_{M_3}+\epsilon]\)</span>，记该区间为<span
class="math inline">\([a_3,b_3]\)</span>，</p>
<p>以此类推，便能得到一系列闭区间<span
class="math inline">\([a_n,b_n]\)</span>且<span
class="math inline">\([a_{n+1},b_{n+1}]\subset[a_n,b_n]\)</span>。由闭区间套定理可知，存在唯一<span
class="math inline">\(\xi \in[a_n,b_n],n=1,2,3,...\)</span>，从而，<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(x_n\)</span>均属于某个闭区间<span
class="math inline">\([a_n,b_n]\)</span>且<span
class="math inline">\(|b_n-a_n|&lt; \epsilon\)</span>，则<span
class="math inline">\(|x_n-\xi|&lt;\epsilon\)</span>，因此<span
class="math inline">\(x_n\rightarrow \xi(n\rightarrow
+\infty)\)</span>。</p>
<h3 id="闭区间套定理证明有限覆盖定理">闭区间套定理证明有限覆盖定理</h3>
<p>证明闭区间<span class="math inline">\([a,b]\)</span>的任意开覆盖<span
class="math inline">\(H\)</span>都有有限子覆盖</p>
<p>采用反证法。假设闭区间<span
class="math inline">\([a,b]\)</span>不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，则对<span
class="math inline">\([a,b]\)</span>进行等分，则两个子区间中至少存在一个闭区间不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖（否则与<span
class="math inline">\([a,b]\)</span>不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖矛盾），记该区间为<span
class="math inline">\([a_1,b_1]\)</span>。以此类推得到一系列闭区间<span
class="math inline">\([a_n,b_n],n=1,2,3,...\)</span>，并且每个闭区间<span
class="math inline">\([a_n,b_n]\)</span>都无法被<span
class="math inline">\(H\)</span>中有限个开区间覆盖。</p>
<p>由闭区间套定理可知，<span
class="math inline">\(\exists\xi\)</span>使得<span
class="math inline">\(\xi\in [a_n,b_n],n=1,2,3...\)</span>，则<span
class="math inline">\(H\)</span>中存在开覆盖<span
class="math inline">\((\alpha,\beta)\)</span>使得<span
class="math inline">\(\xi\in(\alpha,\beta)\)</span>，设<span
class="math inline">\(\epsilon=\min(|\alpha-\xi|,|\beta-\epsilon|)\)</span>，由于<span
class="math inline">\(\lim_{n\rightarrow+\infty}(b_n-a_n)=0\)</span>，则<span
class="math inline">\(\exists M\in N\)</span>，使得<span
class="math inline">\(n&gt;M\)</span>后都有<span
class="math inline">\(|b_n-a_n|&lt;\epsilon\)</span>，又<span
class="math inline">\(\xi\in [a_n,b_n]\)</span>，则<span
class="math inline">\([a_n,b_n]\subset
(\alpha,\beta)\)</span>，即区间<span
class="math inline">\([a_n,b_n]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，与闭区间<span
class="math inline">\([a_n,b_n]\)</span>都无法被<span
class="math inline">\(H\)</span>中有限个开区间覆盖相矛盾，故假设不成立，有限覆盖定理得证。</p>
<h2 id="聚点定理证明其余定理">聚点定理证明其余定理</h2>
<h3 id="聚点定理证明确界原理">聚点定理证明确界原理</h3>
<p>证明非空有上界集合必有上确界（下确界同理可证）。</p>
<p>设集合<span
class="math inline">\(S\)</span>有上界，则任取其上界记为<span
class="math inline">\(b\)</span>，取<span class="math inline">\(a\in
S\)</span>构造区间<span
class="math inline">\([a,b]\)</span>中至少含有集合<span
class="math inline">\(S\)</span>中一项。定义性质<span
class="math inline">\(P\)</span>：区间中至少含有集合<span
class="math inline">\(S\)</span>中一项且区间的右端点必为<span
class="math inline">\(S\)</span>的一个上界。则显然区间<span
class="math inline">\([a,b]\)</span>满足性质<span
class="math inline">\(P\)</span></p>
<p>将区间<span
class="math inline">\([a,b]\)</span>进行二等分，得到区间<span
class="math inline">\([a,\frac{a+b}2]\)</span>和区间<span
class="math inline">\([\frac{a+b}2,b]\)</span>，则两个子区间中至少有一个区间满足性质<span
class="math inline">\(P\)</span>，记该区间为<span
class="math inline">\([a_1,b_1]\)</span>。重复以上过程得到一系列闭区间<span
class="math inline">\([a_n,b_n],n=1,2,3,...\)</span></p>
<p>从而有<span
class="math inline">\(\lim_{n\rightarrow+\infty}(b_n-a_n)=\lim_{n\rightarrow+\infty}\frac1{2^n}(b-a)=0\)</span></p>
<p>构造数列<span class="math inline">\(\{b_n\}\)</span>，显然数列<span
class="math inline">\(\{b_n\}\)</span>有无穷多项且有界（<span
class="math inline">\(a\leq b_n\leq b\)</span>）。由聚点定理可知，<span
class="math inline">\(\{b_n\}\)</span>有聚点记作<span
class="math inline">\(\xi\)</span>。又因为数列<span
class="math inline">\(\{b_n\}\)</span>单调递减，则<span
class="math inline">\(\forall \epsilon\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(b_n\in U(\xi,\epsilon)\)</span>，即<span
class="math inline">\(\xi\)</span>为数列<span
class="math inline">\(\{b_n\}\)</span>的极限。由<span
class="math inline">\(\lim_{n\rightarrow+\infty}(b_n-a_n)=0\)</span>可得，数列<span
class="math inline">\(\{a_n\}\)</span>的极限也为<span
class="math inline">\(\xi\)</span>。</p>
<p>由于<span class="math inline">\(\{b_n\}\)</span>均为<span
class="math inline">\(S\)</span>的上界，因此<span
class="math inline">\(\xi\)</span>也为<span
class="math inline">\(S\)</span>的上界。又<span
class="math inline">\(a_n\rightarrow \xi\)</span>且<span
class="math inline">\([a_n,b_n]\cap S\neq\varnothing\)</span>，则<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(n&gt;M\)</span>时使得<span
class="math inline">\(a_n\)</span>，<span class="math inline">\(\exists
x\in S\)</span>使得<span class="math inline">\(x\in
[a_n,b_n]\)</span>且<span class="math inline">\(\xi-\epsilon&lt;x\leq
\xi\)</span>，故<span class="math inline">\(\xi\)</span>为集合<span
class="math inline">\(S\)</span>的上确界。</p>
<h3 id="聚点定理证明单调有界原理">聚点定理证明单调有界原理</h3>
<p>任取单调有界数列<span
class="math inline">\(\{a_n\}\)</span>，不妨设数列<span
class="math inline">\(\{a_n\}\)</span>单调递增（单调递减的证明类似）。则由致密性定理（聚点定理）可知，<span
class="math inline">\(\{a_n\}\)</span>中存在聚点记为<span
class="math inline">\(a\)</span>。</p>
<p>根据聚点的定义，<span class="math inline">\(\forall
\epsilon&gt;0\)</span>，存在<span class="math inline">\(M\in
N\)</span>使得<span
class="math inline">\(|a_M-a|&lt;\epsilon\)</span>，假设存在<span
class="math inline">\(n_1&gt;M\)</span>使得<span
class="math inline">\(|a_{n_1}-a|&gt;\epsilon\)</span>，则<span
class="math inline">\(a_{n_1}&gt;a+\epsilon\)</span>或<span
class="math inline">\(a_{n_1}&lt;a-\epsilon\)</span>，由数列单调性可知，后者显然不成立。</p>
<p>若前者成立，即<span
class="math inline">\(a_{n_1}&gt;a+\epsilon\)</span>，则根据单调性，任取<span
class="math inline">\(n&gt;n_1\)</span>都有<span
class="math inline">\(a_n&gt;a+\epsilon\)</span>，则<span
class="math inline">\(a\)</span>的<span
class="math inline">\(\epsilon\)</span>邻域中只含有限项，这与<span
class="math inline">\(a\)</span>是<span
class="math inline">\(\{a_n\}\)</span>的聚点矛盾，故原假设不成立。因此，<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，存在<span
class="math inline">\(M\in N\)</span>使得<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(|a_n-a|&lt;\epsilon\)</span>，故数列<span
class="math inline">\(\{a_n\}\)</span>极限存在。</p>
<h3 id="聚点定理证明闭区间套定理">聚点定理证明闭区间套定理</h3>
<p><span
class="math inline">\(\{[a_n,b_n]\}\)</span>为一列闭区间套，令<span
class="math inline">\(S=\{a_n\}\cup\{b_n\}\)</span>，则集合<span
class="math inline">\(S\)</span>有界无限，根据聚点定理，集合<span
class="math inline">\(S\)</span>存在聚点<span
class="math inline">\(\xi\)</span>。接着证明<span
class="math inline">\(a_n\leq\xi\leq b_n\)</span>，采用反证法。</p>
<p>假设存在<span class="math inline">\(a_M\)</span>使得<span
class="math inline">\(b_n&gt;a_M&gt;\xi\)</span>，则由数列<span
class="math inline">\(\{a_n\}\)</span>的单调性可知，<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(a_n&gt;a_M&gt;\xi\)</span>。取<span
class="math inline">\(\epsilon=a_M-\xi\)</span>，则在<span
class="math inline">\((\xi-\epsilon,\xi+\epsilon)\)</span>中，至多有有限<span
class="math inline">\(S\)</span>中的点，这与<span
class="math inline">\(\xi\)</span>是<span
class="math inline">\(S\)</span>的聚点相矛盾，因此<span
class="math inline">\(a_n\leq\xi\)</span>，同理可证<span
class="math inline">\(\xi\leq b_n\)</span>。从而有<span
class="math inline">\(\xi\in[a_n,b_n],n=1,2,3,...\)</span></p>
<p>然后证明唯一性，采用反证法，假设存在<span
class="math inline">\(\xi&#39;\neq \xi\)</span>且<span
class="math inline">\(\xi&#39;\in [a_n,b_n]\)</span>，则<span
class="math inline">\(|\xi&#39;-\xi|\leq|a_n-b_n|\rightarrow0(n\rightarrow
+\infty)\)</span>。故<span
class="math inline">\(\xi&#39;=\xi\)</span>，从而证明唯一性。</p>
<h3 id="聚点定理证明cauchy收敛准则">聚点定理证明Cauchy收敛准则</h3>
<p>证明必要性：</p>
<p>若数列<span class="math inline">\(\{x_n\}\)</span>收敛且极限为<span
class="math inline">\(x\)</span>，则<span class="math inline">\(\forall
\epsilon&gt;0,\exists M\in N\)</span>，使得 <span
class="math inline">\(m,n&gt;M\)</span>时 <span class="math display">\[
|x_m-x|&lt;\frac{\epsilon}{2},\ |x_n-x|&lt;\frac{\epsilon}{2}
\]</span> 由三角不等式可得： <span class="math display">\[
|x_m-x_n|\leq|x_m-x|+|x_n-x|&lt;\frac\epsilon2+\frac\epsilon2=\epsilon
\]</span> 必要性证明完毕。</p>
<p>证明充分性：</p>
<p>设数列<span class="math inline">\(\{x_n\}\)</span>满足，对于<span
class="math inline">\(\forall \epsilon&gt;0,\exists M\in
N\)</span>，使得<span class="math inline">\(m,n&gt;M\)</span>时，<span
class="math inline">\(|x_m-x_n|&lt;\epsilon\)</span>。</p>
<p>首先证明数列<span class="math inline">\(\{x_n\}\)</span>有界。取<span
class="math inline">\(\epsilon=1\)</span>，则<span
class="math inline">\(\exists N_0\)</span>，使得<span
class="math inline">\(n&gt;N_0\)</span>时有<span
class="math inline">\(|x_n-x_{N_0+1}|&lt;1\)</span>，则<span
class="math inline">\(\forall
n&gt;N_0,|x_n|\leq|x_{N_0+1}|+1\)</span>。又因为数列的前<span
class="math inline">\(N_0\)</span>项为有限项，因此数列<span
class="math inline">\(\{x_n\}\)</span>有界。</p>
<p>接着对<span class="math inline">\(\{x_n\}\)</span>进行分类讨论：</p>
<p>若<span
class="math inline">\(\{x_n\}\)</span>中含有有限个相异的项，那么必然会有一项出现无限多次记作<span
class="math inline">\(x_{n_0}\)</span>，这时就可以得到<span
class="math inline">\(\{x_n\}\)</span>的一个子列<span
class="math inline">\(\{x_{n_k}\}\)</span>满足<span
class="math inline">\(x_{n_k}=x_{n_0}\)</span>且<span
class="math inline">\(n_{k+1}&gt;n_k\)</span>。又<span
class="math inline">\(\{x_n\}\)</span>为Cauchy列，故<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(m,n&gt;M\)</span>时，有<span
class="math inline">\(|x_m-x_n|&lt;\epsilon\)</span>。特别的，当<span
class="math inline">\(n&gt;M,k&gt;M\)</span>时，有<span
class="math inline">\(n_k\geq n&gt;M\)</span>，则<span
class="math inline">\(|x_n-x_{n_k}|&lt;\epsilon\)</span>，即<span
class="math inline">\(|x_n-x_{n_0}|&lt;\epsilon|\)</span>，因此，<span
class="math inline">\(\lim_{n\rightarrow+\infty}x_n=x_{n_0}\)</span>。</p>
<p>若<span
class="math inline">\(\{x_n\}\)</span>含有无穷多相异的项，则数集<span
class="math inline">\(S=\{x_n\}\)</span>为有界无限点集，根据聚点定理，<span
class="math inline">\(S\)</span>中至少有一聚点<span
class="math inline">\(\xi\)</span>，根据聚点的定义<span
class="math inline">\(\forall k\)</span>，在<span
class="math inline">\(U(\xi,\frac1k)\)</span>中必包含<span
class="math inline">\(\{x_n\}\)</span>中无穷多项，从而在<span
class="math inline">\(U(\xi,\frac1k),k=1,2,3,...\)</span>中可任选出<span
class="math inline">\(x_{n_k}\)</span>组成子列<span
class="math inline">\(\{x_{n_k}\}\)</span>，则<span
class="math inline">\(x_{n_k}\rightarrow\xi(k\rightarrow
+\infty)\)</span>，同上一部分的证明可知，<span
class="math inline">\(x_n\rightarrow\xi(n\rightarrow+\infty)\)</span></p>
<h3 id="聚点定理证明有限覆盖定理">聚点定理证明有限覆盖定理</h3>
<p>证明闭区间<span class="math inline">\([a,b]\)</span>的任意开覆盖<span
class="math inline">\(H\)</span>都有有限子覆盖</p>
<p>采用反证法。假设闭区间<span
class="math inline">\([a,b]\)</span>不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，则对<span
class="math inline">\([a,b]\)</span>进行等分，则两个子区间中至少存在一个闭区间不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖（否则与<span
class="math inline">\([a,b]\)</span>不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖矛盾），记该区间为<span
class="math inline">\([a_1,b_1]\)</span>。以此类推得到一系列闭区间<span
class="math inline">\([a_n,b_n],n=1,2,3,...\)</span>，并且每个闭区间<span
class="math inline">\([a_n,b_n]\)</span>都无法被<span
class="math inline">\(H\)</span>中有限个开区间覆盖。</p>
<p>令<span
class="math inline">\(S=\{a_n\}\cup\{b_n\}\)</span>，则集合<span
class="math inline">\(S\)</span>有界无限，根据聚点定理，集合<span
class="math inline">\(S\)</span>存在聚点<span
class="math inline">\(\xi\)</span>。接着证明<span
class="math inline">\(a_n\leq\xi\leq b_n\)</span>，采用反证法。</p>
<p>假设存在<span class="math inline">\(a_M\)</span>使得<span
class="math inline">\(b_n&gt;a_M&gt;\xi\)</span>，则由数列<span
class="math inline">\(\{a_n\}\)</span>的单调性可知，<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(a_n&gt;a_M&gt;\xi\)</span>。取<span
class="math inline">\(\epsilon=a_M-\xi\)</span>，则在<span
class="math inline">\((\xi-\epsilon,\xi+\epsilon)\)</span>中，至多有有限<span
class="math inline">\(S\)</span>中的点，这与<span
class="math inline">\(\xi\)</span>是<span
class="math inline">\(S\)</span>的聚点相矛盾，因此<span
class="math inline">\(a_n\leq\xi\)</span>，同理可证<span
class="math inline">\(\xi\leq b_n\)</span>。从而<span
class="math inline">\(a_n\leq\xi\leq b_n,n=1,2,3,...\)</span></p>
<p>又<span class="math inline">\([a_n,b_n]\subset[a,b]\)</span>，故<span
class="math inline">\(\xi\in [a,b]\)</span>，因此<span
class="math inline">\(\xi\)</span>必然属于<span
class="math inline">\(H\)</span>中的某个开区间<span
class="math inline">\((\alpha,\beta)\)</span>设<span
class="math inline">\(\epsilon=\min(|\alpha-\xi|,|\beta-\epsilon|)\)</span>，由于<span
class="math inline">\(\lim_{n\rightarrow+\infty}(b_n-a_n)\)</span>，则<span
class="math inline">\(\exists M\in N\)</span>，使得<span
class="math inline">\(n&gt;M\)</span>后都有<span
class="math inline">\(|b_n-a_n|&lt;\epsilon\)</span>，又<span
class="math inline">\(\xi\in [a_n,b_n]\)</span>，则<span
class="math inline">\([a_n,b_n]\subset
(\alpha,\beta)\)</span>，即区间<span
class="math inline">\([a_n,b_n]\)</span>可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，与闭区间<span
class="math inline">\([a_n,b_n]\)</span>都无法被<span
class="math inline">\(H\)</span>中有限个开区间覆盖相矛盾，故假设不成立，有限覆盖定理得证。</p>
<h2 id="cauchy收敛准则证明其余定理">Cauchy收敛准则证明其余定理</h2>
<h3 id="cauchy收敛准则证明确界原理">Cauchy收敛准则证明确界原理</h3>
<p>设<span
class="math inline">\(S\)</span>为非空有上界数集（非空有下界证明类似），由实数的阿基米德性，对于任意实数<span
class="math inline">\(a\)</span>，存在整数<span
class="math inline">\(K_a\)</span>使得<span
class="math inline">\(\lambda_a=K_aa\)</span>为数集<span
class="math inline">\(S\)</span>的上界，而<span
class="math inline">\(\lambda_a-a=(K_a-1)a\)</span>不为数集<span
class="math inline">\(S\)</span>的上界。即<span
class="math inline">\(\exists x_0\in S\)</span>使得<span
class="math inline">\(x_0&gt;\lambda_a-a\)</span>。</p>
<p>取<span
class="math inline">\(a=\frac1n,n=1,2,3,...\)</span>，则对于每个正整数<span
class="math inline">\(n\)</span>，都存在对应的<span
class="math inline">\(\lambda_n\)</span>使得<span
class="math inline">\(\lambda_n\)</span>为数集的上界，而<span
class="math inline">\(\exists x_0\in S\)</span>，使得<span
class="math inline">\(x_0&gt;\lambda_n-\frac1n\)</span>。</p>
<p>对于实数<span class="math inline">\(m\)</span>则有<span
class="math inline">\(\lambda_m\)</span>为数集<span
class="math inline">\(S\)</span>的上界，故<span
class="math inline">\(\lambda_m\geq x_0&gt;
\lambda_n-\frac1n\)</span>，则<span
class="math inline">\(\lambda_n-\lambda_m&lt;\frac1n\)</span>。同理可得，<span
class="math inline">\(\lambda_m-\lambda_n&lt;\frac1m\)</span>。从而<span
class="math inline">\(|\lambda_m-\lambda_n|&lt;\max(\frac1n,\frac1m)\)</span>。</p>
<p>于是，$&gt;0 <span class="math inline">\(，\)</span>MN<span
class="math inline">\(使得\)</span>m,n&gt;N<span
class="math inline">\(时，\)</span>|_m-_n|&lt;<span
class="math inline">\(。故数列\)</span>{_n}<span
class="math inline">\(为柯西列，极限存在记为\)</span>$。</p>
<p>然后证明<span class="math inline">\(\lambda\)</span>为数集<span
class="math inline">\(S\)</span>的上确界。首先，<span
class="math inline">\(\forall n,\forall a\in S,a\leq
\lambda_n\)</span>，又<span
class="math inline">\(\lim_{n\rightarrow+\infty}\lambda_n=\lambda\)</span>，故<span
class="math inline">\(a\leq \lambda\)</span>，<span
class="math inline">\(\lambda\)</span>为数集<span
class="math inline">\(S\)</span>的一个上界。又<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(\lambda-\lambda_n&lt;\frac\epsilon2\)</span>且<span
class="math inline">\(\frac1n&lt;\frac\epsilon2\)</span>,则 <span
class="math display">\[
\lambda-\epsilon&lt;\lambda_n-\frac\epsilon2&lt;\lambda_n-\frac1n
\]</span> 又<span class="math inline">\(\forall n,\exists x_0\in
S\)</span>使得<span
class="math inline">\(x_0&gt;\lambda_n-\frac1n\)</span>，故<span
class="math inline">\(x_0&gt;\lambda-\epsilon\)</span>，因此<span
class="math inline">\(\lambda\)</span>为数集<span
class="math inline">\(S\)</span>的上确界。</p>
<h3
id="cauchy收敛准则证明单调有界原理">Cauchy收敛准则证明单调有界原理</h3>
<p>设数列<span
class="math inline">\(\{x_n\}\)</span>为单调增有上界，采用反证法，假设数列<span
class="math inline">\(\{x_n\}\)</span>极限不存在，则根据Cauchy收敛准则，<span
class="math inline">\(\exists \epsilon_0\)</span>，使得<span
class="math inline">\(\forall M\in N\)</span>，<span
class="math inline">\(\exists m&gt;n&gt;M\)</span>使得<span
class="math inline">\(x_m-x_n&gt;\epsilon_0\)</span>。任取<span
class="math inline">\(M\)</span>，则可以得到数列<span
class="math inline">\(\{x_n\}\)</span>的一个子列<span
class="math inline">\(\{x_{n_k}\}\)</span>使得<span
class="math inline">\(x_{n_{k+1}}&gt;x_{n_k}+\epsilon_0&gt;...&gt;x_{n_1}+k\epsilon_0\)</span>，则<span
class="math inline">\(x_{n_k}\rightarrow+\infty(k\rightarrow+\infty)\)</span>，故数列<span
class="math inline">\(\{x_n\}\)</span>无解，与<span
class="math inline">\(\{x_n\}\)</span>上有界矛盾，故假设不成立，数列<span
class="math inline">\(\{x_n\}\)</span>极限存在。</p>
<h3
id="cauchy收敛准则证明闭区间套定理">Cauchy收敛准则证明闭区间套定理</h3>
<p>设<span
class="math inline">\(\{[a_n,b_n]\}\)</span>为一列闭区间套，则由<span
class="math inline">\((b_n-a_n)\rightarrow0(n\rightarrow+\infty)\)</span>可知，<span
class="math inline">\(\forall \epsilon&gt;0\)</span>，<span
class="math inline">\(\exists M\in N\)</span>使得<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(|b_n-a_n|&lt;\epsilon\)</span>。</p>
<p>由于数列<span
class="math inline">\(\{a_n\}\)</span>单调递增，数列<span
class="math inline">\(\{b_n\}\)</span>单调递减，且<span
class="math inline">\(b_n&gt;a_n\)</span>，故对于<span
class="math inline">\(\forall m&gt;n&gt;M\)</span>都有 <span
class="math display">\[
a_n\leq a_m\leq b_m\leq b_n
\]</span> 则<span
class="math inline">\(|a_m-a_n|\leq|b_n-a_n|&lt;\epsilon\)</span>，<span
class="math inline">\(|b_m-b_n|\leq|b_n-a_n|&lt;\epsilon\)</span>。</p>
<p>由Cauchy收敛准则可知，数列<span
class="math inline">\(\{a_n\}\)</span>，<span
class="math inline">\(\{b_n\}\)</span>极限存在，又<span
class="math inline">\((b_n-a_n)\rightarrow0(n\rightarrow+\infty)\)</span>，则
<span class="math display">\[
\lim_{n\rightarrow+\infty}b_n=\lim_{n\rightarrow+\infty}a_n=\xi
\]</span> 接着证明<span class="math inline">\(a_n\leq\xi\leq
b_n\)</span>，采用反证法。</p>
<p>假设存在<span class="math inline">\(a_M\)</span>使得<span
class="math inline">\(a_M&gt;\xi\)</span>，则由数列<span
class="math inline">\(\{a_n\}\)</span>的单调性可知，<span
class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(a_n&gt;a_M&gt;\xi\)</span>。因此<span
class="math inline">\(|a_n-\xi|=a_n-\xi&gt;0\)</span>，两侧取极限得$$</p>
<p>然后证明唯一性，采用反证法，假设存在<span
class="math inline">\(\xi&#39;\neq \xi\)</span>且<span
class="math inline">\(\xi&#39;\in [a_n,b_n]\)</span>，则<span
class="math inline">\(|\xi&#39;-\xi|\leq|a_n-b_n|\rightarrow0(n\rightarrow
+\infty)\)</span>。故<span
class="math inline">\(\xi&#39;=\xi\)</span>，从而证明唯一性。</p>
<h3 id="cauchy收敛准则证明聚点定理">Cauchy收敛准则证明聚点定理</h3>
<p>设<span class="math inline">\(S\)</span>为有界无限点集</p>
<p>取<span class="math inline">\(a\)</span>为<span
class="math inline">\(S\)</span>的一个下界，则对于任意自然数<span
class="math inline">\(n\)</span>，存在自然数<span
class="math inline">\(k_n\)</span>使得<span
class="math inline">\(x_n=a+\frac{k_n}n\)</span>满足以下性质：</p>
<ol type="1">
<li><span class="math inline">\((x_n,+\infty)\)</span>中至多包含<span
class="math inline">\(S\)</span>中有限个点</li>
<li><span
class="math inline">\((x_n-\frac1n,+\infty)\)</span>中包含<span
class="math inline">\(S\)</span>中无限个点</li>
</ol>
<p>则对于任意自然数<span class="math inline">\(m,n\)</span>，都有<span
class="math inline">\(x_n-\frac1n&lt;x_m\)</span>，否则若<span
class="math inline">\(x_m\leq x_n-\frac1n\)</span>，则<span
class="math inline">\((x_m,+\infty)\)</span>中含有<span
class="math inline">\(S\)</span>中无限个点，与上述性质矛盾。因此<span
class="math inline">\(|x_m-x_n|&lt;\max(\frac1n,\frac1m)\)</span>，则<span
class="math inline">\(\{x_n\}\)</span>为柯西列，极限存在记为<span
class="math inline">\(\xi\)</span>。 <span class="math display">\[
\lim_{n\rightarrow+\infty}(x_n-\frac1n)=\lim_{n\rightarrow+\infty}x_n-\lim_{n\rightarrow+\infty}\frac1n=\xi
\]</span> 因此，对于<span class="math inline">\(\forall
\epsilon&gt;0\)</span>，<span class="math inline">\(\exists M\in
N\)</span>使得<span class="math inline">\(n&gt;M\)</span>时，<span
class="math inline">\(x_n,x_n-\frac1n\in
(\xi-\epsilon,\xi+\epsilon)\)</span>。则<span
class="math inline">\((x_n-\frac1n,+\infty)\subset
(\xi-\epsilon,+\infty)\)</span>，<span
class="math inline">\((\xi+\epsilon,+\infty)\subset
(x_n,+\infty)\)</span>。因此<span
class="math inline">\((\xi-\epsilon)\)</span>中含有<span
class="math inline">\(S\)</span>中无限个点，<span
class="math inline">\((\xi+\epsilon,+\infty)\)</span>中至多含有<span
class="math inline">\(S\)</span>中有限个点，从而<span
class="math inline">\((\xi-\epsilon,\xi+\epsilon)\)</span>中含有<span
class="math inline">\(S\)</span>中无限个点，故<span
class="math inline">\(\xi\)</span>为<span
class="math inline">\(S\)</span>的聚点，故聚点定理得证。</p>
<h3
id="cauchy收敛准则证明有限覆盖定理">Cauchy收敛准则证明有限覆盖定理</h3>
<p>证明闭区间<span class="math inline">\([a,b]\)</span>的任意开覆盖<span
class="math inline">\(H\)</span>都有有限子覆盖。</p>
<p>设性质<span class="math inline">\(P\)</span>：闭区间可以被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，性质<span
class="math inline">\(P^{-1}\)</span>：闭区间不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖。</p>
<p>采用反证法，假设<span class="math inline">\([a,b]\)</span>不能被<span
class="math inline">\(H\)</span>中有限个开区间覆盖，则<span
class="math inline">\(\exists x_1\in [a,b]\)</span>使得<span
class="math inline">\([x_1-1,x_1+1]\cap[a,b]=[a_1,b_1]\)</span>具有性质<span
class="math inline">\(P^{-1}\)</span>，否则<span
class="math inline">\([a,b]\)</span>具有性质<span
class="math inline">\(P\)</span>。</p>
<p>同理，<span class="math inline">\(\exists x_2\in
[a_1,b_1]\)</span>使得<span
class="math inline">\([x_2-\frac12,x_2+\frac12]\)</span>具有性质<span
class="math inline">\(P^{-1}\)</span>，重复以上过程即可得到数列<span
class="math inline">\(\{x_n\}\)</span>，使得<span
class="math inline">\([a_n,b_n]=[x_n-\frac1n,x_n+\frac1n]\cap[a,b]\)</span>具有性质<span
class="math inline">\(P^{-1}\)</span>。并且对于<span
class="math inline">\(\forall m,n\)</span>，有<span
class="math inline">\(|x_m-x_n|\leq
\max(\frac1m,\frac1n)\)</span>。因此，数列<span
class="math inline">\(\{x_n\}\)</span>为Cauchy列，极限存在记为<span
class="math inline">\(\xi\)</span>。</p>
<p>显然，<span class="math inline">\(\xi \in
[a,b]\)</span>，则存在开区间<span
class="math inline">\((\alpha,\beta)\in H\)</span>使得<span
class="math inline">\(\xi\in(\alpha,\beta)\)</span>，又<span
class="math inline">\(x_n\rightarrow\xi(n\rightarrow
+\infty)\)</span>，则<span class="math inline">\(\exists M\in
N\)</span>使得<span
class="math inline">\([x_M-\frac1M,x_M+\frac1M]\subset
(\alpha,\beta)\)</span>，这与<span
class="math inline">\([x_M-\frac1M,x_M+\frac1M]\)</span>具有性质<span
class="math inline">\(P^{-1}\)</span>相矛盾，故假设不成立，有限覆盖定理得证。</p>
<h2 id="有限覆盖定理证明其余定理">有限覆盖定理证明其余定理</h2>
<h3 id="有限覆盖定理证明确界原理">有限覆盖定理证明确界原理</h3>
<p>设<span
class="math inline">\(S\)</span>为非空上有界数集（非空下有界的证明类似），若<span
class="math inline">\(S\)</span>中存在最大值，则易证上确界为最大值。若<span
class="math inline">\(S\)</span>中无最大值，采用反证法，假设<span
class="math inline">\(\xi=\sup S\)</span>不存在，设<span
class="math inline">\(a\)</span>为<span
class="math inline">\(S\)</span>中任意一点，<span
class="math inline">\(b\)</span>为<span
class="math inline">\(S\)</span>的任意一个上界。下面作区间<span
class="math inline">\([a,b]\)</span>的无限开覆盖，对任意<span
class="math inline">\(x\in [a,b]\)</span>，存在以下三种情形：</p>
<ol type="1">
<li>若<span class="math inline">\(x\in S\)</span>，由于<span
class="math inline">\(S\)</span>中没有最大值，则存在<span
class="math inline">\(x_1&gt;x\)</span>，取<span
class="math inline">\(\delta=x_1-x\)</span>得到<span
class="math inline">\(x\)</span>的邻域<span
class="math inline">\((x-\delta,x+\delta)\)</span></li>
<li>若<span class="math inline">\(x\notin S\)</span>且<span
class="math inline">\(x\)</span>不是<span
class="math inline">\(S\)</span>的上界，则同样存在<span
class="math inline">\(x_1&gt;x\)</span>，取<span
class="math inline">\(\delta=x_1-x\)</span>得到<span
class="math inline">\(x\)</span>的邻域<span
class="math inline">\((x-\delta,x+\delta)\)</span></li>
<li>若<span class="math inline">\(x\)</span>为<span
class="math inline">\(S\)</span>的上界，由于<span
class="math inline">\(S\)</span>没有上确界，则存在<span
class="math inline">\(\delta\)</span>使得<span
class="math inline">\((x-\delta,x+\delta)\)</span>中不存在<span
class="math inline">\(S\)</span>中任何一点。</li>
</ol>
<p>上述所有的开区间组成闭区间<span
class="math inline">\([a,b]\)</span>的一个无限开覆盖： <span
class="math display">\[
H=\{(x-\delta_x,x+\delta_x)|x\in[a,b]\}
\]</span> 由有限覆盖定理可得，<span
class="math inline">\([a,b]\)</span>存在一个有限开覆盖<span
class="math inline">\(H_1\)</span>： <span class="math display">\[
H_1=\{(x_k-\delta_k,x_k+\delta_k)|x_k\in [a,b],k=1,2,3,...\}
\]</span>
设满足情形3的开区间为第一类开区间，否则为第二类开区间。显然，<span
class="math inline">\(a\)</span>在第二类开区间中，<span
class="math inline">\(b\)</span>在第一类开区间中，若<span
class="math inline">\(H_1\)</span>可以有限覆盖<span
class="math inline">\([a,b]\)</span>，则第一类开区间和第二类开区间之间必有交集，而根据两类开区间的定义，第一类开区间和第二类开区间之间不存在交集，故假设不成立，<span
class="math inline">\(S\)</span>的上确界<span
class="math inline">\(\xi=\sup S\)</span>存在。故确界定理得证。</p>
<h3 id="有限覆盖定理证明单调有界原理">有限覆盖定理证明单调有界原理</h3>
<p>设数列<span
class="math inline">\(\{x_n\}\)</span>单调增上有界（单调减下有界的证明类似），若<span
class="math inline">\(\{x_n\}\)</span>中存在最大值，则易证数列<span
class="math inline">\(\{x_n\}\)</span>极限存在。若<span
class="math inline">\(\{x_n\}\)</span>中无最大值，采用反证法，假设数列<span
class="math inline">\(\{x_n\}\)</span>极限不存在。取<span
class="math inline">\(\{x_n\}\)</span>二的任意上界<span
class="math inline">\(M\)</span>和任意自然数<span
class="math inline">\(n_0\)</span>，则显然<span
class="math inline">\(x_{n_0}&lt;M\)</span>，下面作闭区间<span
class="math inline">\([x_{n_0},M]\)</span>的无限开覆盖，设<span
class="math inline">\(x\in
[x_{n_0},M]\)</span>，则存在以下三种情形：</p>
<ol type="1">
<li>若<span class="math inline">\(x=x_{n_1}\)</span>，由于<span
class="math inline">\(\{x_n\}\)</span>中没有最大值，则可以找到<span
class="math inline">\(x_{n_2}&gt;x_{n_1}\)</span>，取<span
class="math inline">\(\delta=x_{n_2}-x_{n_1}\)</span>，得到<span
class="math inline">\(x\)</span>的邻域<span
class="math inline">\((x-\delta, x+\delta)\)</span></li>
<li>若<span class="math inline">\(x\notin \{x_n\}\)</span>且<span
class="math inline">\(x\)</span>不是<span
class="math inline">\(\{x_n\}\)</span>的上界，则同样存在<span
class="math inline">\(x_{n_2}&gt;x\)</span>，取<span
class="math inline">\(\delta=x_{n_2}-x\)</span>，得到<span
class="math inline">\(x\)</span>的邻域<span
class="math inline">\((x-\delta,x+\delta)\)</span></li>
<li>若<span class="math inline">\(x\)</span>为<span
class="math inline">\(\{x_n\}\)</span>的上界，由于<span
class="math inline">\(\{x_n\}\)</span>的极限不存在，故一定存在<span
class="math inline">\(\delta\)</span>使得<span
class="math inline">\((x-\delta,x+\delta)\)</span>中不含任何<span
class="math inline">\(\{x_n\}\)</span>中的项。</li>
</ol>
<p>上述的所有开区间组成闭区间<span
class="math inline">\([x_{n_0},M]\)</span>的一个开覆盖<span
class="math inline">\(H\)</span>。由有限覆盖定理可知，存在一个有限开覆盖<span
class="math inline">\(H_1\)</span>可以覆盖区间<span
class="math inline">\([x_{n_0},M]\)</span>，即<span
class="math inline">\(H_1=\{(x_i-\delta_i,x_i+\delta_i)|i=1,2,3,...\}\)</span>。</p>
<p>可以将这些开区间分为两类，第一类满足上述情形3，第二类不满足。则显然<span
class="math inline">\(M\)</span>在第一类的开区间中，<span
class="math inline">\(x_{n_0}\)</span>在第二类的开区间中。若这些开区间可以将闭区间<span
class="math inline">\([x_{n_0},M]\)</span>有限覆盖，则第一类开区间和第二类开区间必然存在交集。而显然，第一类开区间与第二类开区间之间不存在交集。因此假设不成立，数列<span
class="math inline">\(\{x_n\}\)</span>极限存在。</p>
<h3 id="有限覆盖定理证明闭区间套定理">有限覆盖定理证明闭区间套定理</h3>
<p>设<span
class="math inline">\(\{[a_n,b_n]\}\)</span>为一列闭区间套。采用反证法，假设闭区间<span
class="math inline">\([a_n,b_n],n=1,2,3,...\)</span>中不存在公共点<span
class="math inline">\(\xi\)</span>，从而，<span
class="math inline">\(\forall x \in [a_1,b_1]\)</span>，总存在<span
class="math inline">\(\delta_x\)</span>使得<span
class="math inline">\((x-\delta_x,x+\delta_x)\)</span>不与所有的<span
class="math inline">\([a_n,b_n]\)</span>相交，即存在<span
class="math inline">\([a_{n_x},b_{n_x}]\)</span>使得<span
class="math inline">\((x-\delta_x,x+\delta_x)\cap[a_{n_x},b_{n_x}]=\varnothing\)</span>。则这些<span
class="math inline">\(x\)</span>的邻域构成区间<span
class="math inline">\([a_1,b_1]\)</span>中的一个开覆盖记作： <span
class="math display">\[
H=\{(x-\delta_x,x+\delta_x)|x\in [a_1,b_1]\}
\]</span> 由有限覆盖定理可知，<span
class="math inline">\(H\)</span>中存在<span
class="math inline">\([a_1,b_1]\)</span>的一个有限子覆盖记为： <span
class="math display">\[
H_1=\{(x_k-\delta_{x_k},x_k+\delta_{x_k})|x_k\in [a_1,b_1],k=1,2,3,...\}
\]</span> 相应的，<span
class="math inline">\((x_k-\delta_{x_k},x_k+\delta_{x_k})\cap[a_{n_k},b_{n_k}]=\varnothing\)</span>。根据区间套的条件，在<span
class="math inline">\([a_{n_k},b_{n_k}]\)</span>中找到最小的一个闭区间记作<span
class="math inline">\([a_{n_0},b_{n_0}]\)</span>。则<span
class="math inline">\([a_{n_0},b_{n_0}]\cap(x_k-\delta_{x_k},x_k+\delta_{x_k})=\varnothing,
k=1,2,3,...\)</span>，这与<span
class="math inline">\([a_{n_0},b_{n_0}]\subset
[a_1,b_1]\)</span>矛盾，故假设不成立，闭区间套定理得证。</p>
<h3 id="有限覆盖定理证明聚点定理">有限覆盖定理证明聚点定理</h3>
<p>设<span class="math inline">\(S\)</span>为有界无穷点集，则存在<span
class="math inline">\(M\)</span>，使得<span
class="math inline">\(S\subset
[-M,+M]\)</span>。由于闭区间的聚点都包含在闭区间中，故若<span
class="math inline">\(S\)</span>存在聚点，则一定包含在<span
class="math inline">\([-M,+M]\)</span>中。</p>
<p>采用反证法，假设<span class="math inline">\(S\)</span>无聚点，即<span
class="math inline">\([-M,+M]\)</span>中任意一点都不是<span
class="math inline">\(S\)</span>的聚点，则对于<span
class="math inline">\(\forall x\in [-M,+M]\)</span>，存在相应的<span
class="math inline">\(\delta_x\)</span>使得<span
class="math inline">\(U(x,\delta_x)\)</span>中至多含有限个<span
class="math inline">\(S\)</span>中的点。这些<span
class="math inline">\(x\)</span>的邻域形成区间<span
class="math inline">\([-M,+M]\)</span>的一个无限开覆盖： <span
class="math display">\[
H=\{U(x,\delta_x)|x\in [-M，+M]\}
\]</span> 由有限覆盖定理可知，<span
class="math inline">\(H\)</span>中存在<span
class="math inline">\([-M,+M]\)</span>的一个有限子覆盖记为： <span
class="math display">\[
H_1=\{U(x_i,\delta_{x_i}|x_i\in [-M,+M],i=1,2,3,...\}
\]</span> 则在<span
class="math inline">\(H_1\)</span>中，至多含有限个<span
class="math inline">\(S\)</span>中的点，这与<span
class="math inline">\(\cup H_1\supset [-M,+M]\supset
S\)</span>矛盾，故假设不成立，聚点定理得证。</p>
<h3
id="有限覆盖定理证明cauchy收敛准则">有限覆盖定理证明Cauchy收敛准则</h3>
<p>证明必要性：</p>
<p>若数列<span class="math inline">\(\{x_n\}\)</span>收敛且极限为<span
class="math inline">\(x\)</span>，则<span class="math inline">\(\forall
\epsilon&gt;0,\exists M\in N\)</span>，使得 <span
class="math inline">\(m,n&gt;M\)</span>时 <span class="math display">\[
|x_m-x|&lt;\frac{\epsilon}{2},\ |x_n-x|&lt;\frac{\epsilon}{2}
\]</span> 由三角不等式可得： <span class="math display">\[
|x_m-x_n|\leq|x_m-x|+|x_n-x|&lt;\frac\epsilon2+\frac\epsilon2=\epsilon
\]</span> 必要性证明完毕。</p>
<p>证明充分性：</p>
<p>设数列<span class="math inline">\(\{x_n\}\)</span>满足，对于<span
class="math inline">\(\forall \epsilon&gt;0,\exists M\in
N\)</span>，使得<span class="math inline">\(m,n&gt;M\)</span>时，<span
class="math inline">\(|x_m-x_n|&lt;\epsilon\)</span>。</p>
<p>首先证明数列<span class="math inline">\(\{x_n\}\)</span>有界。取<span
class="math inline">\(\epsilon=1\)</span>，则<span
class="math inline">\(\exists N_0\)</span>，使得<span
class="math inline">\(n&gt;N_0\)</span>时有<span
class="math inline">\(|x_n-x_{N_0+1}|&lt;1\)</span>，则<span
class="math inline">\(\forall
n&gt;N_0,|x_n|\leq|x_{N_0+1}|+1\)</span>。又因为数列的前<span
class="math inline">\(N_0\)</span>项为有限项，因此数列<span
class="math inline">\(\{x_n\}\)</span>有界。则存在闭区间<span
class="math inline">\([a,b]\)</span>使得<span
class="math inline">\(x_n\in [a,b]\)</span></p>
<p>采用反证法，假设数列<span
class="math inline">\(\{x_n\}\)</span>不收敛。则<span
class="math inline">\(\forall x\in [a,b]\)</span>，<span
class="math inline">\(\exists U(x,\delta)\)</span>中至多含有<span
class="math inline">\(\{x_n\}\)</span>有限多项（否则易证<span
class="math inline">\(x\)</span>为<span
class="math inline">\(\{x_n\}\)</span>的极限）。</p>
<p>设<span class="math inline">\([a,b]\)</span>的一个开覆盖为<span
class="math inline">\(H=\{U(x,\delta)|x\in
[a,b]\}\)</span>,则该开覆盖存在有限子覆盖<span
class="math inline">\(H_1=\{U(x_i,\delta_i)|x\in[a,b],i=1,2,3,...\}\)</span>。因此，<span
class="math inline">\(H_1\)</span>中至多含有限项<span
class="math inline">\(\{x_n\}\)</span>中的项，这与<span
class="math inline">\(\cup H_1\supset [a,b]\supset
\{x_n\}\)</span>矛盾，故假设不成立，Cauchy列收敛。</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>实数</tag>
        <tag>证明</tag>
        <tag>数学分析</tag>
      </tags>
  </entry>
  <entry>
    <title>LeTaX数学公式常用语法</title>
    <url>/fc7e112.html</url>
    <content><![CDATA[<center>
码一些经常使用的LeTaX数学公式语法
</center>
<p><img
src="https://download.kezhi.tech/img/8QXOvd.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h3 id="上标与下标">1.上标与下标</h3>
<blockquote>
<p>上标命令为 "^"， 下标命令为 "_"</p>
</blockquote>
<p><span class="math display">\[x_1\]</span> <span
class="math display">\[x_1^2\]</span> <span
class="math display">\[x^2_1\]</span> <span
class="math display">\[x_{22}^{(n)}\]</span> <span
class="math display">\[{}^*\!x^*\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$x_1$$</span><br><span class="line">$$x_1^2$$</span><br><span class="line">$$x^2_1$$</span><br><span class="line">$$x_&#123;22&#125;^&#123;(n)&#125;$$</span><br><span class="line">$$&#123;&#125;^*\!x^*$$</span><br></pre></td></tr></table></figure>
<h3 id="分式">2.分式</h3>
<blockquote>
<p>输入较短的分式时，可以使用 "/"来输入
对于输入带有水平分数线的分式，使用 ""</p>
</blockquote>
<p><span class="math display">\[ (x+y)/2 \]</span><span
class="math display">\[ \frac{x+y}{2} \]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$ (x+y)/2 $$</span><br><span class="line">$$ \frac&#123;x+y&#125;&#123;2&#125; $$</span><br></pre></td></tr></table></figure>
<h3 id="根式">3.根式</h3>
<blockquote>
<p>排版根式的命令是：开平方：；开 n 次方：</p>
</blockquote>
<p><span class="math display">\[\sqrt{2}&lt;\sqrt[3]{3}\]</span><span
class="math display">\[\sqrt{1+\sqrt[p]{1+a^2}}\]</span><span
class="math display">\[\sqrt{1+\sqrt[^p\!]{1+a^2}}\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\sqrt&#123;2&#125;&lt;\sqrt[3]&#123;3&#125;$$</span><br><span class="line">$$\sqrt&#123;1+\sqrt[p]&#123;1+a^2&#125;&#125;$$</span><br><span class="line">$$\sqrt&#123;1+\sqrt[^p\!]&#123;1+a^2&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<h3 id="求和和积分">4.求和和积分</h3>
<blockquote>
<p>排版求和符号与积分符号的命令分别为 和
，它们通常都有上下限，在排版上就是上标和下标。</p>
</blockquote>
<p><span class="math display">\[\sum_{k=1}^{n}\frac{1}{k}\]</span><span
class="math display">\[\sum_{k=1}^n\frac{1}{k}\]</span><span
class="math display">\[\int_a^b f(x)dx\]</span><span
class="math display">\[\int_a^b f(x)dx\]</span><span
class="math display">\[\int_a^b f(x)\mathrm{d}x\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\sum_&#123;k=1&#125;^&#123;n&#125;\frac&#123;1&#125;&#123;k&#125;$$</span><br><span class="line">$$\sum_&#123;k=1&#125;^n\frac&#123;1&#125;&#123;k&#125;$$</span><br><span class="line">$$\int_a^b f(x)dx$$</span><br><span class="line">$$\int_a^b f(x)dx$$</span><br><span class="line">$$\int_a^b f(x)\mathrm&#123;d&#125;x$$</span><br></pre></td></tr></table></figure>
<h3 id="空格">5.空格</h3>
<blockquote>
<p>LaTeX
能够自动处理公式中的大多数字符之间的空格，但是有时候需要自己手动进行控制。</p>
</blockquote>
<p>紧贴 <span class="math inline">\(a\!b\)</span> 没有空格 <span
class="math inline">\(ab\)</span> 小空格 <span
class="math inline">\(a\,b\)</span> 中等空格 <span
class="math inline">\(a\;b\)</span> 大空格 <span
class="math inline">\(a\ b\)</span> quad空格 <span
class="math inline">\(a\quad b\)</span> 两个quad空格 <span
class="math inline">\(a\qquad b\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">紧贴  $a\!b$</span><br><span class="line">没有空格 $ab$</span><br><span class="line">小空格 $a\,b$</span><br><span class="line">中等空格 $a\;b$</span><br><span class="line">大空格 $a\ b$</span><br><span class="line">quad空格 $a\quad b$</span><br><span class="line">两个quad空格 $a\qquad b$</span><br></pre></td></tr></table></figure>
<h3 id="矩阵">6.矩阵</h3>
<blockquote>
<p>对于少于 10 列的矩阵，可使用
matrix，pmatrix，bmatrix，Bmatrix，vmatrix 和 Vmatrix 等环境。</p>
</blockquote>
<p><span class="math display">\[\begin{matrix}1 &amp; 2\\3
&amp;4\end{matrix}\]</span><span class="math display">\[\begin{pmatrix}1
&amp; 2\\3 &amp;4\end{pmatrix}\]</span><span
class="math display">\[\begin{bmatrix}1 &amp; 2\\3
&amp;4\end{bmatrix}\]</span><span
class="math display">\[\begin{Bmatrix}1 &amp; 2\\3
&amp;4\end{Bmatrix}\]</span><span
class="math display">\[\begin{vmatrix}1 &amp; 2\\3
&amp;4\end{vmatrix}\]</span><span
class="math display">\[\begin{Vmatrix}1 &amp; 2\\3
&amp;4\end{Vmatrix}\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\begin&#123;matrix&#125;1 &amp; 2\\3 &amp;4\end&#123;matrix&#125;$$</span><br><span class="line">$$\begin&#123;pmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;pmatrix&#125;$$</span><br><span class="line">$$\begin&#123;bmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;bmatrix&#125;$$</span><br><span class="line">$$\begin&#123;Bmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;Bmatrix&#125;$$</span><br><span class="line">$$\begin&#123;vmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;vmatrix&#125;$$</span><br><span class="line">$$\begin&#123;Vmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;Vmatrix&#125;$$</span><br></pre></td></tr></table></figure>
<h3 id="排版数组">7.排版数组</h3>
<blockquote>
<p>当矩阵规模超过 10 列，或者上述矩阵类型不符需求，可使用 array
环境。该环境可把一些元素排列成横竖都对齐的矩形阵列。</p>
</blockquote>
<p><span class="math display">\[
\mathbf{X} =
\left( \begin{array}{ccc}
x_{11} &amp; x_{12} &amp; \ldots \\
x_{21} &amp; x_{22} &amp; \ldots \\
\vdots &amp; \vdots &amp; \ddots
\end{array} \right)
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\mathbf&#123;X&#125; =</span><br><span class="line">\left( \begin&#123;array&#125;&#123;ccc&#125;</span><br><span class="line">x_&#123;11&#125; &amp; x_&#123;12&#125; &amp; \ldots \\</span><br><span class="line">x_&#123;21&#125; &amp; x_&#123;22&#125; &amp; \ldots \\</span><br><span class="line">\vdots &amp; \vdots &amp; \ddots</span><br><span class="line">\end&#123;array&#125; \right)</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<blockquote>
<p>，\表示换行，{ccc}表示列样式。array
环境也可以用来排版这样的表达式，表达式中使用一个“.”
作为其隐藏的定界符。</p>
</blockquote>
<p><span class="math display">\[
y = \left\{ \begin{array}{ll}
a &amp; \textrm{if $d&gt;c$}\\
b+x &amp; \textrm{in the morning}\\
l &amp; \textrm{all day long}
\end{array} \right.
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">y = \left\&#123; \begin&#123;array&#125;&#123;ll&#125;</span><br><span class="line">a &amp; \textrm&#123;if $d&gt;c$&#125;\\</span><br><span class="line">b+x &amp; \textrm&#123;in the morning&#125;\\</span><br><span class="line">l &amp; \textrm&#123;all day long&#125;</span><br><span class="line">\end&#123;array&#125; \right.</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<blockquote>
<p>你也可以在array 环境中画线，如分隔矩阵中元素。</p>
</blockquote>
<p><span class="math display">\[
\left(\begin{array}{c|c}
1 &amp; 2 \\
\hline
3 &amp; 4
\end{array}\right)
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\left(\begin&#123;array&#125;&#123;c|c&#125;</span><br><span class="line">1 &amp; 2 \\</span><br><span class="line">\hline</span><br><span class="line">3 &amp; 4</span><br><span class="line">\end&#123;array&#125;\right)</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<h3 id="极限符号">8.极限符号</h3>
<p><span class="math display">\[
{\lim_{x \to +\infty}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to +\infty&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
{\lim_{x \to -\infty}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to -\infty&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
{\lim_{x \to 0}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to 0&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
{\lim_{x \to 0^+}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to 0^+&#125;&#125;$$</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>LetaX</tag>
      </tags>
  </entry>
  <entry>
    <title>NexT写作常用样式</title>
    <url>/61ad1e34.html</url>
    <content><![CDATA[<p>一些markdown之外的语法规则，让文章更美观</p>
<blockquote>
<p>本文摘录自 <mark class="label success">周宇峰的博客</mark> <a
href="https://yfzhou.coding.me/2018/08/27/Hexo-Next%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%88%E4%B8%BB%E9%A2%98%E4%BC%98%E5%8C%96%EF%BC%89/">原文链接</a>
<img
src="https://download.kezhi.tech/img/8MAadJ.md.jpg?x-oss-process=style/webp"
alt="8MAadJ.md" /> <span id="more"></span></p>
</blockquote>
<h3 id="文本居中">1.文本居中</h3>
<p>效果: <blockquote class="blockquote-center">
<p>人生乃是一面镜子， 从镜子里认识自己， 我要称之为头等大事，
也只是我们追求的目的！</p>

</blockquote> 源码:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% cq %&#125;</span><br><span class="line">人生乃是一面镜子，</span><br><span class="line">从镜子里认识自己，</span><br><span class="line">我要称之为头等大事，</span><br><span class="line">也只是我们追求的目的！</span><br><span class="line">&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure>
<p>更多NexT主题自带的标签，点击：<a
href="http://theme-next.iissnan.com/tag-plugins.html">http://theme-next.iissnan.com/tag-plugins.html</a></p>
<h3 id="主题自带样式note标签">2.主题自带样式note标签</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;default&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note default">
<p>
default
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note primary&quot;&gt;&lt;p&gt;primary&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note primary">
<p>
primary
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note success&quot;&gt;&lt;p&gt;success&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note success">
<p>
success
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;info&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note info">
<p>
info
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;warning&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note warning">
<p>
warning
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;danger&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note danger">
<p>
danger
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;note danger no-icon&quot;&gt;&lt;p&gt;danger no-icon&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<div class="note danger no-icon">
<p>
danger no-icon
</p>
</div>
<p>首先在主题配置文件中配置： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Note tag (bs-callout).</span><br><span class="line">note:</span><br><span class="line">  # 风格</span><br><span class="line">  style: flat</span><br><span class="line">  # 要不要图标</span><br><span class="line">  icons: true</span><br><span class="line">  # 圆角矩形</span><br><span class="line">  border_radius: 3</span><br><span class="line">  light_bg_offset:</span><br></pre></td></tr></table></figure></p>
<h3 id="自带label">3.自带label</h3>
<mark class="label default">default</mark>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label default@default %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label primary">primary</mark>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label primary@primary %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label success">success</mark>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label success@success %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label info">info</mark>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label info@info %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label warning">warning</mark>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label warning@warning %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label danger">danger</mark>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label danger@danger %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="选项卡">4.选项卡</h3>
<div class="tabs" id="选项卡"><ul class="nav-tabs"><li class="tab"><a href="#选项卡-1">选项卡 1</a></li><li class="tab active"><a href="#选项卡-2">选项卡 2</a></li><li class="tab"><a href="#选项卡-3">选项卡 3</a></li></ul><div class="tab-content"><div class="tab-pane" id="选项卡-1"><p><strong>这是选项卡 1</strong>
呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈……</p></div><div class="tab-pane active" id="选项卡-2"><p><strong>这是选项卡 2</strong></p></div><div class="tab-pane" id="选项卡-3"><p><strong>这是选项卡 3</strong> 哇，你找到我了！φ(≧ω≦*)♪～</p></div></div></div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% tabs 选项卡, 2 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**这是选项卡 1** 呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈呵呵哈哈哈哈哈哈哈哈……</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**这是选项卡 2**</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**这是选项卡 3** 哇，你找到我了！φ(≧ω≦*)♪～</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="主题自带tabs">5.主题自带tabs</h3>
<p>源码: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% btn https://www.baidu.com, 点击下载百度, download fa-lg fa-fw %&#125;</span><br></pre></td></tr></table></figure> 效果:<a class="btn" href="https://www.baidu.com"><i class="fa fa-download fa-lg fa-fw"></i>点击下载百度</a></p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>NexT标签云配置</title>
    <url>/47930864.html</url>
    <content><![CDATA[<p>本文引自<a
href="https://alex-mcavoy.github.io/hexo/7be258c0.html">Next 7.0+
TagCanvas 标签云 | Alex_McAvoy (alex-mcavoy.github.io)</a></p>
<p><img
src="https://download.kezhi.tech/img/20220322172925.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<p>Next 7.0+ 可以对标签进行自定义设置，在此基础上，可以使用球形标签云的
<code>tagcanvas.js</code> 插件进行样式修改，具体修改步骤如下</p>
<ol type="1">
<li><p>下载插件</p>
<p>关于球形标签云 <code>tagcanvas.js</code> 插件的详细介绍：<a
href="http://www.goat1000.com/tagcanvas.php">点击这里</a></p>
<p>将该插件下载后，放入 <code>/theme/next/source/js</code>
目录下</p></li>
<li><p>新建标签云 swig 文件</p>
<p>在 <code>/theme/next/layout/_partials</code> 目录下，建一个名为
<code>tagcanvas.swig</code> 的文件，并写入如下内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myTags&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span> <span class="attr">id</span>=<span class="string">&quot;my3DTags&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Anything in here will be replaced on browsers that support the canvas element<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span> <span class="attr">id</span>=<span class="string">&quot;tags&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; tagcloud(&#123;</span><br><span class="line">        min_font   : theme.tagcloud.min,</span><br><span class="line">        max_font   : theme.tagcloud.max,</span><br><span class="line">        amount     : theme.tagcloud.amount,</span><br><span class="line">        color      : true,</span><br><span class="line">        start_color: theme.tagcloud.start,</span><br><span class="line">        end_color  : theme.tagcloud.end&#125;)</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/tagcanvas.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TagCanvas</span>.<span class="title class_">Start</span>(<span class="string">&#x27;my3DTags&#x27;</span>,<span class="string">&#x27;tags&#x27;</span>,&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">textFont</span>: <span class="string">&#x27;Georgia,Optima&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">textColour</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">outlineColour</span>: <span class="string">&#x27;black&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">weight</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">reverse</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">depth</span>: <span class="number">0.8</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">maxSpeed</span>: <span class="number">0.05</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">bgRadius</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">freezeDecel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">catch</span>(e) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myTags&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改页面配置文件</p>
<p>对 <code>/theme/next/layout/</code> 中的 <code>page.swig</code>
文件按照下图所示进行进行修改</p>
<p><img
src="https://download.kezhi.tech/img/20220322171837.png?x-oss-process=style/webp" /></p>
<p>添加代码为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;# tagcanvas plugin 球型云标签 #&#125;</span><br><span class="line">&#123;% include &#x27;_partials/tagcanvas.swig&#x27; %&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>修改主题配置文件</p>
<p>打开 <code>/theme/config.yml</code>，找到 <code>tagcloud</code>
字段，根据实际需要进行修改即可：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># TagCloud settings for tags page.</span></span><br><span class="line"><span class="attr">tagcloud:</span></span><br><span class="line">  <span class="comment"># All values below are same as default, change them by yourself.</span></span><br><span class="line">  <span class="attr">min:</span> <span class="number">20</span> <span class="comment"># Minimun font size in px</span></span><br><span class="line">  <span class="attr">max:</span> <span class="number">30</span> <span class="comment"># Maxium font size in px</span></span><br><span class="line">  <span class="attr">start:</span> <span class="string">&quot;#19CAAD&quot;</span> <span class="comment"># Start color (hex, rgba, hsla or color keywords)</span></span><br><span class="line">  <span class="attr">end:</span> <span class="string">&quot;#F4606C&quot;</span> <span class="comment"># End color (hex, rgba, hsla or color keywords)</span></span><br><span class="line">  <span class="attr">amount:</span> <span class="number">200</span> <span class="comment"># Amount of tags, change it if you have more than 200 tags</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
      </tags>
  </entry>
  <entry>
    <title>强化学习中的Terminated 和 Truncated</title>
    <url>/5be4b154.html</url>
    <content><![CDATA[<p>深度强化学习的流程可以抽象为以下步骤的重复：</p>
<ol type="1">
<li>智能体与环境交互产生并存储经验</li>
<li>智能体从经验中进行学习</li>
</ol>
<p>本文主要探讨在收集经验过程中，环境自然结束（Terminated，包括目标成功，失败等）和人为截断（Truncated，主要为达到一定步数结束）对经验收集和训练产生的影响，以及如何对其进行处理。并对其进行了部分实验来比较性能。</p>
<p><img src="https://download.kezhi.tech/img/202305242122684.png?x-oss-process=style/webp" style="width:60%;" /></p>
<span id="more"></span>
<h2 id="q-learning-简介">Q-Learning 简介</h2>
<p>在Q-Learning系列算法中，智能体要学习估计每个状态<span
class="math inline">\(s\)</span>下每个动作的最优Q值<span
class="math inline">\(Q^{*}(s,a)\)</span>。其贝尔曼方程如下： <span
class="math display">\[
Q^*(s_t,a_t)=r_t+\gamma \cdot \max_{a&#39;\in
A(s_{t+1})}Q^*(s_{t+1},a_{t+1})
\]</span> 而当<span
class="math inline">\(s_{t+1}\)</span>为一局的结束状态，即<span
class="math inline">\(done(s_{t+1})=True\)</span>时， <span
class="math display">\[
Q^*(s_t,a_t)=r_t
\]</span></p>
<p>写在一起为： <span class="math display">\[
Q^*(s_t,a_t)=\left\{
\begin{array}{**lr**}
r_t+\gamma \cdot \max_{a&#39;\in A(s_{t+1})}Q^*(s_{t+1},a_{t+1}) &amp;
if\ done(s_{t+1})=False\\
r_t &amp; if\ done(s_{t+1})=True
\end{array}
\right.
\]</span> 在程序实现过程中，通常写为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">q_target = reward + self._gamma * max_next_q_value * (<span class="number">1</span> - done)</span><br></pre></td></tr></table></figure>
<h2 id="截断问题">截断问题</h2>
<p>Q-Learning的关键在于对于值函数的准确估计，如果环境在推演过程中被人为截断，如果被当作环境终止来处理，则对<span
class="math inline">\(Q^*\)</span>的估计就少了一项<span
class="math inline">\(\gamma \cdot \max_{a&#39;\in
A(s_{t+1})}Q^*(s_{t+1},a_{t+1})\)</span>。这在一定程度上会使<span
class="math inline">\(Q^*\)</span>函数在学习的过程中不稳定，或难以收敛。另外，终止状态往往和奖励<span
class="math inline">\(r_t\)</span>有关，若不对人为截断的情况进行另外处理，则有可能会给智能体一个有偏差的奖励，从而使智能体的训练过程出现问题。</p>
<p>因此，在经验记录和reward设计时，除了要考虑环境自然结束（Terminated）外，也要考虑提前终止等人为截断（truncated）的情况。强化学习环境库<code>gym</code>从<code>0.26</code>版本开始，每个step都会返回这两个信息，从而方便训练。</p>
<p>考虑截断的情况下，<span
class="math inline">\(Q^*\)</span>的贝尔曼方程的程序实现就变为了：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">q_target = reward + self._gamma * max_next_q_value * (<span class="number">1</span> - done + truncated)</span><br></pre></td></tr></table></figure>
<h2 id="实验对比">实验对比</h2>
<p>本文在<code>gym</code>的<code>CartPole-v1</code>环境上进行测试，最大回合数设为200，训练步数为500，隐层网络为2层64节点的全连接网络，每步训练次数为8，buffer
size为100000，batch size为64，最小训练经验数为500，初始<span
class="math inline">\(\epsilon=0.9\)</span>，终止<span
class="math inline">\(\epsilon=0.01\)</span>，<span
class="math inline">\(\epsilon\)</span> decay
步数为200步，奖励函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cart_pole_v1</span>(<span class="params">params</span>):</span><br><span class="line">    reward = params[<span class="string">&quot;reward&quot;</span>]</span><br><span class="line">    step = params[<span class="string">&quot;step&quot;</span>]</span><br><span class="line">    done = params[<span class="string">&quot;done&quot;</span>]</span><br><span class="line">    truncated = params[<span class="string">&quot;truncated&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> done <span class="keyword">and</span> (<span class="keyword">not</span> truncated):</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">100</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>/((step+<span class="number">1</span>)**<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>在DQN算法中实验结果如图1所示：</p>
<p><img
src="https://download.kezhi.tech/img/202305242121154.png?x-oss-process=style/webp" /></p>
<center>
图1 DQN对比
</center>
<p>在Double DQN算法中实验结果如图2所示：</p>
<p><img
src="https://download.kezhi.tech/img/202305242121791.png?x-oss-process=style/webp" /></p>
<center>
图2 DoubleDQN对比
</center>
<p>在Dueling DQN算法中实验结果如图3所示：</p>
<p><img
src="https://download.kezhi.tech/img/202305242121630.png?x-oss-process=style/webp" /></p>
<center>
图3 DuelingDQN对比
</center>
<p>在D3QN算法中实验结果如图4所示：</p>
<p><img
src="https://download.kezhi.tech/img/202305242122501.png?x-oss-process=style/webp" /></p>
<center>
图3 DoubleDuelingDQN对比
</center>
<p>上述实验结果表明，相比于不考虑截断，考虑截断情况之后，算法的训练更加稳定，最终收敛的结果方差较小。但考虑截断并不能明显提升Q-Learning系列算法的收敛速度或是表现性能。它更多的是提升了训练时的稳定性。</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>Q-Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>强化学习算法实现中的细节</title>
    <url>/aaafe79.html</url>
    <content><![CDATA[<p>强化学习在算法实现时需要非常注意细节，否则网络很难收敛或没有训练效果。本文主要记录我在实现各种强化学习算法时踩到的一些坑以及需要注意的细节，持续更新......</p>
<p>以及附上我自己实现的RL算法库：<a
href="https://github.com/KezhiAdore/RL-Algorithm">https://github.com/KezhiAdore/RL-Algorithm</a></p>
<p><img src="https://download.kezhi.tech/img/202303061042992.jpg?x-oss-process=style/webp" width = "45%" /></p>
<span id="more"></span>
<h2 id="common">Common</h2>
<ul>
<li><code>PyTorch</code>中的交叉熵损失函数<code>torch.nn.functional.cross_entropy</code>里面会先计算一次<code>softmax</code>，在使用策略梯度时要注意<a
href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>。</li>
<li>在部分场景中，存在人为提前结束trajectory的情况（例如Cart
Pole环境中达到一定的step提前阶段）。这种情况下和因失败结束trajectory区分开来。在失败的情况下，<span
class="math inline">\(q(s,a)=r\)</span>，而在人为截断时，<span
class="math inline">\(q(s,a)=r+\gamma*V(s&#39;)\)</span>。<a href="#fn2"
class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a></li>
</ul>
<h2 id="reinforce">REINFORCE</h2>
<ul>
<li>计算<code>loss</code>时，<span
class="math inline">\(-\ln\pi_\theta(a|s)\)</span>与discount
reward相乘时要注意维度一致。</li>
<li>计算完交叉熵之后使用<code>torch.sum</code>求和比<code>torch.mean</code>求平均效果要好<a
href="#fn3" class="footnote-ref" id="fnref3"
role="doc-noteref"><sup>3</sup></a>。</li>
</ul>
<h2 id="dqn系列">DQN系列</h2>
<ul>
<li>计算<code>q_target</code>时要注意<code>done=1</code>的情形：即<code>q_target = reward + self._gamma * max_next_q_value * (1 - done)</code>，否则容易导致训练过程中<code>reward</code>一直上下大幅震荡。</li>
<li>一定要有间隔同步的<code>target_newok</code>，否则很难收敛。</li>
</ul>
<h2 id="reference">Reference</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a
href="https://kezhi.tech/e295e676.html">PyTorch中的CrossEntropyLoss与交叉熵计算不一致
| Kezhi's Blog</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a
href="https://kezhi.tech/5be4b154.html">强化学习中的Terminated 和
Truncated | Kezhi's Blog</a><a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="https://kezhi.tech/b69f94c6.html">Vanilla
Policy Gradient关于loss mean与sum的探讨 | Kezhi's Blog</a><a
href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>影片《字节跳动》创作阐述</title>
    <url>/fa011f5e.html</url>
    <content><![CDATA[<h2 id="序">序</h2>
<p>《字节跳动》创作于2022年5月下旬至6月上旬，历时半个月。是截至目前为止本人参与的短片拍摄最高水平。</p>
<p><img
src="https://download.kezhi.tech/img/202206071619140.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h2 id="影片概述">影片概述</h2>
<p>《字节跳动》荣获了2022年西安交通大学硕士研究生通选课程<em>影视创作</em>课程最佳影片奖，影片中林宁的饰演者获得了最佳演员奖。该影片全片观看如下：</p>
<iframe src="//player.bilibili.com/player.html?aid=257448226&amp;bvid=BV18Y411K7PV&amp;cid=743040841&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<h2 id="工作流程">工作流程</h2>
<p>本次影视创作过程主要包含以下步骤：</p>
<ul>
<li>确定故事题材及大纲</li>
<li>撰写剧本</li>
<li>根据剧本编写分镜</li>
<li>确认拍摄地点</li>
<li>制定拍摄计划，准备拍摄器材和道具</li>
<li>影片拍摄</li>
<li>后期制作</li>
</ul>
<p>后文将对上述过程进行逐一说明。</p>
<p>在团队协作方面，主要用到了以下方案：</p>
<ul>
<li>腾讯会议：线上进行开会交流，不受地理空间限制</li>
<li>石墨在线文档：多人在线共同编辑和查看文档，对文档有修改可以及时看到，便于文本工作的协同</li>
<li>seafile
网盘：可以挂载到电脑目录的云盘，本小组使用其来存放所有的拍摄素材，以便于后期与特效对文件进行访问。</li>
</ul>
<table>
<tr>
<td>
<center>
石墨文档
</center>
</td>
<td>
<center>
Seafile
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202205301641610.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202205301643646.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h3 id="确定故事题材及大纲">确定故事题材及大纲</h3>
<p>这一步是整个创作中最需要头脑风暴和创意的部分。本小组都是理工科专业的学生，相对来说这一步较为困难。本小组在课上讨论环节中考虑了很多题材，悬疑，爱情，科幻，乃至关于人生意义的思考。科幻的拍摄和后期难度略高，第一个被pass。关于人生的意义由于组内成员难以达成共识，遂也被放弃。最后便是在悬疑和爱情题材上进行讨论，讨论过程中突然想到我们是人工智能背景的学生，于是便将目光放在了人工智能与人恋爱的这样一个故事上。</p>
<p>故事的脉络并不复杂，讲的是人工智能男主与人类女主之间产生感情的故事。男主的特征已经很明显了，就是人工智能。这时需要给女主赋予一定的特点，人工智能最通常的特点就是没有显式的感情，那么赋予女主读心术的能力便可以将男主在女主的世界中的特殊性表现出来。此外，还需要考虑两人之间产生感情的动机，初步考虑如下：</p>
<ul>
<li>女主因为能够读到他人的心声发现大家往往都是心口不一的，而男主她无法读到心声，便对男主产生好奇，两人成为好友之后，随着男主的陪伴逐渐对男主产生感情。</li>
<li>男主是一次强人工智能计划的产物，理论上来说没有显式的情感，与女主的相处的经历构成了他感情产生的基础，从而在此之上产生了感情。</li>
</ul>
<p>至此，本次影视创作的故事核心完成。</p>
<h3 id="撰写剧本">撰写剧本</h3>
<p>撰写剧本是将大纲丰富，完善成一个完整故事的过程。换句话说也就是逐步敲定细节。整个过程本小组采用<strong>腾讯会议+石墨在线文档</strong>的方式进行。主要进行了两次会议来讨论剧本，第一次会议完成了剧本的草稿，第二次会议确认了剧本中的一些细节（如男女主如何熟悉，故事如何转折以及最终如何收尾等问题）。此外，剧本在撰写分镜，拍摄计划以及实际拍摄过程中，也经过了多次修改。这里面挑几个有意思的过程进行阐述：</p>
<ol type="1">
<li>对于男女主名字的确定。林宁，莫迟来源于 Machine Learning
的谐音。此外，由于人工智能与机器人要求每位研究生早起打卡，莫迟也有该所研究生莫要迟到之意。</li>
<li>关于收尾部分的那句心声修改过很多次，有“林宁，我喜欢你”，“林宁，我想我明白喜欢是什么意思了”等等，最终敲定为“林宁，我知道什么是喜欢了”。一方面，林宁读到了莫迟的心声表现出莫迟有了感情，另一方面，也是一种留白，这里没有直接交代莫迟对于林宁的感情，留给观众想象空间。</li>
<li>关于片名。字节跳动这个名字是随着故事情节自然而然出来的，字节代表人工智能，跳动代表其有了感情。故字节跳动十分贴切。可能字节跳动这家AI公司的创始人也有这样的想法在里面？</li>
</ol>
<h3 id="根据剧本编写分镜">根据剧本编写分镜</h3>
<p>写分镜是个看似简单的工作，将剧本写成一幕一幕的分镜即可。然而，如果写的分镜存在问题，那么会给拍摄带来很大的不便。由于之前没有拍摄影视作品的经验，本小组在写分镜时着重考虑了对后续拍摄的指导作用，对于大部分画面采用了现场排练+手机试拍的方式来确认画面如何构成，摄像机大概在什么位置等分镜信息。</p>
<h3 id="确认拍摄地点">确认拍摄地点</h3>
<p>在写分镜时对拍摄地点有一定的构想，例如在一个公园里，在教室，在走廊等等。然而如果按照这样的分镜来指导拍摄，拍摄期间必然有大量的时间耗费在寻找合适的场地上，大大降低了拍摄效率。因此，在确定了拍摄时间之后，我，靖雪，子谦便提前寻找合适的场地和时间。本小组拍摄的影片主要涉及如下几个地点：教室，学校道路，公园，天台，宿舍楼下，宿舍内。地点选择过程如下：</p>
<ul>
<li>教室考虑了涵英楼西辅楼的阶梯教室，选择该地的原因有两点：一是这里的阶梯教室比较有青春校园的感觉，室内光线也较好；二是傍晚室外的光透过窗户打进来，可以得到一个很好的拍摄效果（然而在实际拍摄那天室外光线不好没有用上）。</li>
<li>学校道路初步考虑了涵英楼南面的宽阔道路，弘理楼门口的廊道，以及三号楼外面的廊道。最终初步选择了三号楼北面的廊道，因为其附近没有大量的共享单车影响画面（弘理楼附近有很多共享单车），附近还有大量的绿植形成光斑，比较好看。最终拍摄时因为那里的光比较暗，选择了三号楼东边的廊道，并且该路与涵英楼南面的宽阔道路相连接，可以很好的与剧情对应衔接。</li>
<li>公园的选址是个很大的问题，创新港附近真的是什么都没有！！！并且创新港内本身的绿地也没有风景特别好的地方。最终决定在所谓的创新港胭脂坡附近进行拍摄。</li>
<li>天台这个地点是在寻找场地的时候确定的，最开始是想找一个风景好看的地方，最后到那天傍晚的时候发现夕阳很好看，就决定要不要去天台试试，结果效果确实不错。并且运气很好，在实际拍摄的那天夕阳更好看了。</li>
<li>宿舍楼下，这个地点确认了很久，因为这场戏涉及到猫的出境，不能离猫的居住地太远。并且杂物不能太多。在B南区宿舍确定食堂南边的路作为拍摄地点。</li>
<li>宿舍内，这个相对很简单了，靖雪的宿舍布置非常漂亮，拍出来很好看，Nice！</li>
<li>此外，在主要剧情中间还穿插着男女主一起出游的场景，为了将其拍摄的有现实生活的气息也有一些浪漫色彩在里面，选用了商场的场景，创新港绿地的场景以及米兰楼的场景来进行拍摄。在设计这些场景的时候我们发现，太多的镜头下是在一起走路:joy:：两人谈心在散步，去商场一起走路，在爱因斯坦旁边也在走路，在米兰楼还一起走路参观，总之好像两人除了走路就还是走路:happy:（虽然据有恋爱经历的人说确实会经常散步），为了让这些场景的戏显得不那么一致单调，我们对每个场景都进行了一定的设计。商场改为了一起抓娃娃（然而道客商场没有抓娃娃机改成吃饭了），在爱因斯坦雕像旁加入了女主模仿爱因斯坦的戏，米兰楼有转椅于是突发奇想加入了办公室转椅竞速赛的镜头。从而使这些画面看起来比较丰富。</li>
</ul>
<h3
id="制定拍摄计划准备拍摄器材和道具">制定拍摄计划，准备拍摄器材和道具</h3>
<p>本次拍摄所用到的器材和道具如下：</p>
<p>录像设备：Canon 600D×1，Canon 70D×1，Canon 6D Mark II×1</p>
<p>录音设备：品士无线领夹麦克风 [一拖一] [type-c
接口]×2，手机×2（作为麦克风的接收设备）</p>
<p>稳定设备：三脚架×2，相机稳定器</p>
<p>场记板：实物场记板×1，iPad场记板×2（场记软件：<em>轻松场记</em>）</p>
<p>动物：布偶（猫）×1</p>
<p>道具：鸽子粮×1，画×1，猫猫水杯×1，服装若干，《机器学习》×1，《深度学习》×1，笔记本（Notebook）×1，笔记本（laptop）×1</p>
<hr />
<p>拍摄道具的准备是分阶段进行的，在确定拍摄之后，相机，录音设备，稳定设备以及场记板这些器材的准备就被提上日程；剧情中的关键道具是在讨论剧本和分镜的过程中确定的，如鸽子粮，猫，画等；剩下的一些道具是具体布景和拍摄时确定的，如服装，笔记本，书本等。</p>
<p>拍摄计划对于影片拍摄的高效进行非常重要。本小组的男女主并非居住在创新港，因此拍摄时间十分紧张，需要在一天半的时间内完成全部的拍摄。因此，拍摄计划以及拍摄前的准备都是按照尽可能节省拍摄时间而准备的。在制定拍摄计划时，首先考虑如下原则：</p>
<ul>
<li>对于有时间要求的场优先安排（如夕阳下的天台）</li>
<li>将同一地点的戏一次性拍完，从而节省转移场地的时间</li>
<li>具有剧情衔接的戏尽量放在一起，以保证演员对于剧情的理解</li>
<li>多机位多角度拍摄，多设备录音，保证素材的冗余</li>
</ul>
<h3 id="影片拍摄">影片拍摄</h3>
<p>拍摄是影片从创意和计划到现实的过程，影片的拍摄过程需要一套严格遵循的流程来保证拍摄出素材的可用性与规范性。由于拍摄的时间定在了周五和周六两天，恰巧周五那天的影视创作课程讲拍摄的部分。我们在课前的拍摄的过程中采取了以下流程：</p>
<ol type="1">
<li>到达拍摄地点，制作团队每人持一份拍摄计划单，演员持剧本</li>
<li>导演根据拍摄计划单告知制作团队及演员要拍的戏，并且给演员讲戏以确保演员对情绪理解到位</li>
<li>摄影师根据导演要求确定机位和拍摄路径</li>
<li>录音师根据演员的动作和拍摄的角度确定麦克风的放置位置</li>
<li>各部门就绪，场记拿着场记板放在摄影机前。</li>
<li>导演喊“三、二、一，开始”。喊“三”时录音师和摄像师开机录制，喊到“一”时场记从摄像机前移走。</li>
<li>导演喊停，录音师和摄影师停止录制</li>
<li>录音师对录音文件重命名，格式为 "n_k_r次" <span
class="math inline">\(n,k,r \in N^+\)</span></li>
</ol>
<p>而在结束了周五的录制之后，在教室听课时老师降到了拍摄流程的部分，考虑到我们团队自己的拍摄流程，总结下来有几个问题：</p>
<ol type="1">
<li>之前的拍摄中，场记板放在摄影机前，保证了场记板的清晰可见。但是在摄像机的拍摄主体较远时，会导致场记板在拿走后，相机需要大概3秒的时间再次对焦，也就是说相机拍摄到的前3秒画面基本是无法使用的。上课时听了老师的讲述，才反应过来需要将场记板放到相机的焦点附近，以保证在拍摄过程中相机的焦点一致</li>
<li>录音文件一般来说相对较小，可以较早开机。</li>
<li>导演喊“三、二、一，开始”的同时，也需要观察现场各部门的准备情况和演员的就绪情况，不能只顾着喊开始。</li>
<li>每次画面拍摄完都需要回看。在之前的拍摄中，导演在拍摄完毕后只和摄像确认了有没有拍摄成功，而没有逐一确认拍摄画面。导致在后期过程中有一些画面由于过曝或者过暗无法使用。造成了素材的损失。</li>
</ol>
<p>此外，在拍摄过程中比较有意思的一点就是藏麦克风了。录音设备要在保证不出现在拍摄画面里的情况下尽可能离演员近。本小组采用的录音设备是一种无线领夹式的麦克风，本身的体积较小，藏匿空间较大。在拍摄过程中采取了以下几种方案</p>
<ul>
<li>女主和室友一起走路上课时，麦克风放在女主抱着的书与衣服的间隔处</li>
<li>上课时，麦克风放在打开的书页下面</li>
<li>猫的那个镜头里面，两人对话时麦克风在男主的手上</li>
<li>男主有一件胸前有口袋的衣服，当穿这身衣服出镜时，麦克风在这个口袋里</li>
<li>两人在公园边走便聊天时，正面和背面各拍摄了一遍。拍正面视角时麦克风夹在后领，拍背面视角的时候麦克风夹在胸前（拍这场戏的时候蚊子真的好多，并且由于是一场关键戏反复拍了很多次，被咬出了工伤:cry:）</li>
<li>两人坐在山坡上聊天时，麦克风放在怀里</li>
</ul>
<h3 id="后期制作">后期制作</h3>
<p>本片的后期相对来说工作量较大，涉及到影片的剪辑，对于配音（心声）的处理，特效的制作，回忆画面的效果等。因此将工期工作分给了三个小组成员来进行。分别是艺馨，靖雪和我。其中，靖雪负责影片前半部分的开场、剪辑、音频效果及转场；艺馨负责影片后半部分的剪辑，音频效果，回忆画面效果及专场；我负责特效，字幕以及片尾。这样的分工最大程度上减少了工作之间的耦合性，保证了各部分可以独立并行进行，大大提高了生产效率。</p>
<p>其中，所有的素材均存按照场次和镜头号分文件夹放在上文提到的 Seafile
网盘中。在后期过程中，遵循的第一原则就是永远不在原素材上进行任何的修改，所有的修改过程在本地进行。网盘只用于素材的存放以及成片的管理。在这样的原则指导之下，三个人之间的协作没有出现大的问题。</p>
<p>此外，在开始剪辑之初，本小组的三名后期人员便建立微信群方便相互沟通。在经过初步的剪辑之后，这个小组迎来了一名不速之客——我。她并不进行任何剪辑工作，进这个群的初衷是为了尽快看到成片而来不断地push剪辑小组的成员。不过，后来她起到的作用远不止于次，在不断催后期小组工作的基础上，她对于每一个剪辑的片段都会进行评价和改进的建议。这从现在看来是非常必要的，由于剪辑师对于一个片段可能会反复进行观看和改动，从而可能会忽略影片在整体上的观感，也就是观众在看到影片时候的第一感受。而这位“不速之客”的到来使得每一个片段都会有一个观众来提建议，这对于影片后期的成片质量是有很大的作用的。</p>
<h2 id="器材设备使用">器材设备使用</h2>
<p>本次拍摄使用到的器材如下：</p>
<p>录像设备：Canon 600D×1，Canon 70D×1，Canon 6D Mark II×1</p>
<p>录音设备：品士无线领夹麦克风 [一拖一] [type-c
接口]×2，手机×2（作为麦克风的接收设备）</p>
<p>稳定设备：三脚架×2，相机稳定器</p>
<hr />
<p>关于器材的详细说明以及使用情况见上文工作流程中关于“准备拍摄器材和道具”以及“影片拍摄”部分。</p>
<p>一些补充：</p>
<ul>
<li>相机稳定器是租来的，但是不好用，调平一次需要花费很久的时间。后来放弃使用改为手持。结果拍出来的有一点抖动的画面其实比完全静态的画面表现力要更好的。另一方面，摄影师手持相机的能力也大大提升</li>
<li>三脚架在拍摄过程中起到了很大的作用，一些摇的镜头都是由三脚架提供的硬件支持</li>
</ul>
<h2 id="问题解决方案及经验总结">问题，解决方案及经验总结</h2>
<p>本次影视创作让我们小组经历了一次从一个创意到一部影片的全过程，在此过程中我们遇到了很多困难和挑战，而想办法克服这些困难的过程就是我们成长的过程。在此，将创作过程中遇到的问题，解决方案和经验记录如下。</p>
<h3 id="镜头缺失的问题">1. 镜头缺失的问题</h3>
<p>由于男主线的剧本剪辑并没有在之前想的特别详细，导致在拍摄结束后剪辑男主线的镜头的衔接上有一定的突兀。而男女主演员并不常驻在创新港，补拍镜头的成本过高。此时考虑采用一些第一视角以及部分特写的补拍来补足画面（反正看不见脸）。于是就出现了影片后面部分第一视角跑步的衔接镜头<del>（我抱着相机在创新港到处跑的样子真的很像呆逼）</del>。此外，拍摄过程中涉及到女主送男主画的镜头，然而这副画的内容是在送画这场戏之后拍摄的。为了保证拍摄的顺利进行并且避免补拍成本，在拍摄时使用白纸来充当道具，之后再由手替演员来补足看画的特写。</p>
<h3 id="影片拍摄过程中存在穿帮镜头">2. 影片拍摄过程中存在穿帮镜头</h3>
<p>在拍摄电梯镜头时，电梯内部存在镜面反射，这样在相机拍摄时无可避免会照到摄影师入镜，如下左图所示。并且此时的画面还在不断地移动，无法使用简单地覆盖来进行消除。在查找了很多方案之后采取<a
href="https://www.bilibili.com/video/BV1KE411X7gY?share_source=copy_web">【Premiere】pr移除场景中的杂物_哔哩哔哩_bilibili</a>
中的方案对拍摄到的人像进行移除，移除结果如右图所示</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206052135720.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206052135469.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>创作</tag>
        <tag>影视创作</tag>
        <tag>微电影</tag>
        <tag>协作</tag>
      </tags>
  </entry>
  <entry>
    <title>摘抄</title>
    <url>/639b053d.html</url>
    <content><![CDATA[<h2 id="section">2021.04</h2>
<blockquote class="blockquote-center">
<p>矫揉做作地喜好各种规矩就是“有系统”，孜孜不倦且兴致勃勃地处理鸡毛蒜皮的公事就是“勤勉”；该做的事优柔寡断就是“谨慎”；不该做的事盲目地坚持到底就是“决心”。</p>
<p><b>-- 《银河帝国2：基地与帝国》</b></p>

</blockquote>
<span id="more"></span>
<h2 id="section-1">2021.06</h2>
<blockquote class="blockquote-center">
<p>哭泣可能会持续整个夜晚，但是快乐会随早晨而到来</p>
<p><b>-- 诗篇 30：5</b></p>

</blockquote>
<h2 id="section-2">2022.11</h2>
<blockquote class="blockquote-center">
<p>Much of my work has come from being lazy</p>
<p><b>-- Programming Perl</b></p>

</blockquote>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>读书笔记</tag>
        <tag>摘抄</tag>
      </tags>
  </entry>
  <entry>
    <title>数字图像处理（一）图像插值(Python)</title>
    <url>/2b8fba10.html</url>
    <content><![CDATA[<p>数字图像在当代社会有着非常重要的作用，图像的插值作为一种基本的图像处理方法，在很多情况下可以很好的提高图像分辨率，提升图像观感。图像的插值方法主要有以下三种：</p>
<ul>
<li>最近邻插值</li>
<li>双线性插值</li>
<li>双三次插值 <span id="more"></span></li>
</ul>
<h2 id="最近邻插值">最近邻插值</h2>
<p>最近邻插值，顾名思义，在插值时寻找距离图像像素点最近的像素点的值进行图像像素的填充。这种图像插值方法运算速度快，可以很快的出结果。缺点是插值效果较差，由于直接采用最近的像素点的像素值作为插值数据，因此导致在图像边缘，过渡等颜色变化较为明显的地方会出现较为严重的锯齿。
<img
src="https://s1.ax1x.com/2020/03/13/8u4Uwn.png?x-oss-process=style/webp"
alt="最近邻插值" /></p>
<p>实现代码如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">        <span class="keyword">if</span> i&lt;=<span class="number">2044</span> <span class="keyword">and</span> j&lt;=<span class="number">2044</span>:</span><br><span class="line">            result[i][j]=img[<span class="built_in">round</span>(i/<span class="number">4</span>)][<span class="built_in">round</span>(j/<span class="number">4</span>)][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[i][j]=img[math.floor(i/<span class="number">4</span>)][math.floor(j/<span class="number">4</span>)][<span class="number">0</span>]</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,result)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="双线性插值">双线性插值</h2>
<p>双线性插值采用线性的方法对图像进行插值,对于插值图像中的某个像素点，该点的像素值由距离其最近的四个像素值通过线性计算获得。插值得到的结果较好，计算量相比于最近邻要满，但远快于双三次插值，最终得到的插值图像结果除一些小细节之外和双三次插值得到的插值结果相当。可以用来快速，大量的插值图片。
<img
src="https://s1.ax1x.com/2020/03/13/8u5o40.png?x-oss-process=style/webp"
alt="双线性插值" /> 实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">        <span class="keyword">if</span> i&lt;<span class="number">2044</span> <span class="keyword">and</span> j&lt;<span class="number">2044</span>:</span><br><span class="line">            l=i//<span class="number">4</span></span><br><span class="line">            k=j//<span class="number">4</span></span><br><span class="line">            a=i/<span class="number">4</span>-i//<span class="number">4</span></span><br><span class="line">            b=j/<span class="number">4</span>-j//<span class="number">4</span></span><br><span class="line">            result[i][j]=img[l][k][<span class="number">0</span>]*(<span class="number">1</span>-a)*(<span class="number">1</span>-b)+img[l+<span class="number">1</span>][k][<span class="number">0</span>]*a*(<span class="number">1</span>-b)+img[l][k+<span class="number">1</span>][<span class="number">0</span>]*(<span class="number">1</span>-a)*b+img[l+<span class="number">1</span>][k+<span class="number">1</span>][<span class="number">0</span>]*a*b</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[i][j]=img[i//<span class="number">4</span>][j//<span class="number">4</span>][<span class="number">0</span>]</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,result)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>在图像边缘处采取最近邻插值</p>
<h2 id="双三次插值">双三次插值</h2>
<p>双三次插值采用非线性的计算方法，利用三次函数对于图像像素值进行计算。每个像素值由其周围的4*4即16个像素点的像素值计算获得。插值质量较高，运算速度较慢，Photoshop所用的插值方法就是双三次插值。
<span class="math display">\[
f_3(x,y)=\sum_{i=0}^3\sum_{j=0}^3a_{ij}x_iy_i
\]</span></p>
<p>实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">weight</span>(<span class="params">x</span>):</span><br><span class="line">    a=-<span class="number">0.5</span></span><br><span class="line">    x=<span class="built_in">abs</span>(x)</span><br><span class="line">    <span class="keyword">if</span> x&lt;=<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span>  (a+<span class="number">2</span>)*x**<span class="number">3</span>-(a+<span class="number">3</span>)*x**<span class="number">2</span>+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> x&lt;<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> a*x**<span class="number">3</span>-<span class="number">5</span>*a*x**<span class="number">2</span>+<span class="number">8</span>*a*x-<span class="number">4</span>*a</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">        <span class="keyword">if</span> i&gt;<span class="number">4</span> <span class="keyword">and</span> i&lt;<span class="number">2040</span> <span class="keyword">and</span> j&gt;<span class="number">4</span> <span class="keyword">and</span> j&lt;<span class="number">2040</span>:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                    result[i][j]+=img[i//<span class="number">4</span>+k-<span class="number">1</span>][j//<span class="number">4</span>+w-<span class="number">1</span>][<span class="number">0</span>]*weight(i/<span class="number">4</span>-(i//<span class="number">4</span>+k-<span class="number">1</span>))*weight(j/<span class="number">4</span>-(j//<span class="number">4</span>+w-<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[i][j]=img[i//<span class="number">4</span>][j//<span class="number">4</span>][<span class="number">0</span>]</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,result)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="结束语">结束语</h2>
<p>这三种插值方法是图像插值的传统方法，分辨率的提升是基于局部像素的综合运算得到空白像素的像素值。这样的插值方法可以满足当代社会的绝大部分需求，但如果要追求更好的插值效果，或是将图像分辨率成几十倍的扩充即超分辨率，这样的插值方法就不能满足需求。这时，就需要通过一些其他的方法例如机器学习来进行图片质量的提升。</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>插值</tag>
      </tags>
  </entry>
  <entry>
    <title>数字图像处理（五）空域高通滤波器</title>
    <url>/bbc72bae.html</url>
    <content><![CDATA[<p>高通滤波器经常用来增强图像和提取图像的边缘信息，在日常的图像处理和图像识别中都有着很广泛的应用。这里要说明的高通滤波器主要有如下几种：非锐化掩膜，索贝尔算子，拉普拉斯算子，canny算法。</p>
<span id="more"></span>
<h2 id="非锐化掩膜">非锐化掩膜</h2>
<p>该算法经常用于图像的增强，在图像边缘的提取上用的不多。实现的方法如下：</p>
<ul>
<li>对于原始图像<span
class="math inline">\(f(x,y)\)</span>，对其进行高斯模糊得到平滑之后的图像<span
class="math inline">\(\overline{f(x,y)}\)</span></li>
<li>原始图像和平滑后的图像做差得到掩膜<span
class="math inline">\(g_{mask}(x,y)=f(x,y)-\overline{f(x,y)}\)</span></li>
<li>将原始图像与k倍的掩膜相叠加得到增强后的图像<span
class="math inline">\(g(x,y)=f(x,y)+k*g_{mask}(x,y)\)</span></li>
<li>一般将k取值为1，为图像增强，k大于1则为高提升图像。</li>
</ul>
<p>该算法得到的图像处理效果如下：</p>
<blockquote>
<p>从左致右依次为：原始图像，得到的掩膜（规整到0-255），增强后的图像</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141251.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141327.bmp">
</center>
</td>
</tr>
</table>
<p>由上图的结果可以看出，掩膜图像在边缘处的亮度很高，在其余地方的亮度较低，在和原始图像进行叠加之后，这里采用的取整方式是将叠加后图像进行整体归一化之后再乘255之后取整。因为原图像边缘在和掩膜叠加之后，图像边缘的亮度很大，在进行归一化之后原图像中的亮部有一定程度的变暗。如果采用另一种取整方式即：如果叠加超过255则将其视为255，小于0则统一视为0。可以很有效的解决这个问题，但图像的边缘就没有上一方法这么明显。具体使用哪一种方法根据实际情况进行选择。</p>
<h2 id="索贝尔算子">索贝尔算子</h2>
<p>sobel算子在图像边缘的提取中经常用到，它采用的是利用图像的一阶导数来进行边缘的提取。即<span
class="math inline">\(\nabla f\)</span></p>
<p>我们知道，二元函数的梯度由x方向和y方向两个方向的方向导数构成，那么sobel算子也一样，有两个，分别为x方向和y方向，两个算子分别如下：
<span class="math display">\[
\begin{bmatrix}-1&amp;0&amp;1\\-1&amp;0&amp;2\\-1&amp;0&amp;1\end{bmatrix}
~~~~~~~~~~\begin{bmatrix}-1&amp;-2&amp;-1\\0&amp;0&amp;0\\1&amp;2&amp;1\end{bmatrix}
\]</span></p>
<ul>
<li>将图像分别与上述两个算子相卷积得到x方向和y方向的边缘<span
class="math inline">\(G_x\)</span>和<span
class="math inline">\(G_y\)</span></li>
<li>通过<span class="math inline">\(G_x\)</span>和<span
class="math inline">\(G_y\)</span>即可以算出图像的一阶导<span
class="math inline">\(G=\sqrt{G_x^2+G_y^2}\)</span>，有时为了快速计算也会取<span
class="math inline">\(G=|G_x|+|G_y|\)</span>或<span
class="math inline">\(G=max\{|G_x|,|G_y|\}\)</span></li>
<li>将G规整到0-255即可得到图像的sobel算子边缘</li>
</ul>
<blockquote>
<p>依次为：原图像，x方向边缘，y方向边缘，sobel边缘</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330143516.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330143622.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330143708.bmp">
</center>
</td>
</tr>
</table>
<p>sobel算子在提取图像的明显边缘的表现很好，在提取图像的细节边缘方面也有这很好的表现，用领一幅图的处理结果来说明这一点</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330144324.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330144413.bmp">
</center>
</td>
</tr>
</table>
<blockquote>
<p>可以看出，即使是烟囱上的细小边缘轮廓，sobel算子提取出来的边缘有着很好的体现。</p>
</blockquote>
<h2 id="拉普拉斯算子">拉普拉斯算子</h2>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172117.bmp">
</center>
</td>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172117.bmp" >
</center>
</td>
</center>
</td>
</tr>
</table>
<p><span class="math display">\[
[f(x+1)-f(x)]-[f(x)-f(x-1)]=f(x+1)+f(x-1)-2f(x)
\]</span> 由此导出拉普拉斯算子为： <span class="math display">\[
\begin{bmatrix}0&amp;1&amp;0\\1&amp;-4&amp;1\\0&amp;1&amp;0\end{bmatrix}
\]</span> 有时也在其中加入对角线方向的二阶导，则算子为： <span
class="math display">\[
\begin{bmatrix}1&amp;1&amp;1\\1&amp;-8&amp;1\\1&amp;1&amp;1\end{bmatrix}
\]</span> 在实践中也经常使用如下这两个算子： <span
class="math display">\[
\begin{bmatrix}0&amp;-1&amp;0\\-1&amp;4&amp;-1\\0&amp;-1&amp;0\end{bmatrix}
\begin{bmatrix}-1&amp;-1&amp;-1\\-1&amp;8&amp;-1\\-1&amp;-1&amp;-1\end{bmatrix}
\]</span></p>
<blockquote>
<p>假设提取出的图像边缘为<span
class="math inline">\(L(x,y)\)</span>，那么图像增强的算法为<span
class="math inline">\(g(x,y)=f(x,y)+c*L(x,y)\)</span></p>
<p>如果使用最上方两个算子提取出的边缘，则c=-1，使用下面的两个算子，c=1</p>
</blockquote>
<p>使用拉普拉斯算子提取出的图像边缘信息如下：</p>
<blockquote>
<p>依次为：原图像，无对角线的laplace边缘，有对角线的laplace边缘</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330145641.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330145657.bmp">
</center>
</td>
</tr>
</table>
<p>拉普拉斯算子提取出的图像边缘在每个边缘处会有两条边缘线，这是由其二阶导的性质所决定的。相较于sobel算子提取出的边缘结果，laplace边缘更加细致，得到了“边缘的边缘”。由下图的对比可以更加明显的看出：</p>
<blockquote>
<p>左边为sobel算子提取结果，右边为laplace</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330144413.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330150103.bmp">
</center>
</td>
</tr>
</table>
<p>对于这种稍微复杂的图像来说，laplace算子提取的边缘过于细致，反而导致很多地方难以看清，这给肉眼的分辨造成了一些困难。但在一些图像识别领域，例如根据卫星图片去识别地面的车辆，很多时候地面的车辆就是一个个小的色块，用laplace算子就可以很好的勾勒出这些车辆的边缘轮廓以及内部的一些细节。而sobel算子对于内部的细节就显得有些无能为力。同时
，“边缘的边缘”这项很好的性质也使得laplace算子提取的边缘可以很好的用于图像增强。</p>
<h2 id="canny算法">canny算法</h2>
<p>canny算法是在sobel边缘提取上优化而来。sobel算子不论边缘强弱，都会在最终的图像中有所表征，这就导致有很多无效的边缘被提取出来显示在结果图像上。canny算法的基本思路就是对这些边缘信息进行筛选，只留下最可能是边缘的像素点。实现方法如下：</p>
<ul>
<li>和sobel一样，首先算出<span class="math inline">\(G_x\)</span>和<span
class="math inline">\(G_y\)</span>；</li>
<li>根据<span class="math inline">\(G_x\)</span>和<span
class="math inline">\(G_y\)</span>算出每个像素点的<span
class="math inline">\(weight=\sqrt{G_x^2+G_y^2}\)</span>以及<span
class="math inline">\(angle=atan\frac{G_y}{G_x}\)</span></li>
<li>将<span class="math inline">\(angle\)</span>离散化到<span
class="math inline">\(45^o\)</span>的倍数角度。</li>
<li>对于图像中的每个像素点<span
class="math inline">\((x,y)\)</span>，将其权重<span
class="math inline">\(weight(x,y)\)</span>与其<span
class="math inline">\(angle(x,y)\)</span>方向和<span
class="math inline">\(-angle(x,y)\)</span>方向的两个像素点的<span
class="math inline">\(weight\)</span>进行比较，如果该点的<span
class="math inline">\(weight\)</span>不是最大的一个，则将其置为0</li>
<li>双阈值检测：设置边缘的亮度上阈值和下阈值，对图像的边缘进行再一次的筛选，最后将边缘信息规整到0-255,。这里的阈值可以自行手动设置。</li>
</ul>
<blockquote>
<p>依次为：原图像，无双阈值检测，下阈值为150，下阈值为200</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330151754.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330151852.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330151924.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h2 id="附录">附录</h2>
<h3 id="参考文献">参考文献</h3>
<p>[1]数字图像处理[M]：第三版/（美）拉斐尔·C·冈萨雷斯（Rafael
C.Gonzalez），（美）理查德·E·伍兹（Richard E.
Woods）著；阮秋琦等译，—北京：电子工业出版社，2017.5</p>
<p>[2]Brook_icv.图像处理基础(4)：高斯滤波器详解[G/OL].博客园: 2017-02-16
[2020-03-23].https://www.cnblogs.com/wangguchangqing/p/6407717.html#autoid-4-1-0</p>
<p>[4]顽皮的石头7788121.
图像边缘检测：Canny算子、Prewitt算子和sobel算子[G/OL].简书 2018-11-06
[2020-03-26]. https://www.jianshu.com/p/bed4ffe996a1</p>
<h3 id="源代码">源代码</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">sigma=<span class="number">1.5</span>   <span class="comment">#高斯滤波器的参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_zeros</span>(<span class="params">img,edge</span>):    <span class="comment">#图像边缘补零</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=np.zeros((shape[<span class="number">0</span>]+<span class="number">2</span>*edge,shape[<span class="number">1</span>]+<span class="number">2</span>*edge))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            temp[i+edge][j+edge]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):     <span class="comment">#定义二维正态分布函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(math.pi*sigma**<span class="number">2</span>)*math.exp(-(x**<span class="number">2</span>+y**<span class="number">2</span>)/(<span class="number">2</span>*sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">n</span>):   <span class="comment">#生成n*n的高斯滤波器</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    filt=np.zeros((n,n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            filt[i][j]=f(i-mid,j-mid)/f(-mid,-mid)</span><br><span class="line">    <span class="keyword">return</span> filt.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">img,n</span>):    <span class="comment">#对图像进行n*n卷积块的高斯滤波</span></span><br><span class="line">    filt=gauss(n)</span><br><span class="line">    con=<span class="number">1</span>/np.<span class="built_in">sum</span>(filt)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=add_zeros(img,n//<span class="number">2</span>)</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>],<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            tmp=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    tmp+=filt[k][l]*temp[i+k][j+l]</span><br><span class="line">            result[i][j][<span class="number">0</span>]=con*tmp</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unsharp_mask</span>(<span class="params">img,n,is_mask=<span class="number">0</span></span>):        <span class="comment">#用n*n高斯模糊后非锐化掩膜,is_mask为0返回叠加后图像，为1返回掩膜</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    new_img=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>],<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            new_img[i][j][<span class="number">0</span>]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    mask=new_img-gauss_filter(img,n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                mask[i][j][<span class="number">0</span>]=<span class="number">0</span></span><br><span class="line">    result=new_img+mask</span><br><span class="line">    result=result-np.<span class="built_in">min</span>(result)</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    mask=mask-np.<span class="built_in">min</span>(mask)</span><br><span class="line">    mask=mask/np.<span class="built_in">max</span>(mask)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">if</span> is_mask:</span><br><span class="line">        <span class="keyword">return</span> mask.astype(np.uint8)    <span class="comment">#返回掩膜</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)  <span class="comment">#返回结果</span></span><br><span class="line"></span><br><span class="line">sobelx=[[-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[-<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>],[-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line">sobely=[[-<span class="number">1</span>,-<span class="number">2</span>,-<span class="number">1</span>],[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>]]</span><br><span class="line">laplace4=[[<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>],[-<span class="number">1</span>,<span class="number">4</span>,-<span class="number">1</span>],[<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>]]</span><br><span class="line">laplace8=[[-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>],[-<span class="number">1</span>,<span class="number">8</span>,-<span class="number">1</span>],[-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filt_3</span>(<span class="params">img,filt</span>):          <span class="comment">#任意3*3滤波器(图像,算子)</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=add_zeros(img,<span class="number">1</span>)</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>],<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            tmp=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                    tmp+=filt[k][l]*temp[i+k][j+l]</span><br><span class="line">            result[i][j][<span class="number">0</span>]=tmp</span><br><span class="line">    <span class="comment">#result=np.abs(result)     #分别输出x方向和y方向的边缘信息</span></span><br><span class="line">    <span class="comment">#result=result/np.max(result)*255</span></span><br><span class="line">    <span class="comment">#cv.imwrite(&quot;tmp.bmp&quot;,result.astype(np.uint8))</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">laplace_edge</span>(<span class="params">img,filt</span>): <span class="comment">#规整后的拉普拉斯算子边缘</span></span><br><span class="line">    tmp=filt_3(img,filt)</span><br><span class="line">    tmp=tmp-np.<span class="built_in">min</span>(tmp)</span><br><span class="line">    shape=tmp.shape</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span> (shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                tmp[i][j][<span class="number">0</span>]=<span class="number">0</span></span><br><span class="line">    tmp=tmp/np.<span class="built_in">max</span>(tmp)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> tmp.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">laplace</span>(<span class="params">img,filt</span>):  <span class="comment">#原图像与拉普拉斯边缘叠加的结果图像</span></span><br><span class="line">    tmp=filt_3(img,filt)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            result[i][j]=tmp[i][j][<span class="number">0</span>]+img[i][j][<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                result[i][j]=<span class="number">0</span></span><br><span class="line">    result-=np.<span class="built_in">min</span>(result)</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sobel</span>(<span class="params">img</span>):     <span class="comment">#提取图像的sobel边缘</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    sobx=filt_3(img,sobelx)</span><br><span class="line">    soby=filt_3(img,sobely)</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                result[i][j]=<span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result[i][j]=math.sqrt(sobx[i][j][<span class="number">0</span>]**<span class="number">2</span>+soby[i][j][<span class="number">0</span>]**<span class="number">2</span>)</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">canny</span>(<span class="params">img,n=<span class="number">3</span></span>):     <span class="comment">#使用canny算法提取图像边缘（使用n*n的高斯滤波器进行模糊操作）</span></span><br><span class="line">    de=[[<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>],[-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>]]</span><br><span class="line">    shape=img.shape</span><br><span class="line">    tmp=gauss_filter(img,n)</span><br><span class="line">    sobx=filt_3(tmp,sobelx)</span><br><span class="line">    soby=filt_3(tmp,sobely)</span><br><span class="line">    weight,angle,result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>])),np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>])),np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    angle=angle.astype(np.<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            weight[i][j]=math.sqrt(sobx[i][j][<span class="number">0</span>]**<span class="number">2</span>+soby[i][j][<span class="number">0</span>]**<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> sobx[i][j][<span class="number">0</span>]:</span><br><span class="line">                angle[i][j]=<span class="built_in">round</span>((math.atan(soby[i][j][<span class="number">0</span>]/sobx[i][j][<span class="number">0</span>])/(math.pi/<span class="number">4</span>)-<span class="number">0.5</span>))%<span class="number">4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]-<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]-<span class="number">2</span>):</span><br><span class="line">            tmp_i,tmp_j=i+<span class="number">1</span>,j+<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> weight[tmp_i][tmp_j]&lt;=weight[tmp_i+de[angle[tmp_i][tmp_j]][<span class="number">0</span>]][tmp_j+de[angle[tmp_i][tmp_j]][<span class="number">1</span>]] <span class="keyword">and</span> weight[tmp_i][tmp_j]&lt;=weight[tmp_i+de[angle[tmp_i][tmp_j]][<span class="number">2</span>]][tmp_j+de[angle[tmp_i][tmp_j]][<span class="number">3</span>]]:</span><br><span class="line">                result[tmp_i][tmp_j]=<span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result[tmp_i][tmp_j]=weight[tmp_i][tmp_j]</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    mean=np.mean(img)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> result[i][j]&lt;<span class="number">100</span>:</span><br><span class="line">                result[i][j]=<span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename=[<span class="string">&quot;test3_corrupt.pgm&quot;</span>,<span class="string">&quot;test4.tif&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_mask.bmp&quot;</span>,unsharp_mask(img,<span class="number">3</span>,<span class="number">1</span>))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_unsharp_mask.bmp&quot;</span>,unsharp_mask(img,<span class="number">3</span>))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_sobel.bmp&quot;</span>,sobel(img))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_canny.bmp&quot;</span>,canny(img,<span class="number">3</span>))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;laplace4_edge.bmp&quot;</span>,laplace_edge(img,laplace4))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;laplace8_edge.bmp&quot;</span>,laplace_edge(img,laplace8))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>空域滤波器</tag>
      </tags>
  </entry>
  <entry>
    <title>数字图像处理（二）图像配准</title>
    <url>/3cac2a44.html</url>
    <content><![CDATA[<p>图像配准即对于内容大致相同，但在角度，大小或是其他几何位置上有所偏差的两张或几张图像进行坐标变换。使得这些图像矫正到同一规整的大小，角度，坐标上。</p>
<p>图像配准对于图像拼接，制作全景图像，进行环境识别等方面有很大的用处。其原理简单，使用矩阵运算转换速度也很快，在选取映射点合适的情况下，配准效果很好。具体的转化方法如下：</p>
<span id="more"></span>
<h3 id="配准算法">配准算法</h3>
<blockquote>
<p>以图像A为标准配准图像B</p>
</blockquote>
<p>在图像A中选取n个像素点: <span class="math display">\[
p_1(x_1,y_1,1),p_2(x_2,y_2,1),...,p_n(x_n,y_n,1)
\]</span> 构成一个坐标矩阵 <span class="math display">\[
P=\begin{bmatrix}x_1 &amp;x_2
&amp;...&amp;x_n\\y_1&amp;y_2&amp;...&amp;y_n\\1&amp;1&amp;...&amp;1\end{bmatrix}
\]</span> 在图像B中选取与这n个点对应的n个像素点: <span
class="math display">\[
q_1(x_1,y_1),q_2(x_2,y_2),...,q_n(x_n,y_n)
\]</span> 构成另一个坐标矩阵 <span class="math display">\[
Q=\begin{bmatrix}x_1 &amp;x_2
&amp;...&amp;x_n\\y_1&amp;y_2&amp;...&amp;y_n\\1&amp;1&amp;...&amp;1\end{bmatrix}
\]</span></p>
<blockquote>
<p>如果图像B可以通过图像A平移，旋转，缩放得到，那么存在一个转换矩阵H使得：
<span class="math display">\[
Q=HP
\]</span> 那么如果可以计算出转换矩阵H，就可以利用上述公式的变形: <span
class="math display">\[
H^{-1}Q=P
\]</span>
将每个图像B中的像素点映射到图像A相应位置处，从而获得以图像A为模板配准的图像B</p>
</blockquote>
<mark class="label success">如何求出转换矩阵H?</mark>
<p>通过之前在图像A和图像B中已经选取出的点集P和Q，我们不难发现 <span
class="math display">\[
H=QP^{-1}
\]</span></p>
<blockquote>
<p>由于P不是方阵，因而无法对其进行求逆，在这里为求伪逆</p>
</blockquote>
<p>至此，我们已经得到了图像配准的基本流程:</p>
<ul>
<li>在模板图像和待配准图像中选取相互对应的点集$ P <span
class="math inline">\(和\)</span>Q$</li>
<li>通过公式<span
class="math inline">\(H=QP^{-1}\)</span>求出转换矩阵<span
class="math inline">\(H\)</span></li>
<li>通过转换矩阵将待配准图像映射到模板图像上</li>
</ul>
<h3 id="配准示例">配准示例</h3>
<p>例如：以图像A为模板配准图像B <img
src="https://download.kezhi.tech/img/20200429001311.jpg?x-oss-process=style/webp"
alt="Image A" /> <img
src="https://download.kezhi.tech/img/Image%20B.jpg?x-oss-process=style/webp"
alt="图像B" /> 在其中选取七个点，分布为:</p>
<blockquote>
<p>这里采用画图进行选点，画图显示的坐标与(x,y)坐标是正好相反的，在进行坐标记录时需要注意。</p>
</blockquote>
<p><img
src="https://download.kezhi.tech/img/Image%20A(选点).jpg?x-oss-process=style/webp"
alt="选点（图像A）" /> <span class="math display">\[
P=\begin{bmatrix}1448&amp;1694&amp;1756&amp;383&amp;2290&amp;2035&amp;2150\\1308&amp;1198&amp;2744&amp;2516&amp;933&amp;2693&amp;1968\\1&amp;1&amp;1&amp;1&amp;1&amp;1&amp;1\end{bmatrix}
\]</span></p>
<p><span class="math display">\[
Q=\begin{bmatrix}1042&amp;1252&amp;1708&amp;323&amp;1761&amp;1966&amp;1890\\1077&amp;907&amp;2387&amp;2519&amp;498&amp;2265&amp;1535\\1&amp;1&amp;1&amp;1&amp;1&amp;1&amp;1\end{bmatrix}
\]</span></p>
<p>求出的转换矩阵： <span class="math display">\[
H=QP^{-1}=\begin{bmatrix}0.9668&amp;0.2565&amp;693.0275\\-0.2570&amp;0.9671&amp;184.1373\\0.0000&amp;0.0000&amp;1.0000\end{bmatrix}
\]</span> 通过转换矩阵对图像B进行转换，最终得到的结果如下: <img
src="https://download.kezhi.tech/img/result.jpg?x-oss-process=style/webp"
alt="配准后的图像B" /></p>
<p>源码:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment">#np.set_printoptions(threshold=np.inf)</span></span><br><span class="line"></span><br><span class="line">imgA=cv.imread(<span class="string">&quot;Image A.jpg?x-oss-process=style/webp&quot;</span>)</span><br><span class="line">imgB=cv.imread(<span class="string">&quot;Image B.jpg?x-oss-process=style/webp&quot;</span>)</span><br><span class="line">point_A=np.array([[<span class="number">1448</span>,<span class="number">1694</span>,<span class="number">1756</span>,<span class="number">383</span>,<span class="number">2290</span>,<span class="number">2035</span>,<span class="number">2150</span>],[<span class="number">1308</span>,<span class="number">1198</span>,<span class="number">2744</span>,<span class="number">2516</span>,<span class="number">933</span>,<span class="number">2693</span>,<span class="number">1968</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">point_B=np.array([[<span class="number">1042</span>,<span class="number">1252</span>,<span class="number">1708</span>,<span class="number">323</span>,<span class="number">1761</span>,<span class="number">1966</span>,<span class="number">1890</span>],[<span class="number">1077</span>,<span class="number">907</span>,<span class="number">2387</span>,<span class="number">2519</span>,<span class="number">498</span>,<span class="number">2265</span>,<span class="number">1535</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">H=np.dot(point_B,np.linalg.pinv(point_A))</span><br><span class="line"><span class="built_in">print</span>(H)</span><br><span class="line">shape_A=imgA.shape</span><br><span class="line">shape_B=imgB.shape</span><br><span class="line">result,mistake=np.zeros(shape_A),np.zeros(shape_A)</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">mistake=mistake.astype(np.uint8)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape_A[<span class="number">0</span>]):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape_A[<span class="number">1</span>]):</span><br><span class="line">        address=np.dot(H,np.array([i,j,<span class="number">1</span>]))</span><br><span class="line">        address=address.astype(np.<span class="built_in">int</span>)</span><br><span class="line">        <span class="keyword">if</span> address[<span class="number">0</span>]&gt;<span class="number">0</span> <span class="keyword">and</span> address[<span class="number">0</span>]&lt;shape_B[<span class="number">0</span>] <span class="keyword">and</span> address[<span class="number">1</span>]&gt;<span class="number">0</span> <span class="keyword">and</span> address[<span class="number">1</span>]&lt;shape_B[<span class="number">1</span>]:</span><br><span class="line">            result[i][j]=imgB[address[<span class="number">0</span>]][address[<span class="number">1</span>]]</span><br><span class="line">            mistake[i][j]=imgA[i][j]-result[i][j]</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,mistake)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br><span class="line">cv.imwrite(<span class="string">&quot;result.jpg?x-oss-process=style/webp&quot;</span>,result)</span><br><span class="line">cv.imwrite(<span class="string">&quot;mistake.jpg?x-oss-process=style/webp&quot;</span>,mistake)</span><br></pre></td></tr></table></figure>
<h3 id="结束语">结束语</h3>
<p>图像配准的算法比较简单，选取好坐标点之后通过配准的计算方法得到的结果很好。但此次图像配准在选点时为手动选点，如果要大批量进行图像配准或实时配准则需要进行自动选点，此时，如何让程序选取出合适并且相互对应的点集成为了图像配准的难点所在。</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>图像配准</tag>
      </tags>
  </entry>
  <entry>
    <title>数字图像处理（三）直方图均衡</title>
    <url>/a6c8a314.html</url>
    <content><![CDATA[<p>在数字图像处理中，直方图均衡是调整图像亮度，对比度，图像增晰等操作中常用的做法。对于图像中各个不同的颜色进行直方图统计，采取统计数据对于颜色进行重新映射，从而达到调整对比度，图像增晰的目的。</p>
<span id="more"></span>
<h2 id="数字图像的直方图">1.数字图像的直方图</h2>
<p>直方图是指对于整幅图像所有的像素点颜色进行统计，从而得到不同颜色的统计数据，将该数据以直方图的形式画出，即为图像的直方图。</p>
<p>例如，对于下面的这两幅图像：</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/citywall.bmp" title="citywall" width="350"/>
<img src="https://download.kezhi.tech/img/citywall2.bmp" title="citywall1" width="350"/>
</figure>
<p>其所对应的直方图为：</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/image-20200320133506122.png?x-oss-process=style/webp" title="bar_citywall" width="350"/>
<img src="https://download.kezhi.tech/img/image-20200320133652064.png?x-oss-process=style/webp" title="bar_citywall1" width="350"/>
</figure>
<p>由图可见，高对比度的图像颜色分布较广，低对比度图像颜色集中分布在某一区域。第二张图像中的像素值集中分布在一个颜色上，造成图像模糊。</p>
<p>使用图像直方图可以清晰地看出图像的颜色分布情况，从而对于如何进行图形的增晰，提高对比度有了下一步的指导作用</p>
<h2 id="直方图均衡">2.直方图均衡</h2>
<p>直方图均衡，顾名思义，就是在图像直方图上进行图像颜色的均衡。具体来说就是将之前分布过于集中的颜色在直方图上分散开来，让其映射到应当占据的像素值上。具体方法如下(以3位8色为例)：</p>
<p>假设一张64*64像素(M=64,NJ=64,MN=4096)，3位(L=8)的图像来说，其颜色空间为[0,L-1]，即[0,7]。对整张图像的像素值进行统计，得到统计数据如下：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><span
class="math inline">\(r_k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(n_k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(p_r(r_k)=n_k/MN\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(r_0=0\)</span></td>
<td style="text-align: center;">790</td>
<td style="text-align: center;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(r_1=1\)</span></td>
<td style="text-align: center;">1023</td>
<td style="text-align: center;">0.25</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(r_2=2\)</span></td>
<td style="text-align: center;">850</td>
<td style="text-align: center;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(r_3=3\)</span></td>
<td style="text-align: center;">656</td>
<td style="text-align: center;">0.16</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(r_4=4\)</span></td>
<td style="text-align: center;">329</td>
<td style="text-align: center;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(r_5=5\)</span></td>
<td style="text-align: center;">245</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\(r_6=6\)</span></td>
<td style="text-align: center;">122</td>
<td style="text-align: center;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\(r_7=7\)</span></td>
<td style="text-align: center;">81</td>
<td style="text-align: center;">0.02</td>
</tr>
</tbody>
</table>
<p>直方图均衡变换公式为：<span
class="math inline">\(s_k=T(r_k)=(L-1)\sum_{j=0}^kp_r(r_j)=\frac{L-1}{MN}\sum_{j=0}^{k}n_j\)</span></p>
<p>对于该直方图：<span
class="math inline">\(s_0=T(r_0)=7*\sum_{j=0}^0p_r(r_j)=7p_r(r_0)=1.33\)</span></p>
<p>类似的，有：<span
class="math inline">\(s_1=T(r_1)=7\sum_{j=0}^1p_r(r_j)=7p_r(r_0)+7p_r(r_1)=3.08\)</span></p>
<p>以及<span
class="math inline">\(s_1=4.55,s_3=5.67,s_4=6.23,s_5=6.65,s_6=6.86,s_7=7.00\)</span></p>
<p>将所有的<span
class="math inline">\(s\)</span>值近似为最接近的整数(四舍五入) <span
class="math display">\[
s_0=1.33\rightarrow1~~~~~~~s_1=3.08\rightarrow3~~~~~~~s_2=4.55\rightarrow5~~~~s_3=5.67\rightarrow6
\]</span></p>
<p><span class="math display">\[
s_4=6.23\rightarrow6~~~~~~~s_5=6.65\rightarrow7~~~~~~~s_6=6.86\rightarrow7~~~~s_7=7.00\rightarrow7
\]</span></p>
<p>将原有图像通过<span
class="math inline">\(s_k=T(r_k)\)</span>映射到新图像中，得到的结果即为直方图均衡的结果。</p>
<blockquote>
<p>以上图中的长城为例，对于第二张图进行直方图均衡，得到的结果与原图对比如下：</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/image-20200320163708429.png?x-oss-process=style/webp" title="直方图均衡后" width="350"/>
<img src="https://download.kezhi.tech/img/citywall2.bmp" title="原图" width="350"/>
</figure>
<p>原图像整体偏暗，经过直方图均衡之后亮度提升,对比度提升，长城的细节纹理更加清晰。</p>
</blockquote>
<h2 id="目标直方图均衡">3.目标直方图均衡</h2>
<p>以一幅图像的直方图为标准，对待均衡的图像按照该标准进行直方图均衡。方法如下：</p>
<p>首先对于待配准图像计算其均衡变换：<span
class="math inline">\(s_k=T(r_k)=(L-1)\sum_{j=0}^kp_r(r_j)~~~~k=0,1,2...L-1\)</span></p>
<p>计算出标准图像的直方图均衡变换：<span
class="math inline">\(G(z_p)=(L-1)\sum_{i=0}^qp_z(z_i)\)</span></p>
<p>对于每一个待配准图像颜色<span
class="math inline">\(r_k\)</span>，有<span
class="math inline">\(s_k\)</span>与其对应；对于该<span
class="math inline">\(s_k\)</span>，找到与其最近的<span
class="math inline">\(G(z_q)\)</span>，再将其反变换到颜色<span
class="math inline">\(z_q\)</span>，可以建立从<span
class="math inline">\(r_k\rightarrow
z_q\)</span>的映射，从而将待配准的图像以标准图像为模板进行直方图均衡。</p>
<blockquote>
<p>还是以上面的长城图像为例，以原图为目标进行直方图均衡，得到结果对比如下：</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/image-20200320165237866.png?x-oss-process=style/webp" title="目标直方图均衡后" width="350"/>
<img src="https://download.kezhi.tech/img/citywall2.bmp" title="原图" width="350"/>
</figure>
<p>用来匹配的原图为：</p>
<p><img src="https://download.kezhi.tech/img/citywall.bmp" title="citywall" width="350"/></p>
<p>可以看出，相比于上面的直方图均衡，目标直方图均衡在整体的色彩上更加偏向于用于做为目标的标准图，观感上与原图更加接近。</p>
</blockquote>
<h2 id="局部直方图均衡">4.局部直方图均衡</h2>
<p>顾名思义，局部直方图是在图像的每一个小图像块例如<span
class="math inline">\(3*3,5*5
7*7\)</span>大小的局部进行直方图均衡的操作，算法部分类似于直方图均衡，在此不再赘述，得到的效果如下：</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/image-20200320165637769.png?x-oss-process=style/webp" title="原图" width="300"/>
<img src="https://download.kezhi.tech/img/image-20200320165704092.png?x-oss-process=style/webp" title="局部直方图均衡" width="300"/>
</figure>
<h2 id="附录">附录</h2>
<h3 id="参考文献">参考文献：</h3>
<p>[1]数字图像处理[M]：第三版/（美）拉斐尔·C·冈萨雷斯（Rafael
C.Gonzalez），（美）理查德·E·伍兹（Richard E.
Woods）著；阮秋琦等译，—北京：电子工业出版社，2017.5</p>
<h3 id="源码">源码：</h3>
<h4 id="直方图统计">1.直方图统计：</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> mlab</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> rcParams</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">graybar</span>(<span class="params">img,win_num,img_name,flag</span>):</span><br><span class="line">    num=np.zeros((<span class="number">256</span>))</span><br><span class="line">    img_shape=img.shape</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">                num[img[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">if</span> img[i][j][<span class="number">0</span>]==<span class="number">0</span>:</span><br><span class="line">                    img[i][j][<span class="number">0</span>]=<span class="number">255</span></span><br><span class="line">                num[img[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">    fig=plt.figure(win_num)</span><br><span class="line">    rects=plt.bar(<span class="built_in">range</span>(<span class="number">256</span>),num,<span class="number">0.2</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;gray_bar_&#x27;</span>+img_name)</span><br><span class="line">    plt.show()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">filename=[<span class="string">&#x27;citywall.bmp&#x27;</span>,<span class="string">&#x27;citywall1.bmp&#x27;</span>,<span class="string">&#x27;citywall2.bmp&#x27;</span>,<span class="string">&#x27;elain.bmp&#x27;</span>,<span class="string">&#x27;elain1.bmp&#x27;</span>,<span class="string">&#x27;elain2.bmp&#x27;</span>,<span class="string">&#x27;elain3.bmp&#x27;</span>,<span class="string">&#x27;lena.bmp&#x27;</span>,<span class="string">&#x27;lena1.bmp&#x27;</span>,<span class="string">&#x27;lena2.bmp&#x27;</span>,<span class="string">&#x27;lena3.bmp&#x27;</span>,<span class="string">&#x27;woman.BMP&#x27;</span>,<span class="string">&#x27;woman1.bmp&#x27;</span>,<span class="string">&#x27;woman2.bmp&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    graybar(img,<span class="number">0</span>,i,flag(i))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="直方图均衡-1">2.直方图均衡：</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> mlab</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> rcParams</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">graybar_trans</span>(<span class="params">img,flag</span>):</span><br><span class="line">    num=np.zeros((<span class="number">256</span>))</span><br><span class="line">    img_shape=img.shape</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">                num[img[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">if</span> img[i][j][<span class="number">0</span>]==<span class="number">0</span>:</span><br><span class="line">                    img[i][j][<span class="number">0</span>]=<span class="number">255</span></span><br><span class="line">                num[img[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">    fre=num/np.<span class="built_in">sum</span>(num)</span><br><span class="line">    trans=np.zeros((<span class="number">256</span>))</span><br><span class="line">    trans[<span class="number">0</span>]=fre[<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            trans[i]=trans[i-<span class="number">1</span>]+fre[i]*<span class="number">255</span></span><br><span class="line">    trans=trans.astype(np.uint8)</span><br><span class="line">    new_img=np.zeros((img_shape[<span class="number">0</span>],img_shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">            new_img[i][j]=trans[img[i][j][<span class="number">0</span>]]</span><br><span class="line">    <span class="keyword">return</span> new_img.astype(np.uint8)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">filename=[<span class="string">&#x27;citywall.bmp&#x27;</span>,<span class="string">&#x27;citywall1.bmp&#x27;</span>,<span class="string">&#x27;citywall2.bmp&#x27;</span>,<span class="string">&#x27;elain.bmp&#x27;</span>,<span class="string">&#x27;elain1.bmp&#x27;</span>,<span class="string">&#x27;elain2.bmp&#x27;</span>,<span class="string">&#x27;elain3.bmp&#x27;</span>,<span class="string">&#x27;lena.bmp&#x27;</span>,<span class="string">&#x27;lena1.bmp&#x27;</span>,<span class="string">&#x27;lena2.bmp&#x27;</span>,<span class="string">&#x27;lena3.bmp&#x27;</span>,<span class="string">&#x27;woman.BMP&#x27;</span>,<span class="string">&#x27;woman1.bmp&#x27;</span>,<span class="string">&#x27;woman2.bmp&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    result=graybar_trans(img,flag(i))</span><br><span class="line">    <span class="comment"># cv.namedWindow(i,cv.WINDOW_FREERATIO)</span></span><br><span class="line">    <span class="comment"># cv.imshow(i,result)</span></span><br><span class="line">    <span class="comment"># cv.waitKey(0)</span></span><br><span class="line">    cv.imwrite(<span class="string">&#x27;bar_&#x27;</span>+i,result)</span><br></pre></td></tr></table></figure>
<h4 id="目标直方图均衡-1">3.目标直方图均衡：</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> mlab</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> rcParams</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">a,x</span>):</span><br><span class="line">    shape_tmp=a.shape</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape_tmp[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> x-a[i]&lt;=<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> shape_tmp[<span class="number">0</span>]-<span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">graybar_trans</span>(<span class="params">img,cnt,flag</span>):</span><br><span class="line">    file_tem=[<span class="string">&#x27;citywall.bmp&#x27;</span>,<span class="string">&#x27;elain.bmp&#x27;</span>,<span class="string">&#x27;lena.bmp&#x27;</span>,<span class="string">&#x27;woman.bmp&#x27;</span>]</span><br><span class="line">    img_tem=cv.imread(file_tem[cnt])</span><br><span class="line">    num,num_temp=np.zeros((<span class="number">256</span>)),np.zeros((<span class="number">256</span>))</span><br><span class="line">    img_shape=img.shape</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">                num[img[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">                num_temp[img_tem[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">if</span> img[i][j][<span class="number">0</span>]==<span class="number">0</span>:</span><br><span class="line">                    img[i][j][<span class="number">0</span>]=<span class="number">255</span></span><br><span class="line">                num[img[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">                num_temp[img_tem[i][j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">    fre=num/np.<span class="built_in">sum</span>(num)</span><br><span class="line">    fre_temp=num_temp/np.<span class="built_in">sum</span>(num_temp)</span><br><span class="line">    z,z_temp=np.zeros((<span class="number">256</span>)),np.zeros((<span class="number">256</span>))</span><br><span class="line">    z[<span class="number">0</span>],z_temp[<span class="number">0</span>]=fre[<span class="number">0</span>]*<span class="number">256</span>,fre_temp[<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            z[i]=z[i-<span class="number">1</span>]+fre[i]*<span class="number">255</span></span><br><span class="line">            z_temp[i]=z_temp[i-<span class="number">1</span>]+fre_temp[i]*<span class="number">255</span></span><br><span class="line">    trans=np.zeros((<span class="number">256</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        trans[i]=find(z_temp,z[i])</span><br><span class="line">    trans=trans.astype(np.uint8)</span><br><span class="line">    new_img=np.zeros((img_shape[<span class="number">0</span>],img_shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img_shape[<span class="number">1</span>]):</span><br><span class="line">            new_img[i][j]=trans[img[i][j][<span class="number">0</span>]]</span><br><span class="line">    <span class="keyword">return</span> new_img.astype(np.uint8)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cnt</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;citywall&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;elain&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;lena&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;woman&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">filename=[<span class="string">&#x27;citywall.bmp&#x27;</span>,<span class="string">&#x27;citywall1.bmp&#x27;</span>,<span class="string">&#x27;citywall2.bmp&#x27;</span>,<span class="string">&#x27;elain.bmp&#x27;</span>,<span class="string">&#x27;elain1.bmp&#x27;</span>,<span class="string">&#x27;elain2.bmp&#x27;</span>,<span class="string">&#x27;elain3.bmp&#x27;</span>,<span class="string">&#x27;lena.bmp&#x27;</span>,<span class="string">&#x27;lena1.bmp&#x27;</span>,<span class="string">&#x27;lena2.bmp&#x27;</span>,<span class="string">&#x27;lena3.bmp&#x27;</span>,<span class="string">&#x27;woman.BMP&#x27;</span>,<span class="string">&#x27;woman1.bmp&#x27;</span>,<span class="string">&#x27;woman2.bmp&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    result=graybar_trans(img,cnt(i),flag(i))</span><br><span class="line">    <span class="comment"># cv.namedWindow(i,cv.WINDOW_FREERATIO)</span></span><br><span class="line">    <span class="comment"># cv.imshow(i,result)</span></span><br><span class="line">    <span class="comment"># cv.waitKey(0)</span></span><br><span class="line">    cv.imwrite(<span class="string">&quot;aim_bar_&quot;</span>+i,result)</span><br></pre></td></tr></table></figure>
<h4 id="局部直方图均衡-1">4.局部直方图均衡:</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">imname</span>):</span><br><span class="line">    img=cv.imread(imname)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    cnt_i=shape[<span class="number">0</span>]//<span class="number">7</span>+<span class="number">1</span></span><br><span class="line">    cnt_j=shape[<span class="number">0</span>]//<span class="number">7</span>+<span class="number">1</span></span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt_i):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(cnt_j):</span><br><span class="line">            num=np.zeros(<span class="number">256</span>)</span><br><span class="line">            <span class="keyword">for</span> point_i <span class="keyword">in</span> <span class="built_in">range</span>(i*<span class="number">7</span>,i*<span class="number">7</span>+<span class="number">7</span>):</span><br><span class="line">                <span class="keyword">for</span> point_j <span class="keyword">in</span> <span class="built_in">range</span>(j*<span class="number">7</span>,j*<span class="number">7</span>+<span class="number">7</span>):</span><br><span class="line">                    <span class="keyword">if</span> point_i&lt;shape[<span class="number">0</span>] <span class="keyword">and</span> point_j&lt;shape[<span class="number">1</span>]:</span><br><span class="line">                        num[img[point_i][point_j][<span class="number">0</span>]]+=<span class="number">1</span></span><br><span class="line">            fre=num/np.<span class="built_in">sum</span>(num)</span><br><span class="line">            T=np.zeros((<span class="number">256</span>))</span><br><span class="line">            T[<span class="number">0</span>]=fre[<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                <span class="keyword">if</span> k:</span><br><span class="line">                    T[k]=T[k-<span class="number">1</span>]+fre[k]*<span class="number">255</span></span><br><span class="line">            <span class="keyword">for</span> point_i <span class="keyword">in</span> <span class="built_in">range</span>(i*<span class="number">7</span>,i*<span class="number">7</span>+<span class="number">7</span>):</span><br><span class="line">                <span class="keyword">for</span> point_j <span class="keyword">in</span> <span class="built_in">range</span>(j*<span class="number">7</span>,j*<span class="number">7</span>+<span class="number">7</span>):</span><br><span class="line">                    <span class="keyword">if</span> point_i&lt;shape[<span class="number">0</span>] <span class="keyword">and</span> point_j&lt;shape[<span class="number">1</span>]:</span><br><span class="line">                        result[point_i][point_j]=T[img[point_i][point_j][<span class="number">0</span>]]</span><br><span class="line">    result=result.astype(np.uint8)</span><br><span class="line">    cv.imwrite(<span class="string">&quot;trans_&quot;</span>+imname,result)</span><br><span class="line"></span><br><span class="line">trans(<span class="string">&#x27;lena.bmp&#x27;</span>)</span><br><span class="line">trans(<span class="string">&#x27;elain.bmp&#x27;</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>直方图均衡</tag>
      </tags>
  </entry>
  <entry>
    <title>数字图像处理（四）空域低通滤波器</title>
    <url>/29443507.html</url>
    <content><![CDATA[<p>低通滤波器在我们的日常生活中很有用，图像模糊，图像去噪以及图像识别都需要低通滤波器的处理。低通滤波即滤除图像中的高频部分（变化很快的部分），留下低频部分（变化不明显得到部分）。滤波器的实现有空域和频域两种：空域滤波器是直接在空间图像上进行操作，图像矩阵和滤波器算子进行卷积得到滤波后的输出；频域滤波器是将图像经过傅里叶变换到频域上再与滤波器做乘法得到输出。</p>
<span id="more"></span>
<p>这一篇文章主要介绍空域低通滤波器及其实现。</p>
<p>常用的空域滤波器有平均滤波，中值滤波和高斯滤波。这里主要介绍中值滤波和高斯滤波。</p>
<h2 id="中值滤波">中值滤波</h2>
<p>中值滤波，顾名思义，是一种基于统计方法的滤波器。具体的实现方法为：对于一个n*n的中值滤波器，输出图像的像素点(x,y)的像素值等于输入图像中以(x,y)为中心的n*n大小的图像区域中所有像素值的中位数。</p>
<p>滤波器的大小可以根据不同的需要进行选取。</p>
<p>中值滤波器得到的效果如下：</p>
<blockquote>
<p>依次分别为原图像，3*3中值滤波，5*5中值滤波，7*7中值滤波。</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/tmp.bmp">原始图片
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/test1.pgmcenter-3.bmp" >3*3中值
</center>
</td>
</tr>
</table>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/test1.pgmcenter-5.bmp">5*5中值
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/test1.pgmcenter-7.bmp">7*7中值
</center>
</td>
</tr>
</table>
<p>原图中有很多分布不规律的噪声，其中有一部分是盐噪声，但大部分是一些突然的脉冲噪声。在使用3*3的中值滤波时，盐噪声已经很好的去除掉了，但脉冲噪声依然很明显。使用5*5的中值时，脉冲噪声情况有了很大的改善。7*7的滤波器几乎完全去除了噪声，但图像的模糊也很严重。</p>
<h2 id="高斯滤波">高斯滤波</h2>
<p>高斯滤波是一些图形处理软件中经常使用的模糊方法，由二维正态分布函数：<span
class="math inline">\(p(x,y)=\frac1{2\pi\sigma^2}e^{-\frac{x^2+y^2}{2\sigma^2}}\)</span>产生，具体做法如下：</p>
<ul>
<li>若要产生n*n的高斯滤波器，将该n阶仿真的中心置为(0,0)，生成矩阵中其他位置的坐标；</li>
<li>将该n*n矩阵中的每个位置的坐标带入二维正态分布函数得到每个位置的数值；</li>
<li>以矩阵左上角置1为标准等比缩放矩阵中数值大小；</li>
<li>对矩阵进行取整得到的结果就是n*n的高斯滤波器</li>
</ul>
<blockquote>
<p>生成高斯滤波器的函数如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">sigma=<span class="number">1.5</span>   <span class="comment">#高斯滤波器的参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):     <span class="comment">#定义二维正态分布函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(math.pi*sigma**<span class="number">2</span>)*math.exp(-(x**<span class="number">2</span>+y**<span class="number">2</span>)/(<span class="number">2</span>*sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">n</span>):   <span class="comment">#生成n*n的高斯滤波器</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    filt=np.zeros((n,n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            filt[i][j]=f(i-mid,j-mid)/f(-mid,-mid)</span><br><span class="line">    <span class="keyword">return</span> filt.astype(np.uint8)</span><br></pre></td></tr></table></figure>
<p>3*3，5*5，7*7的高斯滤波器如下：</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170522.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170620.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170658.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>其在二维坐标系中的图像如下：</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170756.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170817.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170835.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
</blockquote>
<p>在得到了高斯滤波器的算子之后，使用该算子与输入图像进行卷积即可得到高斯滤波器滤波后的结果。</p>
<p>其效果如下：</p>
<blockquote>
<p>依次为原图，3*3，5*5，7*7高斯滤波的结果：</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/tmp.bmp">原始图片
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172117.bmp" >3*3高斯
</center>
</td>
</tr>
</table>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172156.bmp">5*5高斯
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172217.bmp">7*7高斯
</center>
</td>
</tr>
</table>
<p>高斯模糊对于图像中的盐噪声去除效果较好，但对于脉冲噪声的去除显得颇为吃力，7*7的高斯滤波依然无法滤除掉图像中的脉冲噪声。另一方面，高斯模糊相较于终止模糊图像的信息保留较为完全，细节保留较多。</p>
<h2 id="附录">附录</h2>
<h3 id="参考文献">参考文献</h3>
<p>[1]数字图像处理[M]：第三版/（美）拉斐尔·C·冈萨雷斯（Rafael
C.Gonzalez），（美）理查德·E·伍兹（Richard E.
Woods）著；阮秋琦等译，—北京：电子工业出版社，2017.5</p>
<p>[2]Brook_icv.图像处理基础(4)：高斯滤波器详解[G/OL].博客园: 2017-02-16
[2020-03-23].https://www.cnblogs.com/wangguchangqing/p/6407717.html#autoid-4-1-0</p>
<p>[3]予你心安.Numpy求均值、中位数、众数的方法[G/OL].博客园: 2018-11-04
[2020-03-23].https://www.cnblogs.com/lijinze-tsinghua/p/9905882.html</p>
<h3 id="源代码">源代码</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">img=cv.imread(<span class="string">&quot;test1.pgm&quot;</span>)</span><br><span class="line"></span><br><span class="line">sigma=<span class="number">1.5</span>   <span class="comment">#高斯滤波器的参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):     <span class="comment">#定义二维正态分布函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(math.pi*sigma**<span class="number">2</span>)*math.exp(-(x**<span class="number">2</span>+y**<span class="number">2</span>)/(<span class="number">2</span>*sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">n</span>):   <span class="comment">#生成n*n的高斯滤波器</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    filt=np.zeros((n,n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            filt[i][j]=f(i-mid,j-mid)/f(-mid,-mid)</span><br><span class="line">    <span class="keyword">return</span> filt.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">img,n</span>):    <span class="comment">#对图像img进行n*n卷积块的高斯滤波</span></span><br><span class="line">    filt=gauss(n)</span><br><span class="line">    con=<span class="number">1</span>/np.<span class="built_in">sum</span>(filt)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    temp=np.zeros((shape[<span class="number">0</span>]+n-<span class="number">1</span>,shape[<span class="number">1</span>]+n-<span class="number">1</span>))   <span class="comment">#对边缘进行补0操作</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            temp[i+mid][j+mid]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            tmp=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    tmp+=filt[k][l]*temp[i+k][j+l]</span><br><span class="line">            result[i][j]=con*tmp</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">center_filter</span>(<span class="params">img, n</span>):  <span class="comment">#使用n*n的中值滤波器对图像进行低通滤波</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=np.zeros((shape[<span class="number">0</span>]+n-<span class="number">1</span>,shape[<span class="number">1</span>]+n-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            temp[i+mid][j+mid]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    tmp=np.zeros(n*n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    tmp[k*n+l]=temp[i+k][j+l]</span><br><span class="line">            result[i][j]=np.median(tmp)</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line">filename=[<span class="string">&quot;test1.pgm&quot;</span>,<span class="string">&quot;test2.tif&quot;</span>]</span><br><span class="line">size=[<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> size:</span><br><span class="line">        cv.imwrite(i+<span class="string">&#x27;gauss-&#x27;</span>+<span class="built_in">str</span>(j)+<span class="string">&#x27;.bmp&#x27;</span>,gauss_filter(img,j))</span><br><span class="line">        cv.imwrite(i+<span class="string">&#x27;center-&#x27;</span>+<span class="built_in">str</span>(j)+<span class="string">&#x27;.bmp&#x27;</span>,center_filter(img,j))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>空域滤波器</tag>
      </tags>
  </entry>
  <entry>
    <title>数字图像处理（六）频域滤波器</title>
    <url>/b8e0d4a2.html</url>
    <content><![CDATA[<h2 id="频域滤波器简介">频域滤波器简介</h2>
<p>频域滤波器与空域滤波器相对，空域滤波器是空间卷积块与空间图像做卷积运算，而频域滤波是在将图像进行了离散傅里叶变换之后在频域上与滤波器做乘法，之后再进行傅里叶反变换得到滤波之后的图像。</p>
<p>使用频域滤波器对图像进行滤波的基本步骤：</p>
<ul>
<li>对图像进行DFT变换得到原图像的频域图像</li>
<li>频域图像与频域滤波器相乘得到新的频域图像</li>
<li>对新的频域图像进行IDFT变换到空域得到新图像。</li>
</ul>
<span id="more"></span>
<blockquote>
<p>在此之中有几个要注意的事项：</p>
<ul>
<li>在DFT运算的时候会将原图像在空间上进行上下左右周期延拓，如果直接对原图像进行DFT运算，则会以原图像四周都是原图像进行计算得到DFT的结果。因此，如果要消除图像的边缘相互影响滤波后的结果，可以将图像变换到原图的四倍大小，将原图像放在四倍图像的左上角，其余地方补零。</li>
<li>为了方便计算，一般将频域图像的原点（即（0,0））放在图像中心，而对图像直接进行DFT得到的频域图像的（0,0）点在图像的四个角，为了移动频域图像的（0,0,）点，在DFT之前对空域图像的每个像素点乘上<span
class="math inline">\((-1)^{i+j}\)</span>即可（<span
class="math inline">\(i,j\)</span>分别为以图像左上角为原点，向右向下为正方向的横纵坐标）。当然，在变换时做了此运算，在反变换之后要记得还原。</li>
</ul>
</blockquote>
<p>对图像进行补零DFT并变换中心的函数如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fft</span>(<span class="params">img</span>):       <span class="comment">#对图像做二维快速傅里叶变换</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    new_img=np.zeros((shape[<span class="number">0</span>]*<span class="number">2</span>,shape[<span class="number">1</span>]*<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            new_img[i][j]=img[i][j]*(-<span class="number">1</span>)**(i+j)</span><br><span class="line">    fimg=np.fft.fft2(new_img)</span><br><span class="line">    <span class="keyword">return</span> fimg</span><br></pre></td></tr></table></figure>
<p>将频域图像做相应的反变换的函数如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ifft</span>(<span class="params">f_img</span>):    <span class="comment">#二维傅里叶反变换</span></span><br><span class="line">    img=np.real(np.fft.ifft2(f_img))</span><br><span class="line">    shape=img.shape</span><br><span class="line">    new_img=np.zeros((shape[<span class="number">0</span>]//<span class="number">2</span>,shape[<span class="number">1</span>]//<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]//<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]//<span class="number">2</span>):</span><br><span class="line">            new_img[i][j]=img[i][j]*(-<span class="number">1</span>)**(i+j)</span><br><span class="line">    new_img=new_img-np.<span class="built_in">min</span>(new_img)</span><br><span class="line">    new_img=new_img/np.<span class="built_in">max</span>(new_img)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> new_img.astype(np.uint8)</span><br></pre></td></tr></table></figure>
<h2 id="频域低通滤波器">频域低通滤波器</h2>
<p>低通滤波器顾名思义，即为通低频，阻高频。如果把频域原点放在图像中心，则理想的低通滤波器的图像为：</p>
<p><img src="https://download.kezhi.tech/img/20200508194306.bmp" /></p>
<p>但是这种滤波器由于在边界处不连续，一是无法使用物理器件实现，而来即使在计算机上进行仿真也会对图像有一些影响。因此一般不使用这种理想的滤波器</p>
<h3 id="高斯低通滤波器">高斯低通滤波器</h3>
<p>高斯低通滤波器（GLPF）是最常使用的高通滤波器之一，其生成为二维高斯函数，数学表达式为：
<span class="math display">\[
H(u,v)=e^{-D^2(u,v)/2D_0 ^2}
\]</span> 其中，<span
class="math inline">\(D(u,v)\)</span>为图像中的点到图像中心的距离，<span
class="math inline">\(D_0\)</span>为截止频率，当<span
class="math inline">\(D(u,v)=D_0\)</span>时，GLPF下降到其最大值的0.607处。该滤波器使用图像表示出来为（截止频率分别为10,30,60）：</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508195417.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508195511.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508195551.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>生成高斯滤波器的函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">shape,D0</span>):    <span class="comment">#生成截止频率为D0的高斯低通滤波器</span></span><br><span class="line">    filt=np.zeros(shape)</span><br><span class="line">    P,Q=shape[<span class="number">0</span>],shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D2=(i-P//<span class="number">2</span>)**<span class="number">2</span>+(j-Q//<span class="number">2</span>)**<span class="number">2</span></span><br><span class="line">            filt[i][j]=math.exp(-D2/(<span class="number">2</span>*D0**<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>使用高斯低通滤波器的图像滤波效果如下（分别为原图，半径为10,20的高斯滤波）：</p>
<table>
<tr>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195837.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195909.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195923.jpg?x-oss-process=style/webp"></cneter>
</td>
</tr>
</table>
<p>使用高斯滤波器对图像进行滤波的函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gaussian</span>(<span class="params">img,D0</span>):  <span class="comment">#使用n阶，截止频率为D0的高斯低通滤波器对图像进行滤波</span></span><br><span class="line">    f_img=fft(img)</span><br><span class="line">    shape=f_img.shape</span><br><span class="line">    f_result=f_img*gauss_filter(shape,D0)</span><br><span class="line">    <span class="keyword">return</span> ifft(f_result)</span><br></pre></td></tr></table></figure>
<h3 id="巴特沃斯低通滤波器">巴特沃斯低通滤波器</h3>
<p>截止频率位于距原点<span class="math inline">\(D_0\)</span>处的<span
class="math inline">\(n\)</span>阶巴特沃斯低通滤波器（BLPF）的传递函数定义为：
<span class="math display">\[
H(u,v)=\frac 1{1+[D(u,v)/D_0]^{2n}}
\]</span> 巴特沃斯滤波器用图像表示出来为（n=1,2,5）：</p>
<table>
<tr>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508203825.bmp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508203838.bmp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508203853.bmp"></cneter>
</td>
</tr>
</table>
<p>生成巴特沃斯低通滤波器的函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">butter_filter</span>(<span class="params">shape,n,D0</span>):   <span class="comment">#生成n阶，半径为D0的butterworth低通滤波器</span></span><br><span class="line">    filt=np.zeros(shape)</span><br><span class="line">    P,Q=shape[<span class="number">0</span>],shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D=math.sqrt((i-P//<span class="number">2</span>)**<span class="number">2</span>+(j-Q//<span class="number">2</span>)**<span class="number">2</span>)</span><br><span class="line">            filt[i][j]=<span class="number">1</span>/(<span class="number">1</span>+(D/D0)**(<span class="number">2</span>*n))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>其滤波效果如下（原图，使用3阶半径分别为10,20的滤波器）</p>
<table>
<tr>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195837.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508204916.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508204931.jpg?x-oss-process=style/webp"></cneter>
</td>
</tr>
</table>
<p>使用巴特沃斯低通滤波器对图像进行滤波的函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">butterwroth</span>(<span class="params">img,n,D0</span>):  <span class="comment">#使用n阶，半径为D0的butterworth滤波器对图像进行滤波</span></span><br><span class="line">    f_img=fft(img)</span><br><span class="line">    shape=f_img.shape</span><br><span class="line">    f_result=f_img*butter_filter(shape,n,D0)</span><br><span class="line">    <span class="keyword">return</span> ifft(f_result)</span><br></pre></td></tr></table></figure>
<h2 id="频域高通滤波器">频域高通滤波器</h2>
<p>与低通滤波器相对，其作用为阻低频，通高频，理想高通滤波器在图像上的表示为：</p>
<p><img src="https://download.kezhi.tech/img/20200508205640.bmp" /></p>
<h3 id="高斯高通滤波器">高斯高通滤波器</h3>
<p>截止频率为<span
class="math inline">\(D_0\)</span>的高斯高通滤波器（GHPF）的定义为：
<span class="math display">\[
H(u,v)=1-e^{-D^2(u,v)/2D_0 ^2}
\]</span>
该滤波器在图像上表示出来为（图像大小为200*200，截止频率为5,10,30）：</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210105.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210119.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210127.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>生成该滤波器的函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">shape,D0</span>):    <span class="comment">#生成n阶，滤波半径为D0的高斯高通滤波器</span></span><br><span class="line">    filt=np.zeros(shape)</span><br><span class="line">    P,Q=shape[<span class="number">0</span>],shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D2=(i-P//<span class="number">2</span>)**<span class="number">2</span>+(j-Q//<span class="number">2</span>)**<span class="number">2</span></span><br><span class="line">            filt[i][j]=<span class="number">1</span>-math.exp(-D2/(<span class="number">2</span>*D0**<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>经过该滤波器滤波之后的效果（依次为原图，半径为10,30的高斯高通滤波后增强）：</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210619.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210648.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210700.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h3 id="巴特沃斯高通滤波器">巴特沃斯高通滤波器</h3>
<p>阶数为<span class="math inline">\(n\)</span>，截止频率为<span
class="math inline">\(D_0\)</span>的巴特沃斯高通滤波器的定义为： <span
class="math display">\[
H(u,v)=\frac 1{1+[D_0/D(u,v)]^{2n}}
\]</span>
该滤波器在图像上表示出来为（图像大小为200*200，截止频率为10，阶数为1,2,4）</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211205.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211217.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211330.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>生成该滤波器的函数为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">butter_filter</span>(<span class="params">shape,n,D0</span>):   <span class="comment">#生成n阶，半径为D0的butterworth高通滤波器</span></span><br><span class="line">    filt=np.zeros(shape)</span><br><span class="line">    P,Q=shape[<span class="number">0</span>],shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D=math.sqrt((i-P//<span class="number">2</span>)**<span class="number">2</span>+(j-Q//<span class="number">2</span>)**<span class="number">2</span>)+<span class="number">0.01</span></span><br><span class="line">            filt[i][j]=<span class="number">1</span>/(<span class="number">1</span>+(D0/D)**(<span class="number">2</span>*n))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>使用该滤波器对图像进行滤波的效果如下（依次为原图，使用3阶，半径分别为10,30的BHPF进行滤波）：</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210619.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211615.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211630.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h2 id="参考文献">参考文献</h2>
<p>[1]数字图像处理[M]：第三版/（美）拉斐尔·C·冈萨雷斯（Rafael
C.Gonzalez），（美）理查德·E·伍兹（Richard E.
Woods）著；阮秋琦等译，—北京：电子工业出版社，2017.5</p>
<p>[2]
lcxxcl_1234.numpy中的fft和scipy中的fft，fftshift以及fftfreq[G/OL].CSDN:
2018-07-02
[2020-04-05].https://blog.csdn.net/lcxxcl_1234/article/details/80889783</p>
<p>[3] 方克明.功率谱和频谱的区别[G/OL].CSDN: 2017-08-10
[2020-04-06].https://blog.csdn.net/godloveyuxu/article/details/77030793</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>滤波器</tag>
        <tag>频域</tag>
      </tags>
  </entry>
  <entry>
    <title>来选头像</title>
    <url>/ca112d32.html</url>
    <content><![CDATA[<iframe src="//kezhi.tech/avatar/" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<span id="more"></span>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a href="https://www.pixiv.net/users/6657532">#原神 原神头像 -
QuAn_的插画 - pixiv</a></li>
</ol>
]]></content>
      <categories>
        <category>Collection</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>浅谈信任</title>
    <url>/190fc18.html</url>
    <content><![CDATA[<p>不得不说，信任是十分珍贵且稀少的一样东西。其珍贵和稀少的原因很简单——怀疑是很容易的。</p>
<p><img src="https://download.kezhi.tech/img/202403251731371.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<p>本文对信任的定义采取一种简单且直观的方式：对于任意两个人 A 和 B，A
相信 B 会/不会做某件/某种事情。为简化后文的讨论，我们选用
<code>A 相信 B 不会做某件事</code> 进行分析，其他情形类同。</p>
<p>此外，我们添加如下假设：</p>
<ol type="1">
<li>B 做某件事会对 A 造成较为严重的负面影响</li>
<li>A 很难直接确认 B 是否做了某件事</li>
<li>A 无法判断 B 向其做的表述是否符合事实</li>
<li>A 无法获取充足的信息来判断 B 是否有动机做某件事</li>
</ol>
<p>以上三条假设看似很难达成，但在现实中有太多类似的事情满足以上条件（例如：出轨，出卖，泄密，PUA，具有误导性的意见等）</p>
<p>在以上条件下，我们可以作出以下推论：</p>
<p>若 B 做了该事件，则：</p>
<ul>
<li>A 会受到客观上的伤害</li>
<li>若 A 信任 B，则不会受到主观上对信任的伤害；若 A 怀疑 B 且最终认为 B
做了某事，则会受到主观上对信任的伤害</li>
<li>若 A 怀疑 B 并向 B 进行质问，则 B：
<ul>
<li>承认做过某事，导致信任关系破裂 or 岌岌可危</li>
<li>不承认做过某事，则 A 对 B 的信任最终取决于 A 的主观推断</li>
</ul></li>
</ul>
<p>若 B 没做该事件，则：</p>
<ul>
<li>A 不会受到客观上的伤害</li>
<li>若 A 信任 B，则不会受到主观上对信任的伤害；若 A 怀疑 B 且最终认为 B
做了某事，则会受到主观上对信任的伤害</li>
<li>若 A 怀疑 B 并向 B 进行质问，则 B：
<ul>
<li>不承认做过某事，则 A 对 B 的信任最终取决于 A 的主观推断</li>
</ul></li>
</ul>
<p>从上述推论可知，不论 B 是否做了某件事，除了 B 向 A
承认之外，其余情况下，A 对 B 的信任主要取决于 A
最终的主观推断。由上述推论可以回归到两句俗语上：</p>
<ul>
<li>用人不疑，疑人不用</li>
<li>论迹不论心，论心无完人</li>
</ul>
<p>尽管如此，世界上还是存在可持续的无条件的信任的。如果你拥有这样的信任，那么珍惜它并且维护好它。然而即便没有，那也很正常不必烦忧，因为我们与人生中大部分人打交道其实不需要信任也是ok的。所以，去他妈的信任！</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
  </entry>
  <entry>
    <title>炼丹工业化——mlflow使用简介</title>
    <url>/b01892d.html</url>
    <content><![CDATA[<p>丹药管理是炼丹术中很重要的部分。毕竟，当一批一批的丹药通过不同的材料和火候炼制出来之后，我们总是会产生如下需求：</p>
<ul>
<li>对丹药效果进行评估，筛选出好的丹药</li>
<li>将一批丹药的效果进行对比，从而发现好的材料配比（超参数）</li>
<li>发现了一颗效果好的丹药，想要复现这颗丹药的生产过程</li>
<li>......</li>
</ul>
<p><img src="https://download.kezhi.tech/img/202403212027204.png?x-oss-process=style/webp" style="width:67%;" /></p>
<p>为了实现以上需求，我们便需要炼丹管理技术，简单来说，就是要在
<code>代码</code>，<code>超参数</code>，<code>模型</code>之间建立映射关系并对齐进行存储，以便支持后续的分析以及训练过程的回溯。由此，诞生了很多机器学习全生命周期管理软件，本文主要介绍一款开源软件：<code>MLflow</code>
的简单使用流程</p>
<span id="more"></span>
<h2 id="安装">安装</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install mlflow</span><br></pre></td></tr></table></figure>
<h2 id="管理面板">管理面板</h2>
<p>启动管理面板：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow ui --host=127.0.0.1 --port 8000 </span><br></pre></td></tr></table></figure>
<p>管理面板的页面结构很简单，自行摸索即可。</p>
<p>这里主要说一下数据集中存储的方案。在多台机器跑同一个实验时，通常采用的方案是把所有的
<code>log</code> download
到一台机器上进行比较。这样手动管理十分繁杂且容易出错。<code>mlflow</code>
采用的是 <code>client-server</code>
结构，因此可以用一台机器作为服务器，其他机器在跑实验时通过访问
<code>uri</code>
将数据推送到服务器端，最后统一在服务器端进行查看比较即可。</p>
<p>一种实现思路是在一台服务器上部署 <code>mlflow</code> 并开放访问：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow ui --host=0.0.0.0 --port 8000 </span><br></pre></td></tr></table></figure>
<p>假设这台机器的 <code>ip</code> 为 <code>192.168.1.12</code></p>
<p>那么对其他机器上的 <code>uri</code> 进行对应修改即可：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mlflow.set_tracking_uri(uri=<span class="string">&quot;http://192.168.1.12:8000&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>此外也可以加入权限认证：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow server --app-name basic-auth</span><br></pre></td></tr></table></figure>
<p>关于权限认证更详细的内容见 <a
href="https://www.mlflow.org/docs/latest/auth/index.html#">MLflow
Authentication — MLflow 2.11.2 documentation</a></p>
<h2 id="mlflow-结构简介">MLflow 结构简介</h2>
<p>MLflow 主要分为以下几个模块</p>
<ul>
<li><p>MLflow
Tracking：用来记录实验的<code>logging</code>信息，包括<code>parameters</code>，<code>metric</code>等</p></li>
<li><p>System
Metrics：记录程序运行过程中的系统状态（CPU占用，内存占用，...）</p></li>
<li><p>MLflow Models：保存训练出来的模型</p></li>
<li><p>MLflow Model
Registry：模型登记，用于对训练出的模型进行管理</p></li>
<li><p>MLflow
Projects：项目管理模块，通过记录运行环境和程序入口，来实现</p></li>
<li><p>MLflow Plugins：支持第三方插件</p></li>
</ul>
<h2 id="mlflow-使用说明">MLflow 使用说明</h2>
<p>MLflow 的使用可以支持机器学习项目的整个生命流程，如下图所示</p>
<p><img
src="https://download.kezhi.tech/img/202403211850657.png?x-oss-process=style/webp" /><a
href="https://mlflow.org/docs/latest/introduction/index.html">What is
MLflow? — MLflow 2.11.2 documentation</a></p>
<p>下面对 <code>MLflow</code>的各个部分使用逐一进行简单介绍</p>
<h3 id="mlflow-tracking">MLflow Tracking</h3>
<p>Tracking 的主要作用类似于
<code>tensorboard</code>，即对训练的超参数和过程数据进行记录，使用如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set our tracking server uri for logging</span></span><br><span class="line">mlflow.set_tracking_uri(uri=<span class="string">&quot;http://127.0.0.1:8000&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new MLflow Experiment</span></span><br><span class="line">mlflow.set_experiment(<span class="string">&quot;MLflow Quickstart&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> mlflow.start_run():</span><br><span class="line">    <span class="comment"># log parameters</span></span><br><span class="line">    mlflow.log_param(<span class="string">&quot;lr&quot;</span>, <span class="number">0.001</span>)</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;epoch&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;hidden_size&quot;</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">&quot;is_truncated&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    mlflow:log_params(params)</span><br><span class="line">    <span class="comment"># Your ml code</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># log metric</span></span><br><span class="line">    mlflow.log_metric(<span class="string">&quot;val_loss&quot;</span>, val_loss, step)</span><br><span class="line">    metric = &#123;</span><br><span class="line">        <span class="string">&quot;policy_loss&quot;</span>: policy_loss,</span><br><span class="line">        <span class="string">&quot;critic_loss&quot;</span>: critic_loss,</span><br><span class="line">    &#125;</span><br><span class="line">    mlflow.log_metrics(metric, step)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><code>mlflow.set_tracking_uri</code> 指定了 <code>mlflow</code>
数据存放的位置，不指定则默认为本地文件夹下存储</li>
<li><code>mlflow.set_experiment</code> 定义实验名称，可以认为与
<code>project</code> 对应，同一个 <code>project</code>
的不同算法版本以及不同的超参数选取应使用同一个实验名称</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_param"><code>mlflow.log_param</code></a>：记录某个超参数</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_params"><code>mlflow.log_parame</code></a>：记录多个超参数，通过字典传入</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_metric"><code>mlflow.log_metric</code></a>：记录某个过程指标</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_metrics"><code>mlflow.log_metrics</code></a>：记录多个过程指标，通过字典传入</li>
</ul>
<p>此外，还有很多其他的函数来实现诸如：记录
image，记录<code>matplotlib</code>绘制的
figure，记录文件等，这里便不逐一列举了，可以参考官方文档：<a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_artifact">mlflow
— MLflow 2.11.2 documentation</a></p>
<h4 id="auto-logging">Auto Logging</h4>
<p>此外，<code>MLflow</code>
也支持对过程数据自动进行追踪，使用方法如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"></span><br><span class="line">mlflow.autolog()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Your training code...</span></span><br></pre></td></tr></table></figure>
<p>自动追踪记录会对哪些数据记录我还没有尝试过，这里放一张官方文档的示意图：</p>
<p><img
src="https://download.kezhi.tech/img/202403211923270.png?x-oss-process=style/webp" /></p>
<p><a
href="https://mlflow.org/docs/latest/getting-started/index.html">Getting
Started with MLflow — MLflow 2.11.2 documentation</a></p>
<p>关于 Auto Logging 的进一步说明可以参考：<a
href="https://mlflow.org/docs/latest/tracking/autolog.html">Automatic
Logging with MLflow Tracking — MLflow 2.11.2 documentation</a></p>
<h3 id="system-metrics">System Metrics</h3>
<p>System Metrics
模块用来监控在训练过程中的各项系统状态指标，使用方法如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable automatic logging of system metrics (e.g., CPU and memory usage)</span></span><br><span class="line">mlflow.enable_system_metrics_logging()</span><br><span class="line"><span class="comment"># Set the sampling interval for system metrics to 1 second</span></span><br><span class="line">mlflow.set_system_metrics_sampling_interval(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>系统监控在默认情况下是不打开的，如需记录则执行以上代码即可</p>
<h3 id="mlflow-models">MLflow Models</h3>
<p>MLflow Models
模块主要用于存储代码训练产生的模型，对于不同的深度学习库该模块有不同的实现，以
<code>pytorch</code> 为例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"><span class="keyword">from</span> mlflow.models <span class="keyword">import</span> infer_signature</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net = nn.Linear(<span class="number">6</span>, <span class="number">1</span>)</span><br><span class="line">loss_function = nn.L1Loss()</span><br><span class="line">optimizer = torch.optim.Adam(net.parameters(), lr=<span class="number">1e-4</span>)</span><br><span class="line"></span><br><span class="line">X = torch.randn(<span class="number">6</span>)</span><br><span class="line">y = torch.randn(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">epochs = <span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    outputs = net(X)</span><br><span class="line"></span><br><span class="line">    loss = loss_function(outputs, y)</span><br><span class="line">    loss.backward()</span><br><span class="line"></span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> mlflow.start_run() <span class="keyword">as</span> run:</span><br><span class="line">    signature = infer_signature(X.numpy(), net(X).detach().numpy())</span><br><span class="line">    model_info = mlflow.pytorch.log_model(net, <span class="string">&quot;model&quot;</span>, signature=signature)</span><br><span class="line"></span><br><span class="line">pytorch_pyfunc = mlflow.pyfunc.load_model(model_uri=model_info.model_uri)</span><br><span class="line"><span class="comment"># model_uri 可以在 ui 面板里找到</span></span><br><span class="line">predictions = pytorch_pyfunc.predict(torch.randn(<span class="number">6</span>).numpy())</span><br><span class="line"><span class="built_in">print</span>(predictions)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>更详细的内容见：<a
href="https://mlflow.org/docs/latest/models.html">MLflow Models — MLflow
2.11.2 documentation</a></p>
<h3 id="mlflow-model-registry">MLflow Model Registry</h3>
<p>Model Registry 的功能简单来说就是对生产出的模型进行版本管理，在 ui
面板上操作即可。具体流程见 <a
href="https://mlflow.org/docs/latest/model-registry.html">MLflow Model
Registry — MLflow 2.11.2 documentation</a></p>
<h3 id="mlflow-projects">MLflow Projects</h3>
<p>MLflow Projects
通过一个配置文件来记录代码运行环境以及程序入口，从而便于对程序进行分发。</p>
<p>其主要结构包含三部分内容：</p>
<ul>
<li>Name：项目名称</li>
<li>Entry Points：程序入口，可以带参，并且可以使用多个入口组成
pipeline</li>
<li>Environment：运行环境配置，支持
<code>conda</code>，<code>Vitrualenv</code> 以及
<code>Docker</code></li>
</ul>
<p>在项目的根目录新建
<code>MLproject</code>，并向其中写入配置，例如：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">My</span> <span class="string">Project</span></span><br><span class="line"></span><br><span class="line"><span class="attr">python_env:</span> <span class="string">python_env.yaml</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="comment"># conda_env: my_env.yaml</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="comment"># docker_env:</span></span><br><span class="line"><span class="comment">#    image:  mlflow-docker-example</span></span><br><span class="line"></span><br><span class="line"><span class="attr">entry_points:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="attr">data_file:</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">regularization:</span> &#123;<span class="attr">type:</span> <span class="string">float</span>, <span class="attr">default:</span> <span class="number">0.1</span>&#125;</span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;python train.py -r &#123;regularization&#125; &#123;data_file&#125;&quot;</span></span><br><span class="line">  <span class="attr">validate:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="attr">data_file:</span> <span class="string">path</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;python validate.py &#123;data_file&#125;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>仿照上面的例子创建好配置文件后，便可以使用 <code>mlflow</code>
来自动运行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow run /path/to/project --env-manager=conda</span><br></pre></td></tr></table></figure>
<p>此外，也可以指定 <code>Github</code> 仓库来运行项目：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow run git@github.com:mlflow/mlflow-example.git -P alpha=0.5</span><br></pre></td></tr></table></figure>
<p>对于 <code>mlflow run</code> 的更多信息可以使用
<code>mlflow run --help</code> 来进行查看。</p>
<p>关于 <code>MLflow Project</code> 更详细的说明见 <a
href="https://mlflow.org/docs/latest/projects.html#overview">MLflow
Projects — MLflow 2.11.2 documentation</a></p>
<h3 id="mlflow-plugins">MLflow Plugins</h3>
<p>MLflow
是一个开源项目，并且支持各种各样的插件，各位也可以开发相应的插件来满足自己的个性化需求。关于插件的开发，安装，以及当前社区流行的插件见
<a href="https://mlflow.org/docs/latest/plugins.html">MLflow Plugins —
MLflow 2.11.2 documentation</a></p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>deep learning</tag>
        <tag>mlflow</tag>
      </tags>
  </entry>
  <entry>
    <title>爬取B站所有番剧数据并进行数据分析</title>
    <url>/6b2dc3cb.html</url>
    <content><![CDATA[<h2 id="简介">简介</h2>
<p>Bilibili（以下简称B站）中有大量的番剧版权，截止目前一共有3161部。每一部番剧都可以找到它的<mark class="label primary">播放量</mark>，<mark class="label success">追番量</mark>，<mark class="label info">弹幕数量</mark>等播放数据，除此之外，每部番剧还有其相应的标签（如“漫画改”，“热血”，“搞笑”）。本项目旨在分析番剧播放数据与番剧标签之间的关系，同时也是一项数据分析的大作业，采用APriori频繁项集挖掘进行分析。</p>
<p>GitHub地址：<a
href="https://github.com/KezhiAdore/BilibiliAnimeData_Analysis">https://github.com/KezhiAdore/BilibiliAnimeData_Analysis</a></p>
<p>码云地址：<a
href="https://gitee.com/KezhiAdore/BilibiliAnimeData_Analysis">https://gitee.com/KezhiAdore/BilibiliAnimeData_Analysis</a></p>
<span id="more"></span>
<h2 id="数据收集">数据收集</h2>
<p>首先要获取到需要的所有数据，即B站所有番剧播放信息和标签信息。使用爬虫对数据进行爬取，这里使用的是python的<code>scrapy</code>编写爬虫对数据进行爬取。</p>
<h3 id="页面分析">页面分析</h3>
<p>首先来到番剧索引页面<img
src="https://download.kezhi.tech/img/20201014232024.png?x-oss-process=style/webp" /></p>
<p>从该页面点击某部番剧进入其详情页</p>
<p><img
src="https://download.kezhi.tech/img/20201014232257.png?x-oss-process=style/webp" /></p>
<p>可以看到该页面中就有需要的番剧播放数据以及番剧的标签。</p>
<p>对该页面的HTML进行分析得到数据所在的xpath路径，以tag为例：</p>
<p><img
src="https://download.kezhi.tech/img/20201014232605.png?x-oss-process=style/webp" /></p>
<p>所有数据对应的xpath路径分别为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">标签: //span[@class=&quot;media-tag&quot;]</span><br><span class="line">总播放: //span[@class=&quot;media-info-count-item media-info-count-item-play&quot;]/em</span><br><span class="line">追番人数: //span[@class=&quot;media-info-count-item media-info-count-item-fans&quot;]/em</span><br><span class="line">弹幕总数: //span[@class=&quot;media-info-count-item media-info-count-item-review&quot;]/em</span><br></pre></td></tr></table></figure>
<p>那么到现在来说循环进入所有的番剧列表页，从该页面进入番剧详情页并对每个番剧详情页进行解析，数据保存就可以了，但此时出现了问题。对番剧列表页进行爬取之后的网页数据相应的地方为：</p>
<p><img
src="https://download.kezhi.tech/img/20201014233531.png?x-oss-process=style/webp" /></p>
<p>直接对该页面进行访问无法获取到详细的番剧列表信息。由此，转而对页面接受到的文件进行分析，找到了该页面获取的番剧列表信息文件。</p>
<p><img
src="https://download.kezhi.tech/img/20201014235022.png?x-oss-process=style/webp" /></p>
<p>访问该url得到的信息为：</p>
<p><img
src="https://download.kezhi.tech/img/20201014235127.png?x-oss-process=style/webp" /></p>
<p>对该api网址进行分析，易得<code>page=1</code>控制着页数信息，通过改变该信息即可访问不同的番剧列表页面。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://api.bilibili.com/pgc/season/index/result?season_version=-1&amp;area=-1&amp;is_finish=-1&amp;copyright=-1&amp;season_status=-1&amp;season_month=-1&amp;year=-1&amp;style_id=-1&amp;order=3&amp;st=1&amp;sort=0&amp;page=1&amp;season_type=1&amp;pagesize=20&amp;type=1</span><br></pre></td></tr></table></figure>
<p>该页面获取到的信息为json文件，内含信息格式如下：</p>
<p><img
src="https://download.kezhi.tech/img/20201014235500.png?x-oss-process=style/webp" /></p>
<p>与番剧详情页的网址<a
href="https://www.bilibili.com/bangumi/media/md22718131">https://www.bilibili.com/bangumi/media/md22718131</a>进行比对可以发现，json文件中的<code>media_id</code>数据即为每个番剧详情页的标识，由此，爬取信息的逻辑基本建立了。</p>
<ol type="1">
<li>访问起始api页面（page=1），对其内容进行解析，获取到该页所有番剧的<code>media_id</code></li>
<li>利用<code>media_id</code>构建访问番剧详情页的链接，爬取该页面进行解析，得到一个番剧的数据</li>
<li>访问下一个api页面，再次进行上述操作。</li>
</ol>
<h3 id="爬虫构建">爬虫构建</h3>
<p>首先初始化爬虫</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy startproject anime_data</span><br><span class="line">scrapy genspider anime &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>文件树如下</p>
<p><img
src="https://download.kezhi.tech/img/20201015000820.png?x-oss-process=style/webp" /></p>
<p>打开<code>items.py</code>，建立需要保存的数据对象</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimeDataItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    name = scrapy.Field()   <span class="comment">#番剧名称</span></span><br><span class="line">    play=scrapy.Field()     <span class="comment">#总播放量</span></span><br><span class="line">    fllow=scrapy.Field()    <span class="comment">#追番人数</span></span><br><span class="line">    barrage=scrapy.Field()  <span class="comment">#弹幕数量</span></span><br><span class="line">    tags=scrapy.Field()     <span class="comment">#番剧标签，列表形式</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>再打开刚建立的<code>anime.py</code>，访问页面，解析以及数据保存的代码如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> anime_data.items <span class="keyword">import</span> AnimeDataItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimeSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;anime&#x27;</span></span><br><span class="line">    <span class="comment">#allowed_domains = [&#x27;https://www.bilibili.com&#x27;]</span></span><br><span class="line">    <span class="comment">#番剧信息表api</span></span><br><span class="line">    url_head=<span class="string">&quot;https://api.bilibili.com/pgc/season/index/result?season_version=-1&amp;area=-1&amp;is_finish=-1&amp;copyright=-1&amp;season_status=-1&amp;season_month=-1&amp;year=-1&amp;style_id=-1&amp;order=3&amp;st=1&amp;sort=0&amp;season_type=1&amp;pagesize=20&amp;type=1&quot;</span></span><br><span class="line">    start_urls = [url_head+<span class="string">&quot;&amp;page=1&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 递归解析番剧信息表</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        data=json.loads(response.text)</span><br><span class="line">        next_index=<span class="built_in">int</span>(response.url[response.url.rfind(<span class="string">&quot;=&quot;</span>)+<span class="number">1</span>:])+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]==<span class="number">20</span>:</span><br><span class="line">            next_url=self.url_head+<span class="string">&quot;&amp;page=&quot;</span>+<span class="built_in">str</span>(next_index)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(next_url,callback=self.parse)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">            media_id=i[<span class="string">&#x27;media_id&#x27;</span>]</span><br><span class="line">            detail_url=(<span class="string">&quot;https://www.bilibili.com/bangumi/media/md&quot;</span>+<span class="built_in">str</span>(media_id))</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(detail_url,callback=self.parse_detail)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 解析番剧详情页面</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">self,response</span>):</span><br><span class="line">        item=AnimeDataItem()</span><br><span class="line">        <span class="comment">#番剧名称</span></span><br><span class="line">        item[<span class="string">&#x27;name&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-title-t&quot;]/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#播放量</span></span><br><span class="line">        item[<span class="string">&#x27;play&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-count-item media-info-count-item-play&quot;]/em/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#追番数</span></span><br><span class="line">        item[<span class="string">&#x27;fllow&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-count-item media-info-count-item-fans&quot;]/em/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#弹幕数</span></span><br><span class="line">        item[<span class="string">&#x27;barrage&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-count-item media-info-count-item-review&quot;]/em/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#番剧标签</span></span><br><span class="line">        item[<span class="string">&#x27;tags&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-tag&quot;]/text()&#x27;</span>).extract()</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<h2 id="数据分析">数据分析</h2>
<h3 id="数据整理及筛选">数据整理及筛选</h3>
<p>收集到的数据不能直接进行使用，需要对其进行整理和筛选分为两个工作：</p>
<ol type="1">
<li>去掉没有tag信息的数据</li>
<li>将数据中的数量信息转化为数字（如<code>1万</code>转化为<code>10000</code>）</li>
</ol>
<p>第一步因为数据量不大，直接使用<code>excel</code>的筛选功能就可以快速完成。</p>
<p>第二步编写如下函数对数据进行转换：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#文字数据转化为数字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="keyword">if</span> string[-<span class="number">1</span>]==<span class="string">&#x27;万&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">float</span>(string[<span class="number">0</span>:-<span class="number">1</span>])*<span class="number">1e4</span>)</span><br><span class="line">    <span class="keyword">elif</span> string[-<span class="number">1</span>]==<span class="string">&#x27;亿&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">float</span>(string[<span class="number">0</span>:-<span class="number">1</span>])*<span class="number">1e8</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(string)</span><br></pre></td></tr></table></figure>
<h3 id="apriori算法进行频繁项集挖掘">Apriori算法进行频繁项集挖掘</h3>
<blockquote>
<ol type="1">
<li>项集和数据集</li>
</ol>
<p>设数据中出现的所有项的集合为<span
class="math inline">\(U=\left\{I_1,I_2,...,I_n\right\}\)</span>，需要挖掘频繁项集的数据<span
class="math inline">\(D\)</span>为数据库中事务的集合。<span
class="math inline">\(D\)</span>中的数据为项集，并且每个项集<span
class="math inline">\(T\subseteq U\)</span>。</p>
<ol start="2" type="1">
<li>关联规则（支持度和置信度）</li>
</ol>
<p>设<span class="math inline">\(A\)</span>和<span
class="math inline">\(B\)</span>是两个项集，<span
class="math inline">\(A\subset U,B\subset U, A\neq \emptyset，B\neq
\emptyset，A\cap B=\emptyset\)</span>。</p>
<p>关联规则是形如<span class="math inline">\(A\Rightarrow
B\)</span>的蕴含式，其在事物集<span
class="math inline">\(D\)</span>中的<strong>支持度</strong>为<span
class="math inline">\(s\)</span>，其中<span
class="math inline">\(s\)</span>为事务集<span
class="math inline">\(D\)</span>中包含<span class="math inline">\(A\cup
B\)</span>的百分比。</p>
<p>其在事物集D中的<strong>置信度</strong>为<span
class="math inline">\(c\)</span>，为在事物集D中包含A的事物中包含B的百分比，即<span
class="math inline">\(P(A|B)\)</span>。 <span class="math display">\[
c=P(B|A)=\frac{P(A\cup B)}{P(A)}=\frac{support(A\cup
B)}{support(A)}=\frac{support\text{_}count(A\cup
B)}{support\text{_}count(A)}
\]</span></p>
<ol start="3" type="1">
<li>频繁项集</li>
</ol>
<p>在进行频繁项集挖掘时，设定最小置信度和最小支持度，称同时满足最小支持度和最小置信度的规则称为强规则，满足这种强规则的项集称为频繁项集。</p>
</blockquote>
<h4 id="关联规则">关联规则</h4>
<p>每个番剧都有一定数量的<code>tag</code>来大致描述其内容，用来描述同一部番剧的<code>tag</code>通常是处于不同维度的描述，以《小林家的龙女仆》为例，其<code>tag</code>为<code>[萌系 搞笑 日常 漫画改]</code>，四个<code>tag</code>分别描述了该动画的四个不同的特征。通过对B站上所有的番剧<code>tag</code>数据进行分析，找出其中相关度最高的<code>tag</code>组合。</p>
<h4 id="算法流程">算法流程</h4>
<p>数据集：所有番剧的<code>tag</code>数据集，每一条数据为一部番剧的<code>tag</code></p>
<p>Aprior算法的流程如下：</p>
<ol type="1">
<li><p>构造1项集-&gt;统计1项集出现频数-&gt;计算支持度和置信度-&gt;剪枝-&gt;频繁1项集</p></li>
<li><p>通过k-1项集构造k项集-&gt;统计k项集出现频数-&gt;计算支持度和置信度-&gt;剪枝-&gt;频繁k项集</p></li>
<li><p>重复第2步直到没有项集符合强规则</p></li>
</ol>
<h4 id="编程实现">编程实现</h4>
<p>首先，将处理后的数据读入，从所有数据中单独取出<code>tag</code>数据转成<code>list</code>类型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">filepath=<span class="string">&#x27;data_processed.csv&#x27;</span></span><br><span class="line">df=pd.read_csv(filepath)</span><br><span class="line">tags=df[<span class="string">&#x27;tags&#x27;</span>].to_list()</span><br></pre></td></tr></table></figure>
<p>这时<code>tags</code>中的数据为字符串而非<code>tag</code>列表，如：<code>"恋爱,推理,校园,日常"</code>，需要将其转化为列表，实现如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将逗号分割的字符串以逗号为分隔符转换成列表</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_to_list</span>(<span class="params">str_data</span>):</span><br><span class="line">    <span class="keyword">for</span> index,data <span class="keyword">in</span> <span class="built_in">enumerate</span>(str_data):</span><br><span class="line">        tmp,start,end=[],<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> end!=<span class="built_in">len</span>(data):</span><br><span class="line">            <span class="keyword">if</span> data[start:].find(<span class="string">&#x27;,&#x27;</span>)==-<span class="number">1</span>:</span><br><span class="line">                end=<span class="built_in">len</span>(data)</span><br><span class="line">                tmp.append(data[start:end])</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            end=start+data[start:].find(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            tmp.append(data[start:end])</span><br><span class="line">            start=end+<span class="number">1</span></span><br><span class="line">        str_data[index]=tmp</span><br></pre></td></tr></table></figure>
<p>通过k-1项集构造k项集：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Apriori算法连接步 单步实现</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_list</span>(<span class="params">l1,l2</span>):</span><br><span class="line">    length=<span class="built_in">len</span>(l1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> l1[i]!=l2[i]:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;nope&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> l1[-<span class="number">1</span>]&lt;l2[-<span class="number">1</span>]:</span><br><span class="line">        l=l1.copy()</span><br><span class="line">        l.append(l2[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> l</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;nope&#x27;</span></span><br></pre></td></tr></table></figure>
<p>判断列表的包含关系</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 判断l2是否包含在l1中</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_exist</span>(<span class="params">l1,l2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l2:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> l1:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>剪枝操作：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 利用min_sup和min_conf进行剪枝,即最小支持度和最小置信度,L_last为k-1项频繁集</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prune</span>(<span class="params">L=[],L_last=<span class="number">0</span>,min_sup=<span class="number">0</span>,min_conf=<span class="number">0</span></span>):</span><br><span class="line">    tmp_L=[]</span><br><span class="line">    <span class="keyword">if</span> L_last==<span class="number">0</span> <span class="keyword">or</span> min_conf==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">            <span class="keyword">if</span> l[<span class="number">1</span>]&lt;min_sup:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            tmp_L.append(l)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">            <span class="keyword">if</span> l[<span class="number">1</span>]&lt;min_sup:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> ll <span class="keyword">in</span> L_last:</span><br><span class="line">                <span class="keyword">if</span> l[<span class="number">0</span>][:-<span class="number">1</span>]==ll[<span class="number">0</span>]:</span><br><span class="line">                    <span class="keyword">if</span> l[<span class="number">1</span>]/ll[<span class="number">1</span>]&gt;=min_conf:</span><br><span class="line">                        tmp_L.append(l)</span><br><span class="line">    <span class="keyword">return</span> tmp_L</span><br></pre></td></tr></table></figure>
<p>Apriori算法主体：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Apriori</span>(<span class="params">data,min_sup,min_conf</span>):</span><br><span class="line">    <span class="comment"># C:临时存储k项集  L:临时存储频繁k项集  L_save:保存频繁1-k项集</span></span><br><span class="line">    C,L,L_save=[],[],[]</span><br><span class="line">    <span class="comment"># 使用支持度计数来代替支持度进行计算</span></span><br><span class="line">    min_sup_count=min_sup*<span class="built_in">len</span>(data)</span><br><span class="line">    <span class="comment"># 初始化一项集</span></span><br><span class="line">    <span class="keyword">for</span> tags <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">for</span> tag <span class="keyword">in</span> tags:</span><br><span class="line">            <span class="keyword">if</span> C==[] <span class="keyword">or</span> [tag] <span class="keyword">not</span> <span class="keyword">in</span>[x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> C]:</span><br><span class="line">                C.append([[tag],<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># 筛选出频繁一项集</span></span><br><span class="line">    L=C.copy()</span><br><span class="line">    <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">        <span class="keyword">for</span> tags <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">if</span> is_exist(tags,l[<span class="number">0</span>]):</span><br><span class="line">                L[index][<span class="number">1</span>]+=<span class="number">1</span></span><br><span class="line">    L=prune(L,min_sup=min_sup)</span><br><span class="line">    L_save.append(L)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 由频繁k-1项集构造k项集</span></span><br><span class="line">        C=[]</span><br><span class="line">        <span class="keyword">for</span> l1 <span class="keyword">in</span> L:</span><br><span class="line">            <span class="keyword">for</span> l2 <span class="keyword">in</span> L:</span><br><span class="line">                list_merge=merge_list(l1[<span class="number">0</span>],l2[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> list_merge!=<span class="string">&#x27;nope&#x27;</span>:</span><br><span class="line">                    C.append([list_merge,<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># 统计频次，剪枝</span></span><br><span class="line">        L=C.copy()</span><br><span class="line">        <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">            <span class="keyword">for</span> tags <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">if</span> is_exist(tags,l[<span class="number">0</span>]):</span><br><span class="line">                    L[index][<span class="number">1</span>]+=<span class="number">1</span></span><br><span class="line">        L=prune(L,L_save[-<span class="number">1</span>],min_sup,min_conf)</span><br><span class="line">        <span class="comment"># L=空集时结束循环</span></span><br><span class="line">        <span class="keyword">if</span> L==[]:</span><br><span class="line">            <span class="keyword">return</span> L_save</span><br><span class="line">        L_save.append(L)</span><br></pre></td></tr></table></figure>
<h3 id="k-means算法聚类">K-means算法聚类</h3>
<h4 id="算法介绍">算法介绍</h4>
<p>K-means是一种无监督聚类算法，算法简单，容易实现，但是可能会产生空簇或收敛到局部最优。</p>
<p>算法流程如下：</p>
<ol type="1">
<li>从样本中随机选取k个点作为初始质心</li>
<li>计算每个样本到这k个中心的距离，将样本划分到距离它最近的质心所在的簇中</li>
<li>重新计算每个簇的质心</li>
<li>重复2和3直到质心不改变</li>
</ol>
<h4 id="数据映射">数据映射</h4>
<p>使用K-means对于番剧进行据类分析，采用的数据为<code>[播放量，追番量，弹幕量]</code>这三种数据形成的三维坐标，但是这三个数据的值从几千到几亿不等，不能直接对其进行使用，对数据使用对数函数进行压缩：
<span class="math display">\[
[x,y,z]=[ln\ x,ln\ y,ln\ z]
\]</span>
在进行对数变换之后，为了保证每种数据范围一致以保证他们有相同的权重，将数据进行归一化：
<span class="math display">\[
x=\frac{x-min}{max-min}
\]</span> 实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trans_data</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> index,item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        data[index]=math.log(item)</span><br><span class="line">    Max=<span class="built_in">max</span>(data)</span><br><span class="line">    Min=<span class="built_in">min</span>(data)</span><br><span class="line">    <span class="keyword">for</span> index,item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        data[index]=(item-Min)/(Max-Min)</span><br></pre></td></tr></table></figure>
<h4 id="k-means编程实现">K-means编程实现</h4>
<p>在聚类时采用的距离度量为欧式距离，即： <span class="math display">\[
distance=\sqrt{(x_{1}-y_{1})^2+...+(x_{i}-y_{i})^2+...+(x_{n}-y_{n})^2}
\]</span> 实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">point1,point2</span>):</span><br><span class="line">    dim=<span class="built_in">len</span>(point1)</span><br><span class="line">    <span class="keyword">if</span> dim != <span class="built_in">len</span>(point2):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error! dim of point1 and point2 is not same&#x27;</span>)</span><br><span class="line">    dist=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        dist+=(point1[i]-point2[i])*(point1[i]-point2[i])</span><br><span class="line">    <span class="keyword">return</span> math.sqrt(dist)</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>随机选取k个点作为质心</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shape=np.array(dire).shape</span><br><span class="line">    k_center_index=[]</span><br><span class="line">    k_center=[]</span><br><span class="line">    temp_k=k</span><br><span class="line">    <span class="keyword">while</span>(temp_k):</span><br><span class="line">        temp=random.randrange(<span class="number">0</span>,shape[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> temp <span class="keyword">not</span> <span class="keyword">in</span> k_center_index:</span><br><span class="line">            k_center_index.append(temp)</span><br><span class="line">            k_center.append(<span class="built_in">list</span>(dire[temp]))</span><br><span class="line">            temp_k-=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>对所有的数据进行分簇</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_category</span>(<span class="params">dire,k,k_center</span>):</span><br><span class="line">    shape=np.array(dire).shape</span><br><span class="line">    k_categories=[[] <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        Min=<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            dist=distance(dire[i],k_center[j])</span><br><span class="line">            <span class="keyword">if</span> dist&lt;Min:</span><br><span class="line">                Min=dist</span><br><span class="line">                MinNum=j</span><br><span class="line">        k_categories[MinNum].append(i)</span><br><span class="line">    <span class="keyword">return</span> k_categories</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>计算新的中心并重复</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 最大迭代次数</span></span><br><span class="line">    Maxloop=<span class="number">500</span></span><br><span class="line">    k_center_new=k_center</span><br><span class="line">    k_center=[]</span><br><span class="line">    count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(k_center!=k_center_new <span class="keyword">and</span> count&lt;Maxloop):</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        k_center=copy.deepcopy(k_center_new)</span><br><span class="line">        k_categories=get_category(dire,k,k_center_new)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">                temp=<span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> k_categories[j]:</span><br><span class="line">                    temp+=dire[w][i]</span><br><span class="line">                k_center_new[j][i]=temp/<span class="built_in">len</span>(k_categories[j])</span><br></pre></td></tr></table></figure>
<p>完整的k-means算法主体如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">k_means</span>(<span class="params">dire,k</span>):</span><br><span class="line">    <span class="comment"># 随机选取k个点作为中心</span></span><br><span class="line">    shape=np.array(dire).shape</span><br><span class="line">    k_center_index=[]</span><br><span class="line">    k_center=[]</span><br><span class="line">    temp_k=k</span><br><span class="line">    <span class="keyword">while</span>(temp_k):</span><br><span class="line">        temp=random.randrange(<span class="number">0</span>,shape[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> temp <span class="keyword">not</span> <span class="keyword">in</span> k_center_index:</span><br><span class="line">            k_center_index.append(temp)</span><br><span class="line">            k_center.append(<span class="built_in">list</span>(dire[temp]))</span><br><span class="line">            temp_k-=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 最大迭代次数</span></span><br><span class="line">    Maxloop=<span class="number">500</span></span><br><span class="line">    k_center_new=k_center</span><br><span class="line">    k_center=[]</span><br><span class="line">    count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(k_center!=k_center_new <span class="keyword">and</span> count&lt;Maxloop):</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        k_center=copy.deepcopy(k_center_new)</span><br><span class="line">        k_categories=get_category(dire,k,k_center_new)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">                temp=<span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> k_categories[j]:</span><br><span class="line">                    temp+=dire[w][i]</span><br><span class="line">                k_center_new[j][i]=temp/<span class="built_in">len</span>(k_categories[j])</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;k_center&#x27;</span>:k_center,<span class="string">&#x27;k_categories&#x27;</span>:k_categories,<span class="string">&#x27;dire&#x27;</span>:dire,<span class="string">&#x27;k&#x27;</span>:k&#125;</span><br></pre></td></tr></table></figure>
<h4 id="算法结果及评估">算法结果及评估</h4>
<p>为了更直观的看到分类结果，将分类的点在三维空间中绘制出，用不同的颜色表示不同的类别。</p>
<blockquote>
<p>绘图函数如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_k_means</span>(<span class="params">k_result</span>):</span><br><span class="line">    k,k_categories,dire=k_result[<span class="string">&#x27;k&#x27;</span>],k_result[<span class="string">&#x27;k_categories&#x27;</span>],k_result[<span class="string">&#x27;dire&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        x,y,z=[],[],[]</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> k_categories[i]:</span><br><span class="line">            x.append(dire[index][<span class="number">0</span>])</span><br><span class="line">            y.append(dire[index][<span class="number">1</span>])</span><br><span class="line">            z.append(dire[index][<span class="number">2</span>])</span><br><span class="line">        fig = plt.gcf()</span><br><span class="line">        ax = fig.gca(projection=<span class="string">&#x27;3d&#x27;</span>)</span><br><span class="line">        ax.scatter(x,y,z)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
</blockquote>
<p>分类结果如下：</p>
<table>
<tr>
<td>
<center>
k=2
</center>
</td>
<td>
<center>
k=5
</center>
</td>
<td>
<center>
k=10
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20201124160340.png?x-oss-process=style/webp" width='300'>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20201124160804.png?x-oss-process=style/webp" width='300'>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20201124160900.png?x-oss-process=style/webp" width='300'>
</center>
</td>
</tr>
</table>
<p>为了更好的评估分类效果，选取DB指数（Davies-Bouldin
Index）对分类效果进行评估，DB指数的及算法方法如下：</p>
<ul>
<li>设一共有<span
class="math inline">\(k\)</span>个簇，每个簇的中心点为<span
class="math inline">\(u_i\)</span>，簇中的点用<span
class="math inline">\(x_{ij}\)</span>表示</li>
<li>计算出每个簇的簇内平均距离<span
class="math inline">\(\mu_i\)</span>，即簇内所有点到簇中心的平均距离</li>
<li>计算出质心之间的距离<span
class="math inline">\(d(u_i,u_j)\)</span></li>
<li>计算DBI：</li>
</ul>
<p><span class="math display">\[
DB=\frac1k\sum_{i=1}^k\mathop{max}\limits_{i\neq
j}(\frac{\mu_i+\mu_j}{d(u_i,u_j)})
\]</span></p>
<p>实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dbi</span>(<span class="params">k_result</span>):</span><br><span class="line">    k_center,k_categories,dire,k=k_result[<span class="string">&#x27;k_center&#x27;</span>],k_result[<span class="string">&#x27;k_categories&#x27;</span>],k_result[<span class="string">&#x27;dire&#x27;</span>],k_result[<span class="string">&#x27;k&#x27;</span>]</span><br><span class="line">    <span class="comment"># 簇内平均距离</span></span><br><span class="line">    k_ave_dist=[<span class="number">0</span> <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        temp=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> k_categories[i]:</span><br><span class="line">            temp+=distance(k_center[i],dire[item])</span><br><span class="line">        k_ave_dist[i]=temp/<span class="built_in">len</span>(k_categories[i])</span><br><span class="line">    <span class="comment"># 簇中心之间距离</span></span><br><span class="line">    k_center_dist=[[<span class="number">0</span> <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(k)] <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            k_center_dist[i][j]=distance(k_center[i],k_center[j])</span><br><span class="line">    <span class="comment"># 计算dbi</span></span><br><span class="line">    DB=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        Max=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            <span class="keyword">if</span> i !=j:</span><br><span class="line">                temp=(k_ave_dist[i]+k_ave_dist[j])/k_center_dist[i][j]</span><br><span class="line">                <span class="keyword">if</span> temp&gt;Max:</span><br><span class="line">                    Max=temp</span><br><span class="line">        DB+=Max</span><br><span class="line">    <span class="keyword">return</span> DB/k</span><br></pre></td></tr></table></figure>
<p>计算k=2-10时分类评估结果如下：</p>
<table style="width:100%;">
<colgroup>
<col style="width: 6%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">k</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">DBI</td>
<td style="text-align: center;">0.7028</td>
<td style="text-align: center;">0.7851</td>
<td style="text-align: center;">0.8324</td>
<td style="text-align: center;">0.9075</td>
<td style="text-align: center;">0.9267</td>
<td style="text-align: center;">0.9927</td>
<td style="text-align: center;">0.9242</td>
<td style="text-align: center;">0.9123</td>
<td style="text-align: center;">0.8849</td>
</tr>
</tbody>
</table>
<center>
<img src="https://download.kezhi.tech/img/20201124162738.png?x-oss-process=style/webp" height='300'>
</center>
<p>k从2-50变化时的分类评估结果如下：</p>
<center>
<img src="https://download.kezhi.tech/img/20201124163322.png?x-oss-process=style/webp" height='300'>
</center>
<p>从上述结果可以看出，在k=2或3时的分类效果最好，从使用的数据和k-means算法的特点进行分析，k-means算法采用欧氏距离进行分类，分出的区域为一个个球形。从三维图像上看，采用的数据并没有一个很明显的界限将数据分开，当k=2或3时，每个簇聚集在一个个球中，表现出较好的分类结果。当k继续增长时，由于数据周围孤立点的影响，使分类效果逐渐变差。</p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Crawler</tag>
        <tag>Big Data</tag>
        <tag>Aprior Algorithm</tag>
        <tag>K-Means</tag>
      </tags>
  </entry>
  <entry>
    <title>社会心理学（一）</title>
    <url>/1eea1e9f.html</url>
    <content><![CDATA[<h2 id="社会中的自我">社会中的自我</h2>
<h3 id="自我概念我是谁">自我概念：我是谁</h3>
<span id="more"></span>
<ol type="1">
<li>人们往往会把自己看做是一切的中心，从而高估别人对我们的注意度。即<strong>焦点效应</strong></li>
<li>我们能够敏锐的察觉自己情感的变化，并且认为这也是很清楚地被别人注意到的。而实际注意到我们的人比我们认为的要少。即<strong>透明度错觉</strong></li>
<li>社会环境会影响自我认知，在不同的环境中对自我的认知更多来源于与环境的差异。如在国外时认为自己是中国人，而在国内则不会对这有很强的意识，更多的认为自己是某个地区的人（如陕西人，西安人）。</li>
<li>在自我认知时带有很强的<strong>自利色彩</strong>。在出现问题时，人往往将责任归咎到他人身上。而当作出成绩时，人们往往觉得低估了自己的贡献。</li>
<li>我们在社会关系中界定自我。往往我们在与不同的人相处时会有不同的表现，这些表现得差异和多样化有助于我们了解自己和界定自己的角色。</li>
<li><strong>自我图式</strong>。我们对于自己的认识，会在很大程度上影响我们对于信息的加工。这也就决定了如何感知，回忆和评价他人和自己。（对于一名专业的运动员来说，会特别关注别人的身体和技巧）。</li>
<li><strong>自我参照效应</strong>。我们对于与自己相关的事情总是记忆深刻，并且由于我们将自己看做是世界的核心位置，因此在对事件认知时会高估对自己的指向程度（我们总是认为自己是完成某件事的核心人物）。</li>
</ol>
<h3 id="自我认识">自我认识</h3>
<ol type="1">
<li>在解释自己行为的过程中，往往倾向于高估自己思维和意识的作用，而低估外部因素的影响。如人们往往认为自己不会受媒体的影响，并且认为媒体会对其他人产生影响。</li>
<li>在预测自己的行为时，他人往往能够比自己更准确地预测结果。这是因为在进行自我预测时，我们自己往往关心当下比较突出的因素，而忽略那些其实很重要但没有被注意到的因素。这就造成对未来预期的错误。</li>
<li>在消极事件中，我们尤其会表现出影响偏见，即高估事件的持久性影响，低估自身的自愈能力。并且重大的消极事件会激发我们的心理防御机制，可能会比轻微的情绪波动所引发的痛苦持续时间更短。</li>
<li>一种观点认为，我们实际的思维过程和我们对于思维的解释是两码事。例如，在挑选一副喜欢的画时，要求被试者阐述喜欢的原因，他们在几周之后对画的满意程度要低于那些没有进行归因的。也就是说，当我们对自己的心理过程进行理性的归因时，对我们未来的预测将变得无效。这从某一方面说明了，我们实际的思考过程存在很多我们在分析自己思维时无法体现的东西。</li>
</ol>
<h3 id="自我控制">自我控制</h3>
<ol type="1">
<li><p>自我控制是一种会被消耗的能力，它类似于肌肉力量。在被使用后会变得虚弱，经过休息之后又会回复，随着不断训练会加强。自我控制能力是有限的，当我们花费了大量的精力在日常生活中进行自我控制时（如强迫自己不吃东西，压抑自己的思想），在面对难题时会变得无力。</p></li>
<li><p><strong>自我效能</strong>，即对自己能力与效率的乐观信念可以获得更大的回报。自我效能高的人会更有韧性，生活的更加健康。</p></li>
<li><p>控制点。认为自己的命运是自己来控制的（内部控制点）还是由外部的力量来掌控（外部控制点）。是否感觉命运受自己掌控取决于我们如何解释挫折。内部控制的人往往归因于意外或是需要尝试新的方法来解决。外部控制的人把失败归因于自己无法控制的因素（如学习成绩的糟糕归因于自己笨，不喜欢老师等）。</p></li>
<li><p><strong>习得性无助</strong>，人无法对自己做的事和别人做的事进行控制，从而对事件失去掌控能力，产生习得性无助。与之相反的是自我决定，对自我和环境有一定的控制权。习得性无助常常会让人有更大的压力，变得虚弱，快速衰老。增加一定的自我控制可以增强个体的幸福和健康。但过度的自由和自我决定也会导致人们生活满意度下降，抑郁症增多。过于多的选择会让人们无所适从。</p></li>
</ol>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>心理学</tag>
      </tags>
  </entry>
  <entry>
    <title>电脑软件配置单</title>
    <url>/f9af8ec4.html</url>
    <content><![CDATA[<p>我过去经常帮身边的朋友指导电脑硬件配置。然而，对于个人电脑来说，如果胡乱装软件，或者用了不合适的软件，会让电脑的使用效率事倍功半。同时，在我个人拿到一台新电脑时，也需要根据我的习惯初始化配置很多软件到新电脑上。由此，便有了写一份软件配置清单的想法，一来可以给大家做一些软件推荐，二来我自己也留一份作为参考。</p>
<p><img src="https://download.kezhi.tech/img/202311061722807.png?x-oss-process=style/webp" style="width:67%;" /></p>
<span id="more"></span>
<h2 id="工具类">工具类</h2>
<ul>
<li><p>火绒安全软件：台式机上可装，拦截弹窗很方便，<a
href="https://www.huorong.cn/">火绒安全 (huorong.cn)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061657296.svg" style="width:30%;" /></p></li>
<li><p>达芬奇：好用的视频剪辑调色软件，<a
href="https://www.blackmagicdesign.com/products/davinciresolve">DaVinci
Resolve 18 | Blackmagic Design</a></p>
<p><img src="https://download.kezhi.tech/img/202311061659458.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>OBS Studio：究极好用的开源录屏软件，<a
href="https://obsproject.com/">Open Broadcaster Software | OBS
(obsproject.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061701825.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>网易邮箱大师：邮箱管理软件，<a
href="https://dashi.163.com/">网易邮箱大师-高效强大的全平台邮箱客户端
(163.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061702553.svg" style="width:50%;" /></p></li>
<li><p>BandZip：压缩解压工具，现在有广告了QAQ，<a
href="https://www.bandisoft.com/bandizip/">Windows 版本的 Bandizip ·
业内领先的压缩文件解决方案 (bandisoft.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061712628.png?x-oss-process=style/webp" style="width:10%;" /></p></li>
<li><p>Geek Uninstaller，<a
href="https://geekuninstaller.com/download">Geek Uninstaller -
Download</a></p>
<p><img src="https://download.kezhi.tech/img/202311061716309.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>PotPlayer：免费开源强大的视频播放器，<a
href="https://potplayer.daum.net/">Global Potplayer (daum.net)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061714968.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>SeaDrive：seafile网盘挂载工具，<a
href="https://www.seafile.com/download/">下载 - Seafile</a></p>
<p><img src="https://download.kezhi.tech/img/202311061717524.png?x-oss-process=style/webp" style="width:33%;" /></p></li>
<li><p>MemReduct：win10+系统推荐，用于清理内存，<a
href="https://mem-reduct.updatestar.com/">Mem Reduct 3.4 - 下载
(updatestar.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202312201630287.png" style="width:25%;" /></p></li>
</ul>
<h2 id="学习类">学习类</h2>
<ul>
<li><p>Zotero：究极好用的文献管理工具，<a
href="https://www.zotero.org/">Zotero | Your personal research
assistant</a>，插件移步<a
href="https://kezhi.tech/b2344ef.html">Zotero插件推荐及下载 | Kezhi's
Blog</a></p>
<p><img src="https://download.kezhi.tech/img/202311061647205.png?x-oss-process=style/webp" style="width:50%;" /></p></li>
<li><p>Typora：究极好用的Markdown编辑工具，<a
href="https://typora.io/">Typora — a markdown editor, markdown
reader.</a></p>
<p><img src="https://download.kezhi.tech/img/202311061651956.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>PicGo：与Typora搭配使用，管理图床图片，<a
href="https://molunerfinn.com/PicGo/">PicGo (molunerfinn.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061651551.png?x-oss-process=style/webp" alt="PicGo" style="width:20%;" /></p></li>
<li><p>Pandoc：好用的Markdown渲染工具，与Typora配合使用，<a
href="https://pandoc.org/">Pandoc - index</a></p>
<p><img src="https://download.kezhi.tech/img/202311061719162.png?x-oss-process=style/webp" style="width:33%;" /></p></li>
<li><p>网易有道词典：并不好用的翻译工具，奈何找不到更好的，<a
href="https://www.youdao.com/">网易有道 (youdao.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061654361.png?x-oss-process=style/webp" style="width: 33%;" /></p></li>
<li><p>pot：比较好用的翻译软件，可以自定义翻译源<a
href="https://pot-app.com/">Pot | 跨平台划词翻译和OCR
(pot-app.com)</a></p>
<p><img src="https://pot-app.com/logo/icon.svg" alt="img" style="width:25%;" /></p></li>
</ul>
<h2 id="开发类">开发类</h2>
<ul>
<li><p>Visual Studio Code：<del>最好的</del>代码编辑器，<a
href="https://code.visualstudio.com/">Visual Studio Code - Code Editing.
Redefined</a></p>
<p><img src="https://download.kezhi.tech/img/202311061708754.png?x-oss-process=style/webp" style="width:33%;" /></p></li>
<li><p>Git：版本管理工具，<a href="https://git-scm.com/">Git
(git-scm.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061709133.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>Anaconda3：好用的Python环境管理工具，<a
href="https://www.anaconda.com/download">Free Download |
Anaconda</a></p>
<p><img src="https://download.kezhi.tech/img/202311061710853.svg" style="width:33%;" /></p></li>
</ul>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>List</tag>
      </tags>
  </entry>
  <entry>
    <title>王者荣耀目标检测--Yolov5实现</title>
    <url>/86b4b2c0.html</url>
    <content><![CDATA[<h1 id="智能体对战目标检测">智能体对战目标检测</h1>
<p>手动标注数据集及视频分割程序下载见文章末。</p>
<p><img src="https://download.kezhi.tech/img/202211291652294.jpg?x-oss-process=style/webp" style="width:80%;" /></p>
<span id="more"></span>
<p>识别演示视频：</p>
<iframe src="//player.bilibili.com/player.html?aid=210959614&amp;bvid=BV1Ya411m7mx&amp;cid=490755155&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<h2 id="引言">1. 引言</h2>
<h3 id="问题背景">1.1 问题背景</h3>
<p>强化学习过去在博弈领域取得了很高的成就。如在围棋上打败人类的Alpha Go
(Silver, D. et.al.,
2016)，经过数天自博弈即可在多种棋类游戏上战胜顶尖人类的Alpha Zero
(Silver, D. et.al., 2018)，以及在星际争霸游戏中打败人类的Alpha Star
(Vinyals, O. et.al., 2019)。王者荣耀中达到职业选手水平的觉悟Ai (Wu, B.,
2019)。强化学习的发展使得人工智能在游戏对战领域取得了越来越好的成绩。</p>
<p>但同时，上述智能体解决的问题中，要么环境较为简单（如围棋，象棋等棋牌类游戏），要么在智能体决策的过程时的输入经过了特定的处理。如Alpha
Star的输入中包含了很多无法直接从屏幕上观测到的数据 (Vinyals, O. et.al.,
2019)。而要训练出更加具有通用性的智能体，就需要环境的输入更加一般，通用。计算机视觉成为了一种很好的选择。</p>
<p>在大量的智能体对战场景中，视觉信息是最重要，包含信息量最丰富的信息。如在游戏中，画面信息是玩家获取到的主要信息；在棋牌博弈中，场上的局势和对手的表情信息等都是视觉信息；在军事对战环境中，大量传感器捕获到的都是类视觉信息。因此，如何将视觉信息转换为环境描述信息发送给智能体进行决策具有很强的现实意义。</p>
<p>其中，目标检测是视觉信息转换中很重要的一环。不论是在虚拟游戏环境中，还是在现实环境中，确认地形，友方位置，地方位置都是重中之重。这对智能体之后的动作决策至关重要。因此，本文从游戏对战场景中的目标检测出发，训练一个可以在游戏环境中检测敌我双方智能体单位，中立单位以及环境特征的神经网络模型，实现对场景中的重要主体的检测。</p>
<h2 id="方法原理">2. 方法原理</h2>
<p>本文使用 YoloV5(Ultralytics)
来构建目标检测网络，对游戏场景中的主体进行识别。</p>
<p>Yolov5 的网络结构如下图所示：</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231231485.png?x-oss-process=style/webp"
alt="图2-1 Yolov5网络结构" />
<figcaption aria-hidden="true">图2-1 Yolov5网络结构</figcaption>
</figure>
<p>从Yolov5的网络结构图，可以看出，还是分为<strong>输入端 Input、主干
Backbone、脖颈 Neck、预测
Prediction</strong>四个部分。接下来从这四个部分分别介绍该网络</p>
<h3 id="输入端-input">2.1 输入端 Input</h3>
<p>Yolov5的输入端采用了和Yolov4一样的Mosaic数据增强的方式。Mosaic数据增强提出的作者也是来自Yolov5团队的成员，不过，随机缩放、随机裁剪、随机排布的方式进行拼接，对于小目标的检测效果还是很不错的。</p>
<p>在Yolo算法中，针对不同的数据集，都会有初始设定长宽的锚框。在网络训练中，网络在初始锚框的基础上输出预测框，进而和真实框进行比对，计算两者差距，再反向更新，迭代网络参数。在Yolov3、Yolov4中，训练不同的数据集时，计算初始锚框的值是通过单独的程序运行的。但Yolov5中将此功能嵌入到代码中，每次训练时，自适应的计算不同训练集中的最佳锚框值。</p>
<h3 id="主干-backbone">2.2 主干 Backbone</h3>
<h4 id="focus结构">2.2.1 Focus结构</h4>
<p>Focus模块在v5中是图片进入backbone前，对图片进行切片操作，具体操作是在一张图片中每隔一个像素拿到一个值，类似于邻近下采样，这样就拿到了四张图片，四张图片互补，长的差不多，但是没有信息丢失，这样一来，将W、H信息就集中到了通道空间，输入通道扩充了4倍，即拼接起来的图片相对于原先的RGB三通道模式变成了12个通道，最后将得到的新图片再经过卷积操作，最终得到了没有信息丢失情况下的二倍下采样特征图。其网络结构如下：</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231315193.png?x-oss-process=style/webp"
alt="图2-2 Yolov5中Focus结构" />
<figcaption aria-hidden="true">图2-2 Yolov5中Focus结构</figcaption>
</figure>
<p>以yolov5s为例，原始的640 × 640 ×
3的图像输入Focus结构，采用切片操作，先变成320 × 320 ×
12的特征图，再经过一次卷积操作，最终变成320 × 320 ×
32的特征图。切片操作如下：</p>
<figure>
<img
src="https://img-blog.csdnimg.cn/2021011616173324.png?x-oss-process=style/webp"
alt="图2-3 切片操作" />
<figcaption aria-hidden="true">图2-3 切片操作</figcaption>
</figure>
<h4 id="csp结构">2.2.2 CSP结构</h4>
<p>Yolov4网络结构中，借鉴了CSPNet的设计思路，在主干网络中设计了CSP结构。Yolov5与Yolov4不同点在于，Yolov4中只有主干网络使用了CSP结构。而Yolov5中设计了两种CSP结构，以Yolov5s网络为例，CSP1_X结构应用于Backbone主干网络，另一种CSP2_X结构则应用于Neck中。其在保证准确
度的前提下有效减少了计算量。其网络结构如下图所示</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231322235.png?x-oss-process=style/webp"
alt="图2-4 Yolov5中的CSP结构" />
<figcaption aria-hidden="true">图2-4 Yolov5中的CSP结构</figcaption>
</figure>
<p>其中，CBL结构和Resunit 结构如下图所示：</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231322633.png?x-oss-process=style/webp"
alt="图2-5 CBL结构和Resunit" />
<figcaption aria-hidden="true">图2-5 CBL结构和Resunit</figcaption>
</figure>
<h4 id="spp结构">2.2.3 SPP结构</h4>
<p>SPP 模块借鉴了 SPPNet(Spatial Pyramid Pooling
Network)，由四个并行的分
支组成，采用多种不同大小的卷积核对图片进行卷积，然后将卷积结果进行融合，
有效扩大了模型的感受野，使得模型可以处理图片大小差距较大的情况。其网络结构如下图所示：</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231326040.png?x-oss-process=style/webp"
alt="图2-6 Yolov5中SPP结构" />
<figcaption aria-hidden="true">图2-6 Yolov5中SPP结构</figcaption>
</figure>
<h3 id="脖颈-neck">2.3 脖颈 Neck</h3>
<p>Yolov5 的 Neck 部分采用了 PANet 结构，Neck
主要用于生成特征金字塔。特征金字塔会增强模型对于不同缩放尺度对象的检测，从而能够识别不同大小和尺度的同一个物体。</p>
<p>PANet 结构是在FPN的基础上引入了 Bottom-up path augmentation
结构。FPN主要是通过融合高低层特征提升目标检测的效果，尤其可以提高小尺寸目标的检测效果。Bottom-up
path
augmentation结构可以充分利用网络浅特征进行分割，网络浅层特征信息对于目标检测非常重要，因为目标检测是像素级别的分类浅层特征多是边缘形状等特征。PANet
在 FPN 的基础上加了一个自底向上方向的增强，使得顶层 feature map
也可以享受到底层带来的丰富的位置信息，从而提升了大物体的检测效果。</p>
<p>此外，Yolov5的Neck结构中，采用借鉴CSPnet设计的CSP2结构，加强网络特征融合的能力。</p>
<h3 id="预测-prediction">2.4 预测 Prediction</h3>
<h4 id="bounding-box损失函数">2.4.1 Bounding box损失函数</h4>
<p>Yolov5中采用GIOU_Loss做Bounding
box的损失函数。GIOU不仅关注重叠区域，还关注其他的非重合区域，能更好的反映两者的重合
度。</p>
<h4 id="加权非极大抑制nms">2.4.2 加权非极大抑制NMS</h4>
<p>在目标检测的后处理过程中，针对很多目标框的筛选，通常需要NMS操作。Yolov5中采用加权NMS的方式来剔除边框，与传统的非极大值抑制相
比，加权非极大值抑制并非直接将边框与阈值相比较来进行筛选，而是根据网络预测结果的置信度进行加权得到最终的目标检测矩形框。</p>
<h2 id="数据集及评测指标">3. 数据集及评测指标</h2>
<h3 id="数据集准备">3.1 数据集准备</h3>
<p>本文采用手动标注的游戏画面数据集，游戏画面采用王者荣耀匹配赛的一局游戏中的随机抽帧获得，一共标注8类主体，其类别和标签如下表所示：</p>
<center>
表3-1 王者荣耀画面标注数据集类别
</center>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 11%" />
<col style="width: 9%" />
<col style="width: 11%" />
<col style="width: 15%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">类别</th>
<th style="text-align: center;">英雄</th>
<th style="text-align: center;">小兵</th>
<th style="text-align: center;">野怪</th>
<th style="text-align: center;">防御塔</th>
<th style="text-align: center;">草丛</th>
<th style="text-align: center;">龙</th>
<th style="text-align: center;">红蓝buff</th>
<th style="text-align: center;">血包</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">标注</td>
<td style="text-align: center;">hero</td>
<td style="text-align: center;">dogface</td>
<td style="text-align: center;">monster</td>
<td style="text-align: center;">tower</td>
<td style="text-align: center;">grass</td>
<td style="text-align: center;">dragon</td>
<td style="text-align: center;">buff</td>
<td style="text-align: center;">blood</td>
</tr>
</tbody>
</table>
<p>其中，每一种类别的标注样本数量如下表所示：</p>
<table>
<thead>
<tr class="header">
<th>类别</th>
<th>英雄</th>
<th>小兵</th>
<th>野怪</th>
<th>防御塔</th>
<th>草丛</th>
<th>龙</th>
<th>红蓝buff</th>
<th>血包</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>训练集</td>
<td>319</td>
<td>101</td>
<td>83</td>
<td>58</td>
<td>353</td>
<td>48</td>
<td>30</td>
<td>6</td>
</tr>
<tr class="even">
<td>验证集</td>
<td>90</td>
<td>32</td>
<td>12</td>
<td>18</td>
<td>91</td>
<td>10</td>
<td>11</td>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="评测指标">3.2 评测指标</h3>
<p>模型的评价指标主要由两部分构成，预测准确率（Prediction）和召回率（Recall）。其中：
<span class="math display">\[
Prediction=\frac{TP}{TP+TN}\\
Recall=\frac{TP}{TP+FP}
\]</span> 在目标检测中，通常用各类别的平均准确率(Average
Precision，AP)来衡量算
法的性能，它的值由查准率(Precision)和查全率(Recall)共同决定，根据式
算出的 Recall 和 Precision 可以作出一条 P-R 曲线，该曲线 与 X
轴围成的面积即为AP 值，公式如下： <span class="math display">\[
AP=\sum_{i=1}^{n-1}(Recall_{i+1}-Recall_{i})*Prediction(Recall_{i+1})
\]</span> 本文实验中使用 AP 值衡量网络对每一类物体的检测性能，AP 值越
高代表网络对该类别的检测能力越好；使用 mAP 指示网络对整体数据集的检测
能力，mAP 越高代表网络在此数据集上的表现越好。</p>
<h2 id="实验结果分析">4. 实验结果分析</h2>
<h3 id="实验指标结果分析">4.1 实验指标结果分析</h3>
<p>本文使用上文中的数据集在Yolov5网络上训练300个epoch，最终得到对各个类别的检测性能如下表所示：</p>
<center>
表4-1 测试性能表现
</center>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Class</th>
<th style="text-align: center;">Labels</th>
<th style="text-align: center;">P</th>
<th style="text-align: center;">R</th>
<th style="text-align: center;">mAP@.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">all</td>
<td style="text-align: center;">256</td>
<td style="text-align: center;">0.928</td>
<td style="text-align: center;">0.758</td>
<td style="text-align: center;">0.887</td>
</tr>
<tr class="even">
<td style="text-align: center;">hero</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">0.959</td>
<td style="text-align: center;">0.789</td>
<td style="text-align: center;">0.926</td>
</tr>
<tr class="odd">
<td style="text-align: center;">grass</td>
<td style="text-align: center;">91</td>
<td style="text-align: center;">0.828</td>
<td style="text-align: center;">0.637</td>
<td style="text-align: center;">0.775</td>
</tr>
<tr class="even">
<td style="text-align: center;">dogface</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">0.839</td>
<td style="text-align: center;">0.688</td>
<td style="text-align: center;">0.824</td>
</tr>
<tr class="odd">
<td style="text-align: center;">tower</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">0.988</td>
<td style="text-align: center;">0.667</td>
<td style="text-align: center;">0.833</td>
</tr>
<tr class="even">
<td style="text-align: center;">buff</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.916</td>
<td style="text-align: center;">0.995</td>
</tr>
<tr class="odd">
<td style="text-align: center;">monster</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0.997</td>
<td style="text-align: center;">0.667</td>
<td style="text-align: center;">0.851</td>
</tr>
<tr class="even">
<td style="text-align: center;">blood</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.935</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.995</td>
</tr>
<tr class="odd">
<td style="text-align: center;">dragon</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">0.875</td>
<td style="text-align: center;">0.701</td>
<td style="text-align: center;">0.899</td>
</tr>
</tbody>
</table>
<p>模型测试结果如下图所示：</p>
<center>
<img src="https://download.kezhi.tech/img/202201231714177.png?x-oss-process=style/webp" height=300>
</center>
<br>
<center>
图4-1 模型预测准确率与置信度曲线
</center>
<center>
<img src="https://download.kezhi.tech/img/202201231717272.png?x-oss-process=style/webp" height=300>
</center>
<br>
<center>
图4-2 模型召回率与置信度曲线
</center>
<center>
<img src="https://download.kezhi.tech/img/202201231718078.png?x-oss-process=style/webp" height=300>
</center>
<br>
<center>
图4-3 模型P-R曲线
</center>
<p>由上述实验结果可以看出，模型的总体检测准确率为92.8%，召回率为75.8%，平均准确率为88.7%。性能表现较好。但在具体类别上的目标检测性能差异较大。具体来说，在英雄，防御塔，红蓝buff，野怪等特征较明显，并且数据量相对较大的主体上的识别能力较好。</p>
<p>此外，从总体上来看，模型的识别准确率较好，而召回率较差。也就是很少将检测目标类型识别错，但并非所有的目标都能够识别出来。结合可视化结果来看，初步推断是由于标记的数据集分布不平稳以及数据量不够充足导致的。后续可以考虑通过补充数据集来提升模型的检测性能。</p>
<h3 id="可视化实验结果">4.2 可视化实验结果</h3>
<p>模型在验证集上的部分检测结果和标记数据如下图所示：</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231725232.jpg?x-oss-process=style/webp"
alt="图4-4 模型在验证集上的预测结果" />
<figcaption aria-hidden="true">图4-4
模型在验证集上的预测结果</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/202201231725560.jpg?x-oss-process=style/webp"
alt="图4-5 验证集上的手动标记数据" />
<figcaption aria-hidden="true">图4-5 验证集上的手动标记数据</figcaption>
</figure>
<p>此外，本文还将训练好的模型在另一场英雄不同的游戏视频中进行了测试，最终的测试结果视频链接如下：</p>
<p>https://www.bilibili.com/video/BV1Ya411m7mx?share_source=copy_web</p>
<p>从视频中可以看出，虽然本场游戏视频中的英雄未在训练集中出现，但模型依然可以很好的定位和判别出相应主体为英雄类别。说明模型在游戏美术素材上的泛化性能较好，即使对于未曾训练的贴图，也可以很好的判别出相应的主体。</p>
<h2 id="结论">5. 结论</h2>
<p>本文使用Yolov5网络构建游戏场景中主体的目标检测，通过图像识别的方式成功对游戏画面中的重要主体进行了定位了判别，使用少量数据训练出的模型最终平均准确率在80%以上。如果可以收集更多的数据，那么最终的检测效果还可以继续提升。而随着目标检测技术的不断发展，图像目标检测的准确率也在不断地提升，检测用时也不断缩短。这为智能体智能决策和作战提供了新的数据处理方法和思考。未来的智能体也许可以基于该技术，主要依靠直接的图像输入而非人工转换数据便可以达到很高的智能水平。</p>
<h2 id="参考文献">参考文献</h2>
<ol type="1">
<li>Silver, D., Huang, A., Maddison, C.J., Guez, A., Sifre, L., Van Den
Driessche, G., Schrittwieser, J., Antonoglou, I., Panneershelvam, V.,
Lanctot, M. and Dieleman, S., 2016. Mastering the game of Go with deep
neural networks and tree search. <em>nature</em>, <em>529</em>(7587),
pp.484-489.</li>
<li>Silver, D., Hubert, T., Schrittwieser, J., Antonoglou, I., Lai, M.,
Guez, A., Lanctot, M., Sifre, L., Kumaran, D., Graepel, T. and
Lillicrap, T., 2018. A general reinforcement learning algorithm that
masters chess, shogi, and Go through self-play. <em>Science</em>,
<em>362</em>(6419), pp.1140-1144.</li>
<li>Vinyals, O., Babuschkin, I., Czarnecki, W.M., Mathieu, M., Dudzik,
A., Chung, J., Choi, D.H., Powell, R., Ewalds, T., Georgiev, P. and Oh,
J., 2019. Grandmaster level in StarCraft II using multi-agent
reinforcement learning. <em>Nature</em>, <em>575</em>(7782),
pp.350-354.</li>
<li>Wu, B., 2019, July. Hierarchical macro strategy model for moba game
ai. In <em>Proceedings of the AAAI Conference on Artificial
Intelligence</em> (Vol. 33, No. 01, pp. 1206-1213).</li>
<li>Ultralytics. (n.d.). <em>Ultralytics</em>. [online] Available at:
https://ultralytics.com/yolov5.</li>
<li>Bochkovskiy, A., Wang, C.Y. and Liao, H.Y.M., 2020. Yolov4: Optimal
speed and accuracy of object detection. <em>arXiv preprint
arXiv:2004.10934</em>.</li>
</ol>
<h2 id="附件下载">附件下载</h2>
<p>手动标注数据集及视频分割程序：<a class="btn" href="https://server.kezhi.tech:9160/f/9c47b7368cde4dcdbae5/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>video2img.zip</a></p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Computer Vision</tag>
        <tag>Target Detection</tag>
      </tags>
  </entry>
  <entry>
    <title>科研问题记录</title>
    <url>/4efb358.html</url>
    <content><![CDATA[<h2 id="引言">引言</h2>
<p>在科研和工程实践的过程中，问题的解决往往伴随着新问题的发生。往往这些问题都是在特定场景下才会出现，但是其问题的抽象又具有一定的普适性，从而这些问题能够构成一个个科学研究的起点。</p>
<p><img src="https://download.kezhi.tech/img/202207200159235.jpg?x-oss-process=style/webp" width=30%></p>
<span id="more"></span>
<h2 id="博弈论相关问题记录">博弈论相关问题记录</h2>
<ol type="1">
<li>虚拟遗憾最小化（Counterfactual Regret Minimization,
CFR）系列算法往往被用来解决可以使用博弈树进行建模的离散问题，然而现实中的问题，其状态转移往往是有环图的形式而并非树的形式，如果加入历史信息，那么会导致这棵树非常庞大并且相似的状态无法被相近处理，如何在该类问题上使用遗憾值最小化这种思路进行求解？</li>
<li>博弈理论中，离散型问题通常可以表示为博弈树的形式，在博弈树上进行迭代计算便可以求得博弈树上的最优解或近似纳什均衡解。然而，对于连续问题的求解往往比较困难，连续性问题如何转换为可以用博弈树进行建模的问题，从而转变成离散问题采用迭代求解算法进行求解。这是一个值得思考的问题。</li>
</ol>
<h2 id="强化学习相关问题记录">强化学习相关问题记录</h2>
<ol type="1">
<li>在多智能体强化学习中，一种解决方案是采用分层的思路。上层根据全局信息来进行宏观决策，下层根据上层给出的宏观决策结果来进行微观操作。在此过程中，势必产生不定量的小队合作执行各类任务，这些小队存在成员数量不确定，异质性，合作等性质。如何在这种强化学习架构中巧妙处理这种自组织异质性小队问题？</li>
</ol>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>强化学习</tag>
        <tag>博弈论</tag>
        <tag>多智能体</tag>
      </tags>
  </entry>
  <entry>
    <title>程序中的命名与作用域</title>
    <url>/48242c23.html</url>
    <content><![CDATA[<p>最近在读《代码之髓》，里面讲解了很多编程语言中的concepts是为何产生的。本篇笔记主要参考了书中的第7章：名字与作用域。</p>
<p><img src="https://download.kezhi.tech/img/202211261934570.png?x-oss-process=style/webp" alt="转自:米游社@战小医仙" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="命名">命名</h2>
<p>计算机在执行程序时是根据内存地址中的信息来执行的，其无需得知每个变量的名字是什么。因此早期的编程中是没有命名这一概念的。后来为了方便人在编程时对变量所代表的含义和类型进行记忆，才开始给变量和函数进行取名。例如，相比于"经度：108.654519、纬度：34.255314"来说，中国西部科技创新港更容易理解和记忆，又比如相比"8.7.198.46"来说，"某个不存在的网站"这种描述更令人印象深刻。</p>
<p>那么计算机是如何将名字和变量及函数对应起来的呢，答案是使用对照表。这类似与我们在图书馆里找一本书，通过在数据库中检索，便可以将书名转换为分类编号，再通过分类编号既可以找到想要借阅的书在哪里。以创新港的图书馆为例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">《代码之髓》=&gt;TP312/159,《古今数学思想第一册》=&gt;O11/510-1/C.1</span><br></pre></td></tr></table></figure>
<p>有了这样的对照表，计算机在处理"找到《代码之髓》"这个命令时，便可以转换成"找到编号为TP312/159的图书"来进行执行。</p>
<p>以python为例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&#x27;python&#x27;</span></span><br><span class="line">y = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">z = x</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span>(x)	<span class="comment"># =&gt; 2256008235312</span></span><br><span class="line"><span class="built_in">id</span>(y)	<span class="comment"># =&gt; 2256008254512</span></span><br><span class="line"><span class="built_in">id</span>(z)	<span class="comment"># =&gt; 2256008235312</span></span><br></pre></td></tr></table></figure>
<p>在上述程序中，计算机建立了如下的对照表：</p>
<pre class="mermaid">graph LR
x[x]-->a[2256008235312]
y[y]-->b[2256008254512]
z[z]-->a</pre>
<p>在上面的对照表中，变量x和变量z指向了同一个内存地址，因此，当变量z发生改变时，变量x也会相应的发生改变。<del>只不过python中str不可变罢了</del></p>
<h2 id="命名冲突">命名冲突</h2>
<p>在早期的程序设计中，对照表是整个程序所共有的。这就会产生一些问题，例如下面这段C++代码：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">		<span class="built_in">print</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个循环理应运行10次结束，然而，如果在函数<code>print</code>中对<code>i</code>进行了操作呢：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;ok&quot;</span>&lt;&lt;endl;</span><br><span class="line">	i--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于变量<code>i</code>在函数内部和函数外部中都被使用了，使得其无法在预期的10次<code>for</code>循环之后直接结束。将会无限次循环。</p>
<p>如何避免这种命名冲突呢，一种方法是取更长的名字，在名字中说明这个变量是用于哪里的。例如<code>i_in_print</code>和<code>i_in_main</code>，在多人合作开发时采用变量名申请制来进行管理。</p>
<p>然另一种方法就是引入作用域。下文将主要围绕作用域展开。</p>
<h2 id="作用域">作用域</h2>
<p>作用域是指名字的有效范围，为了不让<code>print</code>函数中对<code>i</code>的操作影响到外部，那么在函数执行之前将其值存储起来，在函数执行结束之后再取出来便可以解决这个问题。这种机制被称为动态作用域</p>
<h3 id="动态作用域">动态作用域</h3>
<p>以<code>Perl</code>语言为例，在函数执行入口保存变量值，在结束时重新写回变量</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">shori</span></span>&#123;</span><br><span class="line">	$old_i = $i;</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line">	$i = $old_i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而，这样的作法存在一个问题，那就是函数在嵌套调用时，对变量的修改会作用到被调用的函数中，以下面这两个函数为例：</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">$x = <span class="string">&quot;global&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">yobu</span> </span>&#123;</span><br><span class="line">	<span class="keyword">local</span> $x = <span class="string">&quot;yobu&quot;</span>;</span><br><span class="line">	&amp;yobarebu();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">yobarebu</span> </span>&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;$x\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用函数<code>yobu</code>时，变量<code>x</code>被改写为<code>yobu</code>，在函数运行结束重新写回之前，调用<code>yobarebu</code>函数时显示使用的变量<code>x</code>的值为<code>yobu</code>。这说明函数<code>yobu</code>中对变量的更改对于在其中调用的函数运行有影响。</p>
<p>产生这种现象的原因时，在动态作用域中，所有变量共享一张全局对照表，而在进入函数时，会创建一张动态对照表，这张表是所有函数共享的，所有的函数都可以读取到，这就造成了上述现象的发生。</p>
<p>总结来说，在动态作用域中，每个变量在查找对应的地址时，按照由近到远的顺序来查找。这造成了函数嵌套调用时相互影响的现象，为了解决这种现象，我们可以给每个函数使用单独的对照表进行存储变量，这就是静态作用域。</p>
<h3 id="静态作用域">静态作用域</h3>
<p>静态作用域每个函数单独使用一张变量表。计算机在寻找变量时，首先从函数内部的变量表中进行查找，如果找不到则到全局变量表中进行查找。这很好的解决了动态作用域下函数嵌套调用时产生的问题。</p>
<p>然而，静态作用域在使用时也存在一些问题。一是嵌套函数的问题，以Python为例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&quot;global&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    x = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bar</span>():</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">    bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>在该嵌套函数中，<code>bar</code>函数中输出的<code>x</code>乍一看应该是<code>foo</code>，然而，在Python
2中，函数<code>bar</code>在查找变量<code>x</code>时，首先查找局部对照表，没找到时直接在全局对照表中进行查找，因此输出结果是<code>global</code>。这种设计给程序带来了很多误解。直到Python
3中才解决了这个问题。</p>
<p>第二个问题是外部作用域的再绑定问题。当我们想要在函数中修改一个外部作用域的值时，反而会创建一个新的变量，从而无法修改外部作用域的值。例如：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&quot;global&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    x = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bar</span>():</span><br><span class="line">        x = <span class="string">&quot;bar&quot;</span></span><br><span class="line">        <span class="comment"># 创建了一个新的x</span></span><br><span class="line">        <span class="comment"># 无法修改外面的x</span></span><br><span class="line">    bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>在Python 3.0中，引入了<code>nonlocal</code>关键字来解决这个问题：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&quot;global&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    x = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bar</span>():</span><br><span class="line">    	<span class="keyword">nonlocal</span> x</span><br><span class="line">        x = <span class="string">&quot;bar&quot;</span></span><br><span class="line">        <span class="comment"># 创建了一个新的x</span></span><br><span class="line">        <span class="comment"># 无法修改外面的x</span></span><br><span class="line">    bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<h2 id="小结">小结</h2>
<p>计算机技术的发展带来了更强大的计算能力，从而出现了越来越复杂的程序。命名与作用域的发展凸显了当程序规模很大时，为变量和函数命名时人与计算机之间的矛盾。编程语言中的任何特性都并非凭空产生，而是为了解决某些问题而出现的。</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Programming</tag>
      </tags>
  </entry>
  <entry>
    <title>线性滤波与非线性滤波实验</title>
    <url>/10ee70e7.html</url>
    <content><![CDATA[<p>本文围绕自由落体运动的估计，进行了线性滤波和非线性滤波的实验。下面这张图是源自西安交通大学蔡远利教授的《随即滤波与控制》课程。
该课程主要围绕估计，平滑与预测三方面讲解各类滤波方法。</p>
<figure>
<img
src="https://download.kezhi.tech/img/202211291710418.jpg?x-oss-process=style/webp"
alt="Map of Control Theory" />
<figcaption aria-hidden="true">Map of Control Theory</figcaption>
</figure>
<span id="more"></span>
<h2 id="问题描述">问题描述</h2>
<ol type="1">
<li><p>已知一物体作自由落体运动，对其高度进行了20次测量，测量值如下表：</p>
<figure>
<img
src="https://download.kezhi.tech/img/202206171143534.png?x-oss-process=style/webp"
alt="image-20220617114332337" />
<figcaption aria-hidden="true">image-20220617114332337</figcaption>
</figure></li>
<li><p>同样考虑自由落体运动的物体，用雷达（和物体在同一水平面）进行测量，如图所示，如果雷达测距和测角的量测噪声为高斯白噪声序列，均值为0，方差阵
<span class="math inline">\(R=\begin{bmatrix}0.04
&amp;0\\0&amp;0.01\end{bmatrix}\)</span>，试根据以下测量数据确定物体的高度和下落速度随时间变化的估计值：</p>
<p><img
src="https://download.kezhi.tech/img/202206171202388.png?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202206171212236.png?x-oss-process=style/webp" /></p>
<p>该下落运动和雷达检测信息如下图所示：</p>
<p><img
src="https://download.kezhi.tech/img/202206171212177.png?x-oss-process=style/webp" /></p></li>
</ol>
<h2 id="模型介绍">模型介绍</h2>
<h3 id="线性估计问题">1. 线性估计问题</h3>
<p>设在自由落体运动时，物体高度为 <span
class="math inline">\(h\)</span>，速度为 <span
class="math inline">\(v\)</span> （向下为正），设 <span
class="math inline">\(x_1=h,x_2=v\)</span>，则系统的状态方程为：</p>
<p><span class="math display">\[
    \begin{bmatrix}
        \dot x_1\\\dot x_2
    \end{bmatrix}=
    \begin{bmatrix}
        0&amp;-1\\
        0&amp;0\\
    \end{bmatrix}
    \begin{bmatrix}
        x_1\\x_2
    \end{bmatrix}+
    \begin{bmatrix}
        0\\1
    \end{bmatrix}g\ \ (g=9.80m/s^2)
\]</span></p>
<p>由上述状态方程可以解出系统的状态转移函数为：</p>
<p><span class="math display">\[
    x(t)=\begin{bmatrix}
        1&amp;-t\\
        0&amp;1
    \end{bmatrix}x(0)
    +\begin{bmatrix}
        -t\\1
    \end{bmatrix}u(t)
\]</span></p>
<p>当步长为 1s 时系统的状态转移函数为：</p>
<p><span class="math display">\[
\Phi_{k+1,k}=\begin{bmatrix}
        1&amp;-1\\
        0&amp;1
    \end{bmatrix}
    \ \Psi_{k+1,k}=\begin{bmatrix}
        -1\\
        1
    \end{bmatrix}
\]</span></p>
<p>由此可得，系统的一步预测为：</p>
<p><span class="math display">\[
x_{k+1,k}=\Phi_{k+1,k}x_{k|k}+\Psi_{k+1,k}u_k
\]</span></p>
<p>由于观测是对物体高度的直接测量，并且假设量测误差为均值为0，方差为1的白噪声，则量测方程为：
<span class="math display">\[
    y_k=H_kx_k+v_k
\]</span></p>
<p>其中： <span class="math display">\[
H_k\equiv \begin{bmatrix}
    1\\0
\end{bmatrix},
\ v_k \sim N(0,1),
\ R=1
\]</span></p>
<p>本题给出的数据中，量测高度单位为<span
class="math inline">\(km\)</span>，加速度为<span
class="math inline">\(9.8m/s\)</span>，为便于计算，统一距离单位为<span
class="math inline">\(km\)</span>，时间单位统一为<span
class="math inline">\(s\)</span>，即重力加速度<span
class="math inline">\(g=0.0098km/s\)</span>。由于滤波初值未给定，根据量测数据估算初始高度为<span
class="math inline">\(2km\)</span>，初始速度为0，即<span
class="math inline">\(x_{0|0}=\begin{bmatrix}2&amp;0\end{bmatrix}\)</span>。由于这样确定的初始估计值比较粗糙，因此方差较大，设定系统初始方差阵为<span
class="math inline">\(P_{0|0}=\begin{bmatrix}10&amp;0\\0&amp;10\end{bmatrix}\)</span>。</p>
<p>建立卡尔曼滤波： <span class="math display">\[
x_{k+1,k}=\Phi_{k+1,k}x_{k|k}+\Psi_{k+1,k}u_k\\
P_{k+1|k}=\Phi_{k+1,k}P_{k|k}\Phi^\top_{k+1,k}\\
P_{k+1|k+1}=[P_{k+1|k}^{-1}+H_{k+1}^{\top} R_{k+1}^{-1}H_{k+1}]^{-1}\\
K_{k+1}=P_{k+1|k+1}H_{k+1}^\top R_{k+1}^{-1}\\
\hat x_{k+1|k+1}=\hat x_{k+1|k}+K_{k+1}(y_{k+1}-H_{k+1}\hat x_{k+1|k})
\]</span>
对物体自由落体下降高度和速度进行计算，计算结果见后文实验结果部分。</p>
<h3 id="非线性估计问题">2. 非线性估计问题</h3>
<p>在第2个问题中，量测与估计值为非线性关系，考虑采用非线性卡尔曼滤波算法对其进行估计，本报告中采用扩展式卡尔曼滤波算法（EKF）。</p>
<p>设测量的斜距为<span
class="math inline">\(l(km)\)</span>，俯仰角为<span
class="math inline">\(\theta(rad)\)</span>，物体高度为<span
class="math inline">\(h(km)\)</span>，下降速度为<span
class="math inline">\(v(km/s)\)</span>（向下为正），物体在地面上的竖直投影到雷达的距离为<span
class="math inline">\(d_0\)</span>。</p>
<p>为便于后续线性化计算，选取系统状态量为： <span
class="math display">\[
x_1=h,\ x_2=v,\ x_3=d_0
\]</span> 则系统的状态方程为： <span class="math display">\[
\dot x=
\begin{bmatrix}
0&amp;-1&amp;0\\
0&amp;0&amp;0\\
0&amp;0&amp;0
\end{bmatrix}x+
\begin{bmatrix}
0\\
1\\
0
\end{bmatrix}g,\ 其中\ g=0.0098\ km/s
\]</span> 求解得出当时间间隔为<span
class="math inline">\(0.5s\)</span>时，系统的离散状态转移函数为： <span
class="math display">\[
\Phi_{k+1,k}=\begin{bmatrix}
1&amp;-0.5&amp;0\\
0&amp;1&amp;0\\
0&amp;0&amp;1
\end{bmatrix},\
\Psi_{k+1,k}=\begin{bmatrix}
-0.125\\
0.5\\
0
\end{bmatrix}
\]</span> 系统观测为雷达测量出的斜距和俯仰角，则： <span
class="math display">\[
y_1=l=\sqrt{h^2+d_0^2}=\sqrt{x_1^2+x_3^2}\\
y_2=\theta=\arctan(\frac{h}{d_0})=\arctan(\frac{x_1}{x_3})
\]</span> 观测量对状态量求导可得： <span class="math display">\[
\frac{\partial y_1}{\partial x_1}=\frac{x_1}{\sqrt{x_1^2+x_3^2}}\\
\frac{\partial y_1}{\partial x_2}=0\\
\frac{\partial y_1}{\partial x_3}=\frac{x_3}{\sqrt{x_1^2+x_3^2}}\\
\frac{\partial y_2}{\partial x_1}=\frac{x_3}{x_1^2+x_3^2}\\
\frac{\partial y_2}{\partial x_2}=0\\
\frac{\partial y_2}{\partial x_3}=-\frac{x_1}{x_1^2+x_3^2}\\
\]</span> 因此，系统的局部线性化系数为： <span class="math display">\[
H=\begin{bmatrix}
\frac{x_1}{\sqrt{x_1^2+x_3^2}}&amp;0&amp;\frac{x_3}{\sqrt{x_1^2+x_3^2}}\\
\frac{x_3}{x_1^2+x_3^2}&amp;0&amp;-\frac{x_1}{x_1^2+x_3^2}
\end{bmatrix}
\]</span> 扩展卡尔曼滤波（EKF）的计算过程如下： <span
class="math display">\[
x_{k+1,k}=\Phi_{k+1,k}x_{k|k}+\Psi_{k+1,k}u_k\\
P_{k+1|k}=\Phi_{k+1,k}P_{k|k}\Phi^\top_{k+1,k}\\
P_{k+1|k+1}=[P_{k+1|k}^{-1}+H_{k+1}^{\top} R_{k+1}^{-1}H_{k+1}]^{-1}\\
K_{k+1}=P_{k+1|k+1}H_{k+1}^\top R_{k+1}^{-1}\\
\hat x_{k+1|k+1}=\hat x_{k+1|k}+K_{k+1}(y_{k+1}-H_{k+1}\hat x_{k+1|k})
\]</span> 其中，与卡尔曼滤波不同的地方在于<span
class="math inline">\(H\)</span>系数矩阵是通过在观测点进行局部线性化得到的。通过上述步骤即可对非线性观测进行滤波估计。</p>
<h2 id="实验结果">实验结果</h2>
<h3 id="线性滤波问题">1. 线性滤波问题</h3>
<p>根据题中给出的高度观测数据进行线性卡尔曼滤波，计算得到的结果如下：</p>
<p>高度估计数据为：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">时间</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">高度</td>
<td style="text-align: center;">1.9943</td>
<td style="text-align: center;">1.9791</td>
<td style="text-align: center;">1.9550</td>
<td style="text-align: center;">1.9211</td>
<td style="text-align: center;">1.8774</td>
<td style="text-align: center;">1.8244</td>
<td style="text-align: center;">1.7605</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">时间</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">12</th>
<th style="text-align: center;">13</th>
<th style="text-align: center;">14</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">高度</td>
<td style="text-align: center;">1.6870</td>
<td style="text-align: center;">1.6038</td>
<td style="text-align: center;">1.5103</td>
<td style="text-align: center;">1.4075</td>
<td style="text-align: center;">1.2947</td>
<td style="text-align: center;">1.1723</td>
<td style="text-align: center;">1.0400</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">时间</th>
<th style="text-align: center;">15</th>
<th style="text-align: center;">16</th>
<th style="text-align: center;">17</th>
<th style="text-align: center;">18</th>
<th style="text-align: center;">19</th>
<th style="text-align: center;">20</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">高度</td>
<td style="text-align: center;">0.8980</td>
<td style="text-align: center;">0.7460</td>
<td style="text-align: center;">0.5845</td>
<td style="text-align: center;">0.4129</td>
<td style="text-align: center;">0.2317</td>
<td style="text-align: center;">0.0405</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>绘制出高度变化图如下：</p>
<p><img
src="https://download.kezhi.tech/img/202206171314878.png?x-oss-process=style/webp" /></p>
<p>下落速度（向下为正）滤波数据如下表所示：</p>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">时间</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">下落速度</td>
<td style="text-align: center;">0.0078</td>
<td style="text-align: center;">0.0157</td>
<td style="text-align: center;">0.0247</td>
<td style="text-align: center;">0.0343</td>
<td style="text-align: center;">0.0439</td>
<td style="text-align: center;">0.0536</td>
<td style="text-align: center;">0.0635</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">时间</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">12</th>
<th style="text-align: center;">13</th>
<th style="text-align: center;">14</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">下落速度</td>
<td style="text-align: center;">0.0733</td>
<td style="text-align: center;">0.0831</td>
<td style="text-align: center;">0.0930</td>
<td style="text-align: center;">0.1028</td>
<td style="text-align: center;">0.1126</td>
<td style="text-align: center;">0.1224</td>
<td style="text-align: center;">0.1322</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">时间</th>
<th style="text-align: center;">15</th>
<th style="text-align: center;">16</th>
<th style="text-align: center;">17</th>
<th style="text-align: center;">18</th>
<th style="text-align: center;">19</th>
<th style="text-align: center;">20</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">下落速度</td>
<td style="text-align: center;">0.1420</td>
<td style="text-align: center;">0.1519</td>
<td style="text-align: center;">0.1616</td>
<td style="text-align: center;">0.1714</td>
<td style="text-align: center;">0.1812</td>
<td style="text-align: center;">0.1911</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>绘制出速度变化图如下：</p>
<p><img
src="https://download.kezhi.tech/img/202206171354944.png?x-oss-process=style/webp" /></p>
<p>同时，高度和下落速度的估计方差随时间变化为：</p>
<table>
<tr>
<td>
<center>
高度估计方差
</center>
</td>
<td>
<center>
速度估计方差
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206171355785.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206171356665.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>从上图中的结果可以看出，卡尔曼滤波对于物体下落高度和速度的估计在新息一开始加入后就迅速减小，之后渐进减小到0附近之后不再有明显下降。物体自由落体的高度变化曲线为抛物线，速度为匀加速变化，符合自由落体的相关物理定律。</p>
<h3 id="非线性估计问题-1">2. 非线性估计问题</h3>
<p>根据题中给出的量测数据以及上文中提到的非线性滤波模型，滤波估计出下落物体的高度和速度变化如下。</p>
<p>物体高度变化为：</p>
<p><img
src="https://download.kezhi.tech/img/202206172029931.png?x-oss-process=style/webp" /></p>
<p>物体下落速度变化为：</p>
<p><img
src="https://download.kezhi.tech/img/202206172029342.png?x-oss-process=style/webp" /></p>
<p>物体自由下落高度和速度估计误差为：</p>
<table>
<tr>
<td>
<center>
高度估计方差
</center>
</td>
<td>
<center>
速度估计方差
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172030142.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172030896.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>从上图估计结果可以看出，下落高度随时间呈抛物线变化，下落速度（向下为正）随时间匀速上升，符合自由落体物理规律。</p>
<h2 id="实验过程中的一些发现">实验过程中的一些发现</h2>
<p>在最开始的编程和实验过程中，由于题目给出的量测数据以<span
class="math inline">\(km\)</span>为单位，为便于计算，将距离单位统一换算为<span
class="math inline">\(km\)</span>处理。但是由于题面中未给出量测方差的单位，故未对该数值进行换算，即按照单位为<span
class="math inline">\(km\)</span>进行处理。</p>
<p>在求解第1题过程中，未发现任何异常，然而在求解第二题时，如果未对量测协方差进行单位换算，将其单位当作<span
class="math inline">\(km\)</span>进行处理，估计出的结果会如下图所示：</p>
<table>
<tr>
<td>
<center>
高度变化
</center>
</td>
<td>
<center>
速度变化
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172039755.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172039518.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>对比上图中计算结果和实验结果中第二问的计算结果可以看出，相对于线性卡尔曼滤波，非线性卡尔曼滤波在计算时收到量测误差的影响更大。这是由于非线性滤波时量测系数矩阵<span
class="math inline">\(H\)</span>是经过局部线性化得到的，如果量测误差本身较大，则会影响卡尔曼系数的计算结果，最终导致估计结果不准确。</p>
<h2 id="附录">附录</h2>
<h3 id="常量配置">常量配置</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@ Author: Yu Zhao</span></span><br><span class="line"><span class="string">@ Contact: yuzhaokz@163.com</span></span><br><span class="line"><span class="string">@ Date: 2022-06-10 16:59:11</span></span><br><span class="line"><span class="string">@ LastEditors: Yu Zhao</span></span><br><span class="line"><span class="string">@ LastEditTime: 2022-06-17 21:02:09</span></span><br><span class="line"><span class="string">@ Description: 知识因被记录而产生价值</span></span><br><span class="line"><span class="string">@ Website: https://kezhi.tech</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">cache_dir=<span class="string">&quot;cache/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># observation</span></span><br><span class="line"></span><br><span class="line">observation_1=[</span><br><span class="line">    [<span class="number">1.9945</span>],</span><br><span class="line">    [<span class="number">1.9794</span>],</span><br><span class="line">    [<span class="number">1.9554</span>],</span><br><span class="line">    [<span class="number">1.9214</span>],</span><br><span class="line">    [<span class="number">1.8777</span>],</span><br><span class="line">    [<span class="number">1.8250</span>],</span><br><span class="line">    [<span class="number">1.7598</span>],</span><br><span class="line">    [<span class="number">1.6867</span>],</span><br><span class="line">    [<span class="number">1.6036</span>],</span><br><span class="line">    [<span class="number">1.5092</span>],</span><br><span class="line">    [<span class="number">1.4076</span>],</span><br><span class="line">    [<span class="number">1.2944</span>],</span><br><span class="line">    [<span class="number">1.1724</span>],</span><br><span class="line">    [<span class="number">1.0399</span>],</span><br><span class="line">    [<span class="number">0.8980</span>],</span><br><span class="line">    [<span class="number">0.7455</span>],</span><br><span class="line">    [<span class="number">0.5850</span>],</span><br><span class="line">    [<span class="number">0.4125</span>],</span><br><span class="line">    [<span class="number">0.2318</span>],</span><br><span class="line">    [<span class="number">0.0399</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">observation_2=[</span><br><span class="line">    [<span class="number">2.82741643781891</span>,<span class="number">0.00075850435876</span>],</span><br><span class="line">    [<span class="number">2.82519811729771</span>,<span class="number">0.00083282260478</span>],</span><br><span class="line">    [<span class="number">2.82066686966236</span>,<span class="number">0.00067808241639</span>],</span><br><span class="line">    [<span class="number">2.81487233105901</span>,<span class="number">0.00085279036802</span>],</span><br><span class="line">    [<span class="number">2.80671786536244</span>,<span class="number">0.00072900768452</span>],</span><br><span class="line">    [<span class="number">2.79725268974089</span>,<span class="number">0.00080072481819</span>],</span><br><span class="line">    [<span class="number">2.78664273475039</span>,<span class="number">0.00075095576213</span>],</span><br><span class="line">    [<span class="number">2.77320365026313</span>,<span class="number">0.00065762725379</span>],</span><br><span class="line">    [<span class="number">2.75919535464551</span>,<span class="number">0.00081186148545</span>],</span><br><span class="line">    [<span class="number">2.74331288628195</span>,<span class="number">0.00079783727034</span>],</span><br><span class="line">    [<span class="number">2.72538888482812</span>,<span class="number">0.00073060712986</span>],</span><br><span class="line">    [<span class="number">2.70664967712312</span>,<span class="number">0.00063242006530</span>],</span><br><span class="line">    [<span class="number">2.68632403406473</span>,<span class="number">0.00063656524495</span>],</span><br><span class="line">    [<span class="number">2.66386533852220</span>,<span class="number">0.00080659845639</span>],</span><br><span class="line">    [<span class="number">2.64093529707333</span>,<span class="number">0.00067704740069</span>],</span><br><span class="line">    [<span class="number">2.61621111727357</span>,<span class="number">0.00076573767706</span>],</span><br><span class="line">    [<span class="number">2.59038109850785</span>,<span class="number">0.00054955759081</span>],</span><br><span class="line">    [<span class="number">2.56298794272843</span>,<span class="number">0.00058487913971</span>],</span><br><span class="line">    [<span class="number">2.53498317950797</span>,<span class="number">0.00055602747368</span>],</span><br><span class="line">    [<span class="number">2.50647589372246</span>,<span class="number">0.00033550412588</span>],</span><br><span class="line">    [<span class="number">2.47571075016386</span>,<span class="number">0.00056012688452</span>],</span><br><span class="line">    [<span class="number">2.44560676000982</span>,<span class="number">0.00056694491978</span>],</span><br><span class="line">    [<span class="number">2.41403690772088</span>,<span class="number">0.00059380631025</span>],</span><br><span class="line">    [<span class="number">2.38252228611696</span>,<span class="number">0.00053681916544</span>],</span><br><span class="line">    [<span class="number">2.35016501182332</span>,<span class="number">0.00065871960781</span>],</span><br><span class="line">    [<span class="number">2.31790939837137</span>,<span class="number">0.00068598344328</span>],</span><br><span class="line">    [<span class="number">2.28597616656453</span>,<span class="number">0.00060922471348</span>],</span><br><span class="line">    [<span class="number">2.25418431681401</span>,<span class="number">0.00057086018918</span>],</span><br><span class="line">    [<span class="number">2.22259320219535</span>,<span class="number">0.00041308535708</span>],</span><br><span class="line">    [<span class="number">2.19237398969466</span>,<span class="number">0.00047302026281</span>],</span><br><span class="line">    [<span class="number">2.16290177997271</span>,<span class="number">0.00030949309972</span>],</span><br><span class="line">    [<span class="number">2.13441725793706</span>,<span class="number">0.00040552624986</span>],</span><br><span class="line">    [<span class="number">2.10811064690727</span>,<span class="number">0.00037545033142</span>],</span><br><span class="line">    [<span class="number">2.08322179823195</span>,<span class="number">0.00017282319262</span>],</span><br><span class="line">    [<span class="number">2.06148109026767</span>,<span class="number">0.00020758327980</span>],</span><br><span class="line">    [<span class="number">2.04219885094031</span>,<span class="number">0.00037186464579</span>],</span><br><span class="line">    [<span class="number">2.02610235314357</span>,<span class="number">0.00018082163465</span>],</span><br><span class="line">    [<span class="number">2.01290326863579</span>,<span class="number">0.00023323830160</span>],</span><br><span class="line">    [<span class="number">2.00463157388395</span>,-<span class="number">0.00004536186964</span>],</span><br><span class="line">    [<span class="number">2.00058143251913</span>,<span class="number">0.00003246284068</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># dimension transform</span></span><br><span class="line">observation_2=[[observation[<span class="number">0</span>],observation[<span class="number">1</span>]*<span class="number">1000</span>] <span class="keyword">for</span> observation <span class="keyword">in</span> observation_2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the parameters of problem 1</span></span><br><span class="line">param_1=&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Phi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">1</span>,-<span class="number">1</span>],</span><br><span class="line">            [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Psi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [-<span class="number">1</span>],</span><br><span class="line">            [<span class="number">1</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;H&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;R&quot;</span>:np.matrix(</span><br><span class="line">        [<span class="number">1</span>/<span class="number">1000</span>]</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># the parameters of problem 2</span></span><br><span class="line">param_2=&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Phi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">1</span>,-<span class="number">0.5</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Psi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [-<span class="number">0.125</span>],</span><br><span class="line">            [<span class="number">0.5</span>],</span><br><span class="line">            [<span class="number">0</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;R&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">0.04</span>/<span class="number">1000</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">0.01</span>],</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="题目1-代码">题目1 代码</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@ Author: Yu Zhao</span></span><br><span class="line"><span class="string">@ Contact: yuzhaokz@163.com</span></span><br><span class="line"><span class="string">@ Date: 2022-06-10 14:44:08</span></span><br><span class="line"><span class="string">@ LastEditors: Yu Zhao</span></span><br><span class="line"><span class="string">@ LastEditTime: 2022-06-17 12:45:17</span></span><br><span class="line"><span class="string">@ Description: 知识因被记录而产生价值</span></span><br><span class="line"><span class="string">@ Website: https://kezhi.tech</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> cache_dir,observation_1,param_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持中文</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  <span class="comment"># 用来正常显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  <span class="comment"># 用来正常显示负号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建cache文件夹</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(cache_dir):</span><br><span class="line">    os.mkdir(cache_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kalman filter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Kalman_filter</span>(<span class="params">x_0:np.matrix,  <span class="comment"># the status of last step</span></span></span><br><span class="line"><span class="params">                  P_0:np.matrix,  <span class="comment"># the variance of last step</span></span></span><br><span class="line"><span class="params">                  y_1:np.matrix,  <span class="comment"># the observation of this step</span></span></span><br><span class="line"><span class="params">                  u_0:np.matrix=<span class="literal">None</span>, <span class="comment"># the input of system</span></span></span><br><span class="line"><span class="params">                  Phi:np.matrix=<span class="literal">None</span>,  <span class="comment"># the status transform matrix </span></span></span><br><span class="line"><span class="params">                  Psi:np.matrix=<span class="literal">None</span>,  <span class="comment"># coefficient of system input</span></span></span><br><span class="line"><span class="params">                  Gamma:np.matrix=<span class="literal">None</span>,   <span class="comment"># coefficient of observing noise</span></span></span><br><span class="line"><span class="params">                  H:np.matrix=<span class="literal">None</span>,    <span class="comment"># y=Hx+v</span></span></span><br><span class="line"><span class="params">                  R:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of observing noise</span></span></span><br><span class="line"><span class="params">                  Q:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of status noise</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># variable check</span></span><br><span class="line">    <span class="keyword">if</span> u_0 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        u_0=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;u_0 is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(u_0))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Phi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Phi=np.matrix(np.eye(x_0.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Phi is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Phi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Psi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Psi=np.matrix(np.zeros((x_0.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Psi is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Psi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Gamma <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Gamma=Psi.copy()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Gamma is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Gamma))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> H <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        H=np.matrix(np.ones((y_1.shape[<span class="number">0</span>],x_0.shape[<span class="number">0</span>])))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;H is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(H))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> R <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        R=np.matrix(np.zeros((y_1.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;R is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(R))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Q <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Q=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Q is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Q))</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># one step prediction</span></span><br><span class="line">    x_10=Phi@x_0+Psi@u_0</span><br><span class="line">    P_10=Phi@P_0@Phi.T+Gamma@Q@Gamma.T</span><br><span class="line">    <span class="comment"># time amend</span></span><br><span class="line">    P_11=(P_10.I+H.T@R.I@H).I</span><br><span class="line">    K_1=P_11@H.T@R.I</span><br><span class="line">    x_11=x_10+K_1@(y_1-H@x_10)</span><br><span class="line">    <span class="keyword">return</span> x_11,P_11,K_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_result</span>(<span class="params">record:<span class="built_in">dict</span>,problem</span>):</span><br><span class="line">    pprint(record)</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> record.items():</span><br><span class="line">        plt.title(key)</span><br><span class="line">        plt.xlabel(<span class="string">&quot;step&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&quot;h&quot;</span>:</span><br><span class="line">            plt.ylabel(<span class="string">&quot;高度:km&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&quot;v&quot;</span>:</span><br><span class="line">            plt.ylabel(<span class="string">&quot;速度:km/s (向下为正)&quot;</span>)</span><br><span class="line">        plt.plot(value)</span><br><span class="line">        plt.savefig(os.path.join(cache_dir,problem+<span class="string">&quot;_&quot;</span>+key+<span class="string">&quot;.png?x-oss-process=style/webp&quot;</span>),dpi=<span class="number">600</span>)</span><br><span class="line">        plt.clf()</span><br><span class="line">        plt.cla()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># solve problem 1</span></span><br><span class="line">    x_0=np.matrix([[<span class="number">2</span>],[<span class="number">0</span>]])</span><br><span class="line">    P_0=np.matrix([[<span class="number">10</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">10</span>]])</span><br><span class="line">    x_record=[x_0]</span><br><span class="line">    P_record=[P_0]</span><br><span class="line">    K_record=[<span class="literal">None</span>]</span><br><span class="line">    <span class="keyword">for</span> obs <span class="keyword">in</span> observation_1:</span><br><span class="line">        y_1=np.matrix(obs).T</span><br><span class="line">        x_1,P_1,K_1=Kalman_filter(</span><br><span class="line">            x_0,</span><br><span class="line">            P_0,</span><br><span class="line">            y_1,</span><br><span class="line">            u_0=np.matrix(<span class="number">9.8</span>/<span class="number">1000</span>),</span><br><span class="line">            Phi=np.matrix(param_1[<span class="string">&quot;Phi&quot;</span>]),</span><br><span class="line">            Psi=np.matrix(param_1[<span class="string">&quot;Psi&quot;</span>]),</span><br><span class="line">            H=np.matrix(param_1[<span class="string">&quot;H&quot;</span>]),</span><br><span class="line">            R=np.matrix(param_1[<span class="string">&quot;R&quot;</span>]),</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        x_record.append(x_1)</span><br><span class="line">        P_record.append(P_1)</span><br><span class="line">        K_record.append(K_1)</span><br><span class="line">        </span><br><span class="line">        x_0=x_1</span><br><span class="line">        P_0=P_1</span><br><span class="line">        </span><br><span class="line">    result_record=&#123;</span><br><span class="line">        <span class="string">&quot;h&quot;</span>:[x[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;v&quot;</span>:[x[<span class="number">1</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;P_0&quot;</span>:[P[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="string">&quot;P_1&quot;</span>:[P[<span class="number">1</span>,<span class="number">1</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="comment"># &quot;K&quot;:K_record,</span></span><br><span class="line">    &#125;</span><br><span class="line">    show_result(result_record,problem=<span class="string">&quot;p1&quot;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="题目2代码">题目2代码</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@ Author: Yu Zhao</span></span><br><span class="line"><span class="string">@ Contact: yuzhaokz@163.com</span></span><br><span class="line"><span class="string">@ Date: 2022-06-17 16:54:31</span></span><br><span class="line"><span class="string">@ LastEditors: Yu Zhao</span></span><br><span class="line"><span class="string">@ LastEditTime: 2022-06-17 21:02:28</span></span><br><span class="line"><span class="string">@ Description: 知识因被记录而产生价值</span></span><br><span class="line"><span class="string">@ Website: https://kezhi.tech</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> cache_dir,observation_2,param_2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持中文</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  <span class="comment"># 用来正常显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  <span class="comment"># 用来正常显示负号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建cache文件夹</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(cache_dir):</span><br><span class="line">    os.mkdir(cache_dir)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compute H in EKF</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_H</span>(<span class="params">x</span>):</span><br><span class="line">    l_2=x[<span class="number">0</span>,<span class="number">0</span>]**<span class="number">2</span>+x[<span class="number">2</span>,<span class="number">0</span>]**<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [x[<span class="number">0</span>,<span class="number">0</span>]/np.sqrt(l_2),<span class="number">0</span>,x[<span class="number">2</span>,<span class="number">0</span>]/np.sqrt(l_2)],</span><br><span class="line">            [x[<span class="number">2</span>,<span class="number">0</span>]/l_2,<span class="number">0</span>,-x[<span class="number">0</span>,<span class="number">0</span>]/l_2],</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># function of observation</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">y</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [np.sqrt(x[<span class="number">0</span>,<span class="number">0</span>]**<span class="number">2</span>+x[<span class="number">2</span>,<span class="number">0</span>]**<span class="number">2</span>)],</span><br><span class="line">            [np.arctan(x[<span class="number">0</span>,<span class="number">0</span>]/x[<span class="number">2</span>,<span class="number">0</span>])],</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># Kalman filter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">EKF</span>(<span class="params">x_0:np.matrix,  <span class="comment"># the status of last step</span></span></span><br><span class="line"><span class="params">        P_0:np.matrix,  <span class="comment"># the variance of last step</span></span></span><br><span class="line"><span class="params">        y_1:np.matrix,  <span class="comment"># the observation of this step</span></span></span><br><span class="line"><span class="params">        u_0:np.matrix=<span class="literal">None</span>, <span class="comment"># the input of system</span></span></span><br><span class="line"><span class="params">        Phi:np.matrix=<span class="literal">None</span>,  <span class="comment"># the status transform matrix </span></span></span><br><span class="line"><span class="params">        Psi:np.matrix=<span class="literal">None</span>,  <span class="comment"># coefficient of system input</span></span></span><br><span class="line"><span class="params">        Gamma:np.matrix=<span class="literal">None</span>,   <span class="comment"># coefficient of observing noise</span></span></span><br><span class="line"><span class="params">        R:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of observing noise</span></span></span><br><span class="line"><span class="params">        Q:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of status noise</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># variable check</span></span><br><span class="line">    <span class="keyword">if</span> u_0 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        u_0=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;u_0 is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(u_0))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Phi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Phi=np.matrix(np.eye(x_0.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Phi is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Phi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Psi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Psi=np.matrix(np.zeros((x_0.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Psi is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Psi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Gamma <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Gamma=np.matrix(np.zeros((x_0.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Gamma is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Gamma))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> R <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        R=np.matrix(np.zeros((y_1.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;R is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(R))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Q <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Q=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Q is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Q))</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># one step prediction</span></span><br><span class="line">    x_10=Phi@x_0+Psi@u_0</span><br><span class="line">    P_10=Phi@P_0@Phi.T+Gamma@Q@Gamma.T</span><br><span class="line">    <span class="comment"># local linearization</span></span><br><span class="line">    H=get_H(x_10)</span><br><span class="line">    <span class="comment"># time amend</span></span><br><span class="line">    P_11=(P_10.I+H.T@R.I@H).I</span><br><span class="line">    K_1=P_11@H.T@R.I</span><br><span class="line">    x_11=x_10+K_1@(y_1-y(x_10))</span><br><span class="line">    <span class="keyword">return</span> x_11,P_11,K_1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mse</span>(<span class="params">x_1:np.matrix,x_2:np.matrix</span>):</span><br><span class="line">    loss=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x_1.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x_1.shape[<span class="number">1</span>]):</span><br><span class="line">            loss+=(x_1[i,j]-x_2[i,j])**<span class="number">2</span></span><br><span class="line">    loss=loss/(x_1.shape[<span class="number">0</span>]*x_1.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="comment"># iteration EKF, which may have a worse result TAT</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">EKF_iter</span>(<span class="params"></span></span><br><span class="line"><span class="params">    x_0:np.matrix,  <span class="comment"># the status of last step</span></span></span><br><span class="line"><span class="params">    P_0:np.matrix,  <span class="comment"># the variance of last step</span></span></span><br><span class="line"><span class="params">    y_1:np.matrix,  <span class="comment"># the observation of this step</span></span></span><br><span class="line"><span class="params">    u_0:np.matrix=<span class="literal">None</span>, <span class="comment"># the input of system</span></span></span><br><span class="line"><span class="params">    Phi:np.matrix=<span class="literal">None</span>,  <span class="comment"># the status transform matrix </span></span></span><br><span class="line"><span class="params">    Psi:np.matrix=<span class="literal">None</span>,  <span class="comment"># coefficient of system input</span></span></span><br><span class="line"><span class="params">    Gamma:np.matrix=<span class="literal">None</span>,   <span class="comment"># coefficient of observing noise</span></span></span><br><span class="line"><span class="params">    R:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of observing noise</span></span></span><br><span class="line"><span class="params">    Q:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of status noise</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># variable check</span></span><br><span class="line">    <span class="keyword">if</span> u_0 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        u_0=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;u_0 is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(u_0))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Phi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Phi=np.matrix(np.eye(x_0.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Phi is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Phi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Psi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Psi=np.matrix(np.zeros((x_0.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Psi is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Psi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Gamma <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Gamma=np.matrix(np.zeros((x_0.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Gamma is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Gamma))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> R <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        R=np.matrix(np.zeros((y_1.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;R is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(R))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Q <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Q=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Q is lacked, use default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Q))</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># one step prediction</span></span><br><span class="line">    x_10=Phi@x_0+Psi@u_0</span><br><span class="line">    P_10=Phi@P_0@Phi.T+Gamma@Q@Gamma.T</span><br><span class="line">    <span class="comment"># local linearization</span></span><br><span class="line">    H=get_H(x_10)</span><br><span class="line">    <span class="comment"># time amend</span></span><br><span class="line">    P_11=(P_10.I+H.T@R.I@H).I</span><br><span class="line">    K_1=P_11@H.T@R.I</span><br><span class="line">    x_11=x_10+K_1@(y_1-y(x_10))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># iteration</span></span><br><span class="line">    count=<span class="number">0</span></span><br><span class="line">    epsilon=<span class="number">1e-9</span></span><br><span class="line">    <span class="keyword">while</span> count&lt;<span class="number">500</span> <span class="keyword">and</span> mse(x_11,x_10)&gt;epsilon:</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        x_10=x_11</span><br><span class="line">        <span class="comment"># local linearization</span></span><br><span class="line">        H=get_H(x_10)</span><br><span class="line">        <span class="comment"># time amend</span></span><br><span class="line">        P_11=(P_10.I+H.T@R.I@H).I</span><br><span class="line">        K_1=P_11@H.T@R.I</span><br><span class="line">        x_11=x_10+K_1@(y_1-y(x_10))</span><br><span class="line">    <span class="keyword">return</span> x_11,P_11,K_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_result</span>(<span class="params">record:<span class="built_in">dict</span>,problem</span>):</span><br><span class="line">    pprint(record)</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> record.items():</span><br><span class="line">        plt.title(key)</span><br><span class="line">        plt.xlabel(<span class="string">&quot;step&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&quot;h&quot;</span>:</span><br><span class="line">            plt.ylabel(<span class="string">&quot;高度:km&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&quot;v&quot;</span>:</span><br><span class="line">            plt.ylabel(<span class="string">&quot;速度:km/s (向下为正)&quot;</span>)</span><br><span class="line">        plt.plot(value)</span><br><span class="line">        plt.savefig(os.path.join(cache_dir,problem+<span class="string">&quot;_&quot;</span>+key+<span class="string">&quot;.png?x-oss-process=style/webp&quot;</span>),dpi=<span class="number">600</span>)</span><br><span class="line">        plt.clf()</span><br><span class="line">        plt.cla()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># solve problem 1</span></span><br><span class="line">    x_0=np.matrix([[<span class="number">2</span>],[<span class="number">0</span>],[<span class="number">2</span>]])</span><br><span class="line">    P_0=np.matrix([[<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>]])</span><br><span class="line">    x_record=[x_0]</span><br><span class="line">    P_record=[P_0]</span><br><span class="line">    K_record=[<span class="literal">None</span>]</span><br><span class="line">    <span class="keyword">for</span> obs <span class="keyword">in</span> observation_2:</span><br><span class="line">        y_1=np.matrix(obs).T</span><br><span class="line">        x_1,P_1,K_1=EKF(</span><br><span class="line">            x_0,</span><br><span class="line">            P_0,</span><br><span class="line">            y_1,</span><br><span class="line">            u_0=np.matrix(<span class="number">9.8</span>/<span class="number">1000</span>),</span><br><span class="line">            Phi=np.matrix(param_2[<span class="string">&quot;Phi&quot;</span>]),</span><br><span class="line">            Psi=np.matrix(param_2[<span class="string">&quot;Psi&quot;</span>]),</span><br><span class="line">            R=np.matrix(param_2[<span class="string">&quot;R&quot;</span>]),</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        x_record.append(x_1)</span><br><span class="line">        P_record.append(P_1)</span><br><span class="line">        K_record.append(K_1)</span><br><span class="line">        </span><br><span class="line">        x_0=x_1</span><br><span class="line">        P_0=P_1</span><br><span class="line">        </span><br><span class="line">    result_record=&#123;</span><br><span class="line">        <span class="string">&quot;h&quot;</span>:[x[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;v&quot;</span>:[x[<span class="number">1</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;d_0&quot;</span>:[x[<span class="number">2</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;P_0&quot;</span>:[P[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="string">&quot;P_1&quot;</span>:[P[<span class="number">1</span>,<span class="number">1</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="string">&quot;P_2&quot;</span>:[P[<span class="number">2</span>,<span class="number">2</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="comment"># &quot;K&quot;:K_record,</span></span><br><span class="line">    &#125;</span><br><span class="line">    show_result(result_record,problem=<span class="string">&quot;p2&quot;</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Kalman Filter</tag>
        <tag>Linear Filter</tag>
        <tag>Nonlinear Filter</tag>
      </tags>
  </entry>
  <entry>
    <title>第一篇论文完成后</title>
    <url>/437bf60f.html</url>
    <content><![CDATA[<p>前段时间，我完成了第一篇论文，经历了从选题 -&gt; 实验 -&gt; 结果分析
-&gt;
论文的全过程。在此期间虽然走了一些弯路，但也对科研发文的方法论有了新的认识。本文将围绕该次发文过程，概述科研大体流程，并对其中的一些细节进行思考。为今后的科研发文以及想要发文章的朋友们提供参考。</p>
<blockquote>
<p>致谢：感谢在实验和论文撰写过程中给予我指导的老师以及与我探讨的朋友们。</p>
</blockquote>
<p><img src="https://download.kezhi.tech/img/202403072120342.webp" alt="Generated by ChatGPT-4" style="width:75%;" /></p>
<span id="more"></span>
<h2 id="为什么要发论文">为什么要发论文？</h2>
<p>在我看来，做一件事的目的直接决定了这件事能不能做好，能不能持续。因此在进行科研之前要先想清楚自己的目的，从而可以对未来做事有更好的指导意义。</p>
<p>首先，发论文不是做研究的最终目的。如果把发论文当作科研的重点，那必然是不可持续的。在我看来，论文的撰写与发表其核心有两个作用：</p>
<ol type="1">
<li>对一定阶段的研究成果进行梳理和总结</li>
<li>与其他科研工作者分享自己的工作</li>
</ol>
<p>当然，除了这两个核心作用之外，发表论文也不可避免地附带着现实收益（学界的影响力，工业界的薪资，高校的考核等等）。因此，在科研过程中，一方面要考虑其学术属性，另一方面也要对现实收益进行考量。两者兼具或许是在当今地学术环境下能够寻求到的一个满意解。</p>
<blockquote>
<p>但科研论文终究是以学术属性为主，需要遵守学术规范和道德，万不可因现实收益而舍弃其核心属性。</p>
</blockquote>
<h2 id="论文撰写流程">论文撰写流程</h2>
<p>一个研究周期大致可以分为以下部分：</p>
<ol type="1">
<li><p>确定选题：选择一个你感兴趣的且未被解决以及解决的不好的问题</p></li>
<li><p>提出方法：提出你认为可以更好解决该问题的方法</p></li>
<li><p>实验和记录：对你的方法进行实验，记录实验结果</p></li>
<li><p>分析整理结果：对实验结果进行分析，若存在不足则返回第2步，完善方法，否则转向第5步</p></li>
<li><p>论文撰写：完成科研论文，分享自己的方法和结果</p></li>
</ol>
<p>选题的大致方向一般都是固定的，重要的是研究的子问题的确定。这一步就需要大量的阅读相关的文献。有两个目的：①
了解大家的工作都做了什么，没做什么，对当前的研究进展有一个大致掌握；②
在阅读文献的过程中进行思考，选择自己接下来要解决的问题。一句话描述这个过程就是
<code>学而不思则罔，思而不学则殆</code>。只看文献不思考那么便得不到有价值的问题，只思考而不读文献则可能找到一个别人做过的问题。我在完成第一篇工作时，就没有充分阅读相关的文献，导致在论文撰写时出了一点小问题。</p>
<p>方法的提出一方面要考虑创新型，另一方面更要考虑其实际意义。从<code>西红柿炒鸡蛋</code>延伸到<code>圣女果炒鹌鹑蛋</code>如果只是研究其味道如何，营养价值几何，那虽不能说是没有创新，但也称得上是毫无意义。但假若由此探究烹饪方法在不同形态下的可扩展性，并且能给未来人们做菜带来一点启示，那便是极有价值的。此外，一个好的方法的提出通常不是一蹴而就的，它需要不断经历<code>提出-&gt;实验-&gt;问题-&gt;再提出</code>的过程来不断打磨最终形成。因此，不必因为最初方法的效果不好而气馁，而要不断快速重复上述迭代过程来提升方法的有效性。</p>
<p>实验和记录通常是时间占比最大的部分，并且这部分时间由于客观规律限制存在时间下限，受主观能动性影响不存在上限。实验的部分不必赘述，这应当是每个科研人的基本功。这里我想强调的是实验的管理以及结果的记录。在我看来，好的实验管理及结果记录应具备以下几点特性：</p>
<ul>
<li>易追溯：当想要调取查看某一次特定实验结果时可以快速，准确地找到</li>
<li>可复现：这里指的不是学术道德意义上地可复现，而是在记录实验结果时，要对当时的实验配置（包括代码版本，参数等）尽可能地进行记录，保证未来想要在此复现可以快速回溯到当时的实验状态</li>
<li>多备份：实验数据毕竟都是自己辛辛苦苦跑出来的，万一由于什么天灾人祸导致数据丢失那想死的心都有了。所以一定要多备份来保证数据安全。</li>
</ul>
<p>结果分析是很十分需要重视的。实验数据只是体现了某种事实，只有对这种事实进行分析和解读才能得出一些可观规律。在分析结果时可以采用多种可视化手段，来让潜藏在数据中的规律更加直观。此外，我个人喜欢关注实验过程中产生的异常值，并分析造成该现象的原因。在这些异常背后通常有着我们没有注意到的地方（实验问题，没学过的理论，甚至新的发现...）</p>
<p>最后是论文撰写，讲真，没什么经验，能把每个部分的内容写完已经是我当前的极限了TAT，以后如果写多了熟练了可以再聊聊这部分。</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>research</tag>
        <tag>总结</tag>
      </tags>
  </entry>
  <entry>
    <title>网站收藏</title>
    <url>/16fab331.html</url>
    <content><![CDATA[<p><img
src="https://download.kezhi.tech/img/202205251650671.webp" /></p>
<span id="more"></span>
<h2 id="实用软件">实用软件</h2>
<ul>
<li><a href="https://geekuninstaller.com/">Geek Uninstaller - the best
FREE uninstaller</a></li>
<li><a href="https://www.bandisoft.com/bandizip/">Windows 版本的
Bandizip · 业内领先的压缩文件解决方案 (bandisoft.com)</a></li>
<li><a href="https://www.7-zip.org/">7-Zip</a></li>
</ul>
<h2 id="文本转语音">文本转语音</h2>
<ul>
<li><p>Free TTS https://freetts.com/</p></li>
<li><p>Balabolka http://balabolka.site/balabolka.htm</p></li>
</ul>
<h2 id="data-source">Data Source</h2>
<h3 id="defi">Defi</h3>
<ul>
<li><p><a
href="https://www.cryptodatadownload.com/">cryptodatadownload.com</a>
下载Defi交易所历史数据</p></li>
<li><p><a href="https://www.coinario.com/">Cryptocurrency -
Coinario.com</a> 查询交易所基本信息</p></li>
<li><p><a href="https://nomics.com/">Nomics: Crypto Market Caps -
Prices, All-Time Highs, Charts</a></p></li>
</ul>
<h3 id="transportation">Transportation</h3>
<ul>
<li><a href="https://www.transtats.bts.gov/">OST_R | BTS | Transtats</a>
美国交通运输数据</li>
</ul>
<h3 id="weather">Weather</h3>
<ul>
<li><a href="https://openweathermap.org/">Сurrent weather and forecast -
OpenWeatherMap</a></li>
</ul>
<h2 id="api">API</h2>
<ul>
<li><a href="https://api.muxiaoguo.cn/">木小果API - 提供免费接口调用平台
(muxiaoguo.cn)</a></li>
</ul>
<h2 id="标准信息查找">标准信息查找</h2>
<ul>
<li>Mac 厂商对照表 https://standards-oui.ieee.org/oui/oui.txt</li>
</ul>
]]></content>
      <categories>
        <category>Collection</category>
      </categories>
      <tags>
        <tag>软件</tag>
        <tag>网站</tag>
        <tag>收藏</tag>
      </tags>
  </entry>
  <entry>
    <title>锦绣太原青年博士行</title>
    <url>/35bdcdc0.html</url>
    <content><![CDATA[<p>24年5月28日 -
24年5月31日，我和果果一起参加了青年博士太原行。总的来说，这次太原之行给我最大的感受就是惊喜。</p>
<p><img src="https://download.kezhi.tech/img/202405311453559.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="抵达太原-开幕式">抵达太原 &amp; 开幕式</h2>
<p>此次太原行是由太原市政府组织，2048名来自各个地方的博士前来参加。这是我第一次来到太原，有一说一，在此之前我并没有特别关注这座城市，也没有要来这里旅游或者就业的打算。那对于我来说，这次太原行给了我一个契机来了解这座城市。</p>
<p>28号晚上，抵达太原，由专车接到酒店入住。主办方准备了一个礼袋，里面有一些小零食，活动文化衫，山西旅游攻略，以及......
一瓶保健醋。</p>
<p>说实话，这个保健醋的味道十分的......陈醋。喝的时候是能品尝到陈醋的独特香味的，但是真的太酸太酸太酸了。</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302237334.jpg?x-oss-process=style/webp" style="width:75%"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302230788.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302233834.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>晚上，和果果到酒店附近的汾河沿河走了走，在桥上看到了对岸的剧院上投影着对我们的欢迎语。除此之外河两岸的很多建筑屏幕也在轮放着相关的标语。这让我有种整座城市都在欢迎我们的感觉。这种感觉迅速拉近了我们与这座城市的距离，令人倍感亲切。</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302232982.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302235305.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302236006.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>第二天早上吃完早饭，7:40就出发前往<code>山西潇河国际会议中心举行开幕式</code>。<del>说实话，这么早起床对于博士来说确实有点困难</del></p>
<p>会场外面准备了很多小零食，这就非常对学术饕餮的胃口^_^</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307315.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307821.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302314259.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307205.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302311640.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307916.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>开幕式市长主持，省长，市委书记，市长，市委组织部部长致辞。开幕式结束后是分各个厅的路演活动。<del>然而我和果果在各个厅游走吃零食。</del></p>
<h2 id="高校-科研院所参观">高校 &amp; 科研院所参观</h2>
<p>开幕式结束后，当天下午是参观活动。我们选择的路线是高校科研院所路线，具体前往的是中科院煤化所和太原理工大学。</p>
<p>先是煤化所。说实话，这个属于专业十分不对口了，走马观花的看了看了解了一下。他们做的
<code>T800</code> 和 <code>T1000</code>
的碳纤维以及各种催化剂看起来都很牛逼。</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302327776.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302327443.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p><img src="https://download.kezhi.tech/img/202405302327070.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>这是参观的一个中试设备，在这个上面做完验证之后就可以进行下一步的投产了。科研院所相比于高校在成果转化方面还是走在前面的。</p>
<p><img src="https://download.kezhi.tech/img/202405302327829.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>囫囵吞枣地参观完煤化所之后，坐车来到了太原理工大学。来了之后果果直奔图书馆开线上会议（乐，这就是博士hhh）</p>
<p><img src="https://download.kezhi.tech/img/202405302328079.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>不得不说，太原理工的图书馆建的是真好，比某不知名的西北第一高校新校区的图书馆好太多了，建议某西北第一高校在这方面向太原理工学习。</p>
<p><img src="https://download.kezhi.tech/img/202405302327398.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p><img src="https://download.kezhi.tech/img/202405302328527.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302328093.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302343056.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>最后再放上太原理工的部分教职待遇，给需要的朋友们参考下：</p>
<p><img src="https://download.kezhi.tech/img/202405302327783.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p><img src="https://download.kezhi.tech/img/202405302328993.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<h2 id="晋祠-天门山">晋祠 &amp; 天门山</h2>
<p>第二天早上的行程是去晋祠和天门山石窟，起的比前一天更早了，7:20就要集合出发。<del>这对我来说实在是太困难了QAQ</del></p>
<p><img
src="https://download.kezhi.tech/img/202405310005086.jpg?x-oss-process=style/webp" /></p>
<p>不得不说，天门山石窟还是很震撼的，依山而建，雕琢精美。尽管历经时间的洗礼，却依然让人觉得宏伟壮观。</p>
<p><img
src="https://download.kezhi.tech/img/202405310005430.jpg?x-oss-process=style/webp" /></p>
<p>但是可憎的小日子在100多年前疯狂偷盗运往海外，现存几乎无一完整的佛像。艹</p>
<p><img
src="https://download.kezhi.tech/img/202405310005499.jpg?x-oss-process=style/webp" /></p>
<p>从天龙山上下来之后，便是前往晋祠了。</p>
<p><img
src="https://download.kezhi.tech/img/202405310005968.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405311317988.jpg?x-oss-process=style/webp" /></p>
<p>晋祠有三绝：周柏，彩塑，难老泉。周柏历经三千多年依然生命力顽强，彩塑从宋代至今依然栩栩如生，难老泉潺潺流淌，生生不息。</p>
<p>有三宝：圣母殿，鱼沼飞梁，献殿。对我来说最震撼，最喜爱的就是圣母殿了。整座殿气势恢宏，里面坐着姜子牙的女儿，周武王的妻子——邑姜。</p>
<p><img
src="https://download.kezhi.tech/img/202405310003973.jpg?x-oss-process=style/webp" /></p>
<p>圣母殿最外面的每个立柱上都盘踞着造型不同的龙像，最可爱的就是这个比✌龙。这个龙爪原本是四根爪子，在历史的岁月中掉了两根，就变成了现在的比✌龙的样子。</p>
<figure>
<img
src="https://download.kezhi.tech/img/202405310003109.jpg?x-oss-process=style/webp"
alt="IMG_20240530_115159" />
<figcaption aria-hidden="true">IMG_20240530_115159</figcaption>
</figure>
<p>大殿屋顶上的雕刻也十分精美，让人不禁感叹我们祖先的艺术造诣和技艺水平。不得不说随着社会经济的发展和自己年纪的逐渐增长，越来越能够感受到我们古代文明的璀璨，延绵不绝和丰富多彩。记得初中的时候，<strong>中华文明源远流长，博大精深</strong>只是历史课本上的一句总结，一个考点。而在这里，这句话在时间和空间中具现。</p>
<p><img
src="https://download.kezhi.tech/img/202405310005930.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405310003658.jpg?x-oss-process=style/webp" /></p>
<p>进入圣母殿之后，里面是邑姜及其侍女的雕像，偌大的殿内没有柱子，为塑像的置景提供了很好的空间条件。不得不再次感叹古人工艺之精巧</p>
<p><img src="https://download.kezhi.tech/img/202405311329642.jpg" /></p>
<p>在晋祠里，我们还遇到了前来游玩的小朋友们，他们穿的服装风格特异，有近代的，民国的，以及我认不出什么制式的汉服。想必对他们来说，中华文明的璀璨是逐渐融入生活之中的，古代文化的传承以及与现代文化的融合必将由他们这代人给出我们想不到的答卷。</p>
<figure>
<img
src="https://download.kezhi.tech/img/202405310005270.jpg?x-oss-process=style/webp"
alt="IMG_20240530_112026" />
<figcaption aria-hidden="true">IMG_20240530_112026</figcaption>
</figure>
<p>在殿外还坐落着一些其他的泥塑，看起来有些熟悉。后来跟其他人交流得知这里是86版西游记里面奔波儿灞那部分的取景地。只能说小时候光看猴了，剧中的美女，布景，古迹都错过了😂</p>
<figure>
<img src="https://download.kezhi.tech/img/202405311329778.jpg"
alt="IMG_20240530_113403" />
<figcaption aria-hidden="true">IMG_20240530_113403</figcaption>
</figure>
<h2 id="钟楼街-古县城">钟楼街 &amp; 古县城</h2>
<p>钟楼街是太原以钟楼为中心打造的一条集旅游，休闲，娱乐，餐饮一体的网红街。进入之后钟楼也在欢迎我们，真的很受宠若惊。</p>
<p><img
src="https://download.kezhi.tech/img/202405310008414.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405310008807.jpg?x-oss-process=style/webp" /></p>
<p>路口的商业大屏也在轮播着对博士们的欢迎</p>
<p><img
src="https://download.kezhi.tech/img/202405310008475.jpg?x-oss-process=style/webp" /></p>
<p>沙棘汁很好喝，说是可以降血脂，为我不甚健康的身体带来了些许慰藉</p>
<p><img
src="https://download.kezhi.tech/img/202405310008247.jpg?x-oss-process=style/webp" /></p>
<p>钟楼街没有太多可以说的内容，这部分就以一张我拍的非常满意的钟楼夜景收尾吧。<code>Mate40 Pro</code>
至今依旧遥遥领先</p>
<p><img
src="https://download.kezhi.tech/img/202405310006497.jpg?x-oss-process=style/webp" /></p>
<p>相比于钟楼街，太原古县城的整体观感是更好的。其依托于县城的城墙而建，内部星罗棋布，东西南北四条大街为主干道，商铺、演出点、景观排布在四条主街的两侧。对于我一个陕西人来说这样的布局再熟悉不过了，简直就像是一个缩小版的西安城区。但和西安城区内不一样的是，这里没有四处穿行的机动车，没有行色匆匆的人们，没有想要建高却为了保护城区景观而形成的低矮高楼。这里有的就是统一的建筑风格和沉浸的游玩体验。</p>
<p><img
src="https://download.kezhi.tech/img/202405302359380.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405302359391.jpg?x-oss-process=style/webp" /></p>
<p>也不知道该念肯德基还是基德肯</p>
<p><img
src="https://download.kezhi.tech/img/202405311358035.jpg?x-oss-process=style/webp" /></p>
<p>古县县衙门，博士双选会在这里进行。里面的空间很大，要是古代的县衙真的是这样的规格的话，那当一个县太爷也确实是有点舒服的。</p>
<p><img
src="https://download.kezhi.tech/img/202405302359859.jpg?x-oss-process=style/webp" /></p>
<p>咱就是说，博士在博士行的时候也不得闲啊（我和果果也是穿插着各种开会和code
review）</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302359035.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302359905.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>古县城的鼓楼和孔圣人庙，孔子庙内不允许拍照就放个门口的图。</p>
<p><img
src="https://download.kezhi.tech/img/202405310000218.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405310000697.jpg?x-oss-process=style/webp" /></p>
<p>古县城内还有一个石头展览馆，里面展示了各类石头以及由其制成的精美工艺品。</p>
<p><img src="https://download.kezhi.tech/img/202405310002112.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>怎么感觉着凤冠比皇冠要好看太多了呢。</p>
<p><img
src="https://download.kezhi.tech/img/202405310002857.jpg?x-oss-process=style/webp" /></p>
<p>由石头做成的满汉全席，真的足以以假乱真了。</p>
<p><img
src="https://download.kezhi.tech/img/202405310001241.jpg?x-oss-process=style/webp" /></p>
<p><img src="https://download.kezhi.tech/img/202405310001789.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>这么大一块青金石，能给全身装备附魔了吧！</p>
<p><img
src="https://download.kezhi.tech/img/202405310003823.jpg?x-oss-process=style/webp" /></p>
<p>自然状态下的铜矿也很好看</p>
<p><img
src="https://download.kezhi.tech/img/202405310002939.jpg?x-oss-process=style/webp" /></p>
<p>离开之前吃了当地特色的陈醋、沙棘、白酒冰淇淋。陈醋冰淇淋是出乎意料的好吃。它保留了陈醋的醇香以及柔和的酸味，再结合冰淇淋的口感，让人回味无穷。</p>
<p><img
src="https://download.kezhi.tech/img/202405310003733.jpg?x-oss-process=style/webp" /><img
src="https://download.kezhi.tech/img/202405302359776.jpg?x-oss-process=style/webp" /></p>
<p>吃完冰淇淋，我和果果便离开了太原古县城，坐车回了酒店。整个青年博士太原行到这里就画上了一个句号。虽然为其不长，但让我思绪良多，便专门写了结语这一部分来谈谈。</p>
<p><img src="https://download.kezhi.tech/img/202405302358571.jpg?x-oss-process=style/webp" style="width:75%;" /></p>
<h2 id="结语">结语</h2>
<p>这次太原行我最大的感受就是惊喜。令人惊喜的招待，令人惊喜的城市建设，令人惊喜的文化底蕴，令人惊喜的人才政策。可以看出，太原市政府对吸引人才这方面是非常重视的。这不止体现在金钱的投入上，也在于整个活动安排的认真细致。准确的活动时间安排，活动各地风格不同但都设计用心的欢迎标语，从各个单位抽调出来的优秀组织者和工作人员无一不体现着太原市对于本次活动的重视程度。</p>
<p>再说说我对太原这座城市的感受。就像她宣传的那样，太原是一个宜居的城市，四季分明但又气候宜人应当是对她最适合的形容。太原的各种基础设施建设和商圈也是比较完善的。但一个比较突出的问题就是缺人。不知道是因为在周内还是别的什么原因，商场、商业街、以及古镇的人流量都是比较小的。2022年太原的第二产业占比
44.2%，第三产业占比 54.9%<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>。其中，旅游经营收入仅有3.37亿元<a
href="#fn2" class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a>，还有很大的增长空间。</p>
<p>最后，再谈谈对太原市政府的一点小建议。从一个外地游客的视角来看，太原的文创产品是少的可怜的。有山西特色的文创主体主要集中在面食，醋，煤炭这些现代物品之上。如果不是有这次太原行活动，在当前的情形下我是不太会选择太原作为我旅游的目的地的。但当我来过之后发现其实太原的文旅资源是十分丰富的，晋祠，天龙山石窟，乔家家训，古县城都是很有文化特色并且别具一格的。可当我想要在返程给朋友们带些纪念品时，却发现这方面的文创产品很少甚至没有。文创店内山西特色的产品大约不足20%，其余的要么是全国都能买到的饰品，要么是别的省市的特色产品。最终，我带回去的是两个看起来不错的煤炭钥匙扣。尽管我想要在回家后把太原所具有的历史底色传达给身边的朋友们，但在缺少实物载体的情况下这显得有些困难。说实话，我是不太想送煤炭或者醋相关的纪念品的，因为这无疑会加深他人对山西的刻板印象。但作为一个消费者来说，我可以选择的空间有些过于有限了。</p>
<p>在我看来，未来的城市发展不只是经济之争、人才之争，也是文化之争，形象之争。随着我国经济结构的转型，人民需求的转变，势必也会带来居住地选择的变化。越来越多的人选择逃离北上广，或是回到故乡，或是寻觅山清水秀之地，亦或是带上行李周游全国。新时代的中国人随着经济的发展有了选择多样生活的底气，而我们幅员辽阔，物产丰富的土地又何尝不能满足这些勤劳的人的需求呢。太原有着宜人的气候，有着完善的基础设施建设，有一批认真做事的人，有丰富的历史文化资源，有着很好的资源禀赋。这些都需要通过各种途径宣传出去，让更多的人听到太原的声音，了解太原的过去，现在和将来。这对太原来说可以吸纳更多的人前往，对国人来说也多了一种生活方式的选择。</p>
<h2 id="参考资料">参考资料</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>2022年太原市经济运行情况-太原市统计局网站
(taiyuan.gov.cn)](https://stats.taiyuan.gov.cn/sjjd/20230201/30018602.html#:~:text=三次产业占GDP,%、54.9%。)<a
href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>2022年太原市经济运行情况-太原市统计局网站
(taiyuan.gov.cn)](https://stats.taiyuan.gov.cn/sjjd/20230201/30018602.html#:~:text=三次产业占GDP,%、54.9%。)<a
href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>太原</tag>
        <tag>博士行</tag>
      </tags>
  </entry>
  <entry>
    <title>转折</title>
    <url>/36e895f1.html</url>
    <content><![CDATA[<p>现在是2023年5月17日凌晨00时57分，不知道是下午喝了那杯拿铁的缘故，还是因为这两天发生的事情，到现在依旧没有困意。此外，脑中也有很多想法在不断涌现和争辩。思来想去，与其在床上胡思乱想，亦或是借酒助眠，不如来工位写一篇文章，梳理一下脑中所想，将不断涌现的混乱的想法整理为有条理与逻辑的文本内容。</p>
<blockquote class="blockquote-center">
<p>红豆生南国，春来发几枝？</p>
<p>愿君多采撷，此物最相思。</p>

</blockquote>
<span id="more"></span>
<p>这篇文章的题目没有经过太多的思考便定了下来——转折。我的人生在今年发生了重大的变故，父亲的离世，与爱人的分手，转为博士研究生。这一系列的事件让我的情绪在几个月内经历了大量的变动。可以说我20岁之后的情绪比我20岁之前加起来都要多。</p>
<p>我一直迷茫的事情就是自己是谁，要做什么。</p>
<p>幼儿园的事情已经记不太清了，只记得我当时是班级最高的几名学生之一，每次排队都站在最后面。在就是大班报名的时候，镇上的幼儿园已经没有空余的名额了。爷爷不想让我现在家里，就安排我到村后面的小学跟着上一年级，于是我便没有上大班和学前班来到了小学。</p>
<p>小学的时光是简单而纯粹的，一到五年级，我的成绩都是年级第一。不过小时候是爷爷奶奶带大的，不太注意个人卫生，因为这件事没少被老师批评教育。在班里我有几个称得上是关系好的朋友，大都是班上比较聪明的男生。没有关系太好的女孩，因为她们总是在放学回家的路上，从我背后把我的裤子。即使是现在，我也没有想明白她们是这样做是出于何种缘故。到了六年级，我便在父亲的安排下转学到了西安。对了，在此之前，我都是爷爷奶奶带大的，只有每年暑假时会去被接去西安和爸妈住一段时间，寒假时爸妈回来过年，每逢播种和收获时父亲回老家帮忙，以及大概在我三四年级的时候父亲翻修家里的房子这些时间我是和爸妈可以待在一起的。每次与爸妈分别，我大多会目送他们离开，然后自己一人跑到房间里哭泣。这可能是那时候的我最强烈的情绪罢。</p>
<p>到了西安的小学之后，我的成绩依然很好，只有语文和英语略有些差。但这不影响我在班级中成为焦点人物。年龄小，数学好过年级所有的学生，每次数学课都是第一个完成老师布置的任务然后跑到微机室玩电脑的（数学老师兼任微机老师的一点小福利）。后来，数学老师就不让我去了，让我在教室里给同学辅导，或者给我布置更难的习题来做。</p>
<p>初中，升学到了远东二中。考试只考了数学，当成绩出来之后，父母在交借读费时看到了我的成绩是第一名。由此还少交了几千块钱来着。这是我第一次感受到成绩好带来的现实价值。刚到远二时，最明显的感觉是不合群。远东二中的大部分学生都是远东二小的，他们之间有很多共同话题可以交谈，学校周围也都是他们熟悉的地方。而我一方面从农村来到城市，对很多事情没有概念；另一方面性格比较内向，没有很强的交际能力。不过好在，学习成绩好又帮了我一把。它起到了两个作用，一是可以通过讨论学习很轻松的融入一些圈子；二是在人际交往中往往自身不需要太过主动。当然，这些都是从现在往回看的结论，对于当时的我来说，大概是意识不到这些事情的。</p>
<p>初二的时候谈过一场恋爱，这段恋爱最终以我慢慢不再理睬对方而收尾。没有一个比较正式的分手过程，现在想想的确很不好。结束的起因就只是因为我身边的几个朋友们多次告诉我“她和我在一起就是想让我给她讲题”。在我后来意识到这件事的荒谬之之后，我便告诉自己感情方面的事情，冷暖自知即可，他人的评价并不重要。</p>
<p>到初三的时候，尤其是中考的前夕。我第一次对自己的价值陷入了迷茫。在过去，我的几乎所有的正面反馈均来自于我的学习成绩，而在待人接物方面，通常都是负面评价居多。而在那时，我渐渐不知道该如何与身边的同学进行相处，除了几个很好的朋友以外，在和大部分同学相处时都会十分敏感。而那时的我也不懂得向他人倾诉或寻求任何帮助，只得将这些心思放在心底，等待着前往高中之后作出新的转变。而最后，在这样的情绪压力以及对中考不够重视的情况下，我的中考成绩失利了。</p>
<p>602分，基本可以说与五大名校无缘，我第一次在父亲的脸上看到了失望和凝重的表情。那天他带着我去西安三中咨询，他说了很多，我沉默了一路。</p>
<p>之后，便到了三中上学，学籍在尊德中学。差别就在于每年要多出几千的学费。我是怀着不甘来到这所高中的，后来我发现很多人也是这样，有交大附中的，铁一中的。相比于本校初中升学的学生，我和他们有着更多的共同语言。不只是因为大家的境遇相似，更多的可能是因为相比于本校学生，我们的心中有着对于一些东西的敬畏。</p>
<p>这三年的高中时光里，是我心智成长最快的时候，也是我干蠢事最多的时候。具体的事情这里就不说了，因为我大概这辈子都不会忘记。对我影响最深的一段恋爱也是这时候开始的。一开始就只是经常聊天，然后是我的表白，再然后经常打电话，在之后就是答应要在一起，日子是2017年3月12日，也就是高考那年我生日那天。我是在高烧的被窝里听到表白的，真的很开心。那之后的一段时间是我最开心的时候，就像所有热恋中的情侣一样，有说不完的情话，不愿意挂断的电话，以及对两个人未来的无限憧憬。不过随着高考的到来，这样的热情慢慢冷却，我们两人的身心大部分都投入到了学习之上。</p>
<p>以上就是大学之前，我印象比较深刻的时光了。大学生活就暂且按下不表，总的来说，过的不算一帆风顺。回忆就先到这里，接下来聊聊今后吧。</p>
<p>第一件事是关于感性和理性的，在我的大脑中，主要存在着两种意识。一个包含了我的各类情感：爱情，亲情，欲望，懒惰，怯懦等等，还有一个包含了我的大部分理性：逻辑，推理，知识，无畏，审慎等等。两个意识在碰到与自己相关的问题时常常会吵架，对外表现为决策游移不定，容易变卦。相对来说，感性的那部分更弱，出来的频率也低，但一旦冲动行事，造成的破坏不小。理性的部分较强，并且可以支持我完成很多事情，但缺乏共情。这两者之间的平衡是今后一件重要的事，</p>
<p>第二件事是关于自己内心的，每个男人心中都有一个小男孩，直到现在，有时候我还是会把自己当作小孩来思考一些事情。这当然是无可厚非的，前提是不要对他人，尤其是亲近的人造成不好的影响，这很重要。</p>
<p>第三件事是关于自己人生道路的，说了过去这么多经历，其实是为了想明白自己到底是谁，究竟要做什么。过去，我通常被周围的环境以及人以及所定义。“懂事的孩子”，“不爱说话”，“年龄小”，“理解力差”，“成绩不用父母担心”等等等等。而我有时也会被困在这些定义中，将自己活成别人描述的样子，追逐他人口中定义的“好”。然而，这些评价固然有一定的参考价值，但从本质上来说，都是从我出发而产生的衍生品。我自身，自己才是最根本的事物，而非其他的任何评价。因此，现在的我认为，我心中所想就构成了我本身。至于我要做什么，在自己的专业领域，我将会成为一个对社会和人民有价值，有贡献的人；在个人的生活上，健康是第一要义，在此基础上可以衍生任何我所喜欢的事物；在家庭方面，沟通，信任与包容是最重要的三件事物。</p>
<p>以前的成长是被动的，无可奈何的。这次的转折是主动的，不再逃避的。</p>
<p>写成于2023年5月17日凌晨02时30分。</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>心情</tag>
      </tags>
  </entry>
  <entry>
    <title>限制WSL内存使用</title>
    <url>/a587561c.html</url>
    <content><![CDATA[<p>在使用WSL2时，系统有空余内存的情况下，Linux子系统在运行时会不断分配系统内存。随着其不断运行，占据的内存越来越大，甚至会将Windows系统内存占满。因此，在运行WSL时要限制其内存的使用。</p>
<span id="more"></span>
<p>操作流程如下：</p>
<ol type="1">
<li><p>在用户目录下创建<code>.wslconfig</code>配置文件</p>
<ul>
<li>打开命令行</li>
<li>输入命令<code>notepad .wslconfig</code>创建并编辑配置文件</li>
</ul></li>
<li><p>写入WSL配置：</p>
<p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[wsl2]</span><br><span class="line">memory=2GB</span><br><span class="line">swap=8GB</span><br><span class="line">localhostForwarding=true</span><br></pre></td></tr></table></figure></p></li>
<li><p>重启WSL<code>wsl --shutdown</code></p></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>WSL</tag>
      </tags>
  </entry>
  <entry>
    <title>高斯分布熵的推导</title>
    <url>/80e25821.html</url>
    <content><![CDATA[<p>本文主要进行了一元高斯分布熵的推导：</p>
<p><img src="https://download.kezhi.tech/img/202312051655209.jpg?x-oss-process=style/webp" alt="113646456_p0" style="width:33%;" /></p>
<span id="more"></span>
<p><span class="math display">\[
\begin{equation}
p(x) = \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma}}
\end{equation}
\]</span></p>
<p><span class="math display">\[
\begin{align}
H(x) &amp; = -\int p(x) \ln p(x) \mathrm{d}x \notag \\
&amp; = -\int
\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}} \cdot \ln
\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\mathrm{d}x \notag \\
&amp; = -\int
\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}} \cdot
(-\ln {\sqrt{2\pi\sigma^2}}-\frac{(x-\mu)^2}{2\sigma^2}) \mathrm{d}x
\notag \\
&amp; = \int \frac{\ln
{\sqrt{2\pi\sigma^2}}}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\cdot
\mathrm{d}x+\int\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\cdot\frac{(x-\mu)^2}{2\sigma^2} \mathrm{d}x \notag \\
&amp; = \ln\sqrt{2\pi\sigma^2}+\frac {1}{\sqrt{\pi}}\int e^{-t^2}\cdot
t^2\mathrm{d}t \notag \\
&amp; = \ln\sqrt{2\pi\sigma^2}+\frac 12 \notag \\
&amp; = \frac 12(\ln(2\pi\sigma^2)+1)
\end{align}
\]</span> 其中： <span class="math display">\[
\begin{equation}
\int e^{-x^2}\mathrm{d}x = \sqrt\pi
\end{equation}
\]</span></p>
<p><span class="math display">\[
\begin{align}
\int x^2\cdot e^{-x^2}\mathrm{d}x &amp; = -\frac12 \int
x(-2x)e^{-x^2}\mathrm{d}x \notag \\
&amp;=-\frac12 \int x\mathrm{d}e^{-x^2} \notag \\
&amp;=-\frac12 (x\cdot e^{-x^2}\Big|_{-\infty}^{+\infty}-\int
e^{-x^2}\mathrm{d}x) \notag \\
&amp;=\frac12 \int e^{-x^2}\mathrm{d}x) \notag \\
&amp;=\frac {\sqrt{\pi}}{2}
\end{align}
\]</span></p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Math</tag>
      </tags>
  </entry>
  <entry>
    <title>黄蜂群算法改进的多机器人区域覆盖</title>
    <url>/623a6b90.html</url>
    <content><![CDATA[<p>GitHub地址：<a
href="https://github.com/KezhiAdore/MultiRobots_CoverMap">https://github.com/KezhiAdore/MultiRobots_CoverMap</a></p>
<p>码云地址：<a
href="https://gitee.com/KezhiAdore/MultiRobots_CoverMap">https://gitee.com/KezhiAdore/MultiRobots_CoverMap</a></p>
<h2 id="一问题提出">一、问题提出</h2>
<h3 id="背景">1. 背景</h3>
<p>机器人在工业、国防和科学技术中的应用日益广泛，
它能够在枯燥和危险的复杂非结构化环境下工作。使用机器人大大提高了人们的工作效率，
改变了人们的生活方式， 带来了巨大的经济和社会效益，
有力地推动了有关学科和技术领域的发展。</p>
<p>区域覆盖是指携带有一定探测范围的传感器如激光、声纳等的机器人探索访问整个区域，
并完成相应任务的过程。区域覆盖是自主移动机器人的一项基本任务。</p>
<span id="more"></span>
<p><img src="https://download.kezhi.tech/img/20200622224835.gif" /></p>
<center>
图1.1 扫地机器人——机器人区域覆盖问题的一个实例
</center>
<h3 id="问题定义">2. 问题定义：</h3>
<ol type="1">
<li><p>一群有自主移动能力和有限感知能力的机器人，协作对有界联通区域进行覆盖。</p></li>
<li><p>机器人可重复覆盖区域中的某一位置，目标是区域的覆盖率到达一定值。</p></li>
<li><p>机器人以分布式的，非集中控制的方式完成任务，依据自身探测到的局部信息确定行动逻辑，不依赖于外部的控制。</p></li>
<li><p>要求覆盖的速度尽可能快。</p></li>
</ol>
<h3 id="问题的复杂性分析">3. 问题的复杂性分析</h3>
<p>相对一般的智能优化问题，群机器人区域覆盖问题在以下方面更加复杂：</p>
<ul>
<li><p>动态性：加入了时间维度，问题所得到的解是若干个机器人行走的路径（点序列），解空间极其庞大。</p></li>
<li><p>分布式：算法的执行中心在单个的机器人上，没有外部主机予以统一控制。而单一机器人的计算能力和感知能力不高，用以决策的算力与信息有限。</p></li>
<li><p>大规模：为了保证地图表示的精度，栅格地图的单元格数必然很多。同时实际环境地图复杂多变且面积较大，机器人数目较多。</p></li>
</ul>
<h2 id="二模型初步建立">二、模型初步建立</h2>
<h3 id="对环境的建模">1. 对环境的建模</h3>
<p>将地图栅格化，形成栅格地图作为机器人运动和障碍物放置的环境。</p>
<p>栅格地图是把环境划分成一些矩形的小栅格，其中每一栅格作为机器人运动，覆盖的最小单元。每个栅格都具有一定的属性，例如信息素的浓度，是否被覆盖过，以及是空地或是障碍物。</p>
<p><img
src="https://download.kezhi.tech/img/20200622225508.png?x-oss-process=style/webp" /></p>
<center>
图2.1 栅格化示例
</center>
<p>在地图中遍布有一些障碍物，对于障碍物栅格，机器人不能通过，但是可以被机器人感知到。</p>
<h3 id="对机器人的建模">2. 对机器人的建模</h3>
<h4 id="机器人质点化">2.1机器人质点化</h4>
<p>忽略机器人的物理形态，把机器人当作一个无体积无碰撞的质点。机器人只能处于栅格地图中某一个单元格内，同一单元格允许存在有多个机器人。</p>
<h4 id="机器人探测范围">2.2机器人探测范围</h4>
<p>由于分布式机器人电源的局限性，其探测范围也是很有限的，在栅格化地图上为了简化运算，将机器人的探测信息素的范围规定为上下左右四个单位。</p>
<p><img
src="https://download.kezhi.tech/img/20200622225820.png?x-oss-process=style/webp" /></p>
<center>
图2.2 机器人的探测范围
</center>
<h4 id="机器人的功能">2.3机器人的功能</h4>
<p>机器人可以执行以下操作：移动到上下左右四个方向中的一个或者保持不动，对上下左右和本身所处的单元格进行感知，以及对自身所处的单元格的信息素浓度进行修改。</p>
<p>我们更多地考虑信息素对于机器人行为的影响而不是研究在物理上具体使用什么信息素来通信，因此将每个位置的信息素浓度抽象为一个数字，机器人到达该位置即可以修改该地的信息素。</p>
<h3 id="对时间的建模">3.对时间的建模</h3>
<p>将时间离散化，每一单位时间称为“轮”。每一轮，每个机器人按照以下流程进行行动：</p>
<p>Step1：实现对当前单元格的覆盖</p>
<p>Step2：修改当前所在单元格的信息素</p>
<p>Step3：进行一次移动，或者选择停在原地不移动。</p>
<p>每轮所有机器人这三步行为都是同步发生的。</p>
<h3 id="对问题的解的建模">4.对问题的解的建模</h3>
<h4 id="解的表示">4.1解的表示</h4>
<p>对于一个单元格，可以使用横纵坐标组成数对<span
class="math inline">\((x,y)\)</span>来表示。那么假如覆盖过程持续了<span
class="math inline">\(t\)</span>轮，共有<span
class="math inline">\(n\)</span>个机器人参与覆盖，解可以由<span
class="math inline">\(n\)</span>个长度为<span
class="math inline">\(t\)</span>的单元格序列表示，即每个机器人的移动轨迹。其中合法的解不应该包含有障碍物单元格。所有单元格组成的集合，就是已覆盖的单元格。</p>
<h4 id="解的优劣衡量">4.2解的优劣衡量</h4>
<p>我们定义覆盖率为已被覆盖的单元格在所有单元格中的占比。同时设定，目标覆盖率为<span
class="math inline">\(\alpha\)</span>。当前覆盖率超过<span
class="math inline">\(\alpha\)</span>或时间超过上限之时，覆盖过程停止。解的优劣由覆盖用时<span
class="math inline">\(t\)</span>衡量。对于相同大小的地图，同样数目的机器人，达到给定覆盖率的用时越短则解越好。进行多次试验。达到给定覆盖率的平均用时越短则算法性能越好，平均用时的标准差越小说明算法性能越好。</p>
<h2 id="三算法设计及改进">三、算法设计及改进</h2>
<h3 id="地图和机器人共性描述">1. 地图和机器人共性描述</h3>
<p>针对该问题，不同的覆盖算法机器人的运行规则不同。但是地图的建立和描述在不同算法中是相同可以复用的。对于地图的描述如下：
- 地图大小为<span
class="math inline">\(M*N\)</span>，机器人总数量为<span
class="math inline">\(n\)</span>，分别为<span
class="math inline">\(r_1,r_2\ldots r_i\ldots r_n\)</span> -
地图上某一点<span
class="math inline">\(\left(i,j\right)\)</span>的信息素为<span
class="math inline">\(s_{ij}\)</span>，初始时每个点的信息素为1</p>
<h3 id="基本的黄蜂群算法">2. 基本的黄蜂群算法</h3>
<p>机器人的运行规则为：</p>
<ol type="1">
<li>每个机器人的响应阈值为: <span
class="math inline">\(\theta\)</span></li>
<li>对于处在<span class="math inline">\((x_i,y_i)\)</span>的机器人<span
class="math inline">\(r_i\)</span>，首先更新其所在位置的信息素：</li>
</ol>
<p><span class="math display">\[
s_{x_iy_i}=s_{x_iy_i}\ast\alpha（\alpha\in(0,1)）
\]</span></p>
<ol start="3" type="1">
<li><p>探测四周的信息素记为：上：<span
class="math inline">\(s_1\)</span> 下：<span
class="math inline">\(s_2\)</span> 左：<span
class="math inline">\(s_3\)</span> 右：<span
class="math inline">\(s_4\)</span></p></li>
<li><p>机器人选择方向<span class="math inline">\(k\)</span>的概率为：
<span class="math display">\[
\frac{s_k^2}{\theta^2+\sum_{k=1}^{4}s_k^2}
\]</span></p></li>
<li><p>停留在原地的概率为： <span class="math display">\[
\frac{\theta_i^2}{\theta^2+\sum_{k=1}^{4}s_k^2}
\]</span></p></li>
<li><p>使用轮盘赌法选择下一步的运动方向或是停留在原地</p></li>
</ol>
<p>上述算法是文献中最基本的黄蜂群算法，有两个影响机器人运行的参数<span
class="math inline">\(\theta\)</span>和<span
class="math inline">\(\alpha\)</span>，通过仿真实验分别探究这两个参数对于地图覆盖的影响。以下所有仿真地图大小为<span
class="math inline">\(100*100\)</span>，机器人数量为50，初始随机分布地图上。</p>
<p><img
src="https://download.kezhi.tech/img/20200623002730.png?x-oss-process=style/webp" /></p>
<center>
图3.1 θ的变化对于覆盖结果的影响
</center>
<p>从上述实验结果可以看出，随着<span
class="math inline">\(\theta\)</span>的增加，覆盖时间和时间方差迅速增长，从算法角度分析，<span
class="math inline">\(\theta\)</span>越大，机器人在四周被探索之后有更大的角度停留在原地。</p>
<p><img
src="https://download.kezhi.tech/img/20200623002917.png?x-oss-process=style/webp" /></p>
<p>在<span
class="math inline">\(\theta\)</span>很小时，即使机器人当前四周的方格被经过了多次，机器人仍有很大的概率继续移动，而非停留在原地。</p>
<p><img
src="https://download.kezhi.tech/img/20200623002947.png?x-oss-process=style/webp" /></p>
<p>当<span
class="math inline">\(\theta\)</span>相较于初始信息素相差不大时，如上图，<span
class="math inline">\(\theta\)</span>为初始信息素的1/10，在这样的情况下，如果其周围的四个方格均已被访问两次以上，则其移动的概率大大降低。这就导致覆盖时间均值和方差急剧上升。
结合上述实验结果，再结合现实实际情况进行考量，由于<span
class="math inline">\(\theta\)</span>在取得较小时机器人停留在原地的作用已经微乎其微，而<span
class="math inline">\(\theta\)</span>较大时又会严重影响地图覆盖速度，而在实际应用场景中，我们更希望群机器人以很快的速度完成覆盖而非节省能源。因此，我们选择去掉机器人停留在原地的规则，即<span
class="math inline">\(\theta\)</span>=0。
在经过上述变动之后，再进行实验探究<span
class="math inline">\(\alpha\)</span>变化对于群机器人覆盖时间的影响。</p>
<p><img
src="https://download.kezhi.tech/img/20200623003121.png?x-oss-process=style/webp" /></p>
<center>
图3.2 α的变化对于覆盖结果的影响
</center>
<p>由上述实验数据可以看出，随着<span
class="math inline">\(\alpha\)</span>的变化，覆盖时间和覆盖时间标准差变化不大，并且有着先增大后减小的趋势。这是因为在<span
class="math inline">\(\alpha\)</span>很小时，探索过区域的信息素浓度变化很快，有效的防止了重复探索，而在<span
class="math inline">\(\alpha\)</span>较大时，对于回到曾经探索过的区域有一定的容忍，可以让机器人回到原来区域覆盖之前漏掉的区域。两者各有优劣，不过总的来说，<span
class="math inline">\(\alpha\)</span>的取值对于覆盖效率的影响不大。</p>
<h3 id="自适应信息素释放黄蜂群算法">3. 自适应信息素释放黄蜂群算法</h3>
<p>对上述黄蜂群算法进行分析，我们发现，以下两种情况在黄蜂群算法下，中心区域信息素的变化是相同的。</p>
<p><img
src="https://download.kezhi.tech/img/20200623003224.png?x-oss-process=style/webp" /></p>
<center>
图3.3 地图探索的不同情形
</center>
<p>但实际上，对于右图，为了探索中心节点周围的空白节点，我们希望有机器人可以再次回到中心节点。而对于左图，由于其四周基本都已经被探索完全，再次回到中心节点的意义不大，我们希望机器人尽量不要回到该区域。
由此，我们提出自适应释放信息素的方法，当周围未探索方格较多时，信息素的修改较小，当未探索方格较多时，信息素的修改较大。同时我们希望该变化是非线性的，新的信息素释放方法如下：</p>
<ul>
<li>信息素的基本更新依然为： <span class="math display">\[
s=s\ast\alpha\
\]</span></li>
<li>设某个方格周围的空格格数为m个，则增加的权重指数为: <span
class="math display">\[
k=1+\frac{4-m}{4}
\]</span></li>
<li>那么机器人在某个方格更新信息素的方式变为： <span
class="math display">\[
s=s\times\alpha^k
\]</span></li>
</ul>
<h3 id="有记忆回溯的黄蜂群算法">4. 有记忆回溯的黄蜂群算法</h3>
<p>在障碍物地图覆盖测试中，我们发现，会出现如下现象：机器人困在某个入口很小的封闭小区域无法出门。这就导致机器人被困住无法正常工作。</p>
<p><img
src="https://download.kezhi.tech/img/20200623003821.png?x-oss-process=style/webp" /></p>
<center>
图3.4 机器人被困
</center>
<p>为了避免这种情况，我们考虑到深度优先搜索具有的回溯性特点，通过记忆历史路径在无路可走时进行回溯，结合记忆回溯黄蜂群算法的算法流程如下：</p>
<p><img
src="https://download.kezhi.tech/img/20200623003850.png?x-oss-process=style/webp" /></p>
<center>
图3.5 记忆回溯黄蜂群算法
</center>
<p>使用该算法便可以使机器人即使进入局部障碍物区域，也可以通过记忆路径回溯从局部环境走出，具有很好的可靠性和鲁棒性。</p>
<h2 id="四性能测试及改进方向">四、性能测试及改进方向</h2>
<h3 id="空旷地图测试">1.空旷地图测试</h3>
<p>空旷地图是最简单，最方便测试的地图，在其上的测试结果可以很好的反映上述几个算法耗费的时间以及时间稳定性。同时本次实验加大实验次数，每张地图每种算法测试500次，避免偶然性，在空旷地图上的测试结果如下：</p>
<p><img
src="https://download.kezhi.tech/img/20200623004514.png?x-oss-process=style/webp" /></p>
<p>由上述实验结果可以看出，自适应信息素释放黄蜂群的探索时间最短，时间稳定性也最好，其他两个算法覆盖时间相当，时间稳定性记忆回溯黄蜂群略差。</p>
<h3 id="简单障碍物地形测试">2. 简单障碍物地形测试</h3>
<p><img
src="https://download.kezhi.tech/img/20200623012150.png?x-oss-process=style/webp" /></p>
<center>
图4.1 简单障碍物地图
</center>
<p>在上述地图的测试结果为：</p>
<p><img
src="https://download.kezhi.tech/img/20200623012213.png?x-oss-process=style/webp" /></p>
<p>测试结果与在空旷地图中的结果有了很大的不同，记忆回溯黄蜂群的两个评价指标最优，其次是自适应信息素释放的黄蜂群，基本黄蜂群所花费的时间较长，时间稳定性也较差。</p>
<h3 id="实地地形测试">3. 实地地形测试</h3>
<h4 id="温泉浴室">3.1 温泉浴室</h4>
<p>温泉浴室的地图如下：</p>
<p><img
src="https://download.kezhi.tech/img/20200623012251.png?x-oss-process=style/webp" /></p>
<center>
图4.2 温泉浴室平面图
</center>
<p>该地图最大的特点是存在大量的小房间，入口很小，机器人进入之后很容易被困住无法出来，在该地图上三种算法的运行结果为：</p>
<p><img
src="https://download.kezhi.tech/img/20200623012321.png?x-oss-process=style/webp" /></p>
<p>由于地形的影响，加之为了测试实际环境，所有机器人均从地图左上角出发而非初始随机分布，使得三种算法覆盖地图所用时间有了较大延长。</p>
<p>三项结果对比，记忆回溯黄蜂群的运行效率最高，自适应信息素释放黄蜂群效率次之并且相差不大，而基本黄蜂群所用的时间较长且时间稳定性差。</p>
<h4 id="仲英书院">3.2 仲英书院</h4>
<p>仲英书院的地形如下：</p>
<p><img
src="https://download.kezhi.tech/img/20200623012351.png?x-oss-process=style/webp" /></p>
<center>
图4.3 仲英书院平面图
</center>
<p>实验结果为：</p>
<p><img
src="https://download.kezhi.tech/img/20200623012410.png?x-oss-process=style/webp" /></p>
<p>在此地图中，记忆回溯黄蜂群明显由于其余两个智能算法，自适应信息素释放也同样比基本的黄蜂群算法时间效率上更优，时间稳定性上，记忆回溯黄蜂群的优势相比其余两个优势很大。</p>
<h3 id="实验结论">4. 实验结论</h3>
<p>•
启发式信息素释放的黄蜂群算法相较于基本的黄蜂群算法在全部情况下时间花费更优。</p>
<p>•
深度优先搜索改进的黄蜂群算法在空白地图上优势不大，甚至在同一起点出发时效果很差，但在有大量障碍物的地图上表现很好，由于基本黄蜂群算法和启发式黄蜂群算法。</p>
<h3 id="其他改进思路">5. 其他改进思路</h3>
<p><em>有限长度记忆的深度优先搜索改进的黄蜂群算法</em></p>
<p>由于实际情况下，无限记忆的dfs算法会因为移动误差和内存限制原因而难以实现，可以在算法中加入长度限制。</p>
<ol type="1">
<li>队列限长：使用双端队列替代栈，在队列长度超出限制时弹出队尾元素。</li>
<li>栈限长：在栈长度超出限制时强制回溯。</li>
</ol>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>智能计算</tag>
        <tag>多机器人</tag>
        <tag>覆盖问题</tag>
        <tag>算法改进</tag>
      </tags>
  </entry>
  <entry>
    <title>聚会互认问题小记</title>
    <url>/244334e3.html</url>
    <content><![CDATA[<p>前两天，由4位轮值主席组织的第一届游在长安活动正式落幕。在活动组织过程中，有一个小游戏的分组问题很有一次，在此记录。</p>
<p><img src="https://download.kezhi.tech/img/202307011126365.png?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="聚会互认问题背景">聚会互认问题背景</h2>
<p>事情是这样的，该次活动由4位轮值主席组织，由轮值主席邀请其一级朋友圈（即直接朋友）和二级朋友圈（即朋友的朋友）参加。因此，对于每一个参与活动的人来说，活动中总是有一部分人是不认识的。并且每个人不认识的人数是不等的。活动参与总人数约为14人</p>
<p>因此，我们采用了这样一个流程来帮助大家互相记住他人的名字：</p>
<ol type="1">
<li>所有参与活动的人均等分为两组</li>
<li>两组内部分别进行<em>直呼其名</em>小游戏</li>
<li>所有参与活动的人重新均等分为两组</li>
<li>两组内部分别进行<em>直呼其名</em>小游戏</li>
</ol>
<blockquote>
<p>直呼其名<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>：</p>
<ol type="1">
<li>选一块宽阔平整的游戏场地。</li>
<li>队员们以小组为单位站成一圈。每人相距约一臂长。作为培训专员的你也不例外。</li>
<li>告诉小组游戏将从你手里开始。你大喊出自己的名字，然后将手中的球传给自己左边的队
友。接到传球的队友也要如法炮制，喊出自己的名字，然后把球传给自己左边的人。这样一直
继续下去，直到球又重新回到你的手中。</li>
<li>你重新拿到球后，告诉大家现在我们要改变游戏规则了。现在接到球的队员必须要喊出另
一个队员的名字，然后把球扔给该队员。</li>
<li>游戏结束后，在解散小组之前，邀请一个志愿者，让他在小组内走一圈，报出每个人的名字。</li>
</ol>
</blockquote>
<p>最开始我们希望通过优化这两次分组的设置即可让所有人相互认识，但在优化的过程中发现这个问题并不像我们预想中那么简单。因此在实践过程中，我们又加了一个步骤：所有参与活动的人一起进行<em>直呼其名</em>的游戏，从而达到预想的让大家都认识的目的。</p>
<h2 id="聚会互认问题">聚会互认问题</h2>
<p>上文中阐述的问题我将之称为聚会互认问题，其可以抽象为一个数学中的图论问题，描述如下：</p>
<blockquote>
<p>任意给定一个包含<span
class="math inline">\(2n\)</span>个点的初始图，可以对其进行<span
class="math inline">\(\Gamma\)</span>操作（把<span
class="math inline">\(2n\)</span>个点均分为两个部分，让这两个部分中的<span
class="math inline">\(n\)</span>个点全连接）。若要求进行2次<span
class="math inline">\(\Gamma\)</span>操作后，这<span
class="math inline">\(2n\)</span>个节点之间全连接，求这2次<span
class="math inline">\(\Gamma\)</span>操作中，应当如何分组？</p>
</blockquote>
<h3 id="解是否存在">解是否存在？</h3>
<p>当然，上面的描述是对我们遇到的问题的数学描述。显然，这个问题是否有解取决于这<span
class="math inline">\(n\)</span>个点构成的初始图。因此，需要对解的存在性进行探讨：</p>
<blockquote>
<p>一个包含<span
class="math inline">\(2n\)</span>个点的初始图，可以对其进行<span
class="math inline">\(\Gamma\)</span>操作（把<span
class="math inline">\(2n\)</span>个点均分为两个部分，让这两个部分中的<span
class="math inline">\(n\)</span>个点全连接）。若存在2次<span
class="math inline">\(\Gamma\)</span>操作，使得在2次<span
class="math inline">\(\Gamma\)</span>操作后，<span
class="math inline">\(2n\)</span>个节点之间全连接。求初始图应该满足的条件。</p>
</blockquote>
<p>首先，<span
class="math inline">\(2n\)</span>个点构成的全连接图包含<span
class="math inline">\(\frac{2n(2n-1)}{2}=2n^2-n\)</span>条边，每次<span
class="math inline">\(\Gamma\)</span>操作会在分成两组的<span
class="math inline">\(n\)</span>个点之间建立全连接，也就是新增不超过<span
class="math inline">\(\frac{n(n-1)}{2}*2=n^2-n\)</span>条边，进行两次<span
class="math inline">\(\Gamma\)</span>操作则新增不超过<span
class="math inline">\(2n^2-2n\)</span>条边。由此我们得到了一个优解的初始图的必要不充分条件：</p>
<ul>
<li>初始边数不少于<span class="math inline">\(n\)</span>条</li>
</ul>
<h3
id="如果2次不行最少需要多少次gamma操作">如果2次不行，最少需要多少次<span
class="math inline">\(\Gamma\)</span>操作？</h3>
<p>此外，在本场景中，由于时间限制，只能进行少量的游戏来在图中建立边，假如没有时间限制，那么对于一个任意的图，最少需要多少次这样的游戏能够建立全连接也是一个值得探讨的问题：</p>
<blockquote>
<p>任意给定一个包含<span
class="math inline">\(n\)</span>个点的初始图，可以对其进行<span
class="math inline">\(\Gamma\)</span>操作：把<span
class="math inline">\(n\)</span>个点均分为两个部分，让这两个部分中的<span
class="math inline">\(n/2\)</span>个点全连接。求至少进行多少次<span
class="math inline">\(\Gamma\)</span>操作可以在这<span
class="math inline">\(n\)</span>个点之间建立全连接。</p>
</blockquote>
<h3 id="每一次的gamma操作是如何分组的">每一次的<span
class="math inline">\(\Gamma\)</span>操作是如何分组的？</h3>
<p>最后，就是根本的求解算法问题：</p>
<blockquote>
<p>任意给定一个包含<span
class="math inline">\(n\)</span>个点的初始图，可以对其进行<span
class="math inline">\(\Gamma\)</span>操作：把<span
class="math inline">\(n\)</span>个点均分为两个部分，让这两个部分中的<span
class="math inline">\(n/2\)</span>个点全连接。求至少进行多少次<span
class="math inline">\(\Gamma\)</span>操作可以在这<span
class="math inline">\(n\)</span>个点之间建立全连接。并给出所有的<span
class="math inline">\(\Gamma\)</span>操作中的分组。</p>
</blockquote>
<h2 id="reference">Reference</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a
href="https://www.xiaohongshu.com/explore/637068d80000000015017520?app_platform=android&amp;app_version=7.85.0&amp;author_share=2&amp;share_from_user_hidden=true&amp;type=normal&amp;xhsshare=WeixinSession&amp;appuid=5a17ada911be1028e2ac1c42&amp;apptime=1687706419">心理团体破冰游戏之直呼其名
(xiaohongshu.com)</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>Happy graduation in 2024.</title>
    <url>/en/35956731.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/35956731.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>In the blink of an eye, it has been seven years since I stepped into
the university campus. Three years ago, I also experienced a graduation,
but at that time, most of my friends chose to continue their studies in
graduate school, so there wasn't much sadness. And this year, most of
the graduate students have also obtained their master's degrees and
embarked on various social positions across the country. From now on, it
may be difficult for us to meet again. With this in mind, I wish all the
friends who are graduating this year a bright future.</p>
<p><img src="https://download.kezhi.tech/img/202406241051402.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="reunion-at-the-wedding">Reunion at the Wedding</h2>
<p>On June 9, 24, Song Ge got married. They have been in love since
their undergraduate years and have now tied the knot. Everyone put aside
their busy schedules and returned to Xi'an from all over the country to
attend Song Ge's wedding.</p>
<p><img src="https://download.kezhi.tech/img/202406241014924.jpg?x-oss-process=style/webp" style="width:75%;" /></p>
<p>In the evening, while everyone was attending the wedding, we gathered
again at a barbecue stall in Xingqing, from day to night. From then on,
Zhu Lao single-handedly established the position of "Guest" at the
automation conference. <del>Also leaving behind precious video
materials</del></p>
<p><img
src="https://download.kezhi.tech/img/202406241018827.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241018505.jpg?x-oss-process=style/webp" /></p>
<h2 id="graduation-photos">Graduation Photos</h2>
<p>Next is the much-anticipated graduation photo session. Xiao Xue and
Jianjian were interning in another city, so they took two photos
together (suggesting a full-body standee next time).</p>
<p><img src="https://download.kezhi.tech/img/202406241025616.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>Two fellow graduates from the research group, wishing them success in
their future work and studies.</p>
<p><img
src="https://download.kezhi.tech/img/202406241026893.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241028403.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241027982.jpg?x-oss-process=style/webp" /></p>
<p>Most of my undergraduate roommates have also graduated (except for a
certain sophomore who loves World War II hhhhh).</p>
<p><img
src="https://download.kezhi.tech/img/202406241029748.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241029272.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241029458.jpg?x-oss-process=style/webp" /></p>
<p>Pretending to graduate myself, basking in the joy😀</p>
<p><img src="https://download.kezhi.tech/img/202406241030462.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<h2 id="graduation-party">Graduation Party</h2>
<p>This year, the graduation ceremony and the graduation party were held
on the same day, with the graduation ceremony during the day and the
graduation party at night. Changing the principal for the graduation
ceremony meant one less anticipated segment, as most of the speeches by
leaders were not very pleasant. However, this year there was an added
segment of releasing pigeons, and many pigeons were set free.</p>
<p><img
src="https://download.kezhi.tech/img/202406241036158.jpg?x-oss-process=style/webp" /></p>
<p>Although I am not graduating, the school's creative ice cream comes
in three flavors✌</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241019765.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241021141.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241021156.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>Graduation Party</p>
<p><img
src="https://download.kezhi.tech/img/202406241036310.jpg?x-oss-process=style/webp" /></p>
<p>The school motto and the westward migration were displayed during the
rehearsal, but were omitted during the actual performance.</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241039263.jpg?x-oss-process=style/webp" />
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241039053.jpg?x-oss-process=style/webp" />
</center>
</td>
</tr>
</table>
<p>Finally, a group photo</p>
<p><img
src="https://download.kezhi.tech/img/202406241040796.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202406241040961.jpg?x-oss-process=style/webp" /></p>
<p>Wishing everyone to always be full of vitality.</p>
<h2 id="automation-dinner">Automation Dinner</h2>
<p>The day after the graduation ceremony, as agreed beforehand, friends
from the undergraduate automation program gathered to have a farewell
dinner.</p>
<p><img
src="https://download.kezhi.tech/img/202406241044954.jpg?x-oss-process=style/webp" /></p>
<p>For those comrades who couldn't be present, we didn't let them feel
lonely either.</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241045135.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202406241045842.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>I have to say, Fuji's straight-out photos are really
high-quality.</p>
<p><img
src="https://download.kezhi.tech/img/202406241047584.jpg?x-oss-process=style/webp" /></p>
<p>World-famous painting: "Xiang Ge Drinking Soup"</p>
<p><img
src="https://download.kezhi.tech/img/202406241046620.jpg?x-oss-process=style/webp" /></p>
<p>Finally, I wish all the friends who have graduated and started
working a bright future, the doctoral students who are still studying to
graduate soon, and the upcoming junior students to find good jobs.</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>毕业</tag>
      </tags>
  </entry>
  <entry>
    <title>Happy graduation in 2023.</title>
    <url>/en/48e66169.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/48e66169.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>As we grow older, we feel that time passes by faster. In the blink of
an eye, it's already 2023. The seniors who are one year older than me
are about to graduate. This blog mainly consists of photos and doesn't
have much text content.</p>
<p>I wish all the graduating seniors a bright future and a wonderful
life. 🎉🎉🎉</p>
<p><img src="https://download.kezhi.tech/img/202306131047631.jpg?x-oss-process=style/webp" style="width:33%;" /></p>
<span id="more"></span>
<p>Let's start with a song called "Goodbye in the Future" as the
background music. I recommend listening to it while reading. ^_^</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1480344409&amp;auto=1&amp;height=66">
</iframe>
<h2 id="graduation-party">Graduation Party</h2>
<p><img
src="https://download.kezhi.tech/img/202306131019051.jpg?x-oss-process=style/webp" /></p>
<center>
Graduation party scene
</center>
<p><img
src="https://download.kezhi.tech/img/202306131021079.jpg?x-oss-process=style/webp" /></p>
<center>
One person achieving the results of seven people
</center>
<p><img
src="https://download.kezhi.tech/img/202306131022653.jpg?x-oss-process=style/webp" /></p>
<center>
I always thought that Hongli Building would have a great display effect,
and it really is stunning
</center>
<h2 id="seniors">Seniors</h2>
<p><img
src="https://download.kezhi.tech/img/202306131026431.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131027348.jpg?x-oss-process=style/webp" /></p>
<center>
So cute~
</center>
<p><img
src="https://download.kezhi.tech/img/202306131028272.png?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131029459.png?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131030337.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306131030062.jpg?x-oss-process=style/webp" /></p>
<p>And who wouldn't want to take a photo with a celebrity.</p>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306131032143.jpg?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306131032204.jpg?x-oss-process=style/webp">
</td>
</tr>
</table>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306131033772.jpg?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306131033428.jpg?x-oss-process=style/webp">
</td>
</tr>
</table>
<h2 id="graduation-photoshoot-of-two-friends">Graduation Photoshoot of
Two Friends</h2>
<blockquote class="blockquote-center">
<p>May time stay in this moment forever, may tomorrow shine like
gold</p>

</blockquote>
<blockquote>
<p>The following are all unedited photos, hehe</p>
</blockquote>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306131035561.jpg?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306131036370.jpg?x-oss-process=style/webp">
</td>
</tr>
</table>
<p><img src="https://download.kezhi.tech/img/202306131036538.jpg?x-oss-process=style/webp" alt="IMG_20230612_122623" style="width:33%;" /></p>
<center>
Prepared two bouquets of flowers and a few peonies
</center>
<p><img src="https://download.kezhi.tech/img/202306131039400.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306141501108.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141450455.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141451789.JPG?x-oss-process=style/webp">
</td>
</tr>
</table>
<table>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306141454583.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141458146.JPG?x-oss-process=style/webp">
</td>
</tr>
<tr>
<td>
<img src="https://download.kezhi.tech/img/202306141456892.JPG?x-oss-process=style/webp">
</td>
<td>
<img src="https://download.kezhi.tech/img/202306141453547.JPG?x-oss-process=style/webp">
</td>
</tr>
</table>
<p><img
src="https://download.kezhi.tech/img/202306141455475.JPG?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202306141459684.JPG?x-oss-process=style/webp" /></p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>毕业</tag>
      </tags>
  </entry>
  <entry>
    <title>Bp Neural Network.</title>
    <url>/en/4f98a72.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/4f98a72.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="overview-of-bp-neural-network">Overview of BP Neural
Network</h2>
<p>The BP neural network is the most basic and widely used neural
network in the field. It consists of three layers of nodes: the input
layer, the hidden layer, and the output layer. The implementation of the
BP neural network is relatively simple, mainly divided into two parts:
forward propagation and backward propagation of errors.</p>
<p>The universal approximation theorem of neural networks states that a
one-dimensional step function can approximate any one-dimensional
continuous function, and a sigmoid function can approximate a step
function. Therefore, a linear combination of one-dimensional sigmoid
functions can approximate any continuous function. This provides a
theoretical basis for the application of neural networks.</p>
<p>The advantage of neural networks lies in the fact that many complex
function mappings that are difficult to solve can be obtained by
combining multiple one-dimensional step functions. The main problem and
difficulty in building a neural network is how to combine these
one-dimensional functions.</p>
<h2 id="understanding-bp-neural-network">Understanding BP Neural
Network</h2>
<p>The BP neural network can be seen as a multi-input multi-output
function. If we ignore its internal structure, it can be represented as
a black box model:</p>
<figure>
<img
src="https://download.kezhi.tech/20200422003115.png?x-oss-process=style/webp"
alt="Black box model of BP neural network" />
<figcaption aria-hidden="true">Black box model of BP neural
network</figcaption>
</figure>
<p>In this BP neural network, there are <span
class="math inline">\(m\)</span> inputs and <span
class="math inline">\(n\)</span> outputs. We know that there should be a
hidden layer between the input and output layers. So how many nodes
should be in the hidden layer? Generally, the determination of the
hidden layer is determined by the following empirical formula: <span
class="math display">\[
h=\sqrt{m+n}+a
\]</span> where <span class="math inline">\(h\)</span> is the number of
nodes in the hidden layer, <span class="math inline">\(m\)</span> is the
number of nodes in the input layer, <span
class="math inline">\(n\)</span> is the number of nodes in the output
layer, and <span class="math inline">\(a\)</span> is an adjustment
constant.</p>
<p>Based on the number of input and output nodes, we can construct a
simple BP neural network model. Its internal structure is as follows
(taking <span class="math inline">\(m=3\)</span>, <span
class="math inline">\(n=3\)</span>, and <span
class="math inline">\(h=3\)</span> as an example):</p>
<figure>
<img
src="https://download.kezhi.tech/20200422003733.png?x-oss-process=style/webp"
alt="Internal structure of a three-layer neural network" />
<figcaption aria-hidden="true">Internal structure of a three-layer
neural network</figcaption>
</figure>
<p>With such a three-layer neural network, any 3D-to-3D mapping can be
achieved through the combination of one-dimensional functions. So how to
establish this mapping? This problem is actually how to train the BP
neural network. The training process mainly consists of two parts:
forward propagation of results and backward propagation of
residuals.</p>
<h2 id="forward-propagation">Forward Propagation</h2>
<p>For any node in the BP neural network, its input is the weighted sum
of the outputs of the previous layer nodes. Taking the hidden layer as
an example, let the output of the input layer node be <span
class="math inline">\(x_i\)</span>, the input of the hidden layer node
be <span class="math inline">\(net_j\)</span>, the weight connecting
node <span class="math inline">\(i\)</span> in the input layer to node
<span class="math inline">\(j\)</span> in the hidden layer be <span
class="math inline">\(w_{ij}\)</span>, and the constant term be <span
class="math inline">\(b_j\)</span>. Then the input of the hidden layer
node is: <span class="math display">\[
net_j=\sum_{i=1}^m w_{ij}x_i+b_j
\]</span> In the BP neural network, in order to ensure that the
activation function is differentiable everywhere, the sigmoid function
is used as the activation function. The output of the node is: <span
class="math display">\[
f(net_j)=\frac1{1+e^{-net_j}}
\]</span></p>
<blockquote>
<p>Advantages of using sigmoid function:</p>
<ol type="1">
<li>Compared to the step function, it is differentiable everywhere in
its domain.</li>
<li>Let <span class="math inline">\(y=sigmoid(x)\)</span>, then <span
class="math inline">\(y&#39;=y(1-y)\)</span>. It can be seen that the
derivative of the sigmoid function can be represented using itself. Once
the value of the sigmoid function is calculated, it is very convenient
to calculate the value of its derivative. This provides convenience for
using gradient descent in backpropagation.</li>
</ol>
<p>Main disadvantages of the sigmoid function:</p>
<ol type="1">
<li><p>Vanishing gradient: Note that when the sigmoid function
approaches 0 or 1, the rate of change becomes flat, which means that the
gradient of the sigmoid tends to 0. Neurons in the network that use the
sigmoid activation function and have outputs close to 0 or 1 are called
saturated neurons. Therefore, the weights of these neurons will not be
updated. In addition, the weights connected to these neurons will also
be updated slowly. This problem is called the vanishing gradient
problem. Therefore, imagine that if a large neural network contains
sigmoid neurons, and many of them are in a saturated state, the network
cannot perform backpropagation.</p></li>
<li><p>Not zero-centered: The output of the sigmoid is not
zero-centered.</p></li>
<li><p>High computational cost: The exp() function has a higher
computational cost compared to other nonlinear activation
functions.</p></li>
</ol>
<figure>
<img
src="https://download.kezhi.tech/20200422005253.png?x-oss-process=style/webp"
alt="Sigmoid function" />
<figcaption aria-hidden="true">Sigmoid function</figcaption>
</figure>
</blockquote>
<p>Each neuron performs this independent calculation, so for a set of
inputs, the neural network can perform calculations to obtain the
corresponding outputs. This is the process of forward propagation.</p>
<h2 id="backward-propagation">Backward Propagation</h2>
<p>At the beginning, all the weights in the system are randomly
determined. Therefore, in order to make the model tend to the desired
result through learning training data, the weights in the nodes need to
be continuously adjusted. The basic algorithm idea of backward
propagation is the gradient descent algorithm in nonlinear programming,
and the goal of the programming is to minimize the loss function. The
general process is as follows:</p>
<ul>
<li>Set the loss function. Assuming that all the results of the output
layer are <span class="math inline">\(d_j\)</span>, the loss function is
as follows:</li>
</ul>
<p><span class="math display">\[
E(w,b)=\frac12\sum_{j=0}^{n-1}(d_j-y_j)^2
\]</span></p>
<ul>
<li>Modify the <span class="math inline">\(w\)</span> and <span
class="math inline">\(b\)</span> from the hidden layer to the output
layer through the loss function. For the weight <span
class="math inline">\(w_{ij}\)</span> from the hidden layer node <span
class="math inline">\(i\)</span> to the output layer node <span
class="math inline">\(j\)</span>, the modification is as follows (where
<span class="math inline">\(\eta\)</span> is the learning rate):</li>
</ul>
<p><span class="math display">\[
\Delta w=-\eta\frac{\partial E}{\partial w_{ij}}
\]</span></p>
<ul>
<li>Similarly, the modification for <span
class="math inline">\(b\)</span> is:</li>
</ul>
<p><span class="math display">\[
\Delta b=-\eta\frac{\partial E}{\partial b_{i}}
\]</span></p>
<p>This is basically the idea. The process of calculating partial
derivatives is quite complex, so I won't go into detail here. Just
remember the idea of using gradient descent to minimize the loss
function.</p>
<h2 id="references">References</h2>
<p>[1] ACdreamers. BP神经网络[G/OL]. CSDN: 2015.03.26[2020.04.22].
https://blog.csdn.net/acdreamers/article/details/44657439</p>
<p>[2] 东皇Amrzs. [整理] BP神经网络讲解——最好的版本[G/OL]. 简书:
2017.02.28[2020.04.22]. https://www.jianshu.com/p/3d96dbf3f764</p>
<p>[3] lx青萍之末. BP神经网络[G]. CSDN: 2018.07.20[2020.04.22].
https://blog.csdn.net/daaikuaichuan/article/details/81135802.</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>神经网络</tag>
        <tag>BP</tag>
      </tags>
  </entry>
  <entry>
    <title>The Impact Of AC Learning Rate Setting on Training Effect in DPG Algorithm.</title>
    <url>/en/46493a5d.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/46493a5d.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Deep reinforcement learning algorithms have more hyperparameters to
tune compared to deep learning. This article mainly discusses the impact
of the learning rate settings for the actor and critic networks in the
DDPG algorithm on the learning performance.</p>
<p><img src="https://download.kezhi.tech/img/202312071724061.png?x-oss-process=style/webp" width="33%"></p>
<span id="more"></span>
<p>Recently, when reproducing the DDPG algorithm, I first followed the
algorithm flow in the paper and then tested it on the continuous
environment "Pendulum-v1". However, the training results were not
satisfactory, and the convergence structure of the algorithm was poor,
as shown in Figure 1.</p>
<p><img
src="https://download.kezhi.tech/img/202309202043247.png?x-oss-process=style/webp" /></p>
<center>
Figure 1: Training results with actor and critic learning rates both set
to 3e-4. Left: critic loss, Right: reward curve
</center>
<p>So I looked for many reproductions of this algorithm to compare and
find out where the problem was. After spending a lot of time confirming
that the decision-making and updating processes of the reproduced DDPG
algorithm were correct, I turned my attention to the setting of
hyperparameters. Finally, I found that the learning rate of the critic
network usually needs to be set slightly higher than that of the actor
network. After increasing the learning rate of the critic net, the DDPG
algorithm finally showed excellent performance and obtained a beautiful
reward curve, as shown in Figure 2.</p>
<p><img
src="https://download.kezhi.tech/img/202309202044469.png?x-oss-process=style/webp" /></p>
<center>
Figure 2: Learning performance after modifying the critic learning rate.
Left: critic loss, Right: reward curve
</center>
<p>After solving this problem, it raised another question: why do the
actor and critic in the DDPG algorithm need different learning rates to
make the algorithm work well? For this, I found discussions about this
issue online. The following are several explanations summarized:</p>
<ul>
<li>The learning rates of the actor and critic are two hyperparameters
that need to be adjusted, and this setting has been found to produce
good results in practice.</li>
<li>If the actor updates faster than the critic, the estimated Q values
may not accurately reflect the value of the actions, because the
critic's Q value function is based on past policy estimations.</li>
<li>Since the actor outputs specific actions, usually bounded, the
learning rate can be smaller. On the other hand, the critic learns the
expected discounted rewards, which are usually unbounded, so a larger
learning rate is needed.</li>
</ul>
<p><img
src="https://download.kezhi.tech/img/202309202032388.png?x-oss-process=style/webp" /></p>
<p>source: <a
href="https://www.reddit.com/r/reinforcementlearning/comments/lsza9m/why_different_learning_rates_for_actor_and_critic/">Why
different learning rates for actor and critic : r/reinforcementlearning
(reddit.com)</a></p>
<p>To further explore the impact of these two parameters on learning, I
conducted a series of experiments using the DDPG algorithm on
"Pendulum-v1".</p>
<ol type="1">
<li><p>Fix the learning rate of the actor at 3e-4 and change the
learning rate of the critic. The experimental results are shown in the
following figure:</p>
<p><img
src="https://download.kezhi.tech/img/202309202109275.png?x-oss-process=style/webp" /></p></li>
<li><p>Fix the learning rate of the critic at 3e-4 and change the
learning rate of the actor. The experimental results are shown in the
following figure:</p>
<p><img
src="https://download.kezhi.tech/img/202309202115148.png?x-oss-process=style/webp" /></p></li>
<li><p>Keep the learning rates of the actor and critic the same, and
change both of them. The experimental results are shown in the following
figure:</p>
<p><img
src="https://download.kezhi.tech/img/202309202117300.png?x-oss-process=style/webp" /></p></li>
</ol>
<p>Based on the above experimental results, the following conclusions
can be drawn:</p>
<ul>
<li>When the learning rate of the actor remains unchanged, appropriately
increasing the learning rate of the critic can accelerate the
convergence speed. If the learning rate of the critic is set too small,
it may lead to slow convergence or even non-convergence.</li>
<li>When the learning rate of the critic is too small and the network is
difficult to converge, adjusting only the learning rate of the actor
cannot make the network converge.</li>
<li>The actor and critic can also converge when their learning rates are
the same, but appropriate parameters need to be selected to achieve
better learning performance.</li>
</ul>
<p>Therefore, when using the DDPG algorithm, it is recommended to set a
slightly higher learning rate for the critic network compared to the
actor network, which can achieve better convergence performance.</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>强化学习</tag>
        <tag>Reinforcement Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>A Fusion Of Llm And Rl.</title>
    <url>/en/b222cfe2.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/b222cfe2.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Recently, Tsinghua University and SenseTime published an article
titled "Ghost in the Minecraft: Generally Capable Agents for Open-World
Environments via Large Language Models with Text-based Knowledge and
Memory," abbreviated as GITM. It's quite interesting, and interested
friends can read the original article.</p>
<p><img
src="https://download.kezhi.tech/img/202306041618232.png?x-oss-process=style/webp" /></p>
<span id="more"></span>
<p>In this article, the authors use large language models to guide the
behavior of intelligent agents and train them using language as an
interactive medium. As a result, they achieved very good experimental
results in the Minecraft environment after training for two days on a
32-core CPU. They also unlocked all the tech trees in the game
<em>Minecraft</em> during the training process.</p>
<p><img src="https://download.kezhi.tech/img/202306041625148.png?x-oss-process=style/webp" style="width:50%;" /></p>
<center>
Comparison of GITM and other models on diamond mining challenge
</center>
<p><img src="https://download.kezhi.tech/img/202306041627612.png?x-oss-process=style/webp" style="width:80%;" /></p>
<center>
Comparison of GITM and other models on tech tree unlocking rate
</center>
<h2 id="background">Background</h2>
<p>First, let's introduce the background of the work done by GITM. The
problem this work aims to solve is to continuously learn from the
beginning of the game initialization in the Minecraft game environment
to achieve the goal of mining diamonds. In the game Minecraft, diamonds
are usually buried at a certain depth underground. To mine a diamond
ore, at least an iron pickaxe is required. To craft an iron pickaxe,
iron is needed, which requires mining iron ore and mastering the
technology of smelting iron. Mining iron ore requires a stone pickaxe,
crafting a stone pickaxe requires stone, and crafting stone requires
wood and a crafting table.</p>
<p>And this is just the tech tree for mining tools. In the game
Minecraft, you also need to continuously replenish food to heal and
prevent hunger, craft weapons and armor to protect yourself, which puts
high demands on the various abilities of the intelligent agent.</p>
<p>The idea of reinforcement learning is that the intelligent agent
observes the environment, generates actions based on the observed data,
the environment changes correspondingly after the agent performs the
action, and the environment provides the agent with a reward signal.
However, in the Minecraft environment, due to its high degree of freedom
and deep tech tree, reinforcement learning has always performed poorly
in this environment.</p>
<h2 id="gitm">GITM</h2>
<p>When solving this problem, GITM did not adopt the reward-guided
action approach of reinforcement learning, but used a large language
model for task decomposition and planning, and finally interacted with
the environment through an interface. Specifically, GITM consists of
three parts: LLM Decomposer, LLM Planner, LLM Interface. Next, let's
introduce these three parts separately.</p>
<h3 id="llm-decomposer">LLM Decomposer</h3>
<p>The role of LLM Decomposer is to decompose the goal. First, define
the goal. In Minecraft, each goal can be defined as a five-tuple: <span
class="math display">\[
(Object, Count, Material, Tool, Info)
\]</span> where <span class="math inline">\(Object\)</span> refers to
the target item, <span class="math inline">\(Count\)</span> specifies
the quantity, <span class="math inline">\(Material\)</span> and <span
class="math inline">\(Tool\)</span> indicate the prerequisites for
obtaining the item, and <span class="math inline">\(Info\)</span>
describes the text knowledge related to the target item. After receiving
a goal input, LLM Decomposer can decompose the goal based on its
prerequisites, generating subtasks with <span
class="math inline">\(Material\)</span> and <span
class="math inline">\(Tool\)</span> as <span
class="math inline">\(Object\)</span>. This decomposition process can be
recursive until the subgoals generated have no prerequisites.</p>
<p>This part can be implemented using a large language model, and the
article also provides specific prompts. Interested friends can try it
with chatGPT, and the effect is quite good.</p>
<h3 id="llm-planner">LLM Planner</h3>
<p>The role of LLM Planner is to decompose a given task into a
combination of structured actions, which are basic actions defined in
Minecraft that can be easily implemented through scripts. Each action
consists of three parts: <span class="math display">\[
(Name, Arguments, Description)
\]</span> The list of structured actions is shown in the table
below:</p>
<p><img
src="https://download.kezhi.tech/img/202306061434297.png?x-oss-process=style/webp" /></p>
<h3 id="llm-interface">LLM Interface</h3>
<p>The main role of LLM Interface is to convert text-based actions
provided by the Planner into actions that can interact with the
environment. There are mainly two ways to achieve this: manually written
scripts and RL learning models. Due to the well-defined structured
actions in Minecraft, a script written by a person is used to control
the actions.</p>
<p>At this level, a language model is also used to decompose actions.
First, after receiving a goal (e.g., "find material and craft an iron
pickaxe"), the language model decomposes it into a tree-structured plan
with a depth of at most 2.</p>
<p>After that, for each leaf node in the tree plan, it is converted into
specific action descriptions ('verb', 'object', 'tools', 'materials')
through the language model.</p>
<h2 id="discussion-on-intelligence">Discussion on Intelligence</h2>
<p>In the Minecraft environment, the method proposed in this article has
achieved very good results:</p>
<p><img
src="https://download.kezhi.tech/img/202306061437232.png?x-oss-process=style/webp" /></p>
<p>Compared to the current state-of-the-art reinforcement learning
algorithms, GITM almost appears in the Minecraft world in a crushing
manner. Its entire process is so reasonable that even such exaggerated
performance comparisons do not make people overly skeptical. The
performance of GITM indicates one thing: in areas where humans have
already mastered, GPT has the potential to achieve a very high level of
intelligence through "looking up strategies." And a large amount of
human knowledge and technology are presented in text form. Therefore,
the potential of this path is enormous.</p>
<p>Nevertheless, I still believe that we are far from true intelligence.
GPT is really too large, and the amount of training data and
computational power it requires is too massive compared to its
capabilities. It must be admitted that Chat GPT has made a big step
forward on the road to AGI, but compared to true intelligence, it is
more like a different kind of search engine, a strategy manual, and even
today it still cannot guarantee reliability over a large range. But it
does give us a glimpse of some shadows of general artificial
intelligence. Finally, I hope that in our lifetime, we can see true
intelligence emerge.</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>GPT</tag>
        <tag>RL</tag>
        <tag>Minecraft</tag>
      </tags>
  </entry>
  <entry>
    <title>Git Commit Message Specification.</title>
    <url>/en/58877bc8.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/58877bc8.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help us
improve the translation. Thanks!</p>
</div>
<h2 id="git-commit-message-specification">Git commit message
specification</h2>
<h3 id="commit-message-format">Commit message format</h3>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h3 id="type">type</h3>
<p>Used to indicate the category of the git commit, only the following
identifiers are allowed.</p>
<p>feat: New feature.</p>
<p>fix/to: Bug fix, can be a bug discovered by QA or a bug discovered by
developers themselves.</p>
<ul>
<li>fix: Generate diff and automatically fix the issue. Suitable for
fixing the problem in one commit.</li>
<li>to: Only generate diff without automatically fixing the issue.
Suitable for multiple commits. Use fix when finally fixing the
issue.</li>
</ul>
<p>docs: Documentation.</p>
<p>style: Formatting (changes that do not affect the code
execution).</p>
<p>refactor: Refactoring (code changes that are neither new features nor
bug fixes).</p>
<p>perf: Performance optimization, such as improving performance and
user experience.</p>
<p>test: Adding tests.</p>
<p>chore: Changes to the build process or auxiliary tools.</p>
<p>revert: Revert to the previous version.</p>
<p>merge: Code merge.</p>
<p>sync: Synchronize bugs in the mainline or branch.</p>
<h3 id="scope-optional">scope (optional)</h3>
<p>Scope is used to indicate the scope affected by the commit, such as
data layer, control layer, view layer, etc., which may vary depending on
the project.</p>
<p>For example, in Angular, it can be location, browser, compile,
compile, rootScope, ngHref, ngClick, ngView, etc. If your modification
affects more than one scope, you can use * instead.</p>
<h3 id="subject-required">subject (required)</h3>
<p>Subject is a brief description of the purpose of the commit, not
exceeding 50 characters.</p>
<p>It is recommended to use Chinese (it feels that using Chinese to
describe the problem can be clearer for Chinese people).</p>
<ul>
<li>Do not add periods or other punctuation marks at the end.</li>
<li>According to the above specification, the git commit message will be
in the following format:</li>
</ul>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">fix(DAO): Missing username attribute in user query</span><br><span class="line">feat(Controller): Development of user query interface</span><br></pre></td></tr></table></figure>
<p>.</p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>语法规范</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker-Vnc Desktop Configuration.</title>
    <url>/en/d97606bd.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/d97606bd.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>When using public servers, users typically have regular user accounts
with limited permissions, unable to configure the server freely
according to their preferences. To meet this demand, Docker is often
used to allow root privileges within containers for environment
configuration. VNC, a commonly used remote desktop tool, facilitates
server-side rendering of graphical interfaces, which is particularly
useful for experiments requiring interfaces (such as mujoco, habitat,
igibson environments). This article mainly discusses configuring VNC
desktop within Docker and provides a pre-packaged image: <a
href="https://hub.docker.com/r/kezhiadore/ubuntu-vnc">kezhiadore/ubuntu-vnc
- Docker Image | Docker Hub</a></p>
<p><img src="https://download.kezhi.tech/img/202311032138787.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<center>
It's lovely rubbish
</center>
<span id="more"></span>
<p>First, start from an initial Ubuntu 18.04 image, download, launch,
and enter the container:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull ubuntu:bionic</span><br><span class="line">docker run -itd --name ubuntu-vnc ubuntu:bionic</span><br><span class="line">docker exec -it ubuntu-vnc</span><br></pre></td></tr></table></figure>
<p>As this container doesn't have a desktop, install the xfce4
desktop:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt install xfce4 xfce4-goodies xorg dbus-x11 x11-xserver-utils</span><br></pre></td></tr></table></figure>
<p>Then, install vncserver after entering:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install tigervnc-standalone-server tigervnc-common</span><br></pre></td></tr></table></figure>
<p>Configure startup files in the user directory:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt install vim</span><br><span class="line">vim ~/.vnc/xstartup</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Add the following script</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">unset SESSION_MANAGER </span><br><span class="line">unset DBUS_SESSION_BUS_ADDRESS </span><br><span class="line">startxfce4 &amp;</span><br><span class="line">[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup </span><br><span class="line">[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources </span><br><span class="line">xsetroot -solid grey</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Save and close the file. The above commands will be executed automatically whenever starting or restarting the TigerVNC server.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Change file permissions</span></span><br><span class="line">chmod +x ~/.vnc/xstartup</span><br></pre></td></tr></table></figure>
<p>Start vncserver:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vncserver :1</span><br></pre></td></tr></table></figure>
<p>The vncserver needs initial configuration for passwords. Once
configured, use a vnc client to access port 5091 to connect to the
remote desktop.</p>
<h2 id="tips">Tips</h2>
<ul>
<li>After entering the desktop, some applications like Google Chrome may
not run under root user mode. Creating a user and launching the remote
desktop under that user's identity can resolve this.</li>
<li>If you encounter issues with terminal not opening, change
<code>application-&gt;settings-&gt;preference</code> in the terminal
settings.</li>
<li>Chinese display garbled characters may result from font and encoding
issues. You can refer to the following tutorials for solutions:
<ul>
<li><a
href="https://blog.csdn.net/qq_40927409/article/details/120030704">Xfce
Desktop Chinese Localization (Command)</a></li>
<li><a
href="https://blog.csdn.net/weixin_42937217/article/details/121970539">Solving
the Problem of Chinese Characters Squares in Xfce</a></li>
<li><a
href="https://learningsky.io/xfce-desktop-environment-display-chinese/">Displaying
Chinese Characters on Xfce Desktop Environment</a></li>
</ul></li>
</ul>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a
href="https://blog.csdn.net/qq_31638535/article/details/131016239">Configuring
VNC and novnc inside Docker containers, accessible from the host or
externally</a></li>
<li><a
href="https://blog.csdn.net/Robert_Q/article/details/127376171">Visualizing
Docker containers using VNC</a></li>
<li><a
href="https://www.pimspeak.com/ubuntu-docker-vnc-desktop.html">Ubuntu
Docker Container with VNC Desktop</a></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Commonly Used Git Commands.</title>
    <url>/en/caff8000.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/caff8000.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="git-file-management-system">Git File Management System</h2>
<blockquote>
<p>This blog is a reprint, the original address is <a
href="https://www.cnblogs.com/chenwolong/p/GIT.html">https://www.cnblogs.com/chenwolong/p/GIT.html</a></p>
</blockquote>
<p><img
src="https://download.kezhi.tech/img/20200424230007.png?x-oss-process=style/webp" /></p>
<span id="more"></span>
<blockquote>
<ul>
<li>Workspace: working directory</li>
<li>Index / Stage: staging area</li>
<li>Repository: repository (or local repository)</li>
<li>Remote: remote repository</li>
</ul>
</blockquote>
<h2 id="create-a-new-code-repository">Create a new code repository</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create a Git code repository in the current directory</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a directory and initialize it as a Git code repository</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download a project and its entire code history</span></span><br><span class="line">$ git clone [url]</span><br></pre></td></tr></table></figure>
<h2 id="configuration">Configuration</h2>
<p>Git's configuration file is <code>.gitconfig</code>, which can be in
the user's home directory (global configuration) or in the project
directory (project configuration).</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Show the current Git configuration</span></span><br><span class="line">$ git config --<span class="built_in">list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Edit the Git configuration file</span></span><br><span class="line">$ git config -e [--<span class="keyword">global</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set user information when submitting code</span></span><br><span class="line">$ git config [--<span class="keyword">global</span>] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--<span class="keyword">global</span>] user.email <span class="string">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="adddelete-files">Add/Delete files</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Add specified files to the staging area</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the specified directory to the staging area, including subdirectories</span></span><br><span class="line">$ git add [<span class="built_in">dir</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add all files in the current directory to the staging area</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># Confirm each change before adding it</span></span><br><span class="line"><span class="comment"># For multiple changes to the same file, multiple commits can be made</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete a file from the working directory and add the deletion to the staging area</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stop tracking a specified file, but keep the file in the working directory</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rename a file and add the renaming to the staging area</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>
<h2 id="code-submission">Code submission</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Submit the staging area to the repository</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Submit the specified file in the staging area to the repository</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Submit changes in the working directory since the last commit directly to the repository</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display all diff information when submitting</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use a new commit to replace the previous commit</span></span><br><span class="line"><span class="comment"># If there are no new changes, the commit message can be modified</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Redo the previous commit and include the new changes to the specified file</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>
<h2 id="branch">Branch</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># List all local branches</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all remote branches</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all local and remote branches</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new branch, but stay on the current branch</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new branch and switch to it</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new branch pointing to the specified commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new branch and establish a tracking relationship with the specified remote branch</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to the specified branch and update the working directory</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to the previous branch</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Establish a tracking relationship between the existing branch and the specified remote branch</span></span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Merge the specified branch into the current branch</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Select a commit and merge it into the current branch</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete a branch</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete a remote branch</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># There is a local branch named develop_chen, but there is no corresponding remote branch. What should I do?</span></span><br><span class="line">$ git push origin develop_chen</span><br><span class="line"></span><br><span class="line"><span class="comment"># This will create a branch on the remote that is the same as the local one.</span></span><br><span class="line"></span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream-to=origin/develop  develop  Establish a tracking relationship between the local branch <span class="keyword">and</span> the remote branch</span><br></pre></td></tr></table></figure>
<h2 id="tag">Tag</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># List all tags</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new tag at the current commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new tag at the specified commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete a local tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete a remote tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># View tag information</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Submit the specified tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Submit all tags</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new branch pointing to a specified tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>
<h2 id="view-information">View information</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Display files with changes</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the version history of the current branch</span></span><br><span class="line">$ git log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the commit history and files changed for each commit</span></span><br><span class="line">$ git log --stat</span><br><span class="line"></span><br><span class="line"><span class="comment"># Search the commit history based on keywords</span></span><br><span class="line">$ git log -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display all changes after a certain commit, with each commit on one line</span></span><br><span class="line">$ git log [tag] HEAD --pretty=<span class="built_in">format</span>:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display all changes after a certain commit, where the &quot;commit description&quot; must match the search criteria</span></span><br><span class="line">$ git log [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the version history of a specified file, including file renaming</span></span><br><span class="line">$ git log --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display each diff related to a specified file</span></span><br><span class="line">$ git log -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the changes made by you today</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the metadata and content changes of a specified commit</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the files changed in a specified commit</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the content of a specified file in a specified commit</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the most recent commits of the current branch</span></span><br><span class="line">$ git reflog</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pull code from the local master to update the current branch: branch is generally master</span></span><br><span class="line">$ git rebase [branch]</span><br></pre></td></tr></table></figure>
<h2 id="remote-synchronization">Remote synchronization</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git remote update  --update remote repository</span><br><span class="line"><span class="comment"># Download all changes from the remote repository</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display all remote repositories</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display information about a specific remote repository</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a new remote repository and name it</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Retrieve changes from the remote repository and merge them with the local branch</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Upload the specified branch from the local repository to the remote repository</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force push the current branch to the remote repository, even if there are conflicts</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># Push all branches to the remote repository</span></span><br><span class="line">$ git push [remote] --<span class="built_in">all</span></span><br></pre></td></tr></table></figure>
<h2 id="undo">Undo</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Restore the specified file in the staging area to the working directory</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Restore the specified file of a certain commit to the staging area and working directory</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Restore all files in the staging area to the working directory</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset the specified file in the staging area to the state of the previous commit, but keep the working directory unchanged</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset the staging area and working directory to the state of the previous commit</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset the pointer of the current branch to the specified commit, and reset the staging area, but keep the working directory unchanged</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset the HEAD of the current branch to the specified commit, and reset the staging area and working directory to the state of the specified commit</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset the HEAD of the current branch to the specified commit, but keep the staging area and working directory unchanged</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new commit to undo the specified commit</span></span><br><span class="line"><span class="comment"># All changes made by the latter will be cancelled out by the former and applied to the current branch</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Temporarily remove uncommitted changes and move them back later</span></span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>
<h2 id="others">Others</h2>
<ol type="1">
<li>Merge the code of the development branch into master</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git checkout dev           <span class="comment">#Switch to the dev development branch</span></span><br><span class="line">$ git pull</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git merge dev              <span class="comment">#Merge the dev branch into master</span></span><br><span class="line">$ git push origin master     <span class="comment">#Push the code to master</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>Synchronize the code of master to the development branch. Merge
method: ensure that the main commit line is clean (can be safely rolled
back)</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ git checkout dev           <span class="comment">#Switch to the dev development branch</span></span><br><span class="line">$ git pull</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git merge dev              <span class="comment">#Merge the dev branch into master</span></span><br><span class="line">$ git push origin master     <span class="comment">#Push the code to master</span></span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>Generate a compressible package for release</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Generate a compressible package for release</span></span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>命令行</tag>
      </tags>
  </entry>
  <entry>
    <title>Configure Hexo Local Writing Environment.</title>
    <url>/en/315fc17e.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/315fc17e.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="reasons-for-writing">Reasons for Writing</h2>
<p>Due to frequently changing computer devices, every time a device is
replaced, the Hexo environment needs to be reconfigured. Therefore, the
configuration process is recorded for future use.</p>
<span id="more"></span>
<h2 id="local-environment-setup">Local Environment Setup</h2>
<ol type="1">
<li><p>Install node.js (it is recommended to install version v12 here,
otherwise deployment may fail)</p>
<p>Windows installation: <a
href="https://nodejs.org/en/download/">Download | Node.js
(nodejs.org)</a></p>
<p>Linux installation:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install nodejs</span><br><span class="line">$ sudo apt-get install npm</span><br></pre></td></tr></table></figure>
<p>After installation, enter the following commands to check if the
installation was successful:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">$ npm -v</span><br></pre></td></tr></table></figure></li>
<li><p>Install Hexo</p>
<p>First, change npm to a domestic source:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm config <span class="built_in">set</span> registry http://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<p>Enter the following command to confirm:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$npm</span> get registry</span><br></pre></td></tr></table></figure>
<p>Open the command line in the root directory of the Blog and enter the
following command to forcefully install Hexo:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$npm</span> install -g hexo-cli --force</span><br></pre></td></tr></table></figure>
<p>After installation, enter the following command to check if the
installation was successful:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$hexo</span> -v</span><br></pre></td></tr></table></figure>
<p>If you are using an existing environment, you can automatically
install the required packages for the environment with the following
command:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$npm</span> install --force</span><br></pre></td></tr></table></figure></li>
<li><p>Install pandoc <code>typora</code> for writing export and
<code>hexo</code> for rendering using <code>pandoc</code> both require
the use of <code>pandoc</code> (this step can be skipped if using the
default rendering engine)</p>
<p>Download <code>pandoc</code> from:
https://pandoc.org/installing.html</p></li>
</ol>
<h2 id="plugins">Plugins</h2>
<h3 id="steam-showcase">Steam Showcase</h3>
<p>Project link: https://github.com/HCLonely/hexo-steam-games</p>
<ol type="1">
<li><p>Install the plugin</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-steam-games --save</span><br></pre></td></tr></table></figure></li>
<li><p>Configure the <code>_config.yml</code> file of
<code>hexo</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">steam:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">steamId:</span> <span class="string">&#x27;*****&#x27;</span> <span class="comment">#steam 64-bit Id</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Steam</span> <span class="string">Game</span> <span class="string">Library</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;Everyone is a top player&#x27;</span></span><br><span class="line">  <span class="attr">tab:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">imgUrl:</span> <span class="string">&#x27;*****&#x27;</span></span><br><span class="line">  <span class="attr">proxy:</span></span><br><span class="line">    <span class="attr">host:</span></span><br><span class="line">    <span class="attr">port:</span></span><br><span class="line">  <span class="attr">extra_options:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">value</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>enable</strong>: Whether to enable</li>
<li><strong>steamId</strong>: Steam 64-bit Id (needs to be enclosed in
quotes, otherwise there may be bugs), <strong><em>Steam library needs to
be set to public!</em></strong></li>
<li><strong>path</strong>: Page path, default
<code>steamgames/index.html</code></li>
<li><strong>title</strong>: Title of the page</li>
<li><strong>quote</strong>: A paragraph at the beginning of the page,
supports HTML syntax</li>
<li><strong>tab</strong>: <code>all</code> or <code>recent</code>,
<code>all: all games</code>,
<code>recent: recently played games</code></li>
<li><strong>length</strong>: Number of games to display, can be limited
if there are too many games</li>
<li><strong>imgUrl</strong>: Image link, place an image below
<code>quote</code> linking to the Steam profile, can be left empty</li>
<li>proxy: Use a proxy if unable to access the Steam community
<ul>
<li><strong>host</strong>: Proxy IP or domain</li>
<li><strong>port</strong>: Proxy port</li>
</ul></li>
<li><strong>extra_options</strong>: This configuration will be extended
to the Hexo <code>page</code> variable</li>
</ul></li>
<li><p>Usage</p>
<ol type="1">
<li>Use the <code>hexo steam -u</code> command to update the steam game
library data before <code>hexo generate</code> or
<code>hexo deploy</code>!</li>
<li>Delete game library data command: <code>hexo steam -d</code></li>
</ol></li>
</ol>
<h3 id="add-bilibili-bangumitv-series-list">Add Bilibili Bangumi/TV
Series List</h3>
<p>Reference: https://opensourcelibs.com/lib/hexo-bilibili-bangumi</p>
<ol type="1">
<li><p>Install</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-bilibili-bangumi --save</span><br></pre></td></tr></table></figure></li>
<li><p>Configure the <code>_config.yml</code> file of
<code>hexo</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Bangumi settings</span></span><br><span class="line"><span class="attr">bangumi:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">  <span class="attr">vmid:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;Bangumi List&#x27;</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;Life goes on, chasing bangumi never stops!&#x27;</span></span><br><span class="line">  <span class="attr">show:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">loading:</span></span><br><span class="line">  <span class="attr">metaColor:</span></span><br><span class="line">  <span class="attr">color:</span></span><br><span class="line">  <span class="attr">webp:</span></span><br><span class="line">  <span class="attr">progress:</span></span><br><span class="line">  <span class="attr">extra_options:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">value</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TV Series settings</span></span><br><span class="line"><span class="attr">cinema:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">path:</span></span><br><span class="line">  <span class="attr">vmid:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;TV Series List&#x27;</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;Life goes on, chasing TV series never stops!&#x27;</span></span><br><span class="line">  <span class="attr">show:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">loading:</span></span><br><span class="line">  <span class="attr">metaColor:</span></span><br><span class="line">  <span class="attr">color:</span></span><br><span class="line">  <span class="attr">webp:</span></span><br><span class="line">  <span class="attr">progress:</span></span><br><span class="line">  <span class="attr">extra_options:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">value</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>enable</strong>: Whether to enable</li>
<li><strong>path</strong>: Page path, default
<code>bangumis/index.html</code>, <code>cinemas/index.html</code></li>
<li><strong>vmid</strong>: Bilibili's <code>vmid(uid)</code>, <a
href="https://opensourcelibs.com/lib/hexo-bilibili-bangumi#获取uid">How
to get it?</a></li>
<li><strong>title</strong>: Title of the page</li>
<li><strong>quote</strong>: A paragraph at the beginning of the page,
supports HTML syntax, can be left empty.</li>
<li><strong>show</strong>: Initial display page:
<code>0: Want to watch</code>, <code>1: Watching</code>,
<code>2: Watched</code>, default is <code>1</code></li>
<li><strong>lazyload</strong>: Whether to enable image lazy loading,
disable if conflicting with the theme's lazy loading, default
<code>true</code></li>
<li><strong>loading</strong>: Loading image before the image is loaded,
lazy loading of images must be enabled</li>
<li><strong>metaColor</strong>: Font color of the meta section (above
the summary)</li>
<li><strong>color</strong>: Font color of the summary</li>
<li><strong>webp</strong>: Use <code>webp</code> format for anime covers
(this format does not display in Safari browser, but reduces the image
size by about 100 times), default <code>true</code></li>
<li><strong>progress</strong>: Whether to show a progress bar when
getting anime data, default <code>true</code></li>
<li><strong>extra_options</strong>: This configuration will be extended
to the Hexo <code>page</code> variable</li>
</ul></li>
<li><p>Usage</p>
<ol type="1">
<li>Use the <code>hexo bangumi -u</code> command to update the bangumi
data before <code>hexo generate</code> or <code>hexo deploy</code>, and
use the <code>hexo cinema -u</code> command to update the TV series
data!</li>
<li>Delete data command: <code>hexo bangumi -d</code> /
<code>hexo cinema -d</code></li>
</ol></li>
</ol>
<h2 id="summary">Summary</h2>
<p>After the above steps are completed, you can generally start writing
and deploying. If there are still issues, you can visit <a
href="https://hexo.io/docs/troubleshooting.html">Troubleshooting |
Hexo</a> for error troubleshooting.</p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>node.js</tag>
      </tags>
  </entry>
  <entry>
    <title>Letax Mathematical Formula Commonly Used Syntax.</title>
    <url>/en/fc7e112.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/fc7e112.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<center>
Code some frequently used LeTaX mathematical formula syntax
</center>
<p><img
src="https://download.kezhi.tech/img/8QXOvd.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h3 id="superscript-and-subscript">1. Superscript and Subscript</h3>
<blockquote>
<p>The superscript command is "^", and the subscript command is "_"</p>
</blockquote>
<p><span class="math display">\[x_1\]</span> <span
class="math display">\[x_1^2\]</span> <span
class="math display">\[x^2_1\]</span> <span
class="math display">\[x_{22}^{(n)}\]</span> <span
class="math display">\[{}^*\!x^*\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$x_1$$</span><br><span class="line">$$x_1^2$$</span><br><span class="line">$$x^2_1$$</span><br><span class="line">$$x_&#123;22&#125;^&#123;(n)&#125;$$</span><br><span class="line">$$&#123;&#125;^*\!x^*$$</span><br></pre></td></tr></table></figure>
<h3 id="fraction">2. Fraction</h3>
<blockquote>
<p>When entering a short fraction, "/" can be used to input. For
fractions with a horizontal fraction line, use ""</p>
</blockquote>
<p><span class="math display">\[ (x+y)/2 \]</span><span
class="math display">\[ \frac{x+y}{2} \]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$ (x+y)/2 $$</span><br><span class="line">$$ \frac&#123;x+y&#125;&#123;2&#125; $$</span><br></pre></td></tr></table></figure>
<h3 id="radical">3. Radical</h3>
<blockquote>
<p>The typesetting command for radical is: square root: ; nth root: </p>
</blockquote>
<p><span class="math display">\[\sqrt{2}&lt;\sqrt[3]{3}\]</span><span
class="math display">\[\sqrt{1+\sqrt[p]{1+a^2}}\]</span><span
class="math display">\[\sqrt{1+\sqrt[^p\!]{1+a^2}}\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\sqrt&#123;2&#125;&lt;\sqrt[3]&#123;3&#125;$$</span><br><span class="line">$$\sqrt&#123;1+\sqrt[p]&#123;1+a^2&#125;&#125;$$</span><br><span class="line">$$\sqrt&#123;1+\sqrt[^p\!]&#123;1+a^2&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<h3 id="summation-and-integration">4. Summation and Integration</h3>
<blockquote>
<p>The typesetting commands for summation symbol and integration symbol
are and respectively. They usually have upper and lower limits, which
are superscripts and subscripts in typesetting.</p>
</blockquote>
<p><span class="math display">\[\sum_{k=1}^{n}\frac{1}{k}\]</span><span
class="math display">\[\sum_{k=1}^n\frac{1}{k}\]</span><span
class="math display">\[\int_a^b f(x)dx\]</span><span
class="math display">\[\int_a^b f(x)dx\]</span><span
class="math display">\[\int_a^b f(x)\mathrm{d}x\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\sum_&#123;k=1&#125;^&#123;n&#125;\frac&#123;1&#125;&#123;k&#125;$$</span><br><span class="line">$$\sum_&#123;k=1&#125;^n\frac&#123;1&#125;&#123;k&#125;$$</span><br><span class="line">$$\int_a^b f(x)dx$$</span><br><span class="line">$$\int_a^b f(x)dx$$</span><br><span class="line">$$\int_a^b f(x)\mathrm&#123;d&#125;x$$</span><br></pre></td></tr></table></figure>
<h3 id="spacing">5. Spacing</h3>
<blockquote>
<p>LaTeX can automatically handle most of the spaces between characters
in formulas, but sometimes you need to manually control them.</p>
</blockquote>
<p>Tight <span class="math inline">\(a\!b\)</span> No space <span
class="math inline">\(ab\)</span> Small space <span
class="math inline">\(a\,b\)</span> Medium space <span
class="math inline">\(a\;b\)</span> Large space <span
class="math inline">\(a\ b\)</span> Quad space <span
class="math inline">\(a\quad b\)</span> Two quad spaces <span
class="math inline">\(a\qquad b\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Tight  $a\!b$</span><br><span class="line">No space $ab$</span><br><span class="line">Small space $a\,b$</span><br><span class="line">Medium space $a\;b$</span><br><span class="line">Large space $a\ b$</span><br><span class="line">Quad space $a\quad b$</span><br><span class="line">Two quad spaces $a\qquad b$</span><br></pre></td></tr></table></figure>
<h3 id="matrix">6. Matrix</h3>
<blockquote>
<p>For matrices with less than 10 columns, you can use matrix, pmatrix,
bmatrix, Bmatrix, vmatrix, and Vmatrix environments.</p>
</blockquote>
<p><span class="math display">\[\begin{matrix}1 &amp; 2\\3
&amp;4\end{matrix}\]</span><span class="math display">\[\begin{pmatrix}1
&amp; 2\\3 &amp;4\end{pmatrix}\]</span><span
class="math display">\[\begin{bmatrix}1 &amp; 2\\3
&amp;4\end{bmatrix}\]</span><span
class="math display">\[\begin{Bmatrix}1 &amp; 2\\3
&amp;4\end{Bmatrix}\]</span><span
class="math display">\[\begin{vmatrix}1 &amp; 2\\3
&amp;4\end{vmatrix}\]</span><span
class="math display">\[\begin{Vmatrix}1 &amp; 2\\3
&amp;4\end{Vmatrix}\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\begin&#123;matrix&#125;1 &amp; 2\\3 &amp;4\end&#123;matrix&#125;$$</span><br><span class="line">$$\begin&#123;pmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;pmatrix&#125;$$</span><br><span class="line">$$\begin&#123;bmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;bmatrix&#125;$$</span><br><span class="line">$$\begin&#123;Bmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;Bmatrix&#125;$$</span><br><span class="line">$$\begin&#123;vmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;vmatrix&#125;$$</span><br><span class="line">$$\begin&#123;Vmatrix&#125;1 &amp; 2\\3 &amp;4\end&#123;Vmatrix&#125;$$</span><br></pre></td></tr></table></figure>
<h3 id="typesetting-arrays">7. Typesetting Arrays</h3>
<blockquote>
<p>When the matrix size exceeds 10 columns, or the above matrix types do
not meet the requirements, you can use the array environment. This
environment can arrange some elements into a rectangular array that is
aligned horizontally and vertically.</p>
</blockquote>
<p><span class="math display">\[
\mathbf{X} =
\left( \begin{array}{ccc}
x_{11} &amp; x_{12} &amp; \ldots \\
x_{21} &amp; x_{22} &amp; \ldots \\
\vdots &amp; \vdots &amp; \ddots
\end{array} \right)
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\mathbf&#123;X&#125; =</span><br><span class="line">\left( \begin&#123;array&#125;&#123;ccc&#125;</span><br><span class="line">x_&#123;11&#125; &amp; x_&#123;12&#125; &amp; \ldots \\</span><br><span class="line">x_&#123;21&#125; &amp; x_&#123;22&#125; &amp; \ldots \\</span><br><span class="line">\vdots &amp; \vdots &amp; \ddots</span><br><span class="line">\end&#123;array&#125; \right)</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<blockquote>
<p>is the uppercase control symbol, \ means line break, and {ccc}
represents the column style. The array environment can also be used to
typeset expressions like this, using a "." as its hidden delimiter.</p>
</blockquote>
<p><span class="math display">\[
y = \left\{ \begin{array}{ll}
a &amp; \textrm{if $d&gt;c$}\\
b+x &amp; \textrm{in the morning}\\
l &amp; \textrm{all day long}
\end{array} \right.
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">y = \left\&#123; \begin&#123;array&#125;&#123;ll&#125;</span><br><span class="line">a &amp; \textrm&#123;if $d&gt;c$&#125;\\</span><br><span class="line">b+x &amp; \textrm&#123;in the morning&#125;\\</span><br><span class="line">l &amp; \textrm&#123;all day long&#125;</span><br><span class="line">\end&#123;array&#125; \right.</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<blockquote>
<p>You can also draw lines in the array environment, such as separating
elements in a matrix.</p>
</blockquote>
<p><span class="math display">\[
\left(\begin{array}{c|c}
1 &amp; 2 \\
\hline
3 &amp; 4
\end{array}\right)
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\left(\begin&#123;array&#125;&#123;c|c&#125;</span><br><span class="line">1 &amp; 2 \\</span><br><span class="line">\hline</span><br><span class="line">3 &amp; 4</span><br><span class="line">\end&#123;array&#125;\right)</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<h3 id="limit-symbol">8. Limit Symbol</h3>
<p><span class="math display">\[
{\lim_{x \to +\infty}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to +\infty&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
{\lim_{x \to -\infty}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to -\infty&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
{\lim_{x \to 0}}
\]</span></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$&#123;\lim_&#123;x \to 0&#125;&#125;$$</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
{\lim_{x \to 0^+}}
\]</span></p>
<p>```letax <span class="math display">\[{\lim_{x \to 0^+}}\]</span></p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>LetaX</tag>
      </tags>
  </entry>
  <entry>
    <title>Next写作常用样式</title>
    <url>/en/61ad1e34.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/61ad1e34.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Some syntax rules beyond markdown make the article more aesthetically pleasing.</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; This article is excerpted from [<span class="string">Zhou Yufeng&#x27;s blog</span>](<span class="link">https://yfzhou.coding.me/2018/08/27/Hexo-Next%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%88%E4%B8%BB%E9%A2%98%E4%BC%98%E5%8C%96%EF%BC%89/</span>).</span></span><br><span class="line"></span><br><span class="line">![<span class="string">8MAadJ.md</span>](<span class="link">https://download.kezhi.tech/img/8MAadJ.md.jpg?x-oss-process=style/webp</span>)</span><br><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line"><span class="section">### 1. Text Alignment</span></span><br><span class="line"></span><br><span class="line">Effect:</span><br><span class="line">&#123;% cq %&#125;</span><br><span class="line">Life is like a mirror,</span><br><span class="line">Knowing oneself from the mirror,</span><br><span class="line">I call it a top priority,</span><br><span class="line">It is also the goal we pursue!</span><br><span class="line">&#123;% endcq %&#125;</span><br><span class="line"></span><br><span class="line">Source Code:</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote class="blockquote-center">
<p>Life is like a mirror, Knowing oneself from the mirror, I call it a
top priority, It is also the goal we pursue!</p>

</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">For more tags provided by NexT theme, click: [http://theme-next.iissnan.com/tag-plugins.html](http://theme-next.iissnan.com/tag-plugins.html)</span><br><span class="line"></span><br><span class="line">### 2. Theme&#x27;s Built-in Style Note Tag</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note default">
<p>
default
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;default&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note primary">
<p>
primary
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note primary&quot;&gt;&lt;p&gt;primary&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note success">
<p>
success
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note success&quot;&gt;&lt;p&gt;success&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note info">
<p>
info
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;info&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note warning">
<p>
warning
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;warning&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note danger">
<p>
danger
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;danger&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note danger no-icon">
<p>
danger no-icon
</p>
</div>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div class=&quot;note danger no-icon&quot;&gt;&lt;p&gt;danger no-icon&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">First, configure in the theme configuration file:</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="note-tag-bs-callout.">Note tag (bs-callout).</h1>
<p>note: # Style style: flat # Whether to have icons icons: true #
Rounded rectangle border_radius: 3 light_bg_offset: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 3. Built-in Label</span><br><span class="line"></span><br><span class="line">&#123;% label default@default %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label default">default</mark> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label primary@primary %&#125;</span><br></pre></td></tr></table></figure> <mark class="label primary">primary</mark> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label success@success %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label success">success</mark> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label info@info %&#125;</span><br></pre></td></tr></table></figure> <mark class="label info">info</mark> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label warning@warning %&#125;</span><br></pre></td></tr></table></figure>
<mark class="label warning">warning</mark> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label danger@danger %&#125;</span><br></pre></td></tr></table></figure> <mark class="label danger">danger</mark> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 4. Tabs</span><br><span class="line"></span><br><span class="line">&#123;% tabs Tabs, 2 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**This is Tab 1** Haha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha...</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**This is Tab 2**</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**This is Tab 3** Wow, you found me! φ(≧ω≦*)♪～</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="tabs" id="tabs"><ul class="nav-tabs"><li class="tab"><a href="#tabs-1">Tabs 1</a></li><li class="tab active"><a href="#tabs-2">Tabs 2</a></li><li class="tab"><a href="#tabs-3">Tabs 3</a></li></ul><div class="tab-content"><div class="tab-pane" id="tabs-1"><p><strong>This is Tab 1</strong> Haha, hahaha, hahaha, hahaha, hahaha,
hahaha, hahaha, hahaha, hahaha, hahaha, hahaha, hahaha...</p></div><div class="tab-pane active" id="tabs-2"><p><strong>This is Tab 2</strong></p></div><div class="tab-pane" id="tabs-3"><p><strong>This is Tab 3</strong> Wow, you found me! φ(≧ω≦*)♪～</p></div></div></div></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 5. Theme&#x27;s Built-in Tabs</span><br><span class="line"></span><br><span class="line">Source Code:</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<a class="btn" href="https://www.baidu.com"><i class="fa fa-download fa-lg fa-fw"></i>Click to download Baidu</a>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Effect:&#123;% btn https://www.baidu.com, Click to download Baidu, download fa-lg fa-fw %&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Next标签云配置</title>
    <url>/en/47930864.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/47930864.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>This article is from <a
href="https://alex-mcavoy.github.io/hexo/7be258c0.html">Next 7.0+
TagCanvas Tag Cloud | Alex_McAvoy (alex-mcavoy.github.io)</a></p>
<p><img
src="https://download.kezhi.tech/img/20220322172925.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<p>Next 7.0+ allows for custom settings for tags. On this basis, the
<code>tagcanvas.js</code> plugin for spherical tag clouds can be used
for style modification. The specific modification steps are as
follows:</p>
<ol type="1">
<li><p>Download the plugin</p>
<p>For a detailed introduction to the spherical tag cloud
<code>tagcanvas.js</code> plugin, click <a
href="http://www.goat1000.com/tagcanvas.php">here</a>.</p>
<p>After downloading the plugin, place it in the
<code>/theme/next/source/js</code> directory.</p></li>
<li><p>Create a tag cloud swig file</p>
<p>In the <code>/theme/next/layout/_partials</code> directory, create a
file named <code>tagcanvas.swig</code> and write the following
content:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myTags&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span> <span class="attr">id</span>=<span class="string">&quot;my3DTags&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Anything in here will be replaced on browsers that support the canvas element<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span> <span class="attr">id</span>=<span class="string">&quot;tags&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; tagcloud(&#123;</span><br><span class="line">        min_font   : theme.tagcloud.min,</span><br><span class="line">        max_font   : theme.tagcloud.max,</span><br><span class="line">        amount     : theme.tagcloud.amount,</span><br><span class="line">        color      : true,</span><br><span class="line">        start_color: theme.tagcloud.start,</span><br><span class="line">        end_color  : theme.tagcloud.end&#125;)</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/tagcanvas.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TagCanvas</span>.<span class="title class_">Start</span>(<span class="string">&#x27;my3DTags&#x27;</span>,<span class="string">&#x27;tags&#x27;</span>,&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">textFont</span>: <span class="string">&#x27;Georgia,Optima&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">textColour</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">outlineColour</span>: <span class="string">&#x27;black&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">weight</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">reverse</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">depth</span>: <span class="number">0.8</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">maxSpeed</span>: <span class="number">0.05</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">bgRadius</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">freezeDecel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">catch</span>(e) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myTags&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Modify the page configuration file</p>
<p>Modify the <code>/theme/next/layout/</code> <code>page.swig</code>
file as shown in the figure below:</p>
<p><img
src="https://download.kezhi.tech/img/20220322171837.png?x-oss-process=style/webp" /></p>
<p>Add the following code:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;# tagcanvas plugin spherical tag cloud #&#125;</span><br><span class="line">&#123;% include &#x27;_partials/tagcanvas.swig&#x27; %&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Modify the theme configuration file</p>
<p>Open <code>/theme/config.yml</code> and find the
<code>tagcloud</code> field. Modify it according to your actual
needs:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># TagCloud settings for tags page.</span></span><br><span class="line"><span class="attr">tagcloud:</span></span><br><span class="line">  <span class="comment"># All values below are same as default, change them by yourself.</span></span><br><span class="line">  <span class="attr">min:</span> <span class="number">20</span> <span class="comment"># Minimun font size in px</span></span><br><span class="line">  <span class="attr">max:</span> <span class="number">30</span> <span class="comment"># Maxium font size in px</span></span><br><span class="line">  <span class="attr">start:</span> <span class="string">&quot;#19CAAD&quot;</span> <span class="comment"># Start color (hex, rgba, hsla or color keywords)</span></span><br><span class="line">  <span class="attr">end:</span> <span class="string">&quot;#F4606C&quot;</span> <span class="comment"># End color (hex, rgba, hsla or color keywords)</span></span><br><span class="line">  <span class="attr">amount:</span> <span class="number">200</span> <span class="comment"># Amount of tags, change it if you have more than 200 tags</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
      </tags>
  </entry>
  <entry>
    <title>Policy Optimization</title>
    <url>/en/309dbe23.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/309dbe23.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>This article mainly reviews and summarizes reinforcement learning
algorithms based on policy optimization theorems and related
variants.</p>
<p><img
src="https://download.kezhi.tech/img/202312181919546.jpg?x-oss-process=style/webp" />
<span id="more"></span></p>
<h2 id="preliminaries">Preliminaries</h2>
<p>A Markov decision process (MDP) can be defined by a five-tuple <span
class="math inline">\(&lt;\mathcal{S},\mathcal{A},\mathcal{R},\mathcal{T},\gamma,\rho_0&gt;\)</span>,
where:</p>
<ul>
<li><span class="math inline">\(\mathcal{S}\)</span> represents the
state space, a set of states</li>
<li><span class="math inline">\(\mathcal{A}\)</span> represents the
action space, a set of actions</li>
<li><span
class="math inline">\(\mathcal{R}:\mathcal{S}\times\mathcal{A}\rightarrow
\mathbb{R}\)</span> represents the reward function, <span
class="math inline">\(\mathcal{R} (s,a)\)</span> is the reward obtained
by taking action <span class="math inline">\(a\)</span> in state <span
class="math inline">\(s\)</span></li>
<li><span class="math inline">\(\mathcal{T}:
\mathcal{S}\times\mathcal{A}\times\mathcal{S}\rightarrow[0,1]\)</span>
represents the state transition probability function, <span
class="math inline">\(\mathcal{T}(s&#39;|s,a)\)</span> is the
probability of transitioning from state <span
class="math inline">\(s\)</span> to state <span
class="math inline">\(s&#39;\)</span> by taking action <span
class="math inline">\(a\)</span></li>
<li><span class="math inline">\(\gamma\)</span> represents the discount
factor</li>
<li><span
class="math inline">\(\rho_0:\mathcal{S}\rightarrow[0,1]\)</span>
represents the initial state distribution</li>
</ul>
<p>The decision process of an agent is represented by a stochastic
policy <span
class="math inline">\(\pi:\mathcal{S}\times\mathcal{A}\rightarrow[0,1]\)</span>,
where <span class="math inline">\(\pi(a|s)\)</span> is the probability
of the agent choosing action <span class="math inline">\(a\)</span> in
state <span class="math inline">\(s\)</span>. Based on policy <span
class="math inline">\(\pi\)</span>, the state value function can be
defined as: <span class="math display">\[
V_\pi(s)=\mathbb{E}\left[\sum_{t=0}^\infty
\gamma^t\mathcal{R}(s_t,a_t)|\pi,s\right]
\]</span> The state-action value function is: <span
class="math display">\[
Q_\pi(s,a) =
\mathcal{R}(s,a)+\gamma\mathbb{E}_{s&#39;\sim\mathcal{T}(\cdot|s,a)}[V_\pi(s&#39;)]
\]</span></p>
<p>Advantage function: <span class="math display">\[
A_\pi(s,a) = Q_\pi(s,a)-V_\pi(s)
\]</span> The agent's optimization goal is usually to maximize the
discounted return on the initial state distribution, i.e.: <span
class="math display">\[
\eta(\pi) = \mathbb{E}_{s\sim\rho_0}[V_\pi(s)]
\]</span> The discounted visit frequency of a state is represented as:
<span class="math display">\[
\rho_\pi(s)=(P(s_0=s)+\gamma P(s_1=s)+\gamma^2 P(s_2=s)+...)
\]</span></p>
<p>Policy gradient theorem: <span class="math display">\[
\nabla \eta(\pi) = \sum_{s,a}\rho_\pi(s)\nabla \pi(a|s)Q_\pi(s,a)
\]</span></p>
<h2
id="approximately-optimal-approximate-reinforcement-learning">Approximately
Optimal Approximate Reinforcement Learning</h2>
<p>Kakade, S. &amp; Langford, J. Approximately Optimal Approximate
Reinforcement Learning. in <em>Proceedings of the Nineteenth
International Conference on Machine Learning</em> 267–274 (Morgan
Kaufmann Publishers Inc., 2002).</p>
<p>This paper addresses three questions:</p>
<ol type="1">
<li>Is there a performance metric that guarantees improvement at each
update step?</li>
<li>How difficult is it to verify that an update improves this
performance metric?</li>
<li>What level of performance can be achieved after a reasonable number
of policy updates?</li>
</ol>
<p>Consider the following conservative policy update rule: <span
class="math display">\[
\pi_{new}(a|s)=(1-\alpha)\pi(a|s)+\alpha\pi&#39;(a|s)
\]</span> where <span class="math inline">\(\alpha\in[0,1]\)</span>. To
ensure policy improvement at <span
class="math inline">\(\alpha=1\)</span>, <span
class="math inline">\(\pi&#39;\)</span> needs to take better actions
than <span class="math inline">\(\pi\)</span> in every state. For <span
class="math inline">\(0&lt;\alpha &lt;1\)</span>, policy improvement
only requires <span class="math inline">\(\pi&#39;\)</span> to choose
better actions in most states rather than all. Define the policy
advantage <span
class="math inline">\(\mathbb{A}_{\pi,\rho_0}(\pi&#39;)\)</span> as:
<span class="math display">\[
\mathbb{A}_{\pi,\rho_0}(\pi&#39;)=\mathbb{E}_{s\sim\rho_\pi}\left[\mathbb{E}_{a\sim\pi&#39;(\cdot|s)}[A_\pi(s,a)]\right]
\]</span> This policy advantage function measures the extent to which
<span class="math inline">\(\pi&#39;\)</span> selects actions with
greater advantage under the initial state distribution <span
class="math inline">\(\rho_0\)</span>. For <span
class="math inline">\(\alpha=0\)</span>, it is evident that <span
class="math inline">\(\frac{\partial \eta}{\partial
\alpha}\big|_{\alpha=0}=\frac{1}{1-\gamma}\mathbb{A}_{\pi,\rho_0}\)</span>.</p>
<p>to be continue......</p>
<h2 id="trpo">TRPO</h2>
<p>Schulman, J., Levine, S., Moritz, P., Jordan, M. &amp; Abbeel, P.
Trust region policy optimization. in <em>Proceedings of the 32nd
International Conference on International Conference on Machine Learning
- Volume 37</em> 1889–1897 (JMLR.org, 2015).</p>
<p>Policy advantage theorem: <span class="math display">\[
\eta(\tilde\pi)=\eta(\pi)+\mathbb{E}_{s_0\sim\rho_0,a\sim\tilde\pi(\cdot|s),s&#39;\sim\mathcal{T}(\cdot|s,a)}\left[\sum_{t=1}^{\infty}\gamma^tA_\pi(s_t,a_t)\right]
\]</span> Proof is as follows (for ease of writing, omit the expectation
subscripts <span
class="math inline">\(s_0\sim\rho_0,s&#39;\sim\mathcal{T}(\cdot|s,a)\)</span>,
<span class="math inline">\(a\sim\pi(\cdot|s)\)</span> is abbreviated as
<span class="math inline">\(a\sim\pi\)</span>): <span
class="math display">\[
\begin{align}
&amp;\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^tA_\pi(s_t,a_t)\right]\\
&amp;=\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t\left[Q_\pi(s_t,a_t)-V_\pi(s_t)\right]\right]\\
&amp;=
\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t\left[r_t+\gamma
V_\pi(s_{t+1})-V_\pi(s_t)\right]\right]\\
&amp;= \mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t
r_t\right]+\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^{t+1}
V_\pi(s_{t+1})\right]-\mathbb{E}_{a\sim\tilde\pi}\left[\sum_{t=0}^{\infty}\gamma^t
V_\pi(s_t)\right]\\
&amp;=\eta(\tilde\pi)-\mathbb{E}_{a\sim\tilde\pi}[V_\pi(s_0)]\\
&amp;=\eta(\tilde\pi)-\eta(\pi)
\end{align}
\]</span></p>
<p>Based on the state visitation frequency <span
class="math inline">\(\rho_\pi\)</span>, equation <span
class="math inline">\(\ref{policy-improve}\)</span> can also be written
in the following form: <span class="math display">\[
\eta(\tilde\pi)=\eta(\pi)+\sum_s\rho_{\tilde\pi}(s)\sum_a\tilde\pi(a|s)A_\pi(s,a)
\]</span> According to equation <span
class="math inline">\(\ref{policy-improve}\)</span>, if for each state
<span class="math inline">\(s\)</span>, <span
class="math inline">\(\sum_a\tilde\pi(a|s)A_\pi(s,a)\geq 0\)</span>,
then the new policy is guaranteed to be better than the old policy.
However, due to the dependence of equation <span
class="math inline">\(\ref{policy-improve}\)</span> on <span
class="math inline">\(\rho_{\tilde\pi}\)</span>, it is not directly
computable in practical optimization. Therefore, considering a local
estimate of <span class="math inline">\(\eta\)</span>: <span
class="math display">\[
L_\pi(\tilde\pi)
=\eta(\pi)+\sum_s\rho_{\pi}(s)\sum_a\tilde\pi(a|s)A_\pi(s,a)
\]</span> The difference between <span
class="math inline">\(L_\pi(\tilde\pi)\)</span> and <span
class="math inline">\(\eta(\tilde\pi)\)</span> lies in replacing <span
class="math inline">\(\rho_{\tilde\pi}\)</span> with <span
class="math inline">\(\rho_{\pi}\)</span>. Next, the analysis of <span
class="math inline">\(L_\pi(\tilde\pi)\)</span> is performed. If there
is a parameterized policy <span
class="math inline">\(\pi_\theta\)</span> that is differentiable with
respect to <span class="math inline">\(\theta\)</span>, then: <span
class="math display">\[
L_{\pi_{\theta_0}}(\pi_{\theta_0})=\eta(\pi_{\theta_0})\\
\nabla_\theta
L_{\pi_{\theta_0}}(\pi_{\theta})\big|_{\theta=\theta_0}=\nabla_\theta\eta(\pi_{\theta})\big|_{\theta=\theta_0}
\]</span> Therefore, if the update of <span
class="math inline">\(\pi\)</span> is small enough, improving <span
class="math inline">\(L_\pi\)</span> will also improve <span
class="math inline">\(\eta\)</span>. Considering the following policy
update: <span class="math display">\[
\tilde\pi(a|s)=(1-\alpha)\pi(a|s)+\alpha\pi&#39;(a|s)
\]</span> where <span
class="math inline">\(\pi&#39;=\arg\max_{\pi&#39;}L_\pi(\tilde\pi)\)</span>,
it can be shown (proof in [(Kakade &amp; Langford,
2002)][approximately_optimal]): <span class="math display">\[
\eta(\tilde\pi)\geq
L_{\pi}(\tilde\pi)-\frac{2\epsilon\gamma}{(1-\gamma(1-\alpha))(1-\gamma)}\alpha^2
\]</span> where <span class="math inline">\(\epsilon =
\max_s|\mathbb{E}_{a\sim\tilde\pi(\cdot|s)}A_\pi(s,a)|\)</span></p>
<p>Continued in the next message...</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>Policy Optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>The CrossEntropyLoss in PyTorch is Inconsistent With The Calculation of Cross-Entropy.</title>
    <url>/en/e295e676.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/e295e676.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>This article mainly discusses the inconsistency between the manual
calculation of cross-entropy and the results obtained by the
<code>CrossEntropyLoss</code> module in <code>PyTorch</code>. After
consulting the official documentation of <code>PyTorch</code>, it was
found that the inconsistency was caused by the <code>SoftMax</code>
operation performed by <code>CrossEntropyLoss</code> on the input
probability distribution before calculating the cross-entropy.</p>
<p>In reinforcement learning, the loss function commonly used in policy
learning is <span class="math inline">\(l=-\ln\pi_\theta(a|s)\cdot
g\)</span>, where <span class="math inline">\(\pi_\theta\)</span> is a
probability distribution over actions given state <span
class="math inline">\(s\)</span>, and <span
class="math inline">\(a\)</span> is the action selected in state <span
class="math inline">\(s\)</span>. Therefore, we have:</p>
<p><span class="math display">\[
-\ln\pi_\theta(a|s) = -\sum_{a&#39;\in A}p(a&#39;)\cdot \ln q(a&#39;)
\]</span></p>
<p><span class="math display">\[
p(a&#39;) = \left\{
             \begin{array}{lr}
             1 &amp;&amp;&amp; a&#39;=a\\
             0 &amp;&amp;&amp; otherwise
             \end{array}
\right.
\]</span></p>
<p><span class="math display">\[
q(a&#39;) = \pi_\theta(a&#39;|s)
\]</span></p>
<p>Thus, this loss function is transformed into the calculation of
cross-entropy between two probability distributions. Therefore, we can
use the built-in <code>torch.nn.functional.cross_entropy</code> function
(referred to as the <code>F.cross_entropy</code> function below) in
<code>PyTorch</code> to calculate the loss function. However, in
practice, it was found that the results calculated using this function
were inconsistent with the results calculated manually, which led to a
series of investigations.</p>
<p>Firstly, we used <code>Python</code> to manually calculate the
cross-entropy of two sets of data and the cross-entropy calculated using
the <code>F.cross_entropy</code> function, as shown in the code
below:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">x = torch.FloatTensor([[<span class="number">0.4</span>, <span class="number">0.6</span>],</span><br><span class="line">                       [<span class="number">0.7</span>, <span class="number">0.3</span>]])</span><br><span class="line">y = torch.LongTensor([<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">loss_1 = -torch.log(x.gather(<span class="number">1</span>, y.view(-<span class="number">1</span>,<span class="number">1</span>)))</span><br><span class="line">loss_2 = F.cross_entropy(x, y, reduction = <span class="string">&quot;none&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Manually calculated cross-entropy:\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_1.squeeze(<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CrossEntropyLoss calculated cross-entropy:\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_2))</span><br></pre></td></tr></table></figure>
<p>The results of the above code are as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Manually calculated cross-entropy:</span><br><span class="line">tensor([0.9163, 1.2040])</span><br><span class="line"></span><br><span class="line">CrossEntropyLoss calculated cross-entropy:</span><br><span class="line">tensor([0.7981, 0.9130])</span><br></pre></td></tr></table></figure>
<p>From the results, it can be seen that the two calculation results are
not consistent. Therefore, we consulted the official documentation of
<code>PyTorch</code> to understand the implementation of
<code>F.cross_entropy</code>.</p>
<p>The description of the <code>F.cross_entropy</code> function in the
documentation does not include the specific calculation process, only
explaining the correspondence between the input data and the output
result dimensions <a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>. However, there is a sentence in the
introduction of this function:</p>
<blockquote>
<p>See <a
href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html#torch.nn.CrossEntropyLoss"><code>CrossEntropyLoss</code></a>
for details.</p>
</blockquote>
<p>So we turned to the documentation of <code>CrossEntropyLoss</code> <a
href="#fn2" class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a> and finally found the calculation
process of cross-entropy in <code>PyTorch</code>:</p>
<p><img
src="https://download.kezhi.tech/img/202303041333317.png?x-oss-process=style/webp" /></p>
<p>It can be seen that the official documentation on the calculation of
cross-entropy is very clear. In summary, the
<code>F.cross_entropy</code> function requires at least two parameters,
one is the predicted probability distribution, and the other is the
index of the target true class. The important point is that the
<code>F.cross_entropy</code> function does not require the input
probability distribution to sum to 1 or each item to be greater than 0.
This is because the function performs a <code>SoftMax</code> operation
on the input probability distribution before calculating the
cross-entropy.</p>
<p>Performing the <code>SoftMax</code> operation before calculating the
cross-entropy improves the tolerance of the input, but if the
<code>SoftMax</code> operation has been performed before the output is
constructed in the neural network, it will cause the calculation of
<code>loss</code> to be distorted, that is, the calculation results of
the previous section are inconsistent.</p>
<p>According to the official documentation of <code>PyTorch</code>, if
we add a <code>SoftMax</code> operation to the manual calculation of
cross-entropy, we can get the same calculation result as the
<code>F.cross_entropy</code> function. The following code is used to
verify this:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">x = torch.FloatTensor([[<span class="number">0.4</span>, <span class="number">0.6</span>],</span><br><span class="line">                       [<span class="number">0.7</span>, <span class="number">0.3</span>]])</span><br><span class="line">y = torch.LongTensor([<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">loss_1 = -torch.log(F.softmax(x, dim=-<span class="number">1</span>).gather(<span class="number">1</span>, y.view(-<span class="number">1</span>,<span class="number">1</span>)))</span><br><span class="line">loss_2 = F.cross_entropy(x, y, reduction = <span class="string">&quot;none&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Manually calculated cross-entropy:\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_1.squeeze(<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CrossEntropyLoss calculated cross-entropy:\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(loss_2))</span><br></pre></td></tr></table></figure>
<p>The output of the above code is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Manually calculated cross-entropy:</span><br><span class="line">tensor([0.7981, 0.9130])</span><br><span class="line"></span><br><span class="line">CrossEntropyLoss calculated cross-entropy:</span><br><span class="line">tensor([0.7981, 0.9130])</span><br></pre></td></tr></table></figure>
<h2 id="reference">Reference</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a
href="https://pytorch.org/docs/stable/generated/torch.nn.functional.cross_entropy.html">torch.nn.functional.cross_entropy
— PyTorch 1.13 documentation</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a
href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html#torch.nn.CrossEntropyLoss">CrossEntropyLoss
— PyTorch 1.13 documentation</a><a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>PyTorch</tag>
        <tag>Deep Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Script For Notifying Experimental Results Via WeChat Work.</title>
    <url>/en/4d54863.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/4d54863.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Deep learning experiments usually take a long time to run. Without
proactive notification, two situations may arise:</p>
<ul>
<li>Check the experiment results after a period of time, unable to focus
on other things.</li>
<li>Abandon the experiment, not knowing whether it is running or
completed.</li>
</ul>
<p>To solve the above problems, it is necessary to add a monitoring
process to the experimental program, notify and send the experimental
results after the experiment ends. This article's script mainly includes
three parts: process monitoring, tensorboard data extraction, and
enterprise WeChat robot notification.</p>
<p><img src="https://download.kezhi.tech/img/202312071711241.png?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="process-monitoring">Process Monitoring</h2>
<p>Usually, experiments are safer to run in the background, and they
will not stop because the <code>terminal</code> is closed. The command
to run in the background is:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nohup your_command &gt;log_name.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>The role of process monitoring is twofold:</p>
<ul>
<li>Notify in time when the experiment ends abnormally.</li>
<li>Notify the result when the experiment ends normally.</li>
</ul>
<p>It is relatively simple to implement. Just monitor whether the
process has ended. The code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> utils.wechat_bot <span class="keyword">import</span> research_bot</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_num</span>(<span class="params">key_words=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">    num_process = <span class="built_in">int</span>(os.popen(<span class="string">f&quot;ps -ef |grep -v grep|grep <span class="subst">&#123;key_words&#125;</span>|wc -l&quot;</span>).read())</span><br><span class="line">    <span class="keyword">return</span> num_process</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> process_num() == <span class="number">0</span>:</span><br><span class="line">        now = datetime.datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        send_report_text(<span class="string">&quot;The experiment is over, analyzing the results...&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    time.sleep(<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># do something</span></span><br></pre></td></tr></table></figure>
<h2 id="tensorboard-data-extraction">Tensorboard Data Extraction</h2>
<p>The learning process data of deep learning is usually recorded in the
log file by <code>tensorboard</code>. Using <code>tensorboard</code>, it
is convenient to view training data, but it also reduces the convenience
of performing other operations on training data. The following script
can be used to extract the log data generated by
<code>tensorboard</code> and write it to an <code>excel</code> file.</p>
<p>Just call the <code>tb_to_excel</code> function to use it. The input
format is:</p>
<ul>
<li>path_list: a list of strings, each item is the path of a log, such
as <code>['logs/0','logs/1']</code></li>
<li>excel_path: the exported <code>excel</code> path, such as
<code>'export.xlsx'</code></li>
<li>one_sheet(default: False): whether to merge all data into one excel
sheet</li>
</ul>
<p>Execution result: the log files in <code>path_list</code> are
exported to the target excel file, and each item in
<code>path_list</code> corresponds to each sheet in the excel file. If
<code>on_sheet=True</code>, all data will be merged into one sheet
through <code>pd.concat</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> tensorboard.backend.event_processing <span class="keyword">import</span> event_accumulator</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_tb_data</span>(<span class="params">path</span>):</span><br><span class="line">    tb_data = event_accumulator.EventAccumulator(path)</span><br><span class="line">    tb_data.Reload()</span><br><span class="line">    <span class="keyword">return</span> tb_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_to_df</span>(<span class="params">tb_data: event_accumulator.EventAccumulator</span>):</span><br><span class="line">    keys = tb_data.scalars.Keys()</span><br><span class="line">    df = pd.DataFrame(columns=keys)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">        data = tb_data.scalars.Items(key)</span><br><span class="line">        df[key] = pd.Series([item.value <span class="keyword">for</span> item <span class="keyword">in</span> data])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;step&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">            df[<span class="string">&#x27;step&#x27;</span>] = pd.Series([item.step <span class="keyword">for</span> item <span class="keyword">in</span> data])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wall_time&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">            df[<span class="string">&#x27;wall_time&#x27;</span>] = pd.Series([item.wall_time <span class="keyword">for</span> item <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line">    order = [<span class="string">&#x27;step&#x27;</span>, <span class="string">&#x27;wall_time&#x27;</span>] + keys</span><br><span class="line">    df = df[order]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_tb_df</span>(<span class="params">path</span>):</span><br><span class="line">    tb_data = get_tb_data(path)</span><br><span class="line">    df = tb_to_df(tb_data)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_all_data</span>(<span class="params">path_list:<span class="built_in">list</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, pd.DataFrame]:</span><br><span class="line">    data_dict = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> filepath <span class="keyword">in</span> path_list:</span><br><span class="line">        fn = filepath.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(filepath):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Reading and processing:&quot;</span>, filepath)</span><br><span class="line">            sheet_name = fn</span><br><span class="line">            df = get_tb_df(filepath)</span><br><span class="line">            data_dict[sheet_name] = df</span><br><span class="line">    <span class="keyword">return</span> data_dict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">df_to_excel</span>(<span class="params">df_dict, path, one_sheet=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> one_sheet:</span><br><span class="line">        df_all = pd.DataFrame()</span><br><span class="line">        <span class="keyword">for</span> df <span class="keyword">in</span> df_dict.values():</span><br><span class="line">            df_all = pd.concat([df_all, df], ignore_index=<span class="literal">True</span>)</span><br><span class="line">        df_all.to_excel(path, index=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> pd.ExcelWriter(path) <span class="keyword">as</span> writer:</span><br><span class="line">            <span class="keyword">for</span> sheet_name, df <span class="keyword">in</span> df_dict.items():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Writing sheet:&quot;</span>, sheet_name)</span><br><span class="line">                df.to_excel(writer, sheet_name, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_to_excel</span>(<span class="params">path_list, excel_path, one_sheet=<span class="literal">False</span></span>):</span><br><span class="line">    df_dict = extract_all_data(path_list)</span><br><span class="line">    df_to_excel(df_dict, excel_path, one_sheet)</span><br></pre></td></tr></table></figure>
<h2 id="enterprise-wechat-robot-notification">Enterprise WeChat Robot
Notification</h2>
<p>There are many ways to choose from for proactive notification,
including but not limited to:</p>
<ul>
<li>SMTP sends email</li>
<li>Push services like Server Chan</li>
<li>QQ robot</li>
<li>WeChat robot</li>
<li>Enterprise WeChat application</li>
<li>Enterprise WeChat group robot</li>
</ul>
<p>Each of these methods has its advantages and disadvantages. The
demand for result notification is:</p>
<ul>
<li>Good real-time performance: the notification can be received
immediately after sending</li>
<li>No response: only one-way notification is required, and no reply
needs to be set up</li>
</ul>
<p>Therefore, after weighing the above requirements and considering the
convenience of implementation, the enterprise WeChat group robot is
selected as the information push method.</p>
<p>First, create an enterprise WeChat group robot:</p>
<ol type="1">
<li>Create an enterprise WeChat group chat (&gt;=3 people)</li>
<li>Kick out irrelevant people</li>
<li>Add a group robot</li>
<li>View the robot information and find the <code>key</code> value in
the <code>Webhook</code> address and record it</li>
</ol>
<p>Then fill in the <code>key</code> in the following script to use
it.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.util.retry <span class="keyword">import</span> Retry</span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SLEEP_INTERVAL = <span class="number">0.1</span> <span class="comment"># sleep time between retries</span></span><br><span class="line">MAX_RETRIES = <span class="number">1</span> <span class="comment"># Number of times to retry a request</span></span><br><span class="line"></span><br><span class="line">retries=Retry(</span><br><span class="line">    total=MAX_RETRIES,</span><br><span class="line">    backoff_factor=SLEEP_INTERVAL,</span><br><span class="line">    status_forcelist=[<span class="number">403</span>, <span class="number">500</span>, <span class="number">502</span>, <span class="number">503</span>, <span class="number">504</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">default_headers=&#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 Edg/98.0.1108.62&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client = requests.Session()</span><br><span class="line">client.mount(<span class="string">&quot;http://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line">client.mount(<span class="string">&quot;https://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line">client.headers=default_headers</span><br><span class="line"></span><br><span class="line">BotList = &#123;</span><br><span class="line">    <span class="string">&quot;Research Assistant&quot;</span>:<span class="string">&quot;XXX&quot;</span> <span class="comment"># Fill in the group chat robot key here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bot</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._base_url = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send&quot;</span></span><br><span class="line">        self._key = key</span><br><span class="line">        self._url = <span class="string">f&quot;<span class="subst">&#123;self._base_url&#125;</span>?key=<span class="subst">&#123;self._key&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_msg</span>(<span class="params">self, msg</span>):</span><br><span class="line">        response = client.post(self._url, json=msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_text</span>(<span class="params">self, content</span>):</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: content</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_image</span>(<span class="params">self, image_path</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># encode an image to base64</span></span><br><span class="line">            image = f.read()</span><br><span class="line">            base64_bytes = <span class="built_in">str</span>(base64.b64encode(image))[<span class="number">2</span>:-<span class="number">1</span>]</span><br><span class="line">            md5 = hashlib.md5(image).hexdigest()</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">            <span class="string">&quot;image&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;base64&quot;</span>: base64_bytes,</span><br><span class="line">                <span class="string">&quot;md5&quot;</span>: md5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_markdown</span>(<span class="params">self, content</span>):</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">            <span class="string">&quot;markdown&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: content</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_news</span>(<span class="params">self, articles</span>):</span><br><span class="line">        msg = &#123;</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">            <span class="string">&quot;news&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;articles&quot;</span>: articles</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.send_msg(msg)</span><br><span class="line"></span><br><span class="line">research_bot = Bot(BotList[<span class="string">&quot;Research Assistant&quot;</span>])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    research_bot.send_text(<span class="string">&quot;Hello I&#x27;m your research assistant&quot;</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Script</tag>
      </tags>
  </entry>
  <entry>
    <title>Python High Performance Programming</title>
    <url>/en/411c70cb.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/411c70cb.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h1 id="python-high-performance-programming">Python High Performance
Programming</h1>
<h2 id="performance-analysis">Performance Analysis</h2>
<h3 id="time-analysis">Time Analysis</h3>
<ol type="1">
<li><p>Use decorators to automatically measure time:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timefn</span>(<span class="params">fn</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">fn</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">measure_time</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        t1=time.time()</span><br><span class="line">        result=fn(*args, **kwargs)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;@timefn:&quot;</span>+fn.__name__+<span class="string">&quot; took &quot;</span>+<span class="built_in">str</span>(t2-t1)+<span class="string">&quot; seconds&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> measure_time</span><br></pre></td></tr></table></figure>
<p>In IPython, you can use the <code>%timeit</code> magic function to
time function runs:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%timeit &lt;function&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Use the UNIX <code>time</code> command to time:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/time -p (--verbose) python &lt;script-name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Use the <code>cProfile</code> module:</p>
<p><code>cProfile</code> is a built-in analysis tool in the standard
library. It hooks into CPython's virtual machine to measure the time it
takes for each function to run. Add the <code>@profile</code> decorator
before the function to be analyzed, and run the following command for
performance analysis:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m cProfile -s cumulative &lt;script-name&gt; &lt;options&gt;</span><br></pre></td></tr></table></figure>
<p>You can also save the analysis results to a statistics file and use
other tools for analysis:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m cProfile -o &lt;outputfilename&gt; &lt;script-name&gt; &lt;options&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Use <code>line_profiler</code> for line-by-line analysis:</p>
<p>Install: <code>pip install line_profiler</code></p>
<p>Add the <code>@profile</code> decorator before the function to be
analyzed, and run the following command for performance analysis:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kernprof -l -v &lt;script-name&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="space-analysis">Space Analysis</h3>
<ol type="1">
<li><p>Use <code>memory_profiler</code> to analyze memory usage:</p>
<p>Install: <code>pip install memory_profiler</code></p>
<p>Add the <code>@profile</code> decorator before the function to be
analyzed, and run the following command for performance analysis:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m memory_profiler &lt;script-name&gt;</span><br></pre></td></tr></table></figure>
<p>Use <code>mprof</code> to plot memory usage. This can be done in two
steps:</p>
<p>Run the program using <code>mprof</code>, which will generate an
<code>mprof*.dat</code> file in the directory:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mprof run &lt;script-name&gt;</span><br></pre></td></tr></table></figure>
<p>Plot the graph:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mprof plot</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="lists-and-tuples">Lists and Tuples</h2>
<p>Data structures such as lists and tuples are called arrays, which are
flat lists of data in some intrinsic order.</p>
<p>The main differences between lists and tuples are as follows:</p>
<ul>
<li>Lists are dynamic arrays that are mutable and can be resized. Tuples
are static arrays that are immutable and cannot be changed once
created.</li>
<li>Tuples are cached in the Python runtime environment, which means
that there is no need to access the kernel to allocate memory every time
a tuple is used.</li>
<li>Lists require more memory overhead than tuples.</li>
</ul>
<h3 id="lists">Lists</h3>
<p>The query operation for lists is O(1).</p>
<p>The default search operation for lists (<code>list.index()</code>) is
a linear operation, with a worst-case time complexity of O(n). Sorting
the list can reduce the search time to O(log n) (using binary
search).</p>
<p>Python lists have a built-in sorting algorithm that uses Tim sort.
Tim sort sorts with a complexity of O(n) in the best case (O(n log n) in
the worst case). It mixes insertion sort and merge sort to achieve this
performance (guessing which algorithm is better for a given data set
using a probing method).</p>
<p>The <code>bisect</code> module can keep the order of the list
unchanged (default from small to large) when inserting into the list.
Some documentation for <code>bisect</code> is as follows[2]:</p>
<blockquote>
<ul>
<li><p><code>bisect.bisect_left(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>Find the leftmost point of insertion for x in list a</p></li>
<li><p><code>bisect.bisect_right(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>Find the rightmost point of insertion for x in list a</p></li>
<li><p><code>bisect.bisect(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>Same as <code>bisect.bisect_left</code></p></li>
<li><p><code>bisect.insort_left(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>Insert x into list a in sorted order, with the insertion point
determined by <code>bisect.bisect_left</code></p></li>
<li><p><code>bisect.insort_right(a, x, lo=0, hi=len(a), *, key=None)</code></p>
<p>Insert x into list a in sorted order, with the insertion point
determined by <code>bisect.bisect_right</code></p></li>
<li><p><code>bisect.insort(a, x, lo=0, hi=len(a), ***, key=None)</code></p>
<p>Same as <code>bisect.insort_right</code></p></li>
</ul>
<p><strong>Performance Notes</strong></p>
<p>When writing time-sensitive code using <code>bisect()</code> and
<code>insort()</code>, keep the following concepts in mind.</p>
<ul>
<li>Binary search is efficient for searching a certain range of values.
For locating a specific value, dictionary performance is better.</li>
<li>The time complexity of the <code>insort()</code> function is O(n)
because the logarithmic search steps are dominated by the linear
insertion steps.</li>
<li>These search functions are stateless and discard the results of the
key function after they are used. Therefore, if the search function is
used in a loop, the key function may be called repeatedly on the same
data element. If the key function is not fast, consider wrapping it with
<a
href="https://docs.python.org/zh-cn/3/library/functools.html#functools.cache"><code>functools.cache()</code></a>
to avoid redundant calculations. Alternatively, consider searching a
precomputed key array to locate the insertion point (as demonstrated in
the example section below).</li>
</ul>
</blockquote>
<p>When allocating memory for a list, a certain amount of reserved space
is added. When a list of size N needs to add new elements, Python
creates a new list that is large enough to hold the original N elements
plus the additional elements. In actual allocation, the size allocated
is not N+1, but N+M, where M is calculated as follows:</p>
<p>M = (N &gt;&gt; 3) + (N &lt; 9 ? 3 : 6) + 1</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">N</th>
<th style="text-align: center;">0</th>
<th style="text-align: center;">1-4</th>
<th style="text-align: center;">5-8</th>
<th style="text-align: center;">9-16</th>
<th style="text-align: center;">17-25</th>
<th style="text-align: center;">26-35</th>
<th style="text-align: center;">...</th>
<th style="text-align: center;">991-1120</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">M</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">140</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Cython</tag>
        <tag>Numpy</tag>
      </tags>
  </entry>
  <entry>
    <title>Tips for Constructing Pytorch Networks</title>
    <url>/en/a7298e70.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/a7298e70.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="about-network-parameters">About Network Parameters</h2>
<p>In Pytorch, each network inherits from the <code>nn.Module</code>
class and implements various network functions by maintaining the
following eight dictionaries after instantiation:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_parameters</span><br><span class="line">_buffers</span><br><span class="line">_backward_hooks</span><br><span class="line">_forward_hooks</span><br><span class="line">_forward_pre_hooks</span><br><span class="line">_state_dict_hooks</span><br><span class="line">_load_state_dict_pre_hooks</span><br><span class="line">_modules</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>During the network initialization process <code>__init__</code>, the
definition of all class variables is registered in <code>__dict__</code>
through the <code>__setattr__</code> method. <code>nn.Module</code>
overrides the registration method and assigns all variables derived from
the <code>Parameter</code> type in the class to the
<code>_parameters</code> dictionary. This explains why using a
<code>list</code> to store each layer of the network will result in
empty <code>parameters</code>.</p>
<p>In addition, when obtaining parameters, <code>nn.Module</code>
traverses the entire <code>_modules</code> dictionary. Therefore,
<code>nn.ModuleList</code> can be used instead of <code>list</code> to
store multiple network layers.</p>
<h2 id="modifying-an-instantiated-network">Modifying an Instantiated
Network</h2>
<p>When obtaining a pre-trained model from others, it is sometimes
necessary to modify the network, such as resetting parameters or
replacing certain modules in the network for retraining. One direct
approach is to find the corresponding attribute in the class and
directly assign and replace it.</p>
<p>First, to modify parameters, there are two approaches. Since
modifying parameters does not change the network structure, the network
parameter dictionary and import method provided by <code>pytorch</code>
can be used directly:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">state_dict = model.state_dict()</span><br><span class="line"><span class="comment"># change some parameters in state_dict</span></span><br><span class="line">model.load_state_dict(state_dict)</span><br></pre></td></tr></table></figure>
<p>Another approach is to use <code>named_parameters()</code> to perform
corresponding modifications:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> name, params <span class="keyword">in</span> model.named_parameters():</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;name of the layer to modify&quot;</span>:</span><br><span class="line">    	params.data=torch.zeros(params.data.shape)</span><br></pre></td></tr></table></figure>
<p>The above are the methods for modifying parameters. Relatively
speaking, modifying parameters is relatively simple, and
<code>pytorch</code> also provides some methods for convenient parameter
replacement. As for modifying the model, the implementation approach is
more direct. Find the location of the layer in the <code>model</code>
and replace it. <code>named_modules()</code> method is used here. Taking
the open-source large language model <code>llama-2-13b</code> as an
example, after the model is loaded, first check the names of each
layer:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> name,layer <span class="keyword">in</span> model.named_modules():</span><br><span class="line">    <span class="built_in">print</span>(name, layer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you are familiar with the network structure, you can also just look at the names</span></span><br><span class="line"><span class="built_in">print</span>([name <span class="keyword">for</span> (name,module) <span class="keyword">in</span> model.named_modules()])</span><br></pre></td></tr></table></figure>
<p><img
src="https://download.kezhi.tech/img/202311041104052.png?x-oss-process=style/webp" /></p>
<p>Then find the name of the layer that needs to be replaced and replace
it. Taking the <code>embeding</code> layer as an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line">model.model.embed_tokens = nn.Linear(<span class="number">32000</span>, <span class="number">5120</span>)</span><br></pre></td></tr></table></figure>
<p><img
src="https://download.kezhi.tech/img/202311041108163.png?x-oss-process=style/webp" /></p>
<p>It can be seen that the <code>embedding</code> layer has been
successfully replaced with a fully connected layer. Modifications to
other layers follow suit.</p>
<h2 id="reference">Reference</h2>
<p>[1] Gemfield, "Detailed Explanation of Network Construction in
Pytorch," <em>Zhihu Column</em>, Jan. 04, 2019.
https://zhuanlan.zhihu.com/p/53927068 (accessed Sep. 26, 2022).</p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pytorch</tag>
        <tag>Neural Network</tag>
      </tags>
  </entry>
  <entry>
    <title>Discussion on Loss Mean and Sum in Vanilla Policy Gradient</title>
    <url>/en/b69f94c6.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/b69f94c6.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Recently, while systematically reproducing RL algorithms, the convergence of policy gradient algorithms has been problematic. After some exploration and comparative experiments, learning from many experimental codes online and in books, a small issue in the code implementation was discovered: the impact of averaging and summing when calculating the final loss in Policy Gradient on network training. This article will discuss this in detail.</span><br><span class="line"></span><br><span class="line">Let&#x27;s start with the conclusion:</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; When optimizing policies using policy gradient descent, it is possible to perform gradient descent after backpropagating the loss of each action one by one (using a `for` loop), or after backpropagating the sum of losses of each action (using a `sum` operation). However, it is advisable to avoid backpropagating after averaging the losses of all actions (using a `mean` operation), as this may lead to slow convergence or even non-convergence.</span></span><br><span class="line"></span><br><span class="line">Detailed reasoning and experimental processes are provided below.</span><br><span class="line"></span><br><span class="line"><span class="section">## Introduction to Vanilla Policy Gradient</span></span><br><span class="line"></span><br><span class="line">Vanilla Policy Gradient (VPG, i.e., REINFORCE), translated into Chinese as the policy gradient algorithm, is a classic algorithm for policy optimization. First, let&#x27;s clarify some symbols:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> $s<span class="emphasis">_t$: the state of the environment at time $t$</span></span><br><span class="line"><span class="emphasis">- $a_</span>t$: the action chosen by the agent at time $t$</span><br><span class="line"><span class="bullet">-</span> $\pi<span class="emphasis">_\theta$: the agent&#x27;s policy, represented by a neural network parameterized by $\theta$ here</span></span><br><span class="line"><span class="emphasis">- $\pi_</span>\theta(a|s)$: the probability of the agent choosing action $a$ given state $s$</span><br><span class="line"><span class="bullet">-</span> $r<span class="emphasis">_t$: the reward given by the environment at time $t$</span></span><br><span class="line"><span class="emphasis">- $\gamma$: the discount factor</span></span><br><span class="line"><span class="emphasis">- $g_</span>t$: the cumulative discounted reward, $g<span class="emphasis">_t=\sum_</span>&#123;t&#x27;=t&#125;^T \gamma^&#123;t&#x27;-t&#125;r<span class="emphasis">_t$</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">VPG roughly consists of two steps: experience collection and policy optimization. The specific implementation of these two parts is as follows:</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">1. The agent interacts with the environment until an episode terminates, obtaining a series of trajectories $s_</span>1,a<span class="emphasis">_1,r_</span>1,s<span class="emphasis">_2,a_</span>2,r<span class="emphasis">_2...s_</span>n,a<span class="emphasis">_n,r_</span>n$.</span><br><span class="line"><span class="bullet">2.</span> Update $\theta$: $\theta =\theta +\alpha\nabla<span class="emphasis">_\theta \pi_</span>\theta(a<span class="emphasis">_t|s_</span>t) g<span class="emphasis">_t$</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">## Why Use Sum and Mean for Loss?</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">The policy gradient algorithm is a gradient ascent algorithm. To facilitate the use of the current gradient descent framework, $loss = -\nabla_</span>\theta \pi<span class="emphasis">_\theta(a_</span>t|s<span class="emphasis">_t)g_</span>t$ can be adopted.</span><br><span class="line"></span><br><span class="line">In the implementation process of VPG, the training part of the neural network uses the <span class="code">`pytorch`</span> framework. In this framework, the <span class="code">`loss`</span> used for backpropagation must be a scalar. The policy gradient algorithm updates the triplet $(s<span class="emphasis">_t,a_</span>t,g<span class="emphasis">_t)$ at each moment with a gradient descent step. That is, multiple backpropagations need to be performed. For this problem, there are mainly three solutions:</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">1. Backpropagate each triplet $(s_</span>t,a<span class="emphasis">_t,g_</span>t)$ separately and then perform gradient descent. The implementation code is as follows:</span><br><span class="line"></span><br><span class="line">   [Python code block retained]</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> Sum all calculated losses and then backpropagate. The implementation code is as follows:</span><br><span class="line"></span><br><span class="line">   [Python code block retained]</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> Average all calculated losses and then backpropagate. The implementation code is as follows:</span><br><span class="line"></span><br><span class="line">   [Python code block retained]</span><br><span class="line"></span><br><span class="line"><span class="section">## Why Using Sum and Mean for Loss Lead to Different Results</span></span><br><span class="line"></span><br><span class="line">Assuming the length of an episode is $n$, there will be $n$ experience triplets $(s<span class="emphasis">_1,a_</span>1,g<span class="emphasis">_1),(s_</span>2,a<span class="emphasis">_2,g_</span>2),...,(s<span class="emphasis">_n,a_</span>n,g<span class="emphasis">_n)$, and let the losses calculated for each triplet be $l_</span>1,l<span class="emphasis">_2,...,l_</span>n$ respectively. Below is an analysis of the impact of sum and mean on backpropagation of loss.</span><br><span class="line"></span><br><span class="line">If we sum the losses, i.e., $l<span class="emphasis">_&#123;tot&#125;=l_</span>1+l<span class="emphasis">_2+...+l_</span>n$, according to the chain rule, we have:</span><br><span class="line">$$</span><br><span class="line">\frac&#123;\partial l<span class="emphasis">_&#123;tot&#125;&#125;&#123;\partial \theta&#125;=\frac&#123;\partial l_</span>1&#125;&#123;\partial \theta&#125;+\frac&#123;\partial l<span class="emphasis">_2&#125;&#123;\partial \theta&#125;+...+\frac&#123;\partial l_</span>n&#125;&#123;\partial \theta&#125;</span><br><span class="line">$$</span><br><span class="line">Therefore, using $l<span class="emphasis">_&#123;tot&#125;$ to calculate the gradient and backpropagate is equivalent to accumulating the gradients of each loss separately.</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>Deep Learning</tag>
        <tag>Neural Network</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue Study Notes</title>
    <url>/en/71513ccb.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/71513ccb.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="vue">Vue</h2>
<h3 id="notes-on-using-vue-with-flask">Notes on Using Vue with
Flask</h3>
<p>There may be conflicts when using Vue with Flask, but they can be
resolved by changing the configuration.</p>
<ul>
<li>Flask</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.jinja_env.variable_start_string = <span class="string">&#x27;[[&#x27;</span></span><br><span class="line">    app.jinja_env.variable_end_string = <span class="string">&#x27;]]&#x27;</span></span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Vue</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">delimiters</span>: [<span class="string">&#x27;[[&#x27;</span>,<span class="string">&#x27;]]&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="directives">Directives</h3>
<div class="line-block">Directive | Purpose |<br />
</div>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>Xjtu System Optimization And Scheduling Course Assignments</title>
    <url>/en/7d0182be.html</url>
    <content><![CDATA[<p>西安交通大学研究生《系统优化与调度》课程作业</p>
<p><img src="https://download.kezhi.tech/img/202211291608420.png?x-oss-process=style/webp" style="width:30%;" /></p>
<span id="more"></span>
<h1 id="assignment-1">Assignment 1</h1>
<h2 id="section">(1)1.1.2</h2>
<h3 id="a">(a)</h3>
<p><span class="math display">\[
f(x,y)=(x^2-4)^2+y^2\\\\
\nabla f(x,y)=(4x^3-16,2y)\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
12x^2-16 &amp; 0\\
0 &amp; 2
\end{pmatrix}
\]</span></p>
<p>so there are three stationary points: (2, 0) (-2, 0) and (0, 0)</p>
<p>the Hesse Matrix is positive semi-definite only when <span
class="math inline">\(|x|&gt;\frac43\)</span></p>
<p>so points (2, 0) (-2, 0) are local minimum points, point (0, 0) is
not a local minimum. <span class="math display">\[
f(2,0)=f(-2,0)=0
\]</span> so (2,0) and (-2,0) are global minimum points of f</p>
<p>let <span
class="math inline">\(g(x,y)=-f(x,y)=-(x^2-4)^2-y^2\)</span>, it is easy
to know that Hesse matrix is not positive semi-definite when <span
class="math inline">\(x=0,y=0\)</span>. So the point(0,0) is not the
minimum of <span class="math inline">\(g(x,y)\)</span>, which means it
is also not the local maximum of <span
class="math inline">\(f(x,y)\)</span>.</p>
<h3 id="b">(b)</h3>
<p><span class="math display">\[
f(x,y)=\frac12x^2+xcos\ y\\\\
\nabla f(x,y)=(x+cos\ y,-xsin\ y)
\]</span></p>
<p><span class="math inline">\(-xsin\ y=0\)</span> only if <span
class="math inline">\(x=0\)</span> or <span
class="math inline">\(y=k\pi\ (k\in Z)\)</span></p>
<p>if <span class="math inline">\(x=0\)</span>, <span
class="math inline">\(x+cos\ y=0\)</span> only if <span
class="math inline">\(y=\frac\pi2+k\pi\ (k\in Z)\)</span></p>
<p>if <span class="math inline">\(y=k\pi\ (k\in Z)\)</span>, <span
class="math inline">\(x+cos\ y=0\)</span> only if <span
class="math inline">\(x=-(-1)^k\)</span></p>
<p>so the stationary points of <span
class="math inline">\(f(x,y)\)</span> are <span
class="math inline">\((0, \frac\pi2+k\pi)\)</span> and <span
class="math inline">\((-(-1)^k,k\pi)\)</span> <span
class="math inline">\((k\in Z)\)</span> <span class="math display">\[
\nabla^2f(x,y)=
\begin{pmatrix}
1 &amp; -sin\ y\\
-sin\ y &amp; -xcos\ y
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
|(1)|&gt;0\\
|\nabla^2f(x,y)|=-xcos\ y-sin^2\ y
\]</span></p>
<p>for points <span class="math inline">\((0, \frac\pi2+k\pi)\)</span>,
<span class="math display">\[
|\nabla^2f(x,y)|=0-1=-1&lt;0
\]</span> for points <span
class="math inline">\((-(-1)^k,k\pi)\)</span>, <span
class="math display">\[
|\nabla^2f(x,y)|=-1-0=-1&lt;0
\]</span> so all the stationary points are not local minimum points.</p>
<p>function <span class="math inline">\(f(x,y)\)</span> have no local
minima</p>
<h3 id="c">(c)</h3>
<p><span class="math display">\[
f(x,y)=sin\ x+sin\ y+sin\ (x+y)\\\\
\nabla f(x,y)=(cos\ x+cos\ (x+y),cos\ y+cos\ (x+y))\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
-sin\ x-sin(x+y) &amp; -sin(x+y)\\
-sin\ (x+y) &amp; -sin\ y-sin(x+y)
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
let \left\{
    \begin{array}{**lr**}
    cos\ x+cos\ (x+y)=0&amp;(1)\\
    cos\ y+cos\ (x+y)=0&amp;(2)
    \end{array}
\right.
\]</span></p>
<p>(1)-(2): <span class="math inline">\(cos\ x-cos\ y=0\)</span>, so
<span class="math inline">\(y=x\ or\ y=2\pi-x\)</span></p>
<p>if <span class="math inline">\(y=x\)</span>, (1) equals to <span
class="math inline">\(cos\ x+cos\ 2x=0\)</span>,</p>
<p>using double angle formula: <span class="math inline">\(cos\
x+2cos^2\ x-1=0\)</span></p>
<p>solution: <span class="math inline">\(cos\ x=\frac12\ ,\ -1\)</span>,
<span class="math inline">\(x=\frac\pi3,\pi,\frac53\pi\)</span></p>
<p>if <span class="math inline">\(y=2\pi-x\)</span>, (1) equals to <span
class="math inline">\(cos\ x+1=0\)</span></p>
<p>solution: <span class="math inline">\(cos\ x=-1\)</span>, <span
class="math inline">\(x=\pi\)</span></p>
<p>The stationary points are <span
class="math inline">\((\frac\pi3,\frac\pi3),(\pi,\pi),(\frac53\pi,\frac53\pi)\)</span>.
<span class="math display">\[
|\nabla^2f(x,y)|=sin\ xsin\ y+(sin\ x+sin\ y)sin\ (x+y)
\]</span></p>
<p>for point <span class="math inline">\((\frac\pi3,\frac\pi3)\)</span>:
<span class="math display">\[
|(-sin\ x-sin(x+y))|=-\sqrt 3\\
|\nabla^2f(x,y)|=\frac94
\]</span> its Hesse Matrix is negative definite, so point <span
class="math inline">\((\frac\pi3,\frac\pi3)\)</span> is a local maximum
point, max value is <span
class="math inline">\(\frac32\sqrt3\)</span></p>
<p>for point <span class="math inline">\((\pi,\pi)\)</span>: <span
class="math display">\[
|(-sin\ x-sin(x+y))|=0\\
|\nabla^2f(x,y)|=0
\]</span> this point is neither a local maximum nor a local minimum.</p>
<p>for point <span
class="math inline">\((\frac53\pi,\frac53\pi)\)</span>: <span
class="math display">\[
|(-sin\ x-sin(x+y))|=\sqrt3\\
|\nabla^2f(x,y)|=-\frac34
\]</span> this point is neither a local maximum nor a local minimum.</p>
<h3 id="d">(d)</h3>
<p><span class="math display">\[
f(x,y)=(y-x^2)^2-x^2\\\\
\nabla f(x,y)=(4x^3-4xy-2x,-2x^2+2y)\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
12x^2-4y-2 &amp; -4x\\
-4x &amp; 2
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
let \left\{
    \begin{array}{**lr**}
    4x^3-4xy-2x=0\\
    -2x^2+2y=0
    \end{array}
\right.
\]</span></p>
<p>Thus the stationary point is <span
class="math inline">\((0,0)\)</span>, for this point: <span
class="math display">\[
|(12x^2-4y-2)|=-2\\
|\nabla^2f(x,y)|=-4
\]</span> its Hesse Matrix is neither positive definite nor negative
definite, so this stationary point is neither a local maximum nor a
local minimum.</p>
<h3 id="e">(e)</h3>
<p>Since the conclusion of (d)——the stationary point is neither a local
maximum nor a local minimum, so the minimum point could only exist on
the boundary.</p>
<p>Consider <span class="math inline">\(y=-1\)</span>, then <span
class="math inline">\(f(x,y)=(-1-x^2)^2-x^2=x^4+x^2+1\)</span>.</p>
<p>In this case, the minimum point is <span
class="math inline">\((0,-1)\)</span> and the minimum is 1</p>
<p>Consider <span class="math inline">\(y=1\)</span>, then <span
class="math inline">\(f(x,y)=(1-x^2)^2-x^2=x^4-3x^2+1\)</span></p>
<p>In this case, the minimum points are <span
class="math inline">\((\frac{\sqrt6}2,1), (-\frac{\sqrt6}2,1)\)</span>,
and the minimum is <span class="math inline">\(-\frac54\)</span>.</p>
<p>Summarizing, with the constraint <span class="math inline">\(-1\leq
y\leq 1\)</span> on <span class="math inline">\(y\)</span>, there exists
global minimum and the global minimum points are <span
class="math inline">\((\frac{\sqrt6}2,1), (-\frac{\sqrt6}2,1)\)</span>,
the global minimum is <span class="math inline">\(-\frac54\)</span>.</p>
<h2 id="section-1">(2)1.1.6</h2>
<p>suppose <span class="math inline">\(x=(a,b),y_i=(a_i,b_i)\)</span>,
then the problem could transform to: <span class="math display">\[
min\  \sum_{i=1}^mw_i\sqrt{(a-a_i)^2+(b-b^i)^2}
\]</span> suppose <span
class="math inline">\(f(a,b)=\sum_{i=1}^mw_i\sqrt{(a-a_i)^2+(b-b^i)^2}\)</span>,
then: <span class="math display">\[
\nabla
f(x,y)=(\sum_{i=1}^mw_i\frac{a-a_i}{\sqrt{(a-a_i)^2+(b-b^i)^2}},\sum_{i=1}^mw_i\frac{b-b_i}{\sqrt{(a-a_i)^2+(b-b^i)^2}})\\\\
\nabla^2f(a,b)=
\begin{pmatrix}
\sum_{i=1}^mw_i\frac{2(b-b_i)^2}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}} &amp;
\sum_{i=1}^mw_i\frac{-2(a-a_i)(b-b_i)}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}}\\
\sum_{i=1}^mw_i\frac{-2(a-a_i)(b-b_i)}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}}
&amp;
\sum_{i=1}^mw_i\frac{2(a-a_i)^2}{\sqrt{((a-a_i)^2+(b-b^i)^2)^3}}
\end{pmatrix}
\]</span> let <span class="math inline">\(\nabla f(a,b)=0\)</span>, then
the stationary point is <span
class="math inline">\((\frac{\sum_{i=1}^mw_ia_i}{\sum_{i=1}^mwi},\frac{\sum_{i=1}^mw_ib_i}{\sum_{i=1}^mwi})\)</span></p>
<p>and <span class="math inline">\(\nabla^2 f(a,b)\)</span> is positive
definite in the point, so it is the global minimum.</p>
<h3 id="b-1">(b)</h3>
<p>there is only one stationary point in this question, so the solution
is unique</p>
<h3 id="c-1">(C)</h3>
<p>let the plane points on be the reference level</p>
<p>suppose the length of string in weight <span
class="math inline">\(i\)</span> is <span
class="math inline">\(l_i\)</span>, so the problem is: <span
class="math display">\[
min\
\sum_{i=1}^mw_i(||x-y||-l_i)=\sum_{i=1}^mw_i||x-y||-\sum_{i=1}^mw_i·l_i
\]</span> and we can see that <span
class="math inline">\(\sum_{i=1}^mw_i·l_i\)</span> is constant, so the
problem could transform to: <span class="math display">\[
\sum_{i=1}^mw_i||x-y||
\]</span> which is same as the problem in (a).</p>
<h2 id="section-2">(3) 1.2.1</h2>
<h3 id="a-1">(a)</h3>
<p><span class="math display">\[
f(x,y)=3x^2+y^4\\\\
\nabla f(x,y)=(6x,4y^3)
\]</span></p>
<p>the start point is <span class="math inline">\((1,-2)\)</span>, so
the descend direction is <span
class="math inline">\((-6,32)&#39;\)</span>. Then choose <span
class="math inline">\(m\)</span></p>
<p>at first, <span class="math inline">\(m=0,\alpha=s=1\)</span> <span
class="math display">\[
f(1,2)-f(-5,30)=19-810075=-810056\leq-0.1*1*-1060=106
\]</span></p>
<p>then <span
class="math inline">\(m=1，\alpha=\alpha*\beta=0.5\)</span> <span
class="math display">\[
f(1,-2)-f(-2,14)=19-38428=-38409\leq -0.1*0.5*-1060=53
\]</span> then <span
class="math inline">\(m=2,\alpha=\alpha*\beta=0.25\)</span> <span
class="math display">\[
f(1,-2)-f(-0.5,6)=19-1296.75=-1277.75\leq -0.1*0.25*-1060=26.5
\]</span> then <span
class="math inline">\(m=2,\alpha=\alpha*\beta=0.125\)</span> <span
class="math display">\[
f(1,-2)-f(0.25,2)=19-16.1875\leq -0.1*0.125*-1060=13.25
\]</span> then <span
class="math inline">\(m=3,\alpha=\alpha*\beta=0.0625\)</span> <span
class="math display">\[
f(1,-2)-f(0.625,0)=19-1.171875=17.828\geq -0.1*0.0625*-1060=6.625
\]</span></p>
<p>so the first stepsize is 0.0625, after the iteration, the point
changes to <span class="math inline">\((0.625, 0)\)</span></p>
<h3 id="b-2">(b)</h3>
<p>when <span class="math inline">\(m=0,\alpha=s=1\)</span>, the result
is above.</p>
<p>then <span
class="math inline">\(m=1，\alpha=\alpha*\beta=0.1\)</span> <span
class="math display">\[
f(1,-2)-f(0.4,1.2)=19-2.5536=16.4464\geq -0.1*0.1*1060=-10.6
\]</span> so the first stepsize is 0.1, after the iteration, the point
changes to <span class="math inline">\((0.4, 1.2)\)</span></p>
<h3 id="c-2">(c)</h3>
<p><span class="math display">\[
\nabla^2f(x,y)=
\begin{pmatrix}
6&amp;0\\
0&amp;12y^2
\end{pmatrix}
\]</span></p>
<p>at point <span class="math inline">\((1,-2)\)</span>, the Hesse
Matrix is: <span class="math display">\[
\begin{pmatrix}
6&amp;0\\
0&amp;48
\end{pmatrix}
\]</span> its inverse matrix is: <span class="math display">\[
\begin{pmatrix}
\frac16&amp;0\\
0&amp;\frac1{48}
\end{pmatrix}
\]</span> so the descend direction is: <span class="math display">\[
d=-\begin{pmatrix}
\frac16&amp;0\\
0&amp;\frac1{48}
\end{pmatrix}\begin{pmatrix}
6\\-32
\end{pmatrix}=\begin{pmatrix}
-1\\\frac23
\end{pmatrix}
\]</span> then choose the stepsize:</p>
<p>at first, <span class="math inline">\(m=0,\alpha=s=1\)</span> <span
class="math display">\[
f(1,-2)-f(0,-\frac43)=19-3.16=15.84\geq -0.1*1*1060=-106
\]</span> so the first stepsize is 1, and the point changes to <span
class="math inline">\((0,-\frac43)\)</span></p>
<p>Comparing with (a), the computing cost of Newton's method is less</p>
<h2 id="section-3">(4) 1.2.6</h2>
<h3 id="a-2">(a)</h3>
<p>PROOF: <span class="math display">\[
\nabla f(x)=Qx-b&#39;\\\\
||\nabla f(x)-\nabla f(y)||=||Qx-Qy||\leq ||Q||·||x-y||=L·||x-y||
\]</span> (b)</p>
<p>PROOF: <span class="math display">\[
x^{k+1}=x^k-sD\nabla f(x^k)=x^k-sD(Qx^k-b&#39;)\\
x^{k+1}=(I-sDQ)x^k+sDb&#39;
\]</span> ICBS: <span class="math display">\[
x^{k+1}+C=A(x^k+C)\\where\ \ A=I-sDQ,B=sDb&#39;, C=(A-I)^{-1}B
\]</span> by iteration: <span class="math display">\[
x^{k+1}+C=A(x^k+C)=A^{k+1}(x^0+C)\\
x^{k+1}=A(x^k+C)=A^{k+1}(x^0+C)-C
\]</span> then: <span class="math display">\[
x^{k+1}=(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)+Q^{-1}b&#39;\\
x^{k+1}-x^*=(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)+Q^{-1}b&#39;-Q^{-1}b&#39;\\
x^{k+1}-x^*=(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)\\
\]</span> so: <span class="math display">\[
\lim_{k\rightarrow\infty}(x^{k+1}-x^*)=\lim_{k\rightarrow\infty}(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)
\]</span></p>
<p><span class="math display">\[
\forall s\in(0,2/L),\quad (I-sDQ)&lt;1
\]</span></p>
<p>then: <span class="math display">\[
\lim_{k\rightarrow\infty}(I-sDQ)^{k+1}(x^0-Q^{-1}b&#39;)=0\\
\lim_{k\rightarrow\infty}(x^{k+1}-x^*)=0
\]</span> Summarizing, the method converges to <span
class="math inline">\(x^*=Q^{-1}b&#39;\)</span> for every starting point
<span class="math inline">\(x^0\)</span> if and only if <span
class="math inline">\(s\in(0,2/L)\)</span>.</p>
<h2 id="section-4">(5) 1.3.1</h2>
<p><span class="math display">\[
Q=\begin{pmatrix}
1&amp;0.9995\\
0.9995&amp;1
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
M=largest\ eigenvalue\ of\ Q= 1.9995\\\\
m=smallest\ eigenvalue\ of\ Q= 0.0005\\\\
\frac{f(x^{k+1})}{f(x^{k})}\leq (\frac{M-m}{M+m})^2= 0.999
\]</span></p>
<p>Let <span class="math inline">\(v_m\)</span>and <span
class="math inline">\(v_M\)</span> be the normalized eigenvectors of Q
corresponding</p>
<p>to m and M, respectively, and let <span class="math display">\[
x^0=\frac smv_m\pm\frac sMv_M, s\in R
\]</span> Then after the first iteration using the line minimization
stepsize</p>
<p>rule,（i.e., a stepsize<span
class="math inline">\(\alpha=\frac2{M+m}\)</span> ), we get <span
class="math display">\[
x^1=\frac{M-m}{M+m}(\frac smv_m\mp\frac sMv_M)=\frac{M-m}{M+m}x^0
\]</span> Therefore, starting the iterations with<span
class="math inline">\(x^0\)</span> , we have for all k <span
class="math display">\[
\frac{f(x^{k+1})}{f(x^{k})}= (\frac{M-m}{M+m})^2
\]</span></p>
<h2 id="section-5">(6) 1.3.4</h2>
<p><span class="math display">\[
f(x)=\frac12(x-x^*)&#39;Q(x-x^*)\\\\
\nabla f(x)=Q(x-x^*)
\]</span></p>
<p>then: <span class="math display">\[
x^{k+1}=x^k-s(Q(x^k-x^*)+e^k)\\
x^{k+1}=x^k(I-sQ)+sQx^*+se^k\\
x^{k+1}-x^*=(x^k-x^*)(I-sQ)+se^k
\]</span> since for any <span class="math inline">\(A B,
||A·B||\leq||A||·||B||\)</span> <span class="math display">\[
||x^{k+1}-x^*||\leq ||(x^k-x^*)(I-sQ)||+s||e^k||
\]</span> then: <span class="math display">\[
||x^{k+1}-x^*||\leq ||x^k-x^*||·q+s\delta
\]</span> by the iteration, <span class="math display">\[
||x^k-x^0||\leq q^k||x0-x^k||+s\delta(1+q+q^2+...+q^{k-1})
\]</span> so: <span class="math display">\[
||x^k-x^0||\leq q^k||x0-x^k||+\frac{s\delta}{1-q}
\]</span> i.e. <span class="math display">\[
||x^k-x^0||\leq \frac{s\delta}{1-q}+q^k||x0-x^k||
\]</span></p>
<h2 id="section-6">(7) 1.4.1</h2>
<p>In Newton's Method, we have: <span class="math display">\[
x^{k+1}=x^k-\alpha^k(\nabla^2f(x^k))^{-1}\nabla f(x^k)
\]</span> consider <span class="math inline">\(x=Sy\)</span>, then:
<span class="math display">\[
Sy^{k+1}=Sy^k-S^{-2}\alpha^k(\nabla^2f(Sy^k))^{-1}S\nabla f(Sy^k)\\\\
y^{k+1}=y^k-S^{-1}\alpha^k(\nabla^2f(Sy^k))^{-1}\nabla f(Sy^k)
\]</span> since <span class="math inline">\(y=S^{-1}x\)</span>, consider
<span class="math inline">\(y^0=S^{-1}x^0\)</span>, then: <span
class="math display">\[
y^{1}=y^0-S^{-1}\alpha^0(\nabla^2f(Sy^0))^{-1}\nabla f(Sy^0)\\
y^{1}=S^{-1}x^0-S^{-1}\alpha^0(\nabla^2f(x^0))^{-1}\nabla f(x^0)
\]</span> so <span class="math inline">\(y^1=S^{-1}x^1\)</span>, for
<span class="math inline">\(y^k=S^{-1}x^k\)</span>: <span
class="math display">\[
y^{k+1}=y^k-S^{-1}\alpha^k(\nabla^2f(Sy^k))^{-1}\nabla f(Sy^k)\\
y^{k+1}=S^{-1}x^k-S^{-1}\alpha^k(\nabla^2f(Sy^k))^{-1}\nabla f(Sy^k)\\
y^{k+1}=S^{-1}x^{k+1}
\]</span> summarizing, the sequence made by Newton's Method <span
class="math inline">\(y^k=S^{-1}x^k\)</span>.</p>
<p>## (8)</p>
<p>PROOF:</p>
<p>Since <span class="math inline">\(f(x)\)</span> is convex, <span
class="math display">\[
\forall x_1,x_2\in \Omega,\lambda\in(0,1)\quad \lambda f(x_1)+(1-\lambda
)f(x_2)\geq f(\lambda x_1+(1-\lambda )x_2)
\]</span> Since <span class="math inline">\(\gamma(x)\)</span> is a
monotone nondecreasing function, <span class="math display">\[
\gamma(\lambda f(x_1)+(1-\lambda )f(x_2))\geq \gamma (f(\lambda
x_1+(1-\lambda )x_2))
\]</span> Since <span class="math inline">\(\gamma(x)\)</span> is
convex, <span class="math display">\[
\lambda\gamma( f(x_1))+(1-\lambda )\gamma(f(x_2)) \geq \gamma(\lambda
f(x_1)+(1-\lambda )f(x_2))
\]</span> Therefore, <span class="math display">\[
\lambda\gamma( f(x_1))+(1-\lambda )\gamma(f(x_2)) \geq \gamma (f(\lambda
x_1+(1-\lambda )x_2))
\]</span> This implies that <span
class="math inline">\(\gamma(f)(x)\)</span> is convex.</p>
<h2 id="section-7">(9)</h2>
<h3 id="a-3">(a)</h3>
<p><span class="math display">\[
f(x,y)=5x^2+5y^2-xy-11x+11y+11\\\\
\nabla f(x,y)=(10x-y-11,10y-x+11)
\]</span></p>
<p><span class="math display">\[
let\left\{
    \begin{array}{**lr**}
    10x-y-11=0\\
    10y-x+11=0
    \end{array}
\right.
\]</span></p>
<p>the solution of the equation set above is <span
class="math inline">\((1,-1)\)</span>,</p>
<p>it is the point satisfying the first-order necessary conditions</p>
<h3 id="b-3">(b)</h3>
<p><span class="math display">\[
\nabla^2 f(x,y)=
\begin{pmatrix}
10&amp;-1\\
-1&amp;10
\end{pmatrix}
\]</span></p>
<p>it is easy to know the Hessian Matrix is always positive definite, so
the point<span class="math inline">\((1,-1)\)</span> is a global minimum
point, and the global minimum is 0</p>
<h3 id="c-3">(c)</h3>
<p>for the steepest decent method, <span
class="math inline">\(D^k=I\)</span> <span class="math display">\[
(D^k)^{\frac12}\nabla^2f(x,y)(D^k)^{\frac12}=\nabla^2f(x,y)=\begin{pmatrix}
10&amp;-1\\
-1&amp;10
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
M=11,\quad m=9\\
\frac{f(x^{k+1})-f(x^*)}{f(x^{k})-f(x^*)}\leq(\frac{M-m}{M+m})^2=0.01
\]</span></p>
<h2 id="section-8">(10)</h2>
<h3 id="a-4">(a)</h3>
<p><span class="math display">\[
f(x,y)=x^2+y^2+xy-3x\\\\
\nabla f(x,y)=(2x+y-3,x+2y)\\\\
\nabla^2f(x,y)=
\begin{pmatrix}
2&amp;1\\
1&amp;2
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
let\left\{
    \begin{array}{**lr**}
    2x+y-3=0\\
    x+2y=0
    \end{array}
\right.
\]</span></p>
<p>the solution of the equation set above is <span
class="math inline">\((2,-1)\)</span>, and the Hessian Matrix is always
positive definite,</p>
<p>so point <span class="math inline">\((2,-1)\)</span> is unconstrained
local minimum point.</p>
<h3 id="b-4">(b)</h3>
<p>Because Hessian Matrix is always positive definite, the function
<span class="math inline">\(f(x,y)\)</span> is convex for all point in
the real space.</p>
<h3 id="c-4">(c)</h3>
<p>the minimum points must on the boundary of the constraint.</p>
<p>consider <span class="math inline">\(x=0\)</span>, then <span
class="math inline">\(f(x,y)=y^2\)</span>, the minimum point is <span
class="math inline">\((0,0)\)</span> and the minimum is <span
class="math inline">\(0\)</span></p>
<p>consider <span class="math inline">\(y=0\)</span>, then <span
class="math inline">\(f(x,y)=x^2-3x\)</span>, the minimum point is <span
class="math inline">\((\frac32,0)\)</span> and the minimum is <span
class="math inline">\(-\frac94\)</span></p>
<p>therefore, the minimum point of f subject to <span
class="math inline">\(x\geq 0,y\geq 0\)</span> is <span
class="math inline">\((\frac32,0)\)</span> and the minimum is <span
class="math inline">\(-\frac94\)</span></p>
<h3 id="d-1">(d)</h3>
<p>for the steepest decent method, <span
class="math inline">\(D^k=I\)</span> <span class="math display">\[
(D^k)^{\frac12}\nabla^2f(x,y)(D^k)^{\frac12}=\nabla^2f(x,y)=\begin{pmatrix}
2&amp;1\\
1&amp;2
\end{pmatrix}
\]</span></p>
<p><span class="math display">\[
M=3,\quad m=1\\
\frac{f(x^{k+1})-f(x^*)}{f(x^{k})-f(x^*)}\leq(\frac{M-m}{M+m})^2=\frac14
\]</span></p>
<h1 id="assignment-2">Assignment 2</h1>
<h2 id="section-9">(1)</h2>
<blockquote>
<p>Q: Consider the quadratic program <span class="math display">\[
min\  0.5x^TQx-b^Tx\\
s.t.\ Ax=c
\]</span> Prove that <span class="math inline">\(x^*\)</span> is a local
minimum point if and only if it is a global minimum point.(No convexity
is assumed)</p>
</blockquote>
<p>Proof:</p>
<p>Since no convexity is assumed, we consider two cases:</p>
<ol type="a">
<li><p>If Q is a positive definitive matrix. It’s obvious that <span
class="math inline">\(x^*\)</span> is a local minimum point if and only
if it is a global minimum point.</p></li>
<li><p>If Q is not a positive definitive matrix.</p></li>
</ol>
<p>Assume <span class="math inline">\(x^*\)</span> is a local minimum
point, set <span class="math inline">\(x^*+d\)</span> as the global
minimum point.</p>
<p>so <span class="math inline">\(A(x^*+d)=c\)</span></p>
<p>and because <span class="math inline">\(A(x^*)=c\)</span></p>
<p>so <span class="math inline">\(Ad=0\)</span></p>
<p>so we have <span class="math inline">\(A(x*+2d)=c\)</span></p>
<p>then according to the optimality condition, we have <span
class="math display">\[
\nabla f(x^*+d)&#39;((x^*+2d)-(x^*+d))\geq0\\
(Q(x^*+d)-b&#39;)d\geq0
\]</span> and we have <span class="math display">\[
\begin{align}
f(x^*+d)&amp;=0.5(x^*+d)&#39;Q(x^*+d)-b&#39;(x^*+d)\\
&amp;=0.5x^{*&#39;}Qx^*-bx^*+(Q(x^*+d)-b&#39;)d-0.5d&#39;Qd\\
&amp;=f(x^*)+(Q(x^*+d)-b&#39;)d-0.5d&#39;Qd\\
\end{align}
\]</span> as <span
class="math inline">\((Q(x^*+d)-b&#39;)d\geq0\)</span> and <span
class="math inline">\(-0.5d&#39;Qd\geq0\)</span></p>
<p>then <span class="math inline">\(f(x^*+d)\geq f(x^*)\)</span></p>
<p>and because <span class="math inline">\(f(x^*+d)\)</span> is the
global minimum, so we can get that <span
class="math inline">\(f(x^*+d)=f(x^*)\)</span>. and then we can conclude
that the local minimum is the global minimum.</p>
<h2 id="section-10">(2)</h2>
<blockquote>
<p>Suppose that the projected negative nablaient d is calculated
satisfying <span class="math display">\[
-g=d+A_q^T\lambda
\]</span> and that some component <span
class="math inline">\(\lambda_i\)</span> of <span
class="math inline">\(\lambda\)</span>, corresponding to an inequality,
is negative. Show that if the <span class="math inline">\(i\)</span>th
inequality is dropped, the projection <span
class="math inline">\(d_i\)</span> of the negative nablaient onto the
remaining constraints is a feasible direction of decent</p>
</blockquote>
<p>Proof:</p>
<p>Let the new direction vector <span class="math inline">\(d_i\)</span>
by relaxing the <span class="math inline">\(i\)</span>th constraint and
projecting the negative nablaient onto the subspace determined by
remaining <span class="math inline">\(q-1\)</span> active
constraints.</p>
<p>Let <span class="math inline">\(A_\bar q\)</span> denote the matrix
<span class="math inline">\(A_q\)</span> with row <span
class="math inline">\(a_j\)</span> deleted.</p>
<p>We know that <span class="math inline">\(g^Td_i&lt;0\)</span> .</p>
<p>Multiplying the equation <span class="math inline">\(-g=d_i+A^T_\bar
q\lambda_i\)</span> by <span class="math inline">\(d_i\)</span> and
using <span class="math inline">\(A_\bar q d_i=0\)</span> we obtain:
<span class="math display">\[
0&gt;g^Td_i=-\lambda_ia_i^Td_i
\]</span> Since <span class="math inline">\(\lambda_i&lt;0\)</span> , we
conclude that <span class="math inline">\(d_i^Td_i&lt;0\)</span> .</p>
<p>So the vector <span class="math inline">\(d_i\)</span> is a direction
of descent, but it is a feasible direction.</p>
<h2 id="section-11">(3) 3.1.9</h2>
<h3 id="a-5">(a)</h3>
<p><span class="math display">\[
min\ x+y+z\\
s.t. xyz=\rho^2(x+y+z)
\]</span></p>
<p>consider the Lagrangian Relaxation: <span class="math display">\[
L(x,y,z,\lambda)=x+y+z+\lambda(xyz-\rho^2(x+y+z))
\]</span> let <span class="math inline">\(\nabla L=0\)</span>, then we
have <span class="math display">\[
\left\{
    \begin{array}{**lr**}
    1+\lambda(yz-\rho^2)=0\\
    1+\lambda(xz-\rho^2)=0\\
    1+\lambda(xy-\rho^2)=0\\
    xyz=\rho^2(x+y+z)
    \end{array}
\right.
\]</span> then we have: <span class="math display">\[
\frac{y+z}x=\frac{x+z}y=\frac{x+y}z
\]</span> so <span class="math inline">\(x=y=z\)</span></p>
<h3 id="b-5">(b)</h3>
<p>consider all lines parallel to the line that passes through <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span> and</p>
<p>intersect the circle.</p>
<p>the maximal area appears only if the point <span
class="math inline">\(x\)</span> is the point of tangency between the
parallel line and the circle.</p>
<p>and we can see that the line through <span
class="math inline">\(x\)</span> and <span class="math inline">\(\hat
x\)</span> is also the line perpendicular to the tangent line and
through point <span class="math inline">\(x\)</span>.</p>
<p>so this line must passes through the center of the circle.</p>
<h3 id="c-5">(c)</h3>
<p>Fix two vertices and the corresponding side of the corresponding side
of the triangle and optimize vertex and the vertex of the circle should
be orthogonal to the fixed side. Hence, the optimal is obtained when the
two remaining side are equal. Repeating this argument, fixing each side
of the triangle in turn, we see that all sides should be equal.</p>
<h3 id="d-2">(d)</h3>
<p>Similar line of argument as in (c).</p>
<h2 id="section-12">(4) 3.3.5</h2>
<h3 id="a-6">(a)</h3>
<p>Let <span class="math inline">\(d\in \bar F(x^*)\)</span>, so <span
class="math inline">\(\exists \{d^k\}\subset F(x^*)\)</span>, so that
<span class="math inline">\(d^k\rightarrow d\)</span>.</p>
<p>And we have: <span class="math display">\[
\nabla f(x^*)&#39;d^k=lim_{\alpha\rightarrow0}\frac{f(x^*+\alpha
d^k)-f(x^*)}\alpha
\]</span></p>
<p>Because <span class="math inline">\(x^*\)</span> is a constrained
local minimum, so<span class="math inline">\(\frac{f(x^*+\alpha
d^k)-f(x^*)}\alpha\geq0\)</span> .</p>
<p>So, <span class="math inline">\(\nabla
f(x^*)&#39;d^k\geq0\)</span>.</p>
<h3 id="b-6">(b)</h3>
<p>If x* is a constrained local minimum, from (a) we can get <span
class="math display">\[
\nabla f(x^*)&#39;d^k\geq0,\ \forall d\ with\ \nabla
g_j(x^*)&#39;d\leq0,\ \forall j\in A(x^*)
\]</span> According to Farkas’Lemma, it is true iff there exists <span
class="math inline">\(u^*\)</span> such that <span
class="math display">\[
-\nabla f(x^*)=\sum_{j\in A(x^*)}u_j\nabla g_j(x^*),\ u_j^*\geq0
\]</span> Setting <span class="math inline">\(u_j^*=0\)</span> for <span
class="math inline">\(j\notin A(x^*)\)</span> .</p>
<p>we have the desired result.</p>
<h3 id="c-6">(c)</h3>
<p>We want to show that <span class="math inline">\(\bar
F(x^*)=V(x)\)</span>, where <span class="math inline">\(V(x^*)\)</span>
is the cone of first order feasible variations given by <span
class="math inline">\(V(x^*)=\{d|\nabla g_j(x^*)&#39;d\leq0,\ \forall
j\in A(x^*\}\)</span>.</p>
<p>From Mean Value Theorem, for each <span class="math inline">\(j \in
A(x^*)\)</span> and for any <span class="math inline">\(d\in
F(x^*)\)</span> there exist <span
class="math inline">\(\varepsilon\in[0,1]\)</span> such that <span
class="math inline">\(g_j(x^*+\alpha d)=g_j(x^*)+\alpha\nabla
g_j(x^*+\varepsilon\alpha d)&#39;d\)</span>.</p>
<p>Because <span class="math inline">\(g_j(x^*+\alpha d)\leq0\)</span>,
so <span class="math display">\[
\lim_{\alpha\rightarrow0}\alpha\nabla g_j(x^*+\varepsilon\alpha
d)&#39;d\leq0
\]</span> And that implies that $g_j(x^<em>)d,jA(x^</em> $, so that
<span class="math inline">\(d\in V(x^*)\)</span>. Therefore <span
class="math inline">\(F(x^*)\subset V(x)\)</span>, since <span
class="math inline">\(V(x^*)\)</span> is closed, so <span
class="math inline">\(\bar F(x^*)\subset V(x)\)</span>.</p>
<p>From each of 1-4, we can also prove that <span
class="math inline">\(\bar F(x^*)\supset V(x)\)</span>.</p>
<p>So we can get that $ F(x^*)=V(x)$.</p>
<h3 id="d-3">(d)</h3>
<p>We can easily get the local minimum is <span
class="math inline">\(x^*= (0,0)\)</span>. So we have <span
class="math display">\[
\nabla g_1(0,0)=(0,1)^T\\
\nabla g_2(0,0)=(0,-1)^T
\]</span> Obviously g1 and g2 are not linear, so the condition(1) is
violated. Furthermore, there is no vector <span class="math inline">\(d=
(d1,d2)’\)</span> such that <span class="math display">\[
\nabla g_1(0,0)&#39;d=d_2&lt;0,\ \nabla g_1(0,0)&#39;d=-d_2&lt;0
\]</span></p>
<p>So the condition2 is violated. Similarly, condition3 is violated. The
vectors <span class="math inline">\(\nabla g_1(0,0)\)</span> and <span
class="math inline">\(\nabla g_2(0,0)\)</span> are linearly dependent
since <span class="math inline">\(\nabla g_1(0,0)=-\nabla
g_2(0,0)\)</span>, so the condition4 is violated.</p>
<p>Assume <span class="math inline">\(u_0\nabla f(x^*)+u_1\nabla
g_1(x^*)+u_2\nabla g_2(x^*)=0\)</span>, so we have: <span
class="math display">\[
(u_0,u_0)&#39;+(0,u_1)&#39;+(0,u_2)&#39;=(0,0)&#39;
\]</span> It follows that <span class="math inline">\(u_0=0\)</span>. So
there is no Lagrange multiplier.</p>
<h3 id="e-1">(e)</h3>
<p>From the description we know that <span
class="math inline">\(x^*\)</span> is also a local minimum for the
modified problem.</p>
<p>The modified problem has a single constraint <span
class="math inline">\(g_1(x)=||h(x)||^2\)</span>, which is active at
<span class="math inline">\(x^*\)</span>.</p>
<p>Since <span class="math inline">\(g_1\)</span> is not linear, the
condition 1 is violated.</p>
<p>Because <span class="math inline">\(\nabla g_1(x^*)=2\nabla
h(x^*)\nabla h(x^*)=0\)</span>, the conditions 2 and 4 are violated. If
condition 3 holds, we can prove that condition 2 is hold too, so
condition 3 is violated, too. From <span
class="math inline">\(u_0^*\nabla g(x^*=-u_1^*\nabla g_1(x^*))\)</span>
and <span class="math inline">\(\nabla g_1(x^*)=0\)</span>, it follows
that <span class="math inline">\(u_0^*=0\)</span>, so there is no
Lagrange multiplier.</p>
<h2 id="section-13">(5) 5.1.7</h2>
<h3 id="a-7">(a)</h3>
<p><span class="math display">\[
let \ x_i=\left\{
    \begin{array}{**lr**}
    0 &amp; if\ the\ object\ is\ included\ in\ the\ subset\\
    1 &amp; otherwise
    \end{array}
\right.
\]</span></p>
<p>Then the total weight and value of objects included is <span
class="math inline">\(\sum_iw_ix_i\)</span> and <em>iv_ix_i,
respectively, and the problem can be written as $$
max f(x)=</em>{i=1}^nv_ix_i\</p>
<ol start="19" type="a">
<li>t._{i=1}^nw_ix_iA, xi ∈ {0, 1}, i= 1, . . . , n. $$</li>
</ol>
<h3 id="b-7">(b)</h3>
<p>Let <span class="math inline">\(\hat f(x)=-f(x)\)</span> and consider
the equivalent problem of minimizing <span class="math inline">\(\hat
f(x)\)</span> subject to the constraints given above. Then <span
class="math display">\[
L(x,\mu)=-\sum_{i=1}^nv_ix_i+\mu(\sum_{i=1}^nw_ix_i-A)
\]</span> and <span class="math display">\[
\hat q(u)=\inf_{x_i\in\{0,1\}}\{\sum_{i=1}^n(\mu w_i-v_i)x_i-\mu A\}
\]</span> Note that the minimization above is a separable problem, and
the minimum is attained at <span class="math display">\[
\hat x_i(\mu)=
\left\{
    \begin{array}{**lr**}
    0&amp; if\ \mu&lt;v_i/w_i\\
    1&amp; if\ \mu&gt;v_i/w_i\\
    o\ or\ 1 &amp; otherwise
    \end{array}
\right.
\]</span> Without loss of generality, assume that the objects are
ordered such that: <span class="math display">\[
\frac{v_1}{w_1}\leq\frac{v_2}{w_2}\leq...\leq\frac{v_n}{w_n}
\]</span> When<span
class="math inline">\(\mu\in(\frac{v_{j-1}}{w_{j-1}},\frac{v_j}{w_j}]\)</span>
for some <span class="math inline">\(j\)</span> with <span
class="math inline">\(1≤j ≤n\)</span>, then <span
class="math inline">\(\hat x_i=1\)</span> for all <span
class="math inline">\(i≥j\)</span>.</p>
<p>And $ x_i() = 0$ otherwise, and <span class="math display">\[
\hat q(\mu)=u(\sum_{i=1}^nw_i-A)-\sum_{i=1}^nv_i
\]</span> From this relation, we see that, as μ increases, the slope of
<span class="math inline">\(\hat q(u)\)</span> decreases from <span
class="math inline">\(\sum_{i=1}^nw_i-A\)</span> to <span
class="math inline">\(−A\)</span>. Therefore, if $ _{i=1}^nw_i-A&gt; 0$,
<span class="math inline">\(\hat q(u)\)</span> is maximized when the
slope of the curve goes from positive to negative. In this case, the
dual optimal value <span class="math inline">\(\hat q^*\)</span> is
attained at <span
class="math inline">\(u^*=\frac{v_i^*}{w_i^*}\)</span>, where<span
class="math inline">\(i^*\)</span>is the largest <span
class="math inline">\(i\)</span> such that <span class="math display">\[
w_1+w_2+...+w_n\geq A
\]</span></p>
<p>If <span class="math inline">\(\sum_{i=1}^nw_i-A ≤ 0\)</span>, then
the dual optimal value <span class="math inline">\(\hat q^*\)</span>is
attained at <span class="math inline">\(u^* = 0\)</span>.</p>
<h3 id="c-7">(c)</h3>
<p>Consider a relaxed version of the problem of minimizing <span
class="math inline">\(\hat f\)</span>: $$
max f_R(x)=-_{i=1}^nv_ix_i\</p>
<ol start="19" type="a">
<li>t._{i=1}^nw_ix_iA, xi ∈ [0, 1], i= 1, . . . , n. $$ Let <span
class="math inline">\(f_R^*\)</span> and <span
class="math inline">\(q_R^*\)</span> be the optimal values of the
relaxed problem and its dual, respectively.</li>
</ol>
<p>In the relaxed problem, the cost function is convex over <span
class="math inline">\(R^n\)</span>(in fact it is linear), and the
constraint set is polyhedral.</p>
<p>Thus, according to Prop. 5.2.1, there is no duality gap, and <span
class="math inline">\(f_R^*=q_R^*\)</span> . The dual function of the
relaxed problem is: <span class="math display">\[
q_R(\mu)=\inf_{x_i\in\{0,1\}}\{\sum_{i=1}^n(\mu w_i-v_i)x_i-\mu A\}
\]</span></p>
<p>Again, <span class="math inline">\(q_R(x)\)</span>is separable and
the minimum is attained at <span class="math display">\[
\hat x_i(\mu)=
\left\{
    \begin{array}{**lr**}
    0&amp; if\ \mu&lt;v_i/w_i\\
    1&amp; if\ \mu&gt;v_i/w_i\\
    o\ or\ 1 &amp; otherwise
    \end{array}
\right.
\]</span> Thus the solution is the same as the <span
class="math inline">\(\{0, 1\}\)</span> constrained problem for all
<span class="math inline">\(i\)</span> with <span
class="math inline">\(\mu\neq\frac{v_i}{w_i}\)</span>. For <span
class="math inline">\(i\)</span> with<span
class="math inline">\(\mu=\frac{v_i}{w_i}\)</span>, the value of <span
class="math inline">\(x_i\)</span> is irrelevant to the dual function
value. Therefore, <span class="math inline">\(\hat
q(u)=q_R(\mu)\)</span> for all μ, and thus <span
class="math inline">\(\hat q^*=q_R^*\)</span>.</p>
<p>Following Example 5.1.2, it can be seen that the optimal primal and
dual solution pair <span class="math inline">\((x^∗, μ^∗)\)</span> of
the relaxed problem satisfies $$ μ∗ w_i = v_i ,  if 0 &lt;x_i^*&lt;
1,\</p>
<p>μ∗ w_i v_i ,  if x_i^*=0,\</p>
<p>μ∗ w_i v_i ,  if x_i^*= 1, $$</p>
<p>In fact, it is straightforward to show that there is an optimal
solution of the relaxed problem such that at most one <span
class="math inline">\(x^*_i\)</span> satisfies <span
class="math inline">\(0 &lt; x_i^*  &lt; 1\)</span>. Consider a solution
equivalent to this optimal solution with the exception that = 0 if 0
&lt; &lt; 1. This solution is clearly feasible for the {0, 1}
constrained problem, so that we have <span class="math display">\[
\hat f^*\leq \hat f(\hat x)\leq f_R^*+\max_{i\leq i\leq n}v_i
\]</span> Combining with earlier results, <span class="math display">\[
\hat f^*\leq q_R^*+\max_{i\leq i\leq n}v_i=\hat q^*+\max_{i\leq i\leq
n}v_i
\]</span> Since <span class="math inline">\(\hat f^*=-f\)</span> and
<span class="math inline">\(\hat q^*=-q^*\)</span> we have the desired
result.</p>
<h3 id="d-4">(d)</h3>
<p>Since the object weights and values remain the same we have from (c)
that <span class="math inline">\(0\leq q^*(k)-f^*(k)\leq \max_{i\leq
i\leq n}v_i\)</span>. By including in the subset each replica of an
object assembled in the optimal solution to the original problem, we see
that <span class="math inline">\(f^*(k)\geq kf^*\)</span> . It then
follows that <span class="math display">\[
\lim_{k\rightarrow\infty}(q^*(k)-f^*(k))=0
\]</span></p>
<h1 id="assignment-3">Assignment 3</h1>
<h2 id="section-14">5.5.2</h2>
<p><span class="math display">\[
min\ \ f(x)=10x_1+3x_2\\
s.t.\ \ 5x_1+x_2\geq4\ \ x_1,x_2\in\{0,1\}
\]</span></p>
<p>Using Lagrangian relaxiation:</p>
<p>the Lagrangian funcion is <span class="math display">\[
L(x,\mu)=10x_1+3x_2+\mu(4-5x_1-x_2)=(10-5\mu)x_1+(3-\mu)x_2+4\mu
\]</span> the dual problem is: <span class="math display">\[
max\ \ q(\mu)=\min_{x\in\{0,1\}}L(x,\mu)\\
s.t.\ \ \mu\geq0
\]</span> the solution is <span class="math inline">\(\mu=2,
q^*=8\)</span></p>
<p>Using constraint relaxation:</p>
<p>the releaxed problem is: <span class="math display">\[
min\ \ f(x)=10x_1+3x_2\\
s.t.\ \ 5x_1+x_2\geq4\ \ x_1,x_2\in[0,1]
\]</span> (a) when <span class="math inline">\(x_1=0\)</span>, the
prolem is: <span class="math display">\[
min\ \ f(x)=3x_2\\
s.t.\ \ x_2\geq4\ \ x_2\in[0,1]
\]</span> this problem is infeasible.</p>
<ol start="2" type="a">
<li>when <span class="math inline">\(x_1=1\)</span>, the problem is:
<span class="math display">\[
min\ \ f(x)=10+3x_2\\
s.t.\ \ 5+x_2\geq4\ \ x_2\in [0,1]
\]</span> when <span class="math inline">\(x_2=0\)</span>, the value of
object function is minimization. so the solution is <span
class="math inline">\((1,0)\)</span>, it is also integer solution, so
the point <span class="math inline">\((1,0)\)</span> is the optimal
point of the primal problem, minimization is 10</li>
</ol>
<p>so the lower bound of Lagrangian relaxiation is less than constraint
relaxation.</p>
<h2 id="section-15">5.5.10</h2>
<ol type="a">
<li><p><span class="math display">\[
\begin{align*}
\bar q&amp;=\inf_{x\in \bar X}\{f(x)+\sum_{j=0}^{\bar r}\mu_jg_j(x)\}\\
   &amp;=\inf_{\ \ \ \ \ \ \ \ \ \ x\in X\\g_{\bar
r+1}(x)\leq0...g_r(x)\leq0}\{f(x)+\sum_{j=1}^{\bar r}\mu_jg_j(x)\}\\
   &amp;\geq \inf_{\ \ \ \ \ \ \ \ \ \ x\in X\\g_{\bar
r+1}(x)\leq0...g_r(x)\leq0}\{f(x)+\sum_{j=1}^{r}\mu_jg_j(x)\}\\
   &amp;\geq \inf_{x\in X}\{f(x)+\sum_{j=1}^{r}\mu_jg_j(x)\}\\
   &amp;=q
\end{align*}
\]</span> so we have <span class="math inline">\(\bar q^*\geq
q^*\)</span>, and we have <span class="math inline">\(\bar q^*\leq
f^*\)</span> by the weak duality theorem, so <span
class="math inline">\(q^*\leq\bar q^*\leq f^*\)</span></p></li>
<li></li>
</ol>
<p>if <span class="math inline">\(q^*=f^*\)</span>, and we have<span
class="math inline">\(q^*\leq\bar q^*\leq f^*\)</span></p>
<p>so we can get <span class="math inline">\(q^*=\bar
q^*=f^*\)</span></p>
<ol start="3" type="a">
<li><span class="math display">\[
min\ \  f(x)=e^{-x_1x_2}\\
s.t.\ \ x_1=0,\ x_1-1\leq0,\ x\in X=\{x|x\geq0\}
\]</span></li>
</ol>
<p><span class="math display">\[
\bar X=\{x|x\geq0, x_1=0\}
\]</span></p>
<p>and we can get <span class="math inline">\(q^*=0,\bar
q^*=f^*=1\)</span>, so <span class="math inline">\(q^*&lt;\bar
q^*=f^*\)</span></p>
<h2 id="section-16">6.3.1</h2>
<ol type="a">
<li></li>
</ol>
<p>Let <span class="math inline">\(\mu^∗\)</span> be a dual optimal
solution, we obtain: <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-2s^k(q^*-q(u^k))+(s^k)^2||g^k||^2
\]</span> where <span class="math inline">\(q^*=q(\mu^*)\)</span>, <span
class="math inline">\(s^k=\frac{q^*-q(\mu^k)}{||g^k||^2}\)</span>, and
we have: <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-\frac{q^*-q(\mu^k)}{||g^k||^2}
\]</span> So <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq ||\mu^{k}-\mu^*||^2,\ \ \forall k
\]</span> implying that <span class="math inline">\(\{\mu^k\}\)</span>
is bounded.</p>
<ol start="2" type="a">
<li></li>
</ol>
<p>Let <span class="math inline">\(C\)</span> be a positive constant
such that <span class="math inline">\(||g^k|| ≤ C\)</span> for all <span
class="math inline">\(k\)</span>, then <span class="math display">\[
||\mu^{k+1}-\mu^*||^2+\frac{q^*-q(\mu^k)}{C^2}\leq ||\mu^{k}-\mu^*||^2
\]</span> By summing these inequalities over all <span
class="math inline">\(k\)</span>, we obtain <span
class="math display">\[
\frac1{C^2}\sum_{k=0}^\infty(q^*-q(\mu^k))^2\leq||\mu^0-\mu^*||^2
\]</span> so <span class="math inline">\(\lim_{k\rightarrow
\infty}q(\mu^k)=q^*\)</span></p>
<p>Since <span class="math inline">\({\mu^k}\)</span> is bounded, there
exist a vector <span class="math inline">\(\hat \mu\)</span> and a
subsequence ${^k}_{kK} {^k} $converging to <span
class="math inline">\(\hat\mu ∈ M\)</span>. By using the
upper-semicontinuity of q, we have <span class="math display">\[
\lim_{k\rightarrow\infty}\sup_{k\in\mathcal K}q(\mu^k)\leq q(\hat
\mu)\leq q^*
\]</span> Now we show that <span
class="math inline">\(\{\mu^k\}\)</span> actually converges. Let <span
class="math inline">\(M^∗\)</span> denote the set of all dual optimal
solutions. Note that <span class="math inline">\(M^∗\)</span> is convex
(by concavity of <span class="math inline">\(q\)</span>) and closed (by
upper-semicontinuity of <span class="math inline">\(q\)</span>). Suppose
that <span class="math inline">\(\{\mu^k\}\)</span> has two distinct
limit points, say <span class="math inline">\(\hat\mu \in M^∗\)</span>
and <span class="math inline">\(\widetilde\mu \in M^∗\)</span>. As seen
in (a), for any <span class="math inline">\(\mu^* \in M^∗\)</span>, the
sequence <span class="math inline">\(\{||\mu^k − \mu^∗||\}\)</span>
decreases monotonically, and therefore it converges. Hence <span
class="math inline">\(||\hat\mu − \mu^∗|| = ||\widetilde\mu  −
\mu^∗||\)</span> for all <span class="math inline">\(\mu^* \in
M^∗\)</span>, implying that <span class="math inline">\(\hat
\mu=\widetilde \mu\)</span>.</p>
<ol start="3" type="a">
<li></li>
</ol>
<p>Let <span class="math inline">\(q\)</span> be real-valued and concave
over the entire space <span class="math inline">\(\mathbb{R}^r\)</span>.
According to Prop. B.24 of Appendix B, since <span
class="math inline">\(\{\mu^k\}\)</span> is bounded, the set <span
class="math inline">\(∪_{k≥0}∂q(\mu^k)\)</span> is bounded, and so is
<span class="math inline">\(\{g^k\}\)</span>.</p>
<h2 id="section-17">6.3.3</h2>
<ol type="a">
<li></li>
</ol>
<p>Suppose that <span
class="math inline">\(\lim_{k\rightarrow\infty}\inf\sqrt{k}(q^*-q(\mu^k))&gt;0\)</span>,
Then there is an <span class="math inline">\(\epsilon&gt;0\)</span> and
large enough <span class="math inline">\(\bar k\)</span> such that <span
class="math inline">\(\sqrt{k}(q^*-q(\mu^k))\geq\epsilon\)</span> for
all <span class="math inline">\(k\geq \bar k\)</span>, so <span
class="math display">\[
(q^*-q(\mu^k))^2\geq\frac{\epsilon^2}{k},\ \ \ \ \forall k\geq \bar k
\]</span> implying that <span class="math display">\[
\sum_{k=\bar k}^\infty(q^*-q(\mu^k))^2\geq \epsilon^2\sum_{k=\bar
k}^\infty\frac1k=\infty
\]</span> which contradicts the relation <span class="math display">\[
\sum_{k=0}^\infty(q^*-q(\mu^k))^2&lt;\infty
\]</span> (b)</p>
<p>As seen in 6.3.1, we have for all dual optimal solutions <span
class="math inline">\(\mu^*\)</span> and all <span
class="math inline">\(k\)</span> <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-\frac{q^*-q(\mu^k)}{||g^k||^2}
\]</span> This relation and the inequality <span
class="math inline">\(q(\mu^∗) − q(\mu^k) ≥ a||\mu^∗ − \mu^k||\)</span>
yield for all <span class="math inline">\(k\)</span> <span
class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq
||\mu^{k}-\mu^*||^2-\frac{a^2||\mu^k-\mu^*||^2}{||g^k||^2}
\]</span> from which, by using <span class="math inline">\(\sup_{k≥0}
||g^k||≤ b\)</span>, we obtain <span class="math display">\[
||\mu^{k+1}-\mu^*||^2\leq (1-\frac{a^2}{b^2})||\mu^{k}-\mu^*||^2
\]</span> and the desired relation follows.</p>
<h1 id="assignment-4">Assignment 4</h1>
<h2 id="section-18">2.1</h2>
<h3 id="a-8">(a)</h3>
<figure>
<img
src="https://download.kezhi.tech/img/20220105160426.png?x-oss-process=style/webp"
alt="the precedence constraints graph" />
<figcaption aria-hidden="true">the precedence constraints
graph</figcaption>
</figure>
<h3 id="b-8">(b)</h3>
<p>We cloud use dynamic program to solve this question, the
computational process is following:</p>
<figure>
<img
src="https://download.kezhi.tech/img/20220105161308.png?x-oss-process=style/webp"
alt="computational process of dp" />
<figcaption aria-hidden="true">computational process of dp</figcaption>
</figure>
<p>and the makespan of this project is 39 weeks</p>
<h3 id="c-8">(c)</h3>
<figure>
<img
src="https://download.kezhi.tech/img/20220105161505.png?x-oss-process=style/webp"
alt="Most cost trace" />
<figcaption aria-hidden="true">Most cost trace</figcaption>
</figure>
<p>This is the most cost trace of the project, shorting each of them
could save a week time.</p>
<p>job 7 (Walls) should be shorten most since it cost 10 weeks and all
the following work must wait for its finishing.</p>
<h2 id="section-19">2.4</h2>
<h3 id="a-9">(a)</h3>
<p>The processor sharing is a service discipline where a number of jobs
are processed simultaneously, it can be seen that the processing could
be interrupt any time. For CPU, the processing already done on the
preempted job is not lost, so the model of the processor sharing concept
on CPU is <em>Preemptive-Resume</em> form.</p>
<h3 id="b-9">(b)</h3>
<p>Assume that the switch of job takes no time, there are <span
class="math inline">\(n\)</span> jobs need to be processed, each job has
a weight <span class="math inline">\(w_j\)</span> and process time <span
class="math inline">\(c_j\)</span>. Function <span
class="math inline">\(g(j,t)\)</span> shows if the job <span
class="math inline">\(j\)</span> has been finished on time <span
class="math inline">\(t\)</span>, if finished, <span
class="math inline">\(g(j,t)=0\)</span>; else <span
class="math inline">\(g(j,t)=1\)</span>. Function <span
class="math inline">\(f(j,t)=1\)</span> shows that job <span
class="math inline">\(j\)</span> are processed on time t, <span
class="math inline">\(f(j,t)=0\)</span> shows that job <span
class="math inline">\(j\)</span> are not processed on time t</p>
<p>We would like the cpu process the job with high weight as quickly as
possible, so we get the following objective optimization problem: <span
class="math display">\[
min\ \ \sum_{j=1}^n\int_0^{+\infty}g(j,t)w_j\\
s.t.\ \ \sum_{j=1}^nf(j,t)\leq 1\\
\ \ \ \ g(j,t)=\left\{
    \begin{array}{**lr**}
    1 &amp; if \int_0^tf(j,\tau)d\tau\geq c_j\\
    0 &amp; otherwise
    \end{array}
\right.\\
\int_0^{+\infty}f(j,\tau)d\tau=c_j
\]</span></p>
<h2 id="section-20">2.9</h2>
<div class="line-block">  jobs | 1 | 2 | 3 | 4 |<br />
:</div>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Optimal</tag>
        <tag>Schedule</tag>
      </tags>
  </entry>
  <entry>
    <title>Xjtu System Optimization And Scheduling Final Report</title>
    <url>/en/a7067052.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/a7067052.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h1
id="application-of-branch-and-bound-method-in-knapsack-problem">Application
of Branch and Bound Method in Knapsack Problem</h1>
<p>Final report for the course "System Optimization and Scheduling" at
Xi'an Jiaotong University</p>
<p><img src="https://download.kezhi.tech/img/202211291638345.jpg?x-oss-process=style/webp" style="width:30%;" /></p>
<span id="more"></span>
<h2 id="introduction">1 Introduction</h2>
<p>The Knapsack problem is a combinatorial optimization problem that is
NP-complete. The problem can be described as follows: given a set of
items, each with its own weight and value, and a limited total weight,
how do we choose the items to maximize the total value while not
exceeding the total weight of the knapsack? The name of the problem
comes from the idea of choosing the most suitable items to put in the
given knapsack. Similar problems often arise in fields such as business,
combinatorial mathematics, computational complexity theory,
cryptography, and applied mathematics.</p>
<h2 id="mathematical-description">2 Mathematical Description</h2>
<p>The Knapsack problem can be divided into three categories based on
the restrictions on the number of items: 0-1 Knapsack problem, Unbounded
Knapsack problem, and Bounded Knapsack problem. In the 0-1 Knapsack
problem, each item can only be selected once (either included in the
knapsack or not). In the Unbounded Knapsack problem, there is no limit
on the number of each item that can be included in the knapsack. In the
Bounded Knapsack problem, each item has a specific limit on the number
of times it can be included in the knapsack. The mathematical
descriptions of these three types of Knapsack problems are explained
below.</p>
<h3 id="knapsack-problem">2.1 0-1 Knapsack Problem</h3>
<p>The most basic Knapsack problem can be mathematically described as
follows: given n items, where item i has a weight wi and a value vi, and
a knapsack with a capacity W, we want to select a subset of items to
maximize the total value while not exceeding the capacity of the
knapsack. This can be formulated as the following optimization
problem:</p>
<p><span class="math display">\[
\max \sum_{i=1}^nv_ix_i\\
s.t.\left\{
    \begin{array}{**lr**}
    \sum_{i=1}^nw_ix_i\leq W\\
    x_i\in\{0,1\}
    \end{array}
\right.
\]</span></p>
<h3 id="unbounded-knapsack-problem">2.2 Unbounded Knapsack Problem</h3>
<p>The Unbounded Knapsack problem can be mathematically described as
follows: given n items, where item i has a weight wi and a value vi, and
a knapsack with a capacity W, we want to select a subset of items to
maximize the total value while not exceeding the capacity of the
knapsack. Unlike the 0-1 Knapsack problem, there is no limit on the
number of each item that can be included in the knapsack. This can be
formulated as the following optimization problem:</p>
<p><span class="math display">\[
\max \sum_{i=1}^nv_ix_i\\
s.t.\left\{
    \begin{array}{**lr**}
    \sum_{i=1}^nw_ix_i\leq W\\
    x_i\in N_+
    \end{array}
\right.
\]</span></p>
<h3 id="bounded-knapsack-problem">2.3 Bounded Knapsack Problem</h3>
<p>The Bounded Knapsack problem can be mathematically described as
follows: given n items, where item i has a weight wi, a value vi, and a
quantity bi, and a knapsack with a capacity W, we want to select a
subset of items to maximize the total value while not exceeding the
capacity of the knapsack. Each item has a specific limit on the number
of times it can be included in the knapsack. This can be formulated as
the following optimization problem:</p>
<p><span class="math display">\[
\max \sum_{i=1}^nv_ix_i\\
s.t.\left\{
    \begin{array}{**lr**}
    \sum_{i=1}^nw_ix_i\leq W\\
    x_i\leq m_i\\
    x_i\in N_+\\
    \end{array}
\right.
\]</span></p>
<h2 id="solution-algorithms">3 Solution Algorithms</h2>
<h3 id="branch-and-bound-algorithm">3.1 Branch and Bound Algorithm</h3>
<p>The Branch and Bound method is the most commonly used algorithm for
solving integer programming problems. This method can be used to solve
both pure integer programming problems and mixed integer programming
problems. The Branch and Bound method is a search and iteration method
that selects different branching variables and subproblems for
branching. Typically, the entire feasible solution space is repeatedly
divided into smaller and smaller subsets, called branching, and a lower
bound is calculated for each subset of solutions (for minimization
problems). This is called bounding. After each branching, those subsets
whose bounds exceed the known feasible solution target value are no
longer further branched, so many subsets can be ignored. This is the
main idea of the Branch and Bound method. The steps of the Branch and
Bound algorithm are as follows:</p>
<blockquote>
<ol type="1">
<li>For minimization problems, set the initial value of the best
feasible solution to best = +∞.</li>
<li>According to the branching rule, select a node (local solution) from
the nodes (local solutions) that have not been fathomed, and branch it
into several new nodes in the next level.</li>
<li>Calculate the lower bound (LB) for each node based on the lower
bound function.</li>
<li>If the lower bound of a node is greater than the current best value,
then the subsequent nodes do not contain feasible solutions, so this
node will not be considered in the subsequent calculations. If a
feasible solution with the smallest lower bound is found in this node,
stop the downward search. Otherwise, continue to search downward with
this node as an unfathomed node.</li>
<li>Check if there are still unfathomed nodes. If there are, go to step
2. If there are no more unfathomed nodes, the algorithm stops, and the
optimal solution is obtained.</li>
</ol>
</blockquote>
<p>The key to the Branch and Bound algorithm lies in the selection of
branching rules and lower bound functions. Different problems have
different ways of selecting them. In the Knapsack problem, the number of
items included is used as the branching criterion, and different
selection methods for each item result in different levels of the search
tree. The lower bound function can be calculated by relaxing the
constraint that the number of items included must be an integer. The
specific algorithm is explained in the following sections.</p>
<h3 id="solving-the-0-1-knapsack-problem">3.2 Solving the 0-1 Knapsack
Problem</h3>
<p>In this problem, the calculation of the Lower Bound for a node is as
follows:</p>
<blockquote>
<ol type="1">
<li>Calculate the unit value of each item, i.e., pi = vi/wi.</li>
<li>Calculate the total weight w_sum and total value v_sum of the items
that have already been determined (included/excluded).</li>
<li>If w_sum &gt; W, the node is infeasible. Otherwise, select the item
with the highest unit value from the items that have not been determined
and include it in the knapsack until the knapsack is full (at this
point, a fractional number of items can be included, e.g., 6/7 items of
type 2, the relaxation condition takes effect here). Calculate the total
value v_sum of the items in the knapsack, which is the Lower Bound of
the node.</li>
</ol>
</blockquote>
<p>The Branch and Bound algorithm proceeds as follows:</p>
<blockquote>
<ol type="1">
<li>Create an empty queue and put the root node into the queue.</li>
<li>Select a node from the queue, generate its child nodes. If there are
no child nodes, it means that the node is a feasible solution. Compare
it with the current best solution. If it is smaller than the best
solution, replace the current best solution. If there are child nodes,
calculate the Lower Bound for each child node. If a child node is
infeasible or its Lower Bound is greater than the current best solution,
discard the node. Otherwise, add the node to the queue.</li>
<li>Repeat step 2 until the queue is empty. The remaining best solution
is the optimal solution to the problem.</li>
</ol>
</blockquote>
<p>The node generation algorithm is as follows:</p>
<blockquote>
<ol type="1">
<li>Find all items that have not been determined.</li>
<li>Select the item with the highest unit value from these items.</li>
<li>Generate two nodes: one with the item included and one with the item
excluded.</li>
</ol>
</blockquote>
<p>In the Branch and Bound process, there are two main methods for
selecting nodes from the queue:</p>
<ul>
<li>FIFO (First-In-First-Out) selection, which selects nodes in the
order they were added to the queue. The advantage is that it requires
less storage space, but the disadvantage is that it requires a large
amount of computation before reaching a feasible solution in order to
update the best solution and perform pruning effectively.</li>
<li>Priority queue selection, which selects the node with the smallest
Lower Bound from the queue for exploration. The advantage is that it
requires less computation and allows for faster exploration and updating
of feasible optimal solutions, making pruning more efficient. The
disadvantage is that it requires more storage space.</li>
</ul>
<p>Let's take a simple 0-1 Knapsack problem as an example:</p>
<p>The knapsack has a capacity of 10, and there are 5 items with their
respective weights and values as shown in the table below:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Weight</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Value</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">10</td>
</tr>
</tbody>
</table>
<p>The solution algorithm will be explained in the following
sections.</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Optimal</tag>
        <tag>背包问题</tag>
        <tag>branch-and-bound</tag>
      </tags>
  </entry>
  <entry>
    <title>Zotero Plugin Recommendation and Download</title>
    <url>/en/b2344ef.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/b2344ef.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Zotero is a very useful open-source reference management software.
After comparing Endnote, Mendeley, and Zotero, I ultimately chose Zotero
as my own reference management software for the following reasons:</p>
<ul>
<li>Support for webdav synchronization of reference records and PDF
attachments</li>
<li>Rich extension plugins</li>
<li>Support for markdown notes</li>
</ul>
<p>This article mainly introduces some commonly used Zotero plugins,
along with their download links, and discusses my experience using them.
The order is based on what I personally consider to be the most
useful.</p>
<p><img src="https://download.kezhi.tech/img/202303021529700.png?x-oss-process=style/webp" width=33% /></p>
<span id="more"></span>
<h2 id="zotero-style">zotero-style</h2>
<p>Download link: <a class="btn" href="https://server.kezhi.tech:9160/f/93275aa01d0f4e32acbd/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-style</a></p>
<p>Plugin documentation: <a
href="https://www.notion.so/Zotero-Style-bc2aebbbb6df4b7baa858e376e4fc5be">Notion
– The all-in-one workspace for your notes, tasks, wikis, and
databases.</a></p>
<p>This plugin integrates many functions, including but not limited
to:</p>
<ul>
<li>#tag: Adding the symbol <code>#</code> before a tag can solve the
problem of Zotero not displaying tag text</li>
<li>Journal tags: Can retrieve and display journal information from
easyscholar</li>
<li>Progress: Displays reading progress and annotation progress</li>
<li>Custom author column display format</li>
<li>PDF background color modification</li>
</ul>
<p>For detailed instructions on how to use it, please refer to the
documentation above.</p>
<h2 id="zotero-night">zotero-night</h2>
<p>Download link: <a class="btn" href="https://server.kezhi.tech:9160/f/10a094e6e76a4439a039/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-night</a></p>
<p>Zotero's dark mode plugin, it is basically the best dark mode for
PDFs that I have used. The dark mode supports two color modes: one is a
deep purple background similar to Dracula, and the other is a pure black
mode. The color scheme of text and images in PDFs will change in dark
mode. The effects are as follows:</p>
<figure>
<img
src="https://download.kezhi.tech/img/image-20230228160125727.png?x-oss-process=style/webp"
alt="Default white mode" />
<figcaption aria-hidden="true">Default white mode</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/image-20230228160150549.png?x-oss-process=style/webp"
alt="Dracula mode" />
<figcaption aria-hidden="true">Dracula mode</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/image-20230228160215515.png?x-oss-process=style/webp"
alt="Pure black mode" />
<figcaption aria-hidden="true">Pure black mode</figcaption>
</figure>
<p>(In short, it is very useful)</p>
<h2 id="zotero-gpt">zotero-gpt</h2>
<p>Project link: <a
href="https://github.com/MuiseDestiny/zotero-gpt">MuiseDestiny/zotero-gpt:
GPT Meet Zotero. (github.com)</a></p>
<p>Download link: <a class="btn" href="https://server.kezhi.tech:9160/f/3a3d24ab756c409186fa/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-gpt</a></p>
<p>Zotero's GPT plugin, supports gpt-3.5 turbo and gpt-4. It has
functions such as asking questions about PDFs, translation, and
improving writing.</p>
<p>The steps to use it are as follows:</p>
<ol type="1">
<li><p>Install the zotero-gpt plugin like installing other
plugins.</p></li>
<li><p>Press <code>Ctrl+/</code> to activate it.</p></li>
<li><p>Enter <code>/secretKey sk-&lt;your gpt key&gt;</code>, as shown
in the figure below:</p>
<p><img
src="https://download.kezhi.tech/img/202305231540402.png?x-oss-process=style/webp" /></p></li>
<li><p>Enjoy your gpt.</p></li>
</ol>
<h2 id="zotero-better-notes">zotero-better-notes</h2>
<p>Download link: <a class="btn" href="https://server.kezhi.tech:9160/f/68ad39f67c23470b91df/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-better-notes</a></p>
<p>Zotero note enhancement software, opens a dedicated area for note
recording. It has better compatibility with markdown syntax and supports
bidirectional references. It is still a powerful tool, but I rarely use
it after using the note software "joplin".</p>
<h2 id="zotero-pdf-translate">zotero-pdf-translate</h2>
<p>Download link: <a class="btn" href="https://server.kezhi.tech:9160/f/c53fd1d987444e568791/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>zotero-pdf-translate</a></p>
<p>Zotero translation plugin, built-in with many translation engines
that can be freely selected. It can also integrate with professional
translation engines provided by some cloud service providers to achieve
better translation results. Although I haven't used this feature much,
giving users a high degree of freedom to choose is a good thing.</p>
<h2 id="jasminum">jasminum</h2>
<p>Download link: <a class="btn" href="https://server.kezhi.tech:9160/f/593cb18ec4c74a0baa3b/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>jasminum</a></p>
<p>A well-known Chinese literature management plugin, but I don't use it
frequently, so I won't comment on it.</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Zotero</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>Xjtu System Optimization And Scheduling Midterm Report</title>
    <url>/en/f95f8ff4.html</url>
    <content><![CDATA[<h1 id="midterm-report">Midterm Report</h1>
<p>西安交通大学《系统优化与调度》课程中期报告</p>
<p><img src="https://download.kezhi.tech/img/202211291631791.jpg?x-oss-process=style/webp" alt="" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="problem">Problem</h2>
<p><span class="math display">\[
min\ \ x_1^3+x_2^3-2x_1^2x_2+5x_1x_2^2+10x_1x_2+7x_1-x_2\\
s.t.\left\{
    \begin{array}{**lr**}
    -x_1+x_2\leq0\\
    -2x_1-5x_2-10\leq0\\
    x_1-100\leq 0
    \end{array}
\right.
\]</span></p>
<p>The graph of the object function is shown below:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202112211558169.png?x-oss-process=style/webp"
alt="object function" />
<figcaption aria-hidden="true">object function</figcaption>
</figure>
<p>The feasible region by the constraint is shown blow:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202112211600017.png?x-oss-process=style/webp"
alt="constraint" />
<figcaption aria-hidden="true">constraint</figcaption>
</figure>
<h2 id="method">Method</h2>
<p>For this problem, we can see that the feasible region is a convex
set, and the object function is not convex. Considering the feasible
region, the constraint works only when searching out the boundary. Using
projection method could let the searched point outing the boundary move
to the boundary. So the method I using is below:</p>
<blockquote>
<ol type="1">
<li>choose the start point <span class="math inline">\(x^0\)</span></li>
<li>replace point with the projection<span
class="math inline">\([x^0]^+\)</span></li>
<li>get the projection of next direction point <span
class="math inline">\(\bar x_k=[x^k-\nabla f(x^k)]^+\)</span></li>
<li>get the search direction <span class="math inline">\(d^k=\bar
x^k-x^k\)</span></li>
<li>calculate the next point <span
class="math inline">\(x^{k+1}=x^k+\alpha^kd^k\)</span></li>
<li>if the terminal condition is satisficed, stop the search and output
the result, else go to the step 3</li>
</ol>
</blockquote>
<p>In this project, I choose Armjio rule to control the step size.</p>
<p>The parameters of the method is following: <span
class="math display">\[
s=1\ \ \beta=0.5\ \ \sigma=1e-5
\]</span></p>
<h2 id="solution">Solution</h2>
<p>Considering the floating error of computers, stipulate <span
class="math inline">\(a=b\)</span> when <span
class="math inline">\(|a-b|&lt;\varepsilon\)</span>, and <span
class="math inline">\(a=0\)</span> if <span
class="math inline">\(|a|&lt;\varepsilon\)</span>. In this project,
<span class="math inline">\(\varepsilon=1e-19\)</span>.</p>
<p>choose the start point (0,0), we could get the following answer:</p>
<div class="line-block">     | <span class="math inline">\(x^k\)</span>
| <span class="math inline">\(f(x^k)\)</span> | <span
class="math inline">\(\alpha^k\)</span> | <span
class="math inline">\(d^k\)</span> |<br />
:--: | :</div>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Optimal</tag>
      </tags>
  </entry>
  <entry>
    <title>Nlp工具Nltk的安装及使用</title>
    <url>/en/3300cce2.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/3300cce2.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="introduction-to-nltk">Introduction to NLTK</h2>
<p>NLTK is a leading platform for building Python programs that use
human language data. It provides an easy-to-use interface for over 50
corpora and lexical resources (such as WordNet), as well as a text
processing library for classification, tokenization, stemming, tagging,
parsing, and semantic inference. NLTK is a famous natural language
processing library on Python, which comes with its own corpus,
part-of-speech tagging library, tokenization, and other functions.</p>
<span id="more"></span>
<h2 id="package-installation">Package Installation</h2>
<p>First, install the NLTK package using pip:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install nltk</span><br></pre></td></tr></table></figure>
<p>You can use the Tsinghua source to speed up the installation:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install nltk -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<h2 id="downloading-nltk-data">Downloading NLTK Data</h2>
<p>After installing the NLTK package, you need to download the relevant
data models to use it. The download method is as follows.</p>
<p>After installing the NLTK package, open the Python command line and
run the following command (you can also create a new Python file and
write the following command to run it):</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download()</span><br></pre></td></tr></table></figure>
<p>The following interface will appear:</p>
<p><img
src="https://download.kezhi.tech/img/202110212046568.png?x-oss-process=style/webp" /></p>
<p>At first, this list is blank. Click "refresh" in the lower right
corner to display the nltk-data list.</p>
<p>Click "Download" in the lower left corner to start downloading the
data. After the download is complete, you can use it normally.</p>
<h2 id="accelerated-download-in-china">Accelerated Download in
China</h2>
<p>When downloading in China, you may encounter situations where DNS
cannot be found or errors occur during the download. The most convenient
solution when encountering this situation is as follows:</p>
<ul>
<li><p>Execute one of the following commands to download nltk-data to
the local machine, which is about 700M in size:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/nltk/nltk_data.git</span><br><span class="line"><span class="comment"># If you cannot connect to GitHub, you can also use one of the following links to clone</span></span><br><span class="line">git <span class="built_in">clone</span> http://gitclone.com/github.com/nltk/nltk_data.git</span><br><span class="line">git <span class="built_in">clone</span> https://hub.fastgit.org/nltk/nltk_data.git</span><br></pre></td></tr></table></figure></li>
<li><p>Enter the nltk-data directory downloaded to the local machine,
and modify the index.xml file under the nltk_data directory, replacing
all</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">s://raw.githubusercontent.com/nltk/nltk_data/gh-pages</span><br></pre></td></tr></table></figure>
<p>with:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">://localhost:8000</span><br></pre></td></tr></table></figure></li>
<li><p>Run the following command in this directory:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -m http.server 8000</span><br></pre></td></tr></table></figure>
<p>At this time, we will provide a server that provides nltk_data data
download services on our local machine. The nltk downloader can obtain
the required files by accessing the local address.</p></li>
<li><p>Re-execute the following statement in Python:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download()</span><br></pre></td></tr></table></figure></li>
<li><p>Replace the address in the server index with
<code>http://localhost:8000/index.xml</code> as shown in the figure
below:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202110212123817.png?x-oss-process=style/webp"
alt="image-20211021212307774" />
<figcaption aria-hidden="true">image-20211021212307774</figcaption>
</figure>
<p>Click "refresh" and "Download" in turn to start the
installation.</p></li>
</ul>
<h2 id="reference">Reference</h2>
<p>[1] <a
href="https://zhuanlan.zhihu.com/p/347931749">国内下载GITHUB库加速方法及快速安装NLTK
- 知乎 (zhihu.com)</a></p>
<p>[2] <a
href="https://blog.csdn.net/qiang12qiang12/article/details/81254595">直接快速下载NLTK数据_今春一别难相逢-CSDN博客_nltk下载</a></p>
<p>[3] <a href="https://github.com/nltk/nltk_data">nltk/nltk_data: NLTK
Data (github.com)</a></p>
<p>[4] <a href="https://www.jianshu.com/p/a3cb9f986e69">自然语言处理|
NLTK - 简书 (jianshu.com)</a></p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>NLP</tag>
        <tag>NLTK</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode compile Latex configuration.</title>
    <url>/en/26b82930.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/26b82930.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Originally, I didn't want to write an article about configuring the
local LaTeX environment because there are already many related blogs and
articles online. However, my junior sister made a mistake by copying the
wrong configuration from the internet when setting up vscode, which
caused the bibliography to fail to compile for half a day and was
difficult to locate the problem. Therefore, I wrote this configuration
guide to maintain a correct configuration and avoid similar issues in
the future.</p>
<p><img src="https://download.kezhi.tech/img/202407101818114.jpg?x-oss-process=style/webp" style="width:66%;" /></p>
<center>
Put a snapping turtle here
</center>
<span id="more"></span>
<h2 id="latex-environment-configuration">LaTeX Environment
Configuration</h2>
<ol type="1">
<li><p>Download the LaTeX compilation tool, it is recommended to use <a
href="https://tug.org/texlive/">texlive</a></p></li>
<li><p>After the package is downloaded, click on install</p></li>
<li><p>Confirm the installation, after texlive is installed, type
<code>tex</code> in the command line, if you get the following result,
it means the system environment variable configuration is successful</p>
<p><img
src="https://download.kezhi.tech/img/202407101802066.png?x-oss-process=style/webp" /></p></li>
</ol>
<h2 id="vscode-configuration">vscode Configuration</h2>
<ol type="1">
<li><p>Install the <code>latex-workshop</code> plugin</p></li>
<li><p>Press <code>Ctrl+Shift+P</code>, type
<code>open user settings</code> to open the user configuration file
<code>settings.json</code></p></li>
<li><p>Add the following content to the user configuration file
<code>settings.json</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;latex-workshop.latex.tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-pdf&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// Definition of xelatex tool here</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">// Set xelatex as the default first preferred compiler in the compilation chain</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.recipes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; biber -&gt; pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;latexmk&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        </span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex -&gt; bibtex -&gt; xelatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></li>
<li><p>Open a <code>*.tex</code> file, if you see the <code>TEX</code>
icon on the left, it means the configuration was successful</p>
<p><img
src="https://download.kezhi.tech/img/202407101807402.png?x-oss-process=style/webp" /></p></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>latex</tag>
      </tags>
  </entry>
  <entry>
    <title>Scrapy Spider Related</title>
    <url>/en/68a55fd7.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/68a55fd7.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="request-spoofing">Request Spoofing</h2>
<p>When crawling Tencent weather data, it was found that the weather
data could not be successfully crawled. After some attempts, it was
discovered that the issue lies in the request headers. The default
request headers used by the spider when crawling web pages are:</p>
<p><img
src="https://download.kezhi.tech/img/20201024223544.png?x-oss-process=style/webp" /></p>
<p>This default request header may be blocked when crawling many
websites, making it impossible to obtain web page data. Therefore,
request header spoofing is needed to make the website think it is a
browser accessing it. The operation steps are as follows:</p>
<span id="more"></span>
<ol type="1">
<li>Create a new file <code>HeaderMidWare.py</code> in the project
directory and write the following code:</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> scrapy.utils.project <span class="keyword">import</span> get_project_settings</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">settings = get_project_settings()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProcessHeaderMidware</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;process request add request info&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Randomly select a header from the list and pass it to user_agent for use</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ua = random.choice(settings.get(<span class="string">&#x27;USER_AGENT_LIST&#x27;</span>))</span><br><span class="line">        spider.logger.info(msg=<span class="string">&#x27;now entering download midware&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> ua:</span><br><span class="line">            request.headers[<span class="string">&#x27;User-Agent&#x27;</span>] = ua</span><br><span class="line">            <span class="comment"># Add desired logging message here.</span></span><br><span class="line">            spider.logger.info(<span class="string">u&#x27;User-Agent is : &#123;&#125; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(request.headers.get(<span class="string">&#x27;User-Agent&#x27;</span>), request))</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>Add the following code to <code>setting.py</code>:</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">USER_AGENT_LIST=[</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (X11; CrOS i686 2268.111.0) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1092.0 Safari/536.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1090.0 Safari/536.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/19.77.34.5 Safari/537.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.9 Safari/536.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.0) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.36 Safari/536.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SE 2.X MetaSr 1.0; SE 2.X MetaSr 1.0; .NET CLR 2.0.50727; SE 2.X MetaSr 1.0)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.0 Safari/536.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">&#x27;projectname.HeaderMidWare.ProcessHeaderMidware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>After adding this, rerun the spider, and it will automatically select
a user_agent for spoofing and successfully crawl the content on the web
page.</p>
<p><img
src="https://download.kezhi.tech/img/20201024224545.png?x-oss-process=style/webp" /></p>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Scrapy</tag>
        <tag>Crawler</tag>
      </tags>
  </entry>
  <entry>
    <title>一个用单片机放视频的小项目</title>
    <url>/en/d9a2f421.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/d9a2f421.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="overall-design-concept">Overall Design Concept</h2>
<p>The playback of a video essentially involves a sequence of images
displayed in a specific order at regular time intervals, creating a
visual effect. Therefore, driving an LCD to play a video with a
microcontroller involves pushing images to the LCD's buffer at certain
intervals, continuously refreshing the screen to switch images. At the
end of the article, I've included the source project files for
reference.</p>
<span id="more"></span>
<blockquote>
<p>If audio playback is desired, connect an amplifier to the
microcontroller's pin, and the microcontroller can continuously power
the amplifier with audio voltage. Since the microcontroller's frequency
is only 1MHz and it generates square wave signals, the simulation effect
in Proteus is not ideal, so audio playback is not included here.</p>
</blockquote>
<p>Here's a demo video:</p>
<iframe src="//player.bilibili.com/player.html?aid=74949672&amp;bvid=BV1bE411q7YA&amp;cid=128219853&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<p>Thus, the entire project can be divided into several parts:</p>
<ul>
<li>Crop and scale the video to the size of the display, and binarize
the video content.</li>
<li>Write the binarized video stream into a .h file in frame order for
easy retrieval.</li>
<li>Connect the circuit on the Proteus simulation platform.</li>
<li>Write a program to control the microcontroller to continuously write
images to the LCD.</li>
</ul>
<h2 id="video-processing">1. Video Processing</h2>
<p>Python is used here for video processing, utilizing the OpenCV
library for Python. Referring to a tutorial book on OpenCV-python, which
I've made available <a
href="https://download.kezhi.tech/document/OpenCV%E5%AE%98%E6%96%B9%E6%95%99%E7%A8%8B%E4%B8%AD%E6%96%87%E7%89%88%EF%BC%88For%20Python%EF%BC%89.pdf">here</a>,
interested readers can download it.</p>
<p>Here's how the video is read:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python code block</span></span><br></pre></td></tr></table></figure>
<h2 id="writing-frame-data-to-.h-file">2. Writing Frame Data to .h
File</h2>
<p>The frame data obtained from the previous step is arranged
sequentially and separated by ',' to form the dataset needed for
displaying the video.</p>
<p>Create an image.h file and paste all the data into a static
array:</p>
<figure>
<img
src="https://download.kezhi.tech/img/image-20200324202341272.png?x-oss-process=style/webp"
alt="Writing to .h file" />
<figcaption aria-hidden="true">Writing to .h file</figcaption>
</figure>
<blockquote>
<p>Note: The display resolution is 64 * 128, totaling 8192 pixels. Each
pixel has a value of 0/1. Using run-length compression, 8 pixels are
compressed to 1 byte. Therefore, each frame occupies memory size of 8 *
128 = 1024 bytes = 1K. In Proteus simulation software, the maximum RAM
is 64K. Considering that some space is needed for other code, here we
can store a maximum of 62~63 frames, depending on the space occupied by
other code.</p>
</blockquote>
<h2 id="connecting-the-circuit-on-proteus">3. Connecting the Circuit on
Proteus</h2>
<p>The chosen microcontroller is the classic AT89C51, and the display
model is AMPIPR128*64.</p>
<p>The wiring is done using labeled connections for easy setup and
viewing:</p>
<figure>
<img
src="https://download.kezhi.tech/img/image-20200324203135152.png?x-oss-process=style/webp"
alt="LCD Section" />
<figcaption aria-hidden="true">LCD Section</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/image-20200324203205683.png?x-oss-process=style/webp"
alt="Microcontroller Section" />
<figcaption aria-hidden="true">Microcontroller Section</figcaption>
</figure>
<blockquote>
<p>For the meanings and usage methods of the microcontroller pins and
the meanings of each pin of the LCD, you can search and learn by
yourself. There are many related materials available online.</p>
</blockquote>
<h2 id="writing-the-program-for-the-microcontroller">4. Writing the
Program for the Microcontroller</h2>
<p>To write a program to drive the LCD with the microcontroller, we need
to understand the functions of each LCD pin and how to drive it to
display images. Similarly, there are plenty of manuals available online
for reference. Here, we directly use a pre-packaged driver file to
perform low-level operations on the display, focusing only on the
application-level logic.</p>
<p>Source code:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// C code block</span></span><br></pre></td></tr></table></figure>
<p>The encapsulated display driver .h file:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Another C code block</span></span><br></pre></td></tr></table></figure>
<h2 id="conclusion-with-project-download-link">5. Conclusion (with
Project Download Link)</h2>
<p>This project was done during my junior year of college and it
inspired me greatly. It made me realize that seemingly complex projects
in our lives often have simple underlying principles, just like video
playback. However, simplicity can also be complex. Later, when working
on speech recognition, using my extracted speech features to recognize
digits 0-9, the overall recognition rate was less than 30%. Therefore,
assessing the difficulty of a task cannot be based solely on intuition;
instead, it requires understanding its operation mechanism and module
composition, analyzing its implementation principles, and thereby
gaining a clear understanding of each project.</p>
<p>Project file download: <a
href="https://download.kezhi.tech/document/cxk_video.zip">Click to
Download</a></p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Protues</tag>
        <tag>单片机</tag>
      </tags>
  </entry>
  <entry>
    <title>于小鸡历险记（一）</title>
    <url>/en/32347def.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/32347def.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="introduction">Introduction</h2>
<p>Sometimes, life brings us surprises. It could be a beautiful sunset
we stumble upon while skipping class, or a blooming flower we wake up
to. In this ever-progressing industrial era, we are all involuntarily
caught up in the hustle and bustle. This is the deepest realization I've
had since I entered graduate school and gained a deeper understanding of
the world.</p>
<p><img src="https://download.kezhi.tech/img/202205102220466.jpg?x-oss-process=style/webp" width=30%></p>
<span id="more"></span>
<p>In this regard, my partner, Dou Dou, has brought me a lot of
inspiration. There are two main points I have summarized: ① This world
is truly vast, to the point where each of us is so insignificant in the
face of society and the nation, feeling powerless. As the economy and
technology continue to develop, the distance between the government,
society, and individuals will become closer, and correspondingly,
individuals will feel more powerless. ② Every inch of this world is
precious, and we can always gain something by stopping to appreciate it.
The beauty of a flower lies not in itself, but in the eyes that
appreciate it; the greatness of a work lies not in the definition of the
author, but in the reader's understanding; the significance of a photo
album lies not in the precise pixels, but in the memories it contains.
Life is not lacking in beauty, but rather the discovery and appreciation
of beauty.</p>
<h2 id="anecdotes-after-the-spring-date">Anecdotes after the Spring
Date</h2>
<h3 id="section">1</h3>
<p>The Spring Date is a grand event during the spring and summer social
season in the harbor. Every time, single men and women from various
universities in Shaanxi Province gather here, hoping to meet the right
person in their lives. To ensure the seriousness of the event,
participants usually need to register in advance and sign a single
guarantee agreement, and they can enter with their admission tickets on
the day of the event.</p>
<p>On May 8, 2022, Bai Qi and Zi Yao informed me that this grand event
was taking place at Milan Building. Out of curiosity, I made an
appointment with Bai Qi to go together. Unfortunately, Zi Yao stayed at
home that day and couldn't join us. Also, due to the pandemic, students
from other universities were unable to come, which was a great pity.</p>
<p><img
src="https://download.kezhi.tech/img/202205102228785.jpg?x-oss-process=style/webp" /></p>
<p>When we arrived, it was almost time for dinner in the afternoon, and
it was drizzling. We walked towards Milan Building and saw many
disappointed faces on the men and women walking back from there. I
couldn't help but sigh: the weather was just like the mood of these men
and women. It was clear when they arrived, but became gloomy when they
left.</p>
<p>Entering the venue (although we didn't have admission tickets, who
would care about admission tickets when the event was about to end), the
scene inside could be summarized as follows: most men and women were
staying with people of the same sex, and only a few were interacting
with the opposite sex. On the way back, I suggested that we bring
friends to participate in this event next year. Bai Qi told me that it
would be better to come alone, as with more people, we might only play
with our companions who came with us. She was right, not only here, but
also among the young people I could interact with. Interactions between
men and women have become a difficult thing, something burdensome that
must be done for the purpose of marriage, rather than for the joy that
comes from interacting and playing with the opposite sex.</p>
<p>If the desire for the opposite sex brought about by reproduction is
the most natural and primitive pursuit of human beings, then the
discomfort we feel when interacting with the opposite sex nowadays is,
in a sense, a regression. Of course, I don't want to go back to that
primitive era. I just hope that at some point in the future, people can
freely interact with others, regardless of whether they are of the same
sex or opposite sex, for the sake of spiritual pleasure.</p>
<h3 id="section-1">2</h3>
<p>Last month, I bought a pot of gardenia flowers. When they were
delivered, they were still in bud. This was my first time raising
flowers, and I was full of hope for them to bloom. Finally, one morning,
I woke up to a pleasant surprise.</p>
<p><img
src="https://download.kezhi.tech/img/202205102250858.jpg?x-oss-process=style/webp" /></p>
<p>Its blooming was sudden and splendid. At that moment, I felt the
vitality of life. The beauty of a flower lies not only in its
brightness, but also in the moment it blooms. In the future, I can try
using time-lapse photography to capture the moment of blooming.</p>
<p>Good things don't last long. Due to the small size of the pot for the
gardenia flowers, the nutrients inside were not enough. The flowers
gradually withered, and although there were new flowers blooming later,
only the newest one bloomed beautifully.</p>
<p><img
src="https://download.kezhi.tech/img/202205102253440.jpg?x-oss-process=style/webp" /></p>
<p>The blooming of flowers brings joy, while their withering makes us
sigh at the cruelty of time. However, if I change to a larger pot and
fertilize it in a timely manner, can I make all the flowers bloom with
nourishment? It's worth a try.</p>
<h3 id="section-2">3</h3>
<p>Sometimes, surprises may not necessarily be a good thing. On May 9,
2022, while I was busy studying the "Beginner's Guide to Mining," I
suddenly learned that the homework for the optimal control course was
due the next day, and it involved four assignments. However, I have a
habit that when I am immersed in one thing, I prioritize finishing what
I am currently working on before dealing with other urgent matters.</p>
<p>As a result, my mining study didn't end until half past eleven in the
evening. Finally, the computer could mine on its own. Looking at the
running hash on the screen and the blank A4 paper I had prepared for the
assignment, I couldn't help but feel that I was torturing myself.</p>
<p>In order to learn faster and complete the assignments, I went
upstairs to find Lao Wang to work on them together. On the way, I
remembered that Han Chi's workstation should be nearby, so I went to
take a look.</p>
<p><img
src="https://download.kezhi.tech/img/202205102302265.jpg?x-oss-process=style/webp" /></p>
<p>Jerry is really cute!</p>
<h3 id="section-3">4</h3>
<p>I don't know if it's because I spend too much time looking at
screens, lack of sleep, or frequently rubbing my eyes, but recently I
often feel dryness and itching in my eyes. I decided to go to the nearby
pharmacy in Xinghua to buy eye drops, but I kept forgetting to do so for
a few days. Finally, on the afternoon of May 10, 2022, I remembered this
matter, went to Han Ying Building for lunch, and bought the eye drops.
However, these eye drops are quite unique in appearance.</p>
<p><img
src="https://download.kezhi.tech/img/202205102305766.jpg?x-oss-process=style/webp" /></p>
<p>To be honest, this is the first time I've seen eye drops in this
form. I used to use the small bottle ones. But upon careful
consideration, this kind of eye drops has its advantages. Firstly, it is
a single-use package, greatly reducing the risk of contamination.
Secondly, the individual packaging serves as a reminder for me to use
the eye drops in a timely manner, rather than remembering it later like
before. Overall, ergonomics is an essential aspect of product design,
and having this kind of design is better.</p>
<h2 id="some-minor-matters-after-film-and-television-creation">Some
Minor Matters after Film and Television Creation</h2>
<h3 id="section-4">1</h3>
<p>"Film and Television Creation" is an elective course for graduate
students at the Innovation Harbor. I was very fortunate to have enrolled
in this course when it was first offered. The reason I initially chose
this course was because the instructor was good-looking, and her
educational background made me very curious (see <a
href="http://rwxy.xjtu.edu.cn/info/1091/4265.htm">Wang Yao - School of
Humanities and Social Sciences, Xi'an Jiaotong University
(xjtu.edu.cn)</a>).</p>
<p>The format of this course is as follows: 6-8 people form a group and
complete the entire process of creating a microfilm. For the creative
process of this film, please refer to <a
href="https://kezhi.tech/Explanation-of-the-Creation-of-the-Film-ByteDance/">Explanation
of the Creation of the Film "ByteDance"</a>. I was very fortunate to be
the leader of the group.</p>
<p><img
src="https://download.kezhi.tech/img/202206011656848.jpg?x-oss-process=style/webp" /></p>
<p>For a long time, I have dealt with many things on my own and rarely
collaborated with others. Also, due to the fact that group assignments
during my student days were often about getting a good grade rather than
completing the project seriously, I didn't have much experience in
leading and cooperating with others. This film and television creation
project was different. There was no excessive pursuit of grades in this
elective course, and the project itself also matched the interests of
some members of our group. Therefore, I believed that we should put some
seriousness into the filming of this microfilm.</p>
<p>Ren Zhengfei once said: "Being ahead is simple, just do better than
others; being a leader is difficult, it requires leading everyone
together." Being ahead and being a leader are two completely different
things. Being ahead only requires doing one's own things well, while
being a leader is different. Being a leader requires ensuring that
everyone does their own things well. This involves matching abilities
and tasks, and stimulating enthusiasm, etc., which are all related to
people.</p>
<p>Firstly, it is important to mobilize the subjective initiative of the
group members. I believe the best way is to make everyone a contributor
to the creation, so that everyone takes the subsequent processes
seriously. In other words, this is similar to a rule I once read about
relationships: "A person's feelings depend more on how much they give,
and less on how much they receive." For this reason, during the
scriptwriting process, all members of our group participated and made
contributions, and they identified with the script. This way, we
wouldn't just go through the motions in the subsequent processes.</p>
<p>Secondly, there is the issue of division of labor. Fortunately, the
members of our group are versatile, including photography enthusiasts,
pet owners, video editing experts, film enthusiasts, and avid learners.
Each person's individual abilities are not sufficient to produce a film
with rich content, but when these abilities are combined, they can
overcome the difficulties encountered in the creative process. In
addition, reasonable task allocation is necessary, taking into account
each person's schedule and individual abilities. However, the tasks in
film and television creation are heterogeneous, such as writing the
script, storyboarding, planning the shooting schedule, shooting, and
post-production. The workload of these tasks will inevitably differ,
which will lead to unequal task durations and fairness issues. Faced
with this problem, I believe it is important to respect individual
preferences. For the participants who are truly passionate about this
film, even if it means staying up late to edit, they are willing to see
their own results. As for the participants who are not willing to invest
a lot of personal time, there is no need to overly criticize them. What
needs to be paid attention to is not letting the latter affect the
enthusiasm and dedication of the former, which requires constant
attention.</p>
<p>Finally, the feeling of several people working together towards a
common goal is great. Some people skipped group meetings for the sake of
shooting, some actively prepared props and made good use of existing
conditions to solve difficulties, some traveled a long way to assist us
in shooting, some spent a day in advance scouting locations to ensure
everything went smoothly on the day of shooting, and some took the time
to edit the post-production meticulously. The whole process was arduous,
but the result was beautiful. This experience of working together taught
me a vivid lesson. Collaboration is a wonderful thing.</p>
<p>Finally, here is our film:</p>
<iframe src="//player.bilibili.com/player.html?aid=257448226&amp;bvid=BV18Y411K7PV&amp;cid=743040841&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<h3 id="section-5">2</h3>
<p>On June 1, 2022, I woke up early in the morning and heard the phone
ringing. It was from Taikang Life Insurance. They have been calling me
many times recently, but coincidentally, they always called when I was
busy, so I never answered. Today happened to be a time when I had some
free time, so I answered the call and had a chat.</p>
<p>The phone call was mainly about promoting their accidental insurance.
I won't go into the details of the insurance itself, but this sales call
reminded me of an experience I had about half a year ago when China
Merchants Bank was promoting insurance to me. There was a significant
difference between the salespeople in these two sales calls. The former
didn't waste much time and, after obtaining my consent, explained the
details of the insurance to me in detail and reminded me to record the
key information of the insurance policy for future consideration. After
the introduction, they sent me a document detailing the insurance plan
for reference. In this communication, they didn't ask me to immediately
apply for the insurance, but gave me enough time to consider whether I
needed to purchase it. They called me back after a day and had a
detailed discussion about the follow-up matters. In today's sales call,
compared to the former, it seemed less professional. Firstly, the
salesperson's speech was not clear enough, and his voice was not loud
enough. I had to listen very carefully to hear what he was saying. After
a brief introduction of the insurance, he also asked me to take notes,
but instead of recording important information about the insurance, he
asked me to write down his employee number. After this conversation, he
immediately started confirming my personal information, including my
name, age, etc. However, it was obvious that Taikang was promoting to me
based on the registered information of my phone number, and the
information they mentioned was all about my mother. This contradicted
what they initially said about selecting high-quality customers for
promotion. After confirming the basic information, they asked for my ID
card number, bank card number, and other information to process the
transaction.</p>
<p>I won't go into the details of what happened afterwards, but these
two different sales experiences reflect the training of salespeople, the
attitude of the company towards salespeople, and the importance of
service in the insurance business. Personally, I would prefer to
purchase insurance from the former salesperson. The entire process
demonstrated respect for my personal preferences and respect for the
contract. It doesn't necessarily mean that I will get a better contract
in this situation, but as an individual, this kind of communication
makes me more confident that when I encounter an accident, the personnel
trained by such a company will be able to efficiently solve the problem
for me. As for the latter, even if their insurance coverage is good,
their approach in promoting it made me doubt whether the company that
recruits and trains such salespeople would be able to respond promptly
when I encounter an accident.</p>
<p>The above paragraph is biased. A good impression of a salesperson
does not necessarily mean that the company's business capabilities are
good, and a poor impression of a salesperson does not mean that their
service will be bad. However, this is my personal feeling, which is an
important factor in cooperation in our society. This feeling is
reflected in many aspects. Teachers look for a feeling when recruiting
students, employers look for a feeling when hiring employees, and
individuals consider the feeling towards a brand when choosing products.
When I was young, I always thought that this feeling was not important.
I believed that good things would naturally be appreciated. However, as
I grew older, I increasingly realized that sometimes this feeling could
be the determining factor in the outcome of things. Therefore, feelings
should not be taken lightly. If I were to start a company in the future,
I would need to pay attention to this.</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>日常</tag>
      </tags>
  </entry>
  <entry>
    <title>Yunnan Shidian No.2 Middle School Support Teaching Memoir.</title>
    <url>/en/ebd84d05.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/ebd84d05.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="day-0">Day 0</h2>
<p>During my master's studies, I needed to participate in a social
practice. So I made an appointment with a friend to go to Shidian
County, Yunnan Province to teach. The original plan was to go to a
middle school in the county, a middle school in the village, and a
middle school in the mountains. Initially, we planned to go to the
mountain middle school to implement the mushroom picking plan. However,
due to unforeseen circumstances, the teaching support team's plan
changed, and we were assigned to Shidian No. 2 Middle School.</p>
<p>On the way there, we flew from Xi'an to Kunming and then transferred
to Baoshan. The school arranged for us to be picked up from Baoshan
Airport and taken to the school. Along the way, we passed through the
Qinling Mountains and the Yungui Plateau. From the north to the south,
from the plains to the mountains, and then to the plateau, both the
climate and the topography changed diversely.</p>
<p>During the descent of the plane, I looked down from the air and found
that the architectural style in Yunnan cities is basically the same as
the standard style in China. On the way to the school, the architecture
in the county and the countryside was no different from that in the
county and countryside of Shaanxi where I was located. When we arrived
at the school, everything, including the school gate, beds, and
architectural style, was in a classic style. This is the result of
industrialization, where various materials can be standardized to reduce
costs and allow more people to use them. It is also the result of
China's system, where good models are promoted nationwide, benefiting
more people. However, such uniformity can make people feel a bit lonely.
China is a country spanning more than 5,000 kilometers, with various
landforms and climates, as well as various dialects and customs.
However, with the advancement of modernization and urbanization, our
cities and rural areas have gradually become uniform. This makes me
wonder, is there an inevitable conflict between modernization,
urbanization, socialist characteristics, and regional individuality?</p>
<p>First of all, modernization (industrialization) allows standardized
goods to be mass-produced at very low costs, providing a material basis
for the convergence of regional individuality. However,
industrialization alone is not enough, because China is vast and has a
large population. The process of industrialization can be developed
asynchronously in different places, so that each city in the country has
its corresponding industrial characteristics.</p>
<p>Urbanization is closely related to industrialization and brings not
only material abundance but also changes in thinking. Relatively
speaking, rural people have a better understanding of and attach more
importance to local traditional customs, and have a higher level of
mastery of dialects. On the other hand, urban people have more
communication and interaction with the outside world, and have a higher
level of mastery of the common language. Therefore, relatively speaking,
rural people have more regional characteristics, while urban people have
more universality. Urbanization has a certain impact on people's
thinking. However, it is undeniable that cities are developed based on
the foundation of rural areas, and their development generally has a
certain continuity. Therefore, it is difficult to conclude that
urbanization erases regional individuality.</p>
<p>Finally, there is China's unique system. The dual driving forces of
modernization and urbanization, both economically and ideologically,
have brought about industrial social standards and universal concepts.
The unified decision-making at the national level undoubtedly further
expands the advantages brought by industrialization, namely, low cost.
If all industrial products in the country are produced and purchased
together, compared with each place developing its own industry, the cost
of industrial products in each professional category can be further
reduced, thereby reducing the overall industrial production cost in the
country. This is its remarkable advantage and the reason why some
products developed in China can be sold at very low prices after they
are developed (a huge demand market + e-commerce has eliminated regional
characteristics). It must be said that in the early stages of China's
industrial development, this method can be said to be the best solution.
That is, to seek the fastest development at the lowest cost. However,
now, with the sluggish growth of China's economy and the urgent need for
industrial transformation, perhaps we should turn our attention to
regional individuality. On the 9.6 million square kilometers of land,
there should not be only one type of dormitory bed.</p>
<p>When I entered Shidian No. 2 Middle School today, I saw a stone with
the words "China University of Geosciences Aid Construction" written on
it. After entering the campus and looking at the various facilities in
the school, I couldn't help but feel emotional. A university is called a
university not only because of its great achievements, but also because
it should shoulder the great responsibility of society and contribute to
social progress and development. As university students, we should also
take on more social responsibilities and strive to make this society
better.</p>
<h2 id="day-1">Day 1</h2>
<p>It's the first day at Shidian No. 2 Middle School. The main task is
to coordinate with the corresponding substitute teachers. The teacher
who will be guiding me is Mr. Chang, the physics teacher of the Grade 9
teaching and research group. The course I will be teaching is Grade 9
physics. During the discussion, Mr. Chang mentioned that they are
currently studying internal energy, and the next two weeks will focus on
the topic of heat engines. Today, I assigned a set of exercises on
internal energy, and the students will complete them during the two-day
break. When they come back, we will start with the exercises.</p>
<p>I am responsible for three classes: Class 205, Class 206, and Class
207. Coincidentally, Class 207 has a physics class in the afternoon. I
took this opportunity to get to know the students quickly. The
preparation for this class was rushed, mainly focusing on the origin,
development, and application of physics, as well as its future
development. In the evening, I also attended a class in Wang Weitao's
class.</p>
<p>Overall, these students have left a deep impression on me with their
thirst for knowledge. When I ask questions or talk about new knowledge,
students from the front row to the back row listen attentively. The same
goes for when I listen to classes in other classes. Another impression
is their youth. Youth represents unlimited possibilities. Looking at
these young students, I always want to share more with them in my
limited time and have a positive impact on them.</p>
<p>In the afternoon, a high school teacher told me that it is very
difficult to provide summer classes for senior high school students
here. Some students report the school for providing summer classes, some
parents help their children take leave to avoid summer classes and the
college entrance examination, and some parents come to the school to
demand summer classes when the school does not provide them. The
situation is quite complicated. In addition, classes here have a two-day
weekend (starting on Friday afternoon, which should actually be two and
a half days), while some schools in the city only have one day off per
month. As a result, high school education here faces significant
challenges.</p>
<h2 id="day-2">Day 2</h2>
<p>Today, we went to 707 Town, which is named after its distance of 707
kilometers from Kunming. We had mushroom hot pot for lunch.</p>
<p>In the afternoon, we went to Shidian County to taste the hand-grabbed
rice.</p>
<p>In the evening, we had a small barbecue party with roasted pig skin,
snail meat, chicken gizzards, intestines, and ribs.</p>
<p>Good night.</p>
<h2 id="day-3">Day 3</h2>
<p>We woke up at 6 a.m. and went to Baoshan City. We passed through 707
Town, which is named after its distance of 707 kilometers from Kunming.
In Baoshan City, we had mushroom hot pot for lunch.</p>
<p>In the afternoon, we went to Shidian County to taste the hand-grabbed
rice.</p>
<p>In the evening, we had a small barbecue party with roasted pig skin,
snail meat, chicken gizzards, intestines, and ribs.</p>
<p>Good night.</p>
<h2 id="day-4">Day 4</h2>
<ul>
<li>Nothing to do.</li>
</ul>
<h2 id="day-5">Day 5</h2>
<p>Today is the first official day of teaching. Last week, Mr. Chang
assigned a physics exercise to Classes 205, 206, and 207. The main task
today is to explain this exercise. The first class was Class 206, and I
was the one teaching, while Mr. Chang sat at the back and listened.</p>
<p>After class, Mr. Chang gave me some suggestions:</p>
<ul>
<li>The way of explanation can be more specific. For example, when
analyzing questions related to specific heat capacity, I can use water
and sand as examples to explain, instead of using abstract concepts like
substance A and substance B, which may cause difficulties for students
to understand.</li>
<li>The pace of the class needs to be adjusted. Some simple and
repetitive conceptual questions can be explained more quickly. More time
can be allocated to calculation questions that students are prone to
make mistakes in.</li>
<li>Some time can be allocated for students to do exercises during
class. Normally, students don't do homework after class.</li>
</ul>
<p>It was the first time I taught formal teaching content, and there
were still many shortcomings due to my lack of understanding of the
students' situation and lack of experience. The teaching curriculum in
middle school is different from university courses, speeches, and
sharing sessions. It is mainly designed with the goal of getting
students to answer questions correctly, and guiding interest and
knowledge expansion is very rare.</p>
<h2 id="day-6">Day 6</h2>
<p>The self-study class here is divided into two sessions. The first
session is from 7:00 p.m. to 7:50 p.m., lasting for 50 minutes, which is
similar to a regular middle school class. The second session is from
8:00 p.m. to 10:00 p.m., with a 20-minute break from 8:50 p.m. to 9:10
p.m. During this break, students usually go to the cafeteria and
supermarket for additional meals.</p>
<p>Today is the self-study class for Classes 205 and 206. This class
includes three activities:</p>
<ul>
<li><p>"Game of Game Theory Course at Stanford University"</p>
<blockquote>
<p>A small game introduced in the Game Theory course at Stanford
University: Each student writes down a number between 0 and 100, and the
student whose number is closest to two-thirds of the average of all the
numbers wins the prize prepared for the game.</p>
</blockquote></li>
<li><p>Book distribution: "Fascinating Materials"</p>
<blockquote>
<p>This book is one of the recommended books in the 100 Must-Read
Classics of Xi'an Jiaotong University. It introduces ten common
materials in life. Suitable for all ages.</p>
</blockquote></li>
<li><p>Q&amp;A session</p>
<blockquote>
<p>An idea proposed by Teacher Sun from the teaching support team.
Considering that some students may be reluctant to raise their hands to
ask questions directly, they are asked to write down their questions on
paper and then collect them for on-the-spot answers.</p>
</blockquote></li>
</ul>
<p>The final results of the three classes were approximately 26, 30, and
30. Following the results of this game, I introduced the field of game
theory to the students. At the same time, I also shared a bit about my
life as a graduate student.</p>
<p>During the Q&amp;A session, the students asked questions mainly
focused on emotions, learning, and family. Some of the questions that
left a deep impression on me were:</p>
<ul>
<li>How to balance friendship, love, study, and life?</li>
<li>What should we do if our parents and teachers don't understand
us?</li>
<li>Why do we have to study?</li>
<li>Which is more important, suitability or feelings?</li>
</ul>
<p>After answering the questions one by one, I organized the questions
they wrote and took them back to Xi'an. Later, I plan to scan them and
keep a copy.</p>
<p>In Class 205, the last question asked was, "Teacher, can you show us
a movie?" Coincidentally, I showed them a micro-movie I had filmed
before<del>which took up ten minutes of the class break</del>.</p>
<p>Finally, I also left them my contact information. After thinking
about it, leaving an email address is the most appropriate.</p>
<p>In the evening, I heard from a high school teacher that it is very
difficult to provide summer classes for senior high school students
here. Some students report the school for providing summer classes, some
parents help their children take leave to avoid summer classes and the
college entrance examination, and some parents come to the school to
demand summer classes when the school does not provide them. The
situation is quite complicated. In addition, classes here have a two-day
weekend (starting on Friday afternoon, which should actually be two and
a half days), while some schools in the city only have one day off per
month. As a result, high school education here faces significant
challenges.</p>
<h2 id="day-7">Day 7</h2>
<p>Today is the self-study class for Class 207. The content and
activities are similar to yesterday's class. However, Class 207 is
relatively more active, and there were many interesting questions
asked.</p>
<p>One thing I noticed is that writing questions on paper can receive a
greater quantity and higher quality of questions. The longer the time
given for these questions, the higher the probability of asking
high-quality questions. On the other hand, directly asking questions in
class results in more general and easy questions (such as black history,
emotional experiences, and life regrets, similar to "truth or
dare").</p>
<p>The first thing I did after each class was to quickly get some water
in the office. Teaching so many classes in a row made me both sleepy and
thirsty. Overall, high-intensity teaching does take a toll on the
body.</p>
<p>For lunch, I had dumplings from here, which were very good. I also
discovered that I have gradually developed a liking for mint.</p>
<p>In the afternoon, I listened to a high school teacher talking about
the difficulties of providing summer classes for senior high school
students here. Some students report the school for providing summer
classes, some parents help their children take leave to avoid summer
classes and the college entrance examination, and some parents come to
the school to demand summer classes when the school does not provide
them. The situation is quite complicated. In addition, classes here have
a two-day weekend (starting on Friday afternoon, which should actually
be two and a half days), while some schools in the city only have one
day off per month. As a result, high school education here faces
significant challenges.</p>
<h2 id="day-8">Day 8</h2>
<p>Today, there are three physics classes according to the schedule,
which will be taught in three different classes. The prepared teaching
content mainly covers heat engines and the law of energy conservation.
While preparing, I happened to see that Ruanyifeng's Science Weekly had
been updated, so I selected some content from it as the opening of the
class. I also shared the website with the students.</p>
<p>After comparing, I found that writing questions on paper can receive
a greater quantity and higher quality of questions. The longer the time
given for these questions, the higher the probability of asking
high-quality questions. On the other hand, directly asking questions in
class results in more general and easy questions (such as black history,
emotional experiences, and life regrets, similar to "truth or
dare").</p>
<p>During the lunch break, the teachers from the teaching support team
informed us that there is only one more day left for the teachers at the
school, and the summer course will end here. This change came three days
earlier than planned, which caught us off guard. Originally, we planned
to teach Class 208 on Wednesday, but now we only have one day of classes
left on Monday.</p>
<p>In response to this sudden change, our teaching support team
contacted the school's teachers overnight and negotiated that the last
day's classes would all be taught by the teaching support team. In
addition, I also discussed with Teacher Lvlin and asked for half of the
evening self-study class to teach Class 208.<del>which I promised during
the dinner at the student's house</del></p>
<p>Coincidentally, the physics teacher who guided me had five classes
that day. In addition to the three classes in the morning, he also
exchanged two classes with the physical education teacher. In total, he
had to teach five classes. Combined with the evening self-study class
for Class 208, there were a total of six class hours to be taught.</p>
<p>In the morning, I helped the research group collect questionnaire
survey results in the class. I thought for a long time about what to
teach in the last class for the students in the afternoon. Finally, I
thought of the many students who were curious about my research when
they learned that I was a graduate student, so I decided to popularize
some knowledge in this area for them. During the lunch break, I
collected materials from several friends who are currently doing or have
completed research or projects, and prepared the last class for the
students.</p>
<p>Although I explained these research contents in the simplest way, due
to the inclusion of multiple research directions, the students'
knowledge is limited, and it can be seen that there are some students
who completely do not understand some of the content. However, at the
same time, there are also some students who can understand and are very
interested in some parts of the content.</p>
<p>In the evening, I taught the first class for Class 208 during the
self-study class. It was also the last class. I quickly finished my
sharing of my graduate student life and quickly moved on to the Q&amp;A
session, which was a chat with the students. Their class is the most
active in Grade 9, and they ask questions directly, so there was no need
to write them on paper.</p>
<blockquote>
<p>After comparison, writing questions on paper can receive a greater
quantity and higher quality of questions, and the longer the time given
for these questions, the higher the probability of asking high-quality
questions. On the other hand, directly asking questions in class results
in more general and easy questions (such as black history, emotional
experiences, and life regrets, similar to "truth or dare").</p>
</blockquote>
<p>The first thing I did after each class was to quickly get some water
in the office. Teaching so many classes in a row made me both sleepy and
thirsty. Overall, high-intensity teaching does take a toll on the
body.</p>
<p>For lunch, I had a bowl of the local specialty, bean curd skin rice
noodles.</p>
<p>In the afternoon, I went to the office to listen to a high school
teacher talking about the difficulties of providing summer classes for
senior high school students here. Some students report the school for
providing summer classes, some parents help their children take leave to
avoid summer classes and the college entrance examination, and some
parents come to the school to demand summer classes when the school does
not provide them. The situation is quite complicated. In addition,
classes here have a two-day weekend (starting on Friday afternoon, which
should actually be two and a half days), while some schools in the city
only have one day off per month. As a result, high school education here
faces significant challenges.</p>
<h2 id="day-9">Day 9</h2>
<p>The students have a day off today. After teaching two classes in the
morning, we cleaned up the classroom and went home. Last night, the
principal told us that the teachers at the school would leave in one
day, and the summer course would end here. This change came three days
earlier than planned, which caught us off guard. Originally, we planned
to teach Class 208 on Wednesday, but now we only have one day of classes
left on Monday.</p>
<p>In response to this sudden change, our teaching support team
contacted the school's teachers overnight and negotiated that the last
day's classes would all be taught by the teaching support team. In
addition, I also discussed with Lvlin Teacher and asked for half of the
evening self-study class to teach Class 208.<del>which I promised during
the dinner at the student's house</del></p>
<p>Coincidentally, the physics teacher who guided me had five classes
that day. In addition to the three classes in the morning, he also
exchanged two classes with the physical education teacher, totaling five
classes. Combined with the evening self-study class for Class 208, there
were a total of six class hours to be taught.</p>
<p>In the morning, I helped the research group collect questionnaire
survey results in the class. During the break, I thought about what to
teach in the last class for the students in the afternoon. Finally, I
thought of the many students who were curious about my research when
they learned that I was a graduate student, so I decided to popularize
some knowledge in this area for them. The research I introduced covers
multiple directions, and the students' knowledge is limited, so it can
be seen that some students completely do not understand some of the
content. However, at the same time, there are also some students who can
understand and are very interested in some parts of the content.</p>
<p>In the evening, I taught the first class for Class 208 during the
self-study class. It was also the last class. I quickly finished my
sharing of my graduate student life and quickly moved on to the Q&amp;A
session, which was a chat with the students. Their class is the most
active in Grade 9, and they ask questions directly, so there was no need
to write them on paper.</p>
<p>Every class, the first thing I did after class was to quickly get
some water in the office. Teaching so many classes in a row made me both
sleepy and thirsty. Overall, high-intensity teaching does take a toll on
the body.</p>
<p>For lunch, I had a bowl of dumplings from here, which were very good.
I also found that I have gradually developed a liking for mint.</p>
<p>In the afternoon, I listened to a high school teacher talking about
the difficulties of providing summer classes for senior high school
students here. Some students report the school for providing summer
classes, some parents help their children take leave to avoid summer
classes and the college entrance examination, and some parents come to
the school to demand summer classes when the school does not provide
them. The situation is quite complicated. In addition, classes here have
a two-day weekend (starting on Friday afternoon, which should actually
be two and a half days), while some schools in the city only have one
day off per month. As a result, high school education here faces
significant challenges.</p>
<h2 id="day-10">Day 10</h2>
<p>We went to the mango market in the morning and then went straight to
Kunming. In the morning, we had the last crispy bun, and it was a pity
that there was no ham filling. The school arranged a car to take us to
Baoshan Airport and Baoshan Railway Station.</p>
<p>After arriving in Kunming, it started pouring rain outside as soon as
we checked in at the homestay. The rain came and went quickly, stopping
after about half an hour.</p>
<p>We went to the restaurant recommended by Dongqiang for dinner, but we
couldn't find a place to eat after searching for a long time. So
Dongqiang came to meet us and took us to a place to have a proper meal.
We didn't have dinner, so we went to eat the Shantou hot pot where every
kind of meat is 13 seconds. After dinner, we walked around outside for a
while and then took a taxi back to the homestay to sleep.</p>
<h2 id="day-11">Day 11</h2>
<p>The original plan for today was to go to the Dounan Flower Market in
the morning and then go directly to Kunming South Railway Station to
take the high-speed train back to Xi'an. When we took a taxi from the
accommodation to the subway station, a police officer told us that the
flower market is better to visit in the evening because in the morning,
the flower farmers are picking flowers, and now there are only some
fixed stalls. In the evening, the flower market is usually more lively,
with activities such as throwing and picking flowers.</p>
<p>So we decided to change our plan and go to Guandu Ancient Town
instead.</p>
<p>We walked around there and saw children studying hard.</p>
<p>We had a bowl of tofu pudding rice noodles for lunch.</p>
<p>We carried our luggage and went back to Xi'an by high-speed
train.</p>
<h2 id="the-end">The End</h2>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>日常</tag>
        <tag>支教</tag>
        <tag>感悟</tag>
      </tags>
  </entry>
  <entry>
    <title>Modify operating system installation time.</title>
    <url>/en/629d278e.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/629d278e.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Due to certain indescribable reasons, there is a need to modify the
installation time of the operating system. Here is a brief summary.</p>
<p><img src="https://download.kezhi.tech/img/202206231950445.png?x-oss-process=style/webp" width=30%></p>
<span id="more"></span>
<h2 id="windows">Windows</h2>
<p>To modify the installation time of Windows operating system, follow
these steps:</p>
<ol type="1">
<li>Press <code>win</code>+<code>R</code> and type <code>regedit</code>
to open the registry.</li>
<li>Go to the path
<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion</code>.</li>
<li>The <code>InstallData</code> on the right side represents the system
installation time.</li>
<li>Write the modified timestamp value in decimal format.</li>
</ol>
<blockquote>
<p>For timestamp conversion, you can visit:
http://tool.chinaz.com/Tools/unixtime.aspx</p>
</blockquote>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
        <tag>安装时间</tag>
        <tag>系统修改</tag>
      </tags>
  </entry>
  <entry>
    <title>About film and television creation.</title>
    <url>/en/624fe65f.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/624fe65f.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<blockquote class="blockquote-center">
<p>Movies achieve a sense of naturalness through extreme
deliberation.</p>

</blockquote>
<h2 id="basic-process-of-film-and-television-production">Basic Process
of Film and Television Production</h2>
<p><img
src="https://download.kezhi.tech/img/202205251718490.webp" /></p>
<span id="more"></span>
<ol type="1">
<li>Scriptwriting</li>
<li>Converting the script into storyboards</li>
<li>Planning the shoot based on storyboards (grouping shots at the same
location)</li>
<li>Casting actors, securing shooting locations</li>
<li>Preparing costumes, makeup, props</li>
<li>Conducting the shoot</li>
<li>Post-production</li>
<li>Release</li>
</ol>
<h2 id="film-shooting-process">Film Shooting Process</h2>
<p>Process:</p>
<ol type="1">
<li>Upon arrival at the shooting location, the first step is to conduct
a regular rehearsal of the scene to ensure the actors' emotional states
are intact. Duct tape can be used on the ground to mark positions and
aid actors in their movements.</li>
<li>Pay attention to camera language and scene scheduling. Try to shoot
all scenes from each camera angle to ensure the coherence of the actors'
emotions.</li>
<li>After the rehearsal, the camera and microphone conduct a preview to
confirm the shooting effect.</li>
<li>The director, cinematographer, sound recorder, and script supervisor
confirm readiness.</li>
<li>Turn on all microphones (compared to video files, audio files are
much smaller and can be recorded multiple times for error
tolerance).</li>
<li>Start recording with the camera.</li>
<li>The script supervisor places the slate in the focal point of the
lens (near the shooting subject) and signals the scene, shot, and take.
After slating, exit the scene.</li>
<li>The director shouts "Three, two, one, action." Everyone remains
quiet, and the actors begin their performance. Each department records
according to the preview actions.</li>
<li>The director shouts "Cut," the actors stop performing, and the
recording for each department ends.</li>
<li>Review the recording playback. If approved by the director, continue
to the next shot; otherwise, repeat steps 4-9.</li>
</ol>
<p>Notes:</p>
<ol type="1">
<li>Camera recording files are large, especially with high-quality
cameras, so try to minimize ineffective camera shooting time in the
process.</li>
<li>The slate is really important for organizing files in
post-production! Really important! Really important!</li>
<li>As the director shouts "Three, two, one," observe whether the script
supervisor has exited the frame and adjust the pace according to the
surrounding activities. Ensure silence and a clean frame after saying
"action."</li>
<li>Even if the actors have finished their lines, continue acting
(improvising) until the director shouts "cut."</li>
</ol>
<h2 id="shooting-equipment">Shooting Equipment</h2>
<p>Microphones: Large NTG3, Small H5</p>
<p>Voice-over: If post-production voice-over is needed, consider
wrapping the recording equipment and voice-over actors with blankets to
ensure clean sound without reverberation. This provides more room for
audio post-processing.</p>
<p>Reflection: If encountering glass reflections, water surface
reflections, or insufficiently clear skies during shooting, use
polarizers in front of the lens to eliminate these reflections.</p>
<p>Slate: You can use a physical slate or use an app on an iPad or
smartphone as a slate. The key is clarity in the shot.</p>
<h2 id="post-production">Post-production</h2>
<h3 id="sound">Sound</h3>
<p>Main Volume: Between -12 and -6</p>
<p>Background Volume: Between -24 and -8</p>
<p>Use wired closed-back headphones for monitoring whenever
possible.</p>
<p>Recommendations: Sennheiser, HD25SP, SONY7506</p>
<h3 id="image">Image</h3>
<p>Aspect Ratio:</p>
<ul>
<li>1.85:1 for a cinematic feel</li>
<li>2.35:1 for widescreen (to compete with home TVs, the wider, the
better for viewer perception).</li>
<li>In the 1960s, 3D movies gradually disappeared. 2D can also tell a
story well.</li>
</ul>
<p>Video Format Conversion: Use Format Factory.</p>
<h2 id="insights">Insights</h2>
<p>Film and television production is a meticulous process, with each
step being crucial. Any issue in one step can affect the final result.
Among them, storyboarding and shooting are particularly important. A
good storyboard can streamline the shooting process and greatly improve
efficiency. I believe a good storyboard should have the following
characteristics:</p>
<ul>
<li>Accurate description, allowing visualization of the shot from the
storyboard.</li>
<li>Feasible shooting plans can be executed based on the
storyboard.</li>
<li>Allow for redundancy, adding some extra shots to increase editing
flexibility.</li>
</ul>
<p>During the shooting process, two points are crucial: adhering to the
shooting schedule and strictly following the shooting process for each
shot. Even for a short film, there can be dozens to hundreds of shots,
and each shot may require multiple takes, resulting in a large number of
files. Adhering to the shooting schedule and process ensures no shots
are missed and greatly facilitates post-production. Additionally, pay
attention to the following:</p>
<ul>
<li>After each shot, review the footage to check for any issues in
recording quality.</li>
<li>Use a slate for every shot, which greatly facilitates file
organization in post-production.</li>
<li>Naming convention for shooting files (recommended): Scene
number_Shot number_Take number_Equipment ID_Equipment model.</li>
<li>Ensure that the naming of recording files corresponds to shooting
files for easy editing in post-production.</li>
</ul>
<p>After shooting, organize the footage according to scene and shot
numbers, including video and audio files.</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>感悟</tag>
        <tag>拍摄</tag>
        <tag>电影</tag>
        <tag>创作</tag>
      </tags>
  </entry>
  <entry>
    <title>Innovation Port Sports Facilities Automatic Reservation.</title>
    <url>/en/66f3a0f6.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/66f3a0f6.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="project-background">Project Background</h2>
<p>The Innovation Port badminton venue has a high demand for
reservations every day. The online reservation system opens around 8:40
am every morning, and the opening time is not fixed. These factors have
caused a lot of trouble for manual venue reservations, so it is
considered to automate the venue reservation process with a script.</p>
<p><img
src="https://download.kezhi.tech/img/202203212104191.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h2 id="project-concept">Project Concept</h2>
<p>The sports venue reservation system needs to confirm the identity
through the SJTU authentication system. Consider carrying the identity
information after logging in to access the sports venue reservation
system. The identity authentication here refers to the library seat
reservation script by Guoguo:</p>
<p><a
href="https://gwyxjtu.github.io/2020/06/02/XJTU%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%8A%A2%E5%BA%A7%E4%BD%8D%E8%84%9A%E6%9C%AC-requests%E5%BA%93/">XJTU
Library Seat Reservation Script - Requests Library | Guoguo's Blog
(gwyxjtu.github.io)</a></p>
<p>In addition, the sports venue reservation system is open from 8:40 to
21:40, not all day. Therefore, connectivity detection is required for
reservation control.</p>
<p>The project process architecture is shown below:</p>
<ol type="1">
<li>Check connectivity to confirm whether the sports venue reservation
system is open.</li>
<li>Use the sports venue query API to obtain all venue information.</li>
<li>Set certain conditions to filter out the venues that need to be
reserved.</li>
<li>Obtain identity information through SJTU authentication.</li>
<li>Send a reservation POST request to the venue reservation system to
make a reservation.</li>
</ol>
<h2 id="project-implementation">Project Implementation</h2>
<h3 id="connectivity-detection">1. Connectivity Detection</h3>
<p>Use the <code>urlopen</code> library in the <code>requests</code>
library to perform connectivity detection:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_net</span>(<span class="params">testserver</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ret = request.urlopen(url=testserver, timeout=<span class="number">3.0</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>The waiting code for the detection in the main function is as
follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> check_net(<span class="string">&#x27;http://202.117.17.144/&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="query-venue-information">2. Query Venue Information</h3>
<p>First, create a <code>session</code> to perform subsequent access.
Access through <code>session</code> ensures continuity of access.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.util.retry <span class="keyword">import</span> Retry</span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"></span><br><span class="line">MAX_RETRIES = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">SLEEP_INTERVAL=<span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">retries=Retry(</span><br><span class="line">    total=MAX_RETRIES,</span><br><span class="line">    backoff_factor=SLEEP_INTERVAL,</span><br><span class="line">    status_forcelist=[<span class="number">403</span>, <span class="number">500</span>, <span class="number">502</span>, <span class="number">503</span>, <span class="number">504</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.mount(<span class="string">&quot;http://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line">session.mount(<span class="string">&quot;https://&quot;</span>, HTTPAdapter(max_retries=retries))</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 Edg/98.0.1108.62&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Next is to query the venue information. Taking the Innovation Port
table tennis venue as an example (because there are many unreserved
venues, which is convenient for testing ^_^).</p>
<p><img
src="https://download.kezhi.tech/img/202203211850928.png?x-oss-process=style/webp" /></p>
<p>By observing the link and conducting tests, it can be inferred that
each venue is identified by an <code>id</code>, which is used for
subsequent venue information queries and reservation applications.</p>
<p><img
src="https://download.kezhi.tech/img/202203211904502.png?x-oss-process=style/webp" /></p>
<p>By checking the page request, you can find that sending a
<code>GET</code> request to <code>/findtime.html</code> can query the
required information.</p>
<p>However, the information returned by this request is incomplete, and
an event <code>id</code> is not returned. This event <code>id</code> is
needed for subsequent reservations. After multiple searches, the
following <code>api</code> was finally found on the tennis court
reservation page:</p>
<p><img
src="https://download.kezhi.tech/img/202203211912146.png?x-oss-process=style/webp" /></p>
<p>From this <code>api</code>, three key pieces of information can be
found:</p>
<ul>
<li>id: the identifier of each time slot for each venue</li>
<li>status: venue status, 1 for available, 2 for reserved</li>
<li>stockid: identifier of each venue</li>
</ul>
<p>Therefore, you can use this <code>api</code> to query the venue
information for each venue. The implementation is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_avaliable_seats</span>(<span class="params">court_id,date</span>):</span><br><span class="line">    </span><br><span class="line">    params=&#123;<span class="string">&#x27;s_date&#x27;</span>:date,</span><br><span class="line">            <span class="string">&#x27;serviceid&#x27;</span>:court_id&#125;</span><br><span class="line">    response=session.get(<span class="string">&#x27;http://202.117.17.144/product/findOkArea.html&#x27;</span>,params=params,headers=headers).json()</span><br><span class="line">    </span><br><span class="line">    available_court_list=[]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> response[<span class="string">&#x27;object&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> item[<span class="string">&#x27;status&#x27;</span>]==<span class="number">1</span>:</span><br><span class="line">            available_court_list.append(item)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> available_court_list</span><br></pre></td></tr></table></figure>
<h3 id="filter-the-required-venues">3. Filter the Required Venues</h3>
<p>This step is relatively easy, just filter the sessions obtained in
the previous step.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_suitable_seats</span>(<span class="params">seat_list,time</span>):</span><br><span class="line">    result=[]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> seat_list:</span><br><span class="line">        <span class="keyword">if</span> item[<span class="string">&#x27;stock&#x27;</span>][<span class="string">&#x27;time_no&#x27;</span>]==time:</span><br><span class="line">            result.append(item)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<h3 id="obtain-identity-information-through-sjtu-authentication">4.
Obtain Identity Information through SJTU Authentication</h3>
<p>Here, Guoguo's library seat reservation script is referenced <a
href="https://gwyxjtu.github.io/2020/06/02/XJTU%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%8A%A2%E5%BA%A7%E4%BD%8D%E8%84%9A%E6%9C%AC-requests%E5%BA%93/">XJTU
Library Seat Reservation Script - Requests Library | Guoguo's Blog
(gwyxjtu.github.io)</a>. The only difference is that the application to
which it jumps after logging in to the authentication system is
different. In the browser, jump from the sports venue reservation system
to the authentication page to query the page cookie to obtain the
corresponding <code>appid</code>.</p>
<p><img
src="https://download.kezhi.tech/img/202203211921930.png?x-oss-process=style/webp" /></p>
<p>Fill in the corresponding <code>appid</code> in the appropriate
location to perform login and jump. The login part of the code is as
follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_pwd</span>(<span class="params">raw_pwd, publicKey=<span class="string">&#x27;0725@pwdorgopenp&#x27;</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; AES-ECB encrypt &#x27;&#x27;&#x27;</span></span><br><span class="line">    publicKey = publicKey.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># pkcs7 padding</span></span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + (BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)</span><br><span class="line">    pwd = pad(raw_pwd)</span><br><span class="line">    <span class="comment"># zero padding</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    pwd = raw_pwd</span></span><br><span class="line"><span class="string">    while len(raw_pwd.encode(&#x27;utf-8&#x27;)) % 16 != 0:</span></span><br><span class="line"><span class="string">    pwd += &#x27;\0&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    cipher = AES.new(publicKey, AES.MODE_ECB)</span><br><span class="line">    pwd = cipher.encrypt(pwd.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(base64.b64encode(pwd), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># get cookie route</span></span><br><span class="line">        session.get(<span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get JcaptchaCode and cookie JSESSIONID &amp; sid_code</span></span><br><span class="line">        r_JcaptchaCode = session.post(<span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/g/admin/getJcaptchaCode&#x27;</span>,</span><br><span class="line">                              headers=headers)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># is_JcaptchaCode_show</span></span><br><span class="line">        url = <span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/g/admin/getIsShowJcaptchaCode&#x27;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;userName&#x27;</span>: config[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;_&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        r = session.get(url, params=params, headers=headers)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="comment"># login</span></span><br><span class="line">        url = <span class="string">&#x27;https://org.xjtu.edu.cn/openplatform/g/admin/login&#x27;</span></span><br><span class="line">        cookie = &#123;</span><br><span class="line">            <span class="string">&#x27;cur_appId_&#x27;</span>:<span class="string">&#x27;n0C/SQT28fY=&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;loginType&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: config[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line">            <span class="string">&quot;pwd&quot;</span>: encrypt_pwd(config[<span class="string">&#x27;password&#x27;</span>]),</span><br><span class="line">            <span class="string">&quot;jcaptchaCode&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span></span><br><span class="line">        r = session.post(url, data=json.dumps(data), headers=headers,cookies=cookie)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Authentication successful, redirecting...&#x27;</span>)</span><br><span class="line">        token = json.loads(r.text)[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;tokenKey&#x27;</span>]</span><br><span class="line">        memberId=json.loads(r.text)[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;orgInfo&#x27;</span>][<span class="string">&#x27;memberId&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        cookie = &#123;</span><br><span class="line">            <span class="string">&#x27;cur_appId_&#x27;</span>:<span class="string">&#x27;n0C/SQT28fY=&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;open_Platform_User&#x27;</span> : token,</span><br><span class="line">            <span class="string">&#x27;memberId&#x27;</span>: <span class="built_in">str</span>(memberId)</span><br><span class="line">        &#125;</span><br><span class="line">        r=session.get(<span class="string">&#x27;http://org.xjtu.edu.cn/openplatform/oauth/auth/getRedirectUrl?userType=1&amp;personNo=3121154016&amp;_=1590998261976&#x27;</span>,cookies = cookie)</span><br><span class="line">        r=session.get(json.loads(r.text)[<span class="string">&#x27;data&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h3 id="reserve-the-venue">5. Reserve the Venue</h3>
<p>The last step is to reserve the venue. The manual reservation process
is as follows:</p>
<ol type="1">
<li>Select the venue.</li>
<li>Click the confirm venue button.</li>
<li>Jump to a new page to confirm the venue information.</li>
<li>Click the continue reservation button to display the verification
code.</li>
<li>Enter the verification code and confirm.</li>
<li>Return the reservation status information (success or failure).</li>
</ol>
<p>By examining and analyzing the page requests in these processes, it
is found that only two processes are related to successful reservations:
① obtaining and recognizing the verification code, and ② submitting a
reservation <code>post</code> with the verification code.</p>
<p>Taking the table tennis venue reservation page as an example, the
verification code generation method is as follows:</p>
<p><img
src="https://download.kezhi.tech/img/202203212042773.png?x-oss-process=style/webp" /></p>
<p>That is, access the address
http://202.117.17.144/login/yzm.html?+(any float random number) to
obtain the verification code image.</p>
<p>The <code>post</code> request can be located step by step through
nested functions:</p>
<p><img
src="https://download.kezhi.tech/img/202203212046298.png?x-oss-process=style/webp" /></p>
<p>It can be seen that the final submitted <code>post</code> request
address is <code>/order/book</code>, with two parameters, one is the
string converted from the reservation information, and the other is the
verification code. Below are the methods to obtain these two
parameters.</p>
<p>There are many parameters in the reservation information, but many
parameters are <code>null</code> and do not need to be considered. The
parameters that need to be constructed are as follows:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">param=<span class="punctuation">&#123;</span><span class="attr">&quot;activityPrice&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span>	<span class="comment">//Price information, keep it unchanged</span></span><br><span class="line">           <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span>&#x27;<span class="number">102</span>&#x27;<span class="punctuation">,</span> <span class="comment">//Venue id </span></span><br><span class="line">           <span class="attr">&quot;extend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span>	<span class="comment">//Extra information, keep it unchanged</span></span><br><span class="line">           <span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span>	<span class="comment">//Keep it unchanged</span></span><br><span class="line">           <span class="attr">&quot;stock&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>&#x27;<span class="number">169111</span>&#x27;<span class="punctuation">:</span>&#x27;<span class="number">1</span>&#x27;<span class="punctuation">&#125;</span><span class="punctuation">,</span>	<span class="comment">//The first number is the stockid of the venue mentioned above, and the second number is filled with 1</span></span><br><span class="line">           <span class="attr">&quot;stockdetail&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>&#x27;<span class="number">169111</span>&#x27;<span class="punctuation">:</span>&#x27;<span class="number">1711756</span>&#x27;<span class="punctuation">&#125;</span><span class="punctuation">,</span>	<span class="comment">//The second number is the event id</span></span><br><span class="line">           <span class="attr">&quot;stockdetailids&quot;</span><span class="punctuation">:</span>&#x27;<span class="number">1711756</span>&#x27;	<span class="comment">//Event id</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>The verification code part can be verified online through some online
recognition <code>api</code>, and the verification code is relatively
simple and has a high success rate. The <code>api</code> address used in
this project is: https://aicode.my-youth.cn</p>
<p>At this point, the venue can be successfully reserved. The
reservation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">order</span>(<span class="params">seat_info</span>):</span><br><span class="line">    </span><br><span class="line">    param=&#123;<span class="string">&quot;activityPrice&quot;</span>:<span class="number">0</span>,</span><br><span class="line">           <span class="string">&quot;address&quot;</span>:seat_info[<span class="string">&#x27;stock&#x27;</span>][<span class="string">&#x27;serviceid&#x27;</span>],</span><br><span class="line">           <span class="string">&quot;extend&quot;</span>:&#123;&#125;,</span><br><span class="line">           <span class="string">&quot;flag&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">           <span class="string">&quot;stock&quot;</span>:&#123;<span class="built_in">str</span>(seat_info[<span class="string">&#x27;stockid&#x27;</span>]):<span class="string">&#x27;1&#x27;</span>&#125;,</span><br><span class="line">           <span class="string">&quot;stockdetail&quot;</span>:&#123;<span class="built_in">str</span>(seat_info[<span class="string">&#x27;stockid&#x27;</span>]):<span class="built_in">str</span>(seat_info[<span class="string">&#x27;id&#x27;</span>])&#125;,</span><br><span class="line">           <span class="string">&quot;stockdetailids&quot;</span>:<span class="built_in">str</span>(seat_info[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">           </span><br><span class="line">    <span class="comment"># Get the verification code image</span></span><br><span class="line">    img=session.get(<span class="string">&#x27;http://202.117.17.144/login/yzm.html?0.16003635332777866&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;yzm.jpg?x-oss-process=style/webp&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(img.content)</span><br><span class="line">        f.close()</span><br><span class="line">    <span class="comment"># Verification code recognition</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;yzm.jpg?x-oss-process=style/webp&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        img_base64=<span class="built_in">str</span>(base64.b64encode(f.read()))[<span class="number">2</span>:-<span class="number">1</span>]</span><br><span class="line">        f.close()</span><br><span class="line">        </span><br><span class="line">    headers[<span class="string">&#x27;Content-Type&#x27;</span>]=<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    headers[<span class="string">&#x27;Origin&#x27;</span>]=<span class="string">&#x27;https://aicode.my-youth.cn&#x27;</span></span><br><span class="line">    response=session.post(<span class="string">&#x27;https://aicode.my-youth.cn/base64img&#x27;</span>,data=&#123;<span class="string">&#x27;data&#x27;</span>:<span class="string">&quot;image/jpeg;base64,&quot;</span>+img_base64&#125;,headers=headers)</span><br><span class="line">    yzm=response.json()[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Reserve the venue</span></span><br><span class="line">    headers[<span class="string">&#x27;Content-Type&#x27;</span>]=<span class="string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span></span><br><span class="line">    headers[<span class="string">&#x27;Origin&#x27;</span>]=<span class="string">&#x27;http://202.117.17.144&#x27;</span></span><br><span class="line">    response=session.post(<span class="string">&#x27;http://202.117.17.144/order/book.html&#x27;</span>,params=&#123;<span class="string">&#x27;id&#x27;</span>:seat_info[<span class="string">&#x27;stock&#x27;</span>][<span class="string">&#x27;serviceid&#x27;</span>]&#125;,data=&#123;<span class="string">&#x27;param&#x27;</span>:<span class="built_in">str</span>(param),<span class="string">&#x27;yzm&#x27;</span>:yzm&#125;,headers=headers).json()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h2 id="project-summary">Project Summary</h2>
<p>During the development process, I also took some detours. For
example, in the implementation of the reservation stage, I studied the
logic of page jumping for a long time. But in fact, only the last
request sent by the last page is effective. When writing the script, pay
attention to the result-oriented rather than the process-oriented. This
avoids many unnecessary developments.</p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Script</tag>
        <tag>Automation</tag>
      </tags>
  </entry>
  <entry>
    <title>Terminated and Truncated in reinforcement learning.</title>
    <url>/en/5be4b154.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/5be4b154.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>The process of deep reinforcement learning can be abstracted into the
following steps:</p>
<ol type="1">
<li>The agent interacts with the environment and generates and stores
experiences.</li>
<li>The agent learns from the experiences.</li>
</ol>
<p>This article mainly discusses the impact of natural termination
(Terminated), including successful or failed goals, and artificial
truncation (Truncated), mainly ending after a certain number of steps,
on experience collection and training. It also conducts some experiments
to compare performance.</p>
<p><img src="https://download.kezhi.tech/img/202305242122684.png?x-oss-process=style/webp" style="width:60%;" /></p>
<span id="more"></span>
<h2 id="introduction-to-q-learning">Introduction to Q-Learning</h2>
<p>In the Q-Learning series of algorithms, the agent learns to estimate
the optimal Q-value <span class="math inline">\(Q^{*}(s,a)\)</span> for
each action under each state <span class="math inline">\(s\)</span>. The
Bellman equation is as follows: <span class="math display">\[
Q^*(s_t,a_t)=r_t+\gamma \cdot \max_{a&#39;\in
A(s_{t+1})}Q^*(s_{t+1},a_{t+1})
\]</span> When <span class="math inline">\(s_{t+1}\)</span> is a
terminal state, i.e., <span
class="math inline">\(done(s_{t+1})=True\)</span>, the equation becomes:
<span class="math display">\[
Q^*(s_t,a_t)=r_t
\]</span></p>
<p>Combined together, it can be written as: <span
class="math display">\[
Q^*(s_t,a_t)=\left\{
\begin{array}{**lr**}
r_t+\gamma \cdot \max_{a&#39;\in A(s_{t+1})}Q^*(s_{t+1},a_{t+1}) &amp;
\text{if } done(s_{t+1})=False\\
r_t &amp; \text{if } done(s_{t+1})=True
\end{array}
\right.
\]</span> In the implementation of the program, it is usually written
as:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">q_target = reward + self._gamma * max_next_q_value * (<span class="number">1</span> - done)</span><br></pre></td></tr></table></figure>
<h2 id="truncation-issue">Truncation Issue</h2>
<p>The key to Q-Learning is the accurate estimation of the value
function. If the environment is artificially truncated during the
deduction process and treated as a termination, the estimation of <span
class="math inline">\(Q^*\)</span> will lack the term <span
class="math inline">\(\gamma \cdot \max_{a&#39;\in
A(s_{t+1})}Q^*(s_{t+1},a_{t+1})\)</span>. This can make the <span
class="math inline">\(Q^*\)</span> function unstable or difficult to
converge during the learning process. Additionally, the terminal state
is often related to the reward <span class="math inline">\(r_t\)</span>.
If the truncation situation is not handled separately, it may give the
agent a biased reward, resulting in problems during the training
process.</p>
<p>Therefore, when recording experiences and designing rewards, in
addition to considering natural termination (Terminated), one should
also consider artificial truncation (Truncated). The reinforcement
learning environment library <code>gym</code> has included these two
pieces of information in each step since version 0.26, making training
more convenient.</p>
<p>Considering the truncation, the Bellman equation for <span
class="math inline">\(Q^*\)</span> in the program implementation
becomes:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">q_target = reward + self._gamma * max_next_q_value * (<span class="number">1</span> - done + truncated)</span><br></pre></td></tr></table></figure>
<h2 id="experimental-comparison">Experimental Comparison</h2>
<p>This article conducted tests on the <code>CartPole-v1</code>
environment in <code>gym</code>. The maximum number of episodes was set
to 200, the number of training steps was 500, the hidden layer network
was a fully connected network with 2 layers and 64 nodes, the training
was performed 8 times per step, the buffer size was 100,000, the batch
size was 64, the minimum training experience was 500, the initial <span
class="math inline">\(\epsilon\)</span> was 0.9, the terminal <span
class="math inline">\(\epsilon\)</span> was 0.01, and the <span
class="math inline">\(\epsilon\)</span> decay step was 200 steps. The
reward function was defined as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cart_pole_v1</span>(<span class="params">params</span>):</span><br><span class="line">    reward = params[<span class="string">&quot;reward&quot;</span>]</span><br><span class="line">    step = params[<span class="string">&quot;step&quot;</span>]</span><br><span class="line">    done = params[<span class="string">&quot;done&quot;</span>]</span><br><span class="line">    truncated = params[<span class="string">&quot;truncated&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> done <span class="keyword">and</span> (<span class="keyword">not</span> truncated):</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">100</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>/((step+<span class="number">1</span>)**<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>The experimental results for the DQN algorithm are shown in Figure
1:</p>
<p><img
src="https://download.kezhi.tech/img/202305242121154.png?x-oss-process=style/webp" /></p>
<center>
Figure 1 Comparison of DQN
</center>
<p>The experimental results for the Double DQN algorithm are shown in
Figure 2:</p>
<p><img
src="https://download.kezhi.tech/img/202305242121791.png?x-oss-process=style/webp" /></p>
<center>
Figure 2 Comparison of Double DQN
</center>
<p>The experimental results for the Dueling DQN algorithm are shown in
Figure 3:</p>
<p><img
src="https://download.kezhi.tech/img/202305242121630.png?x-oss-process=style/webp" /></p>
<center>
Figure 3 Comparison of Dueling DQN
</center>
<p>The experimental results for the D3QN algorithm are shown in Figure
4:</p>
<p><img
src="https://download.kezhi.tech/img/202305242122501.png?x-oss-process=style/webp" /></p>
<center>
Figure 4 Comparison of Double Dueling DQN
</center>
<p>The above experimental results indicate that considering truncation
makes the training of the algorithm more stable, resulting in smaller
variance in the final convergence. However, considering truncation does
not significantly improve the convergence speed or performance of the
Q-Learning series of algorithms. It mainly improves the stability during
training.</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>Q-Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>The details of implementing reinforcement learning algorithms.</title>
    <url>/en/aaafe79.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/aaafe79.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h1 id="common">Common</h1>
<ul>
<li>Be cautious when implementing reinforcement learning algorithms, as
attention to detail is crucial for convergence and training
effectiveness. This article mainly documents some pitfalls encountered
and details to be aware of while implementing various reinforcement
learning algorithms, with continuous updates...</li>
</ul>
<p>And here's my self-implemented RL algorithm library: <a
href="https://github.com/KezhiAdore/RL-Algorithm">https://github.com/KezhiAdore/RL-Algorithm</a></p>
<figure>
<img
src="https://download.kezhi.tech/img/202303061042992.jpg?x-oss-process=style/webp"
style="width:45.0%" alt="Image" />
<figcaption aria-hidden="true">Image</figcaption>
</figure>
<span id="more"></span>
<h2 id="common-1">Common</h2>
<ul>
<li>In <code>PyTorch</code>, the cross-entropy loss function
<code>torch.nn.functional.cross_entropy</code> first computes a
<code>softmax</code>, which should be noted when using policy gradients
<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>.</li>
<li>In some scenarios, there's a human-induced premature termination of
trajectories (e.g., reaching a certain step in the Cart Pole
environment). This needs to be distinguished from termination due to
failure. In the latter case, <span
class="math inline">\(q(s,a)=r\)</span>, while in human-induced
truncation, <span
class="math inline">\(q(s,a)=r+\gamma*V(s&#39;)\)</span> <a href="#fn2"
class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a>.</li>
</ul>
<h2 id="reinforce">REINFORCE</h2>
<ul>
<li>When computing the <code>loss</code>, ensure consistency in
dimensions when multiplying <span
class="math inline">\(-\ln\pi_\theta(a|s)\)</span> with discounted
rewards.</li>
<li>After computing the cross-entropy, using <code>torch.sum</code> for
summation is more effective than <code>torch.mean</code> for averaging
<a href="#fn3" class="footnote-ref" id="fnref3"
role="doc-noteref"><sup>3</sup></a>.</li>
</ul>
<h2 id="dqn-series">DQN Series</h2>
<ul>
<li>Be mindful when calculating <code>q_target</code>, especially when
<code>done=1</code>, where
<code>q_target = reward + self._gamma * max_next_q_value * (1 - done)</code>,
to prevent significant oscillations in rewards during training.</li>
<li>Ensure there's periodic synchronization of the
<code>target_network</code>, as convergence is challenging without
it.</li>
</ul>
<h2 id="reference">Reference</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://kezhi.tech/e295e676.html">Inconsistency
in CrossEntropyLoss and Cross-Entropy Calculation in PyTorch | Kezhi's
Blog</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://kezhi.tech/5be4b154.html">Terminated
and Truncated in Reinforcement Learning | Kezhi's Blog</a><a
href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="https://kezhi.tech/b69f94c6.html">Discussion on
Loss Mean vs. Sum in Vanilla Policy Gradient | Kezhi's Blog</a><a
href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Reinforcement Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Excerpt.</title>
    <url>/en/639b053d.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/639b053d.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="section">2021.04</h2>
<blockquote class="blockquote-center">
<p>Being artificially fond of various rules is called "systematic",
tirelessly and enthusiastically dealing with trivial matters is called
"diligence"; being indecisive about what should be done is called
"caution"; persisting blindly in what should not be done is called
"determination".</p>
<p><b>-- "Foundation and Empire" by Isaac Asimov</b></p>

</blockquote>
<span id="more"></span>
<h2 id="section-1">2021.06</h2>
<blockquote class="blockquote-center">
<p>Tears may last through the night, but joy comes with the morning.</p>
<p><b>-- Psalm 30:5</b></p>

</blockquote>
<h2 id="section-2">2022.11</h2>
<blockquote class="blockquote-center">
<p>Much of my work has come from being lazy.</p>
<p><b>-- Programming Perl</b></p>

</blockquote>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>读书笔记</tag>
        <tag>Excerpt.</tag>
      </tags>
  </entry>
  <entry>
    <title>The film &quot;ByteDance&quot; is a creative exposition.</title>
    <url>/en/fa011f5e.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/fa011f5e.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="introduction">Introduction</h2>
<p>"ByteDance" was created from late May to early June 2022, taking half
a month. It is the highest level short film I have participated in so
far.</p>
<p><img
src="https://download.kezhi.tech/img/202206071619140.jpg?x-oss-process=style/webp" /></p>
<span id="more"></span>
<h2 id="film-overview">Film Overview</h2>
<p>"ByteDance" won the Best Film Award in the 2022 Master's Degree
General Elective Course "Film Creation" at Xi'an Jiaotong University.
The actor who played Lin Ning also won the Best Actor Award. The full
film can be viewed below:</p>
<iframe src="//player.bilibili.com/player.html?aid=257448226&amp;bvid=BV18Y411K7PV&amp;cid=743040841&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<h2 id="workflow">Workflow</h2>
<p>The film creation process mainly includes the following steps:</p>
<ul>
<li>Determine the story theme and outline</li>
<li>Write the script</li>
<li>Write storyboards based on the script</li>
<li>Confirm shooting locations</li>
<li>Develop a shooting plan and prepare equipment and props</li>
<li>Film shooting</li>
<li>Post-production</li>
</ul>
<p>The following sections will explain each of the above processes in
detail.</p>
<p>In terms of team collaboration, the following solutions were mainly
used:</p>
<ul>
<li>Tencent Meeting: Online meetings and communication without
geographical limitations</li>
<li>Shimo Online Documents: Collaborative editing and viewing of
documents online, allowing real-time updates and facilitating text
collaboration</li>
<li>Seafile Cloud Storage: A cloud storage that can be mounted to the
computer directory, used by our team to store all shooting materials for
easy access and collaboration with special effects files.</li>
</ul>
<table>
<tr>
<td>
<center>
Shimo Documents
</center>
</td>
<td>
<center>
Seafile
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202205301641610.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202205301643646.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h3 id="determine-the-story-theme-and-outline">Determine the Story Theme
and Outline</h3>
<p>This step is the most brainstorming and creative part of the entire
creation process. Our team consists of students majoring in science and
engineering, so this step was relatively challenging. During the
discussion phase in class, our team considered many themes, including
suspense, love, science fiction, and even contemplation of the meaning
of life. Science fiction was slightly more difficult in terms of
shooting and post-production, so it was the first to be ruled out. As
for the meaning of life, it was abandoned because the team members could
not reach a consensus. Finally, we discussed the themes of suspense and
love, and during the discussion, we suddenly thought that we are
students with a background in artificial intelligence, so we focused on
a story about artificial intelligence falling in love with a human.</p>
<p>The story is not complicated. It tells the story of the relationship
between an artificial intelligence male lead and a human female lead.
The characteristics of the male lead are already obvious, he is an
artificial intelligence. At this point, we need to give the female lead
certain characteristics. The most common characteristic of artificial
intelligence is the lack of explicit emotions, so we gave the female
lead the ability to read minds to highlight the male lead's uniqueness
in her world. In addition, we also need to consider the motivation for
the two characters to develop feelings for each other. The initial
considerations are as follows:</p>
<ul>
<li>The female lead discovers that people often say one thing but mean
another, but she cannot read the male lead's mind, which piques her
curiosity. After becoming friends, she gradually develops feelings for
him through their time together.</li>
<li>The male lead is the result of a strong artificial intelligence
program and theoretically lacks explicit emotions. The experiences of
interacting with the female lead form the basis for his emotional
development, leading to the development of feelings.</li>
</ul>
<p>With this, the core of the story for this film creation is
complete.</p>
<h3 id="write-the-script">Write the Script</h3>
<p>Writing the script is the process of enriching and completing the
outline into a complete story. In other words, it is the step-by-step
finalization of the details. Our team used the Tencent Meeting and Shimo
Online Documents for this process. We held two meetings to discuss the
script. The first meeting completed the draft of the script, and the
second meeting confirmed some details of the script (such as how the
male and female leads become acquainted, the plot twists, and the
ending). In addition, the script went through multiple revisions during
the process of writing storyboards, preparing for shooting, and actual
shooting. Here are some interesting processes:</p>
<ol type="1">
<li>Determining the names of the male and female leads. Lin Ning and Mo
Chi are homophonic with "Machine Learning". In addition, because
artificial intelligence and robots require graduate students to clock in
early, Mo Chi also implies that graduate students should not be
late.</li>
<li>The line of the heart voice at the end of the film went through many
revisions, including "Lin Ning, I like you," "Lin Ning, I think I
understand what it means to like someone," and so on. Finally, it was
finalized as "Lin Ning, I know what it means to like someone." On the
one hand, Lin Ning reads Mo Chi's mind and shows that Mo Chi has
developed feelings. On the other hand, it leaves room for
interpretation, as it does not directly explain Mo Chi's feelings for
Lin Ning, leaving it to the audience's imagination.</li>
<li>About the film title. The name "ByteDance" naturally emerged with
the story plot. "Byte" represents artificial intelligence, and "Dance"
represents the development of emotions. The name "ByteDance" is very
fitting. Perhaps the founder of ByteDance, an AI company, also had this
idea?</li>
</ol>
<h3 id="write-storyboards-based-on-the-script">Write Storyboards Based
on the Script</h3>
<p>Writing storyboards may seem like a simple task, just turning the
script into a series of scenes. However, if there are problems with the
storyboards, it can cause significant inconvenience during shooting.
Since our team had no previous experience in shooting films, we focused
on considering the guidance for subsequent shooting when writing the
storyboards. For most shots, we used on-site rehearsals and test shots
with mobile phones to confirm how the shots would be composed and where
the camera would be positioned.</p>
<h3 id="confirm-shooting-locations">Confirm Shooting Locations</h3>
<p>When writing the storyboards, we had some ideas for shooting
locations, such as in a park, in a classroom, in a corridor, and so on.
However, if we followed these storyboards to guide the shooting, it
would inevitably take a lot of time to find suitable locations, greatly
reducing shooting efficiency. Therefore, after determining the shooting
time, Jing Xue, Zi Qian, and I started looking for suitable locations
and times in advance. The main shooting locations for our film include
classrooms, school roads, parks, rooftops, dormitory entrances, and
dormitories. The location selection process is as follows:</p>
<ul>
<li>For the classroom, we considered the staircase classrooms in the
west annex building of Hanying Building. We chose this location for two
reasons: first, the staircase classrooms here have a youthful campus
feel and good indoor lighting; second, in the evening, the outdoor light
shines through the windows, creating a good shooting effect (although
the outdoor lighting was not good on the actual shooting day).</li>
<li>For the school roads, we initially considered the wide roads south
of Hanying Building, the corridor at the entrance of Hongli Building,
and the corridor outside Building 3. We finally chose the corridor north
of Building 3 because there were fewer shared bicycles nearby (there
were many shared bicycles near Hongli Building), and there were many
plants nearby that created light spots, which looked better. On the
actual shooting day, we chose the corridor on the east side of Building
3 because the lighting there was darker, and this road was connected to
the wide road south of Hanying Building, which provided a good
transition for the plot.</li>
<li>Choosing a location for the park was a big problem. There really is
nothing near the Innovation Harbor!!! And the green spaces inside the
Innovation Harbor itself are not particularly scenic. We finally decided
to shoot near the so-called "Yanzhi Slope" near the Innovation
Harbor.</li>
<li>The rooftop location was determined while looking for locations.
Initially, we wanted to find a place with a beautiful view, and then we
discovered that the sunset was beautiful that evening, so we decided to
try shooting on the rooftop. The result was indeed good. And luckily,
the sunset was even more beautiful on the actual shooting day.</li>
<li>For the dormitory entrance, it took a long time to confirm the
location because this scene involved the cat's exit, and it couldn't be
too far from the cat's living area. Also, there couldn't be too many
objects. We finally chose the road south of the cafeteria in the B South
Area as the shooting location.</li>
<li>For the dormitory interior, it was relatively simple. Jing Xue's
dormitory was beautifully decorated, and it looked great in the shots.
Nice!</li>
<li>In addition, there are scenes of the male and female leads going on
outings together in the main plot. In order to give these scenes a
realistic and romantic atmosphere, we chose scenes in a shopping mall,
the green space of the Innovation Harbor, and the Milan Building for
shooting. When designing these scenes, we found that there were too many
shots of them walking together:joy: - they walk and talk, walk together
in the mall, walk next to Einstein, and even walk together to visit the
Milan Building. It seems that besides walking, they only walk:happy:
(although people with dating experience say that walking together is
indeed common). To make these scenes less monotonous, we designed each
scene with some creativity. We changed the mall scene to them playing
claw machines together (but there were no claw machines in DaKe Mall, so
we changed it to eating), added a scene where the female lead imitates
Einstein next to his statue, and added a scene of an office chair race
in the Milan Building because there was a swivel chair there. This made
these shots look more diverse.</li>
</ul>
<h3 id="develop-a-shooting-plan-and-prepare-equipment-and-props">Develop
a Shooting Plan and Prepare Equipment and Props</h3>
<p>The equipment and props used in this shoot are as follows:</p>
<p>Video recording equipment: Canon 600D×1, Canon 70D×1, Canon 6D Mark
II×1</p>
<p>Audio recording equipment: PINSUN wireless lapel microphone
[one-to-one] [type-c interface]×2, mobile phones×2 (used as receivers
for the microphones)</p>
<p>Stabilization equipment: Tripods×2, camera stabilizer</p>
<p>Clapperboard: Physical clapperboard×1, iPad clapperboard×2
(Clapperboard software: "Easy Clapper")</p>
<p>Animals: Puppet (cat)×1</p>
<p>Props: Pigeon feed×1, painting×1, cat cup×1, clothing, "Machine
Learning" book×1, "Deep Learning" book×1, notebook (Notebook)×1,
laptop×1</p>
<p>The preparation of shooting props was done in stages. After
determining the shooting, the preparation of camera equipment, audio
equipment, stabilization equipment, and clapperboards were put on the
schedule. The key props in the plot were determined during the
discussion of the script and storyboards, such as pigeon feed, cat, and
painting. The remaining props were determined during the specific set
design and shooting, such as clothing, notebooks, and books.</p>
<p>The shooting plan is crucial for the efficient shooting of the film.
The male and female leads do not reside in the Innovation Harbor, so the
shooting time was very tight, and we needed to complete all the shooting
within a day and a half. Therefore, the shooting plan and preparation
before shooting were made to save as much shooting time as possible.
When developing the shooting plan, the following principles were
considered:</p>
<ul>
<li>Prioritize scenes with time constraints (such as the rooftop scene
at sunset)</li>
<li>Shoot all scenes in the same location at once to save time for
moving locations</li>
<li>Group scenes that are connected in the plot together to ensure
actors' understanding of the plot</li>
<li>Shoot from multiple angles and positions, record audio with multiple
devices to ensure redundant footage</li>
</ul>
<h3 id="film-shooting">Film Shooting</h3>
<p>Shooting is the process of turning the creative and planned ideas
into reality. The shooting process of a film requires a strict and
standardized workflow to ensure the usability and standardization of the
footage. Since the shooting was scheduled for Friday and Saturday, the
shooting part of the film creation course coincided with the shooting
process. We followed the following process during the shooting:</p>
<ol type="1">
<li>Arrive at the shooting location. Each member of the production team
has a copy of the shooting plan, and the actors have the script.</li>
<li>The director informs the production team and actors of the scenes to
be shot based on the shooting plan and explains the emotions to ensure
that the actors understand the emotions.</li>
<li>The cinematographer determines the camera positions and shooting
paths based on the director's requirements.</li>
<li>The sound recordist determines the microphone placement based on the
actors' actions and camera angles.</li>
<li>All departments are ready, and the clapperboard is placed in front
of the camera by the script supervisor.</li>
<li>The director shouts "Three, two, one, action." When shouting
"Three," the sound recordist and cinematographer start recording. When
shouting "One," the script supervisor moves away from the camera.</li>
<li>The director shouts "Cut," and the sound recordist and
cinematographer stop recording.</li>
<li>The sound recordist renames the audio files in the format "n_k_r
take" <span class="math inline">\(n,k,r \in N^+\)</span></li>
</ol>
<p>After the shooting on Friday, the shooting process was discussed in
class, and we realized that we needed to make some adjustments to our
shooting process. Based on our own shooting process, we summarized the
following issues and solutions:</p>
<ol type="1">
<li><p>The problem of missing shots: The script and editing of the male
lead's storyline were not very detailed, which led to some abrupt
transitions in the editing of the male lead's shots after shooting.
Since the male and female leads do not reside in the Innovation Harbor,
it would be costly to reshoot the missing shots. To solve this problem,
we decided to use some first-person perspective and close-up shots to
fill in the missing footage (since the face is not visible anyway). As a
result, we added first-person perspective running shots in the later
part of the film<del>(I running around with the camera in the Innovation
Harbor really looked like an idiot)</del>. In addition, during the
shooting process, there was a scene where the female lead gave a
painting to the male lead, but the content of the painting was shot
after the scene. To ensure smooth shooting and avoid additional costs,
we used a blank piece of paper as a prop during the shooting and later
had the actor's hand replace it in the close-up shots.</p></li>
<li><p>The problem of continuity errors in the film: During the elevator
scene, there was a mirror reflection inside the elevator, which
inevitably captured the cinematographer in the shot, as shown in the
left image below. Moreover, the camera was constantly moving at this
time, making it impossible to simply cover up the reflection. After
exploring many solutions, we used the method shown in <a
href="https://www.bilibili.com/video/BV1KE411X7gY?share_source=copy_web">【Premiere】pr移除场景中的杂物_哔哩哔哩_bilibili</a>
to remove the person captured in the shot, as shown in the right image
below.</p></li>
</ol>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206052135720.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206052135469.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h3 id="post-production">Post-Production</h3>
<p>The post-production of this film was relatively extensive, involving
film editing, handling of voiceovers (heart voice), special effects
production, and memory flashback effects. Therefore, the workload was
divided among three team members. The responsibilities were as follows:
Yi Xin was responsible for the opening, editing, audio effects, and
transitions in the first half of the film; Jing Xue was responsible for
the editing, audio effects, memory flashback effects, and special scenes
in the second half of the film; I was responsible for special effects,
subtitles, and the ending. This division of work minimized the coupling
between tasks and ensured that each part could be worked on
independently, greatly improving production efficiency.</p>
<p>In addition, at the beginning of the editing process, the three
post-production team members created a WeChat group for easy
communication. After the initial editing, an unexpected guest joined the
group - me. She did not participate in any editing work but joined the
group to push the members of the editing team to finish their work as
soon as possible. However, her role turned out to be more than that. On
top of constantly urging the post-production team, she provided feedback
and improvement suggestions for each edited segment. This turned out to
be necessary because the editor may repeatedly watch and make changes to
a segment, which may lead to overlooking the overall impression of the
film, i.e., the audience's first impression when watching the film. The
arrival of this "unexpected guest" ensured that each segment had an
audience member providing suggestions, which greatly contributed to the
overall quality of the final film.</p>
<h2 id="equipment-and-device-usage">Equipment and Device Usage</h2>
<p>The equipment used in this shoot is as follows:</p>
<p>Video recording equipment: Canon 600D×1, Canon 70D×1, Canon 6D Mark
II×1</p>
<p>Audio recording equipment: PINSUN wireless lapel microphone
[one-to-one] [type-c interface]×2, mobile phones×2 (used as receivers
for the microphones)</p>
<p>Stabilization equipment: Tripods×2, camera stabilizer</p>
<p>For detailed explanations of the equipment and their usage, please
refer to the "Develop a Shooting Plan and Prepare Equipment and Props"
and "Film Shooting" sections above.</p>
<p>Some additional notes:</p>
<ul>
<li>The camera stabilizer was rented, but it was not easy to use. It
took a long time to balance it. We eventually gave up and switched to
handheld shooting. The result was that the slightly shaky footage
actually had better expressive power than completely static shots. On
the other hand, the cinematographer's ability to shoot handheld also
improved significantly.</li>
<li>The tripods played a significant role during the shooting, providing
stable support for shots that required stability.</li>
</ul>
<h2 id="problems-solutions-and-lessons-learned">Problems, Solutions, and
Lessons Learned</h2>
<p>This film creation process allowed our team to experience the entire
process from an idea to a film, and we encountered many difficulties and
challenges along the way. Finding solutions to these difficulties was a
process of growth for us. Here, we record the problems, solutions, and
lessons learned during the creation process.</p>
<h3 id="problem-of-missing-shots">1. Problem of missing shots</h3>
<p>Due to the lack of detailed planning and editing for the male lead's
storyline, there were some abrupt transitions in the editing of the male
lead's shots after shooting. Since the male and female leads do not
reside in the Innovation Harbor, reshooting the missing shots would be
costly. To solve this problem, we decided to use some first-person
perspective and close-up shots to fill in the missing footage (since the
face is not visible anyway). As a result, we added first-person
perspective running shots in the later part of the film<del>(I running
around with the camera in the Innovation Harbor really looked like an
idiot)</del>. In addition, during the shooting process, there was a
scene where the female lead gave a painting to the male lead, but the
content of the painting was shot after the scene. To ensure smooth
shooting and avoid additional costs, we used a blank piece of paper as a
prop during the shooting and later had the actor's hand replace it in
the close-up shots.</p>
<h3 id="continuity-errors-in-the-film">2. Continuity errors in the
film</h3>
<p>During the elevator scene, there was a mirror reflection inside the
elevator, which inevitably captured the cinematographer in the shot, as
shown in the left image below. Moreover, the camera was constantly
moving at this time, making it impossible to simply cover up the
reflection. After exploring many solutions, we used the method shown in
<a
href="https://www.bilibili.com/video/BV1KE411X7gY?share_source=copy_web">【Premiere】pr移除场景中的杂物_哔哩哔哩_bilibili</a>
to remove the person captured in the shot, as shown in the right image
below.</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206052135720.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206052135469.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>创作</tag>
        <tag>影视创作</tag>
        <tag>微电影</tag>
        <tag>协作</tag>
      </tags>
  </entry>
  <entry>
    <title>Digital Image Processing (Part 1) - Image Interpolation (Python)</title>
    <url>/en/2b8fba10.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/2b8fba10.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Digital images play a very important role in contemporary society.
Image interpolation, as a basic image processing method, can effectively
improve image resolution and enhance visual perception in many cases.
There are three main interpolation methods for images:</p>
<ul>
<li>Nearest Neighbor Interpolation</li>
<li>Bilinear Interpolation</li>
<li>Bicubic Interpolation <span id="more"></span></li>
</ul>
<h2 id="nearest-neighbor-interpolation">Nearest Neighbor
Interpolation</h2>
<p>As the name suggests, nearest neighbor interpolation fills the pixels
of the image by finding the nearest pixel value to the image pixel point
during interpolation. This interpolation method has fast computation
speed and can quickly produce results. However, it has the disadvantage
of poor interpolation effect. Since the pixel values of the nearest
pixel points are directly used as the interpolation data, severe
aliasing occurs in areas with color changes such as image edges and
transitions. <img
src="https://s1.ax1x.com/2020/03/13/8u4Uwn.png?x-oss-process=style/webp"
alt="Nearest Neighbor Interpolation" /></p>
<p>The implementation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">        <span class="keyword">if</span> i&lt;=<span class="number">2044</span> <span class="keyword">and</span> j&lt;=<span class="number">2044</span>:</span><br><span class="line">            result[i][j]=img[<span class="built_in">round</span>(i/<span class="number">4</span>)][<span class="built_in">round</span>(j/<span class="number">4</span>)][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[i][j]=img[math.floor(i/<span class="number">4</span>)][math.floor(j/<span class="number">4</span>)][<span class="number">0</span>]</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,result)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="bilinear-interpolation">Bilinear Interpolation</h2>
<p>Bilinear interpolation uses a linear method to interpolate the image.
For a certain pixel point in the interpolated image, its pixel value is
obtained by linear calculation based on the four nearest pixel values.
The interpolation result is good, and the computational complexity is
less than that of nearest neighbor interpolation, but much faster than
bicubic interpolation. The final interpolated image result is comparable
to that obtained by bicubic interpolation, except for some small
details. It can be used to quickly interpolate a large number of images.
<img
src="https://s1.ax1x.com/2020/03/13/8u5o40.png?x-oss-process=style/webp"
alt="Bilinear Interpolation" /></p>
<p>The implementation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">        <span class="keyword">if</span> i&lt;<span class="number">2044</span> <span class="keyword">and</span> j&lt;<span class="number">2044</span>:</span><br><span class="line">            l=i//<span class="number">4</span></span><br><span class="line">            k=j//<span class="number">4</span></span><br><span class="line">            a=i/<span class="number">4</span>-i//<span class="number">4</span></span><br><span class="line">            b=j/<span class="number">4</span>-j//<span class="number">4</span></span><br><span class="line">            result[i][j]=img[l][k][<span class="number">0</span>]*(<span class="number">1</span>-a)*(<span class="number">1</span>-b)+img[l+<span class="number">1</span>][k][<span class="number">0</span>]*a*(<span class="number">1</span>-b)+img[l][k+<span class="number">1</span>][<span class="number">0</span>]*(<span class="number">1</span>-a)*b+img[l+<span class="number">1</span>][k+<span class="number">1</span>][<span class="number">0</span>]*a*b</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[i][j]=img[i//<span class="number">4</span>][j//<span class="number">4</span>][<span class="number">0</span>]</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,result)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>Nearest neighbor interpolation is used at the image edges.</p>
<h2 id="bicubic-interpolation">Bicubic Interpolation</h2>
<p>Bicubic interpolation uses a non-linear calculation method to
calculate the pixel values of the image using cubic functions. Each
pixel value is calculated based on the pixel values of the surrounding
4x4, which is 16 pixel points. The interpolation quality is high, but
the computation speed is slow. The interpolation method used by
Photoshop is bicubic interpolation. <span class="math display">\[
f_3(x,y)=\sum_{i=0}^3\sum_{j=0}^3a_{ij}x_iy_i
\]</span></p>
<p>The implementation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">weight</span>(<span class="params">x</span>):</span><br><span class="line">    a=-<span class="number">0.5</span></span><br><span class="line">    x=<span class="built_in">abs</span>(x)</span><br><span class="line">    <span class="keyword">if</span> x&lt;=<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span>  (a+<span class="number">2</span>)*x**<span class="number">3</span>-(a+<span class="number">3</span>)*x**<span class="number">2</span>+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> x&lt;<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> a*x**<span class="number">3</span>-<span class="number">5</span>*a*x**<span class="number">2</span>+<span class="number">8</span>*a*x-<span class="number">4</span>*a</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):</span><br><span class="line">        <span class="keyword">if</span> i&gt;<span class="number">4</span> <span class="keyword">and</span> i&lt;<span class="number">2040</span> <span class="keyword">and</span> j&gt;<span class="number">4</span> <span class="keyword">and</span> j&lt;<span class="number">2040</span>:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                    result[i][j]+=img[i//<span class="number">4</span>+k-<span class="number">1</span>][j//<span class="number">4</span>+w-<span class="number">1</span>][<span class="number">0</span>]*weight(i/<span class="number">4</span>-(i//<span class="number">4</span>+k-<span class="number">1</span>))*weight(j/<span class="number">4</span>-(j//<span class="number">4</span>+w-<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[i][j]=img[i//<span class="number">4</span>][j//<span class="number">4</span>][<span class="number">0</span>]</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,result)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="conclusion">Conclusion</h2>
<p>These three interpolation methods are traditional methods for image
interpolation. The improvement of resolution is based on the
comprehensive calculation of local pixels to obtain the pixel values of
blank pixels. Such interpolation methods can meet the needs of most
contemporary society. However, if better interpolation effects are
pursued, or if the image resolution needs to be increased by tens of
times, such interpolation methods cannot meet the requirements. In this
case, other methods such as machine learning need to be used to improve
image quality.</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>插值</tag>
      </tags>
  </entry>
  <entry>
    <title>Digital Image Processing (II) Image Registration.</title>
    <url>/en/3cac2a44.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/3cac2a44.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Image registration refers to the process of transforming the
coordinates of two or more images that have similar content but differ
in aspects like angle, size, or geometric position. This transformation
aims to align these images to the same standardized size, angle, and
coordinates.</p>
<p>Image registration finds extensive applications in image stitching,
creating panoramic images, and environmental recognition. Its principle
is simple, utilizing matrix operations for fast transformation. With
appropriately selected mapping points, registration yields excellent
results. The specific transformation method is outlined as follows:</p>
<h3 id="registration-algorithm">Registration Algorithm</h3>
<blockquote>
<p>Taking image A as the reference for registering image B.</p>
</blockquote>
<p>Selecting n pixels in image A: <span class="math display">\[
p_1(x_1,y_1,1),p_2(x_2,y_2,1),...,p_n(x_n,y_n,1)
\]</span> Forms a coordinate matrix: <span class="math display">\[
P=\begin{bmatrix}x_1 &amp;x_2
&amp;...&amp;x_n\\y_1&amp;y_2&amp;...&amp;y_n\\1&amp;1&amp;...&amp;1\end{bmatrix}
\]</span> Selecting n pixels corresponding to these n points in image B:
<span class="math display">\[
q_1(x_1,y_1),q_2(x_2,y_2),...,q_n(x_n,y_n)
\]</span> Forms another coordinate matrix: <span class="math display">\[
Q=\begin{bmatrix}x_1 &amp;x_2
&amp;...&amp;x_n\\y_1&amp;y_2&amp;...&amp;y_n\\1&amp;1&amp;...&amp;1\end{bmatrix}
\]</span></p>
<blockquote>
<p>If image B can be translated, rotated, and scaled to match image A,
then there exists a transformation matrix H such that: <span
class="math display">\[
Q=HP
\]</span> Thus, if the transformation matrix H can be computed, we can
use the following formula: <span class="math display">\[
H^{-1}Q=P
\]</span> Mapping each pixel in image B to the corresponding position in
image A, thereby obtaining image B registered with image A as the
template.</p>
</blockquote>
<mark class="label success">How to compute the transformation matrix H?</mark>
<p>Given the point sets P and Q already selected in images A and B, it's
evident that <span class="math display">\[
H=QP^{-1}
\]</span></p>
<blockquote>
<p>As P is not a square matrix, it cannot be inverted directly. Here, we
find the pseudo-inverse.</p>
</blockquote>
<p>At this point, we've outlined the basic process of image
registration:</p>
<ul>
<li>Select corresponding point sets $ P $ and $ Q $ in the template
image and the image to be registered.</li>
<li>Compute the transformation matrix $ H $ using the formula $
H=QP^{-1} $.</li>
<li>Map the image to be registered onto the template image using the
transformation matrix.</li>
</ul>
<h3 id="registration-example">Registration Example</h3>
<p>For instance: using image A as the template to register image B:</p>
<p><img
src="https://download.kezhi.tech/img/20200429001311.jpg?x-oss-process=style/webp"
alt="Image A" /> <img
src="https://download.kezhi.tech/img/Image%20B.jpg?x-oss-process=style/webp"
alt="Image B" /></p>
<p>Selecting seven points within them, distributed as follows:</p>
<blockquote>
<p>Note: The coordinate system displayed by the drawing tool is opposite
to the (x, y) coordinates. Pay attention when recording coordinates.</p>
</blockquote>
<p><img
src="https://download.kezhi.tech/img/Image%20A(选点).jpg?x-oss-process=style/webp"
alt="Selected Points (Image A)" /> <span class="math display">\[
P=\begin{bmatrix}1448&amp;1694&amp;1756&amp;383&amp;2290&amp;2035&amp;2150\\1308&amp;1198&amp;2744&amp;2516&amp;933&amp;2693&amp;1968\\1&amp;1&amp;1&amp;1&amp;1&amp;1&amp;1\end{bmatrix}
\]</span></p>
<p><span class="math display">\[
Q=\begin{bmatrix}1042&amp;1252&amp;1708&amp;323&amp;1761&amp;1966&amp;1890\\1077&amp;907&amp;2387&amp;2519&amp;498&amp;2265&amp;1535\\1&amp;1&amp;1&amp;1&amp;1&amp;1&amp;1\end{bmatrix}
\]</span></p>
<p>The computed transformation matrix: <span class="math display">\[
H=QP^{-1}=\begin{bmatrix}0.9668&amp;0.2565&amp;693.0275\\-0.2570&amp;0.9671&amp;184.1373\\0.0000&amp;0.0000&amp;1.0000\end{bmatrix}
\]</span> Transforming image B using the transformation matrix yields
the following result: <img
src="https://download.kezhi.tech/img/result.jpg?x-oss-process=style/webp"
alt="Registered Image B" /></p>
<p>Source Code:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">imgA=cv.imread(<span class="string">&quot;Image A.jpg?x-oss-process=style/webp&quot;</span>)</span><br><span class="line">imgB=cv.imread(<span class="string">&quot;Image B.jpg?x-oss-process=style/webp&quot;</span>)</span><br><span class="line">point_A=np.array([[<span class="number">1448</span>,<span class="number">1694</span>,<span class="number">1756</span>,<span class="number">383</span>,<span class="number">2290</span>,<span class="number">2035</span>,<span class="number">2150</span>],[<span class="number">1308</span>,<span class="number">1198</span>,<span class="number">2744</span>,<span class="number">2516</span>,<span class="number">933</span>,<span class="number">2693</span>,<span class="number">1968</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">point_B=np.array([[<span class="number">1042</span>,<span class="number">1252</span>,<span class="number">1708</span>,<span class="number">323</span>,<span class="number">1761</span>,<span class="number">1966</span>,<span class="number">1890</span>],[<span class="number">1077</span>,<span class="number">907</span>,<span class="number">2387</span>,<span class="number">2519</span>,<span class="number">498</span>,<span class="number">2265</span>,<span class="number">1535</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">H=np.dot(point_B,np.linalg.pinv(point_A))</span><br><span class="line"><span class="built_in">print</span>(H)</span><br><span class="line">shape_A=imgA.shape</span><br><span class="line">shape_B=imgB.shape</span><br><span class="line">result,mistake=np.zeros(shape_A),np.zeros(shape_A)</span><br><span class="line">result=result.astype(np.uint8)</span><br><span class="line">mistake=mistake.astype(np.uint8)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape_A[<span class="number">0</span>]):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape_A[<span class="number">1</span>]):</span><br><span class="line">        address=np.dot(H,np.array([i,j,<span class="number">1</span>]))</span><br><span class="line">        address=address.astype(np.<span class="built_in">int</span>)</span><br><span class="line">        <span class="keyword">if</span> address[<span class="number">0</span>]&gt;<span class="number">0</span> <span class="keyword">and</span> address[<span class="number">0</span>]&lt;shape_B[<span class="number">0</span>] <span class="keyword">and</span> address[<span class="number">1</span>]&gt;<span class="number">0</span> <span class="keyword">and</span> address[<span class="number">1</span>]&lt;shape_B[<span class="number">1</span>]:</span><br><span class="line">            result[i][j]=imgB[address[<span class="number">0</span>]][address[<span class="number">1</span>]]</span><br><span class="line">            mistake[i][j]=imgA[i][j]-result[i][j]</span><br><span class="line">cv.namedWindow(<span class="string">&quot;test&quot;</span>,cv.WINDOW_NORMAL)</span><br><span class="line">cv.imshow(<span class="string">&quot;test&quot;</span>,mistake)</span><br><span class="line">cv.waitKey(<span class="number">0</span>)</span><br><span class="line">cv.imwrite(<span class="string">&quot;result.jpg?x-oss-process=style/webp&quot;</span>,result)</span><br><span class="line">cv.imwrite(<span class="string">&quot;mistake.jpg?x-oss-process=style/webp&quot;</span>,mistake)</span><br></pre></td></tr></table></figure>
<h3 id="conclusion">Conclusion</h3>
<p>The image registration algorithm is relatively straightforward. With
well-selected coordinate points, the computed registration results are
commendable. However, manual point selection was employed in this
instance. For large-scale or real-time image registration, automated
point selection becomes essential. Thus, devising a method for the
program to select appropriate and corresponding point sets poses a
challenge in image registration.</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>图像配准</tag>
      </tags>
  </entry>
  <entry>
    <title>Digital Image Processing (III) Histogram Equalization.</title>
    <url>/en/a6c8a314.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/a6c8a314.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>In digital image processing, histogram equalization is a common
practice used to adjust brightness, contrast, and image sharpening. It
involves statistical analysis of the histogram of different colors in an
image, followed by remapping the colors based on this analysis to
achieve the desired adjustments in contrast and sharpness.</p>
<h2 id="histogram-of-digital-images">1. Histogram of Digital Images</h2>
<p>A histogram refers to the statistical analysis of all the pixel
colors in an entire image, presenting the statistical data of different
colors in the form of a histogram.</p>
<p>For example, consider the following two images:</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/citywall.bmp" title="citywall" width="350"/><br />
<img src="https://download.kezhi.tech/img/citywall2.bmp" title="citywall1" width="350"/>
</figure>
<p>Their corresponding histograms are:</p>
<figure class="half">
<img src="https://download.kezhi.tech/img/image-20200320133506122.png?x-oss-process=style/webp" title="bar_citywall" width="350"/>
<img src="https://download.kezhi.tech/img/image-20200320133652064.png?x-oss-process=style/webp" title="bar_citywall1" width="350"/>
</figure>
<p>From these figures, it can be observed that an image with high
contrast has a wider distribution of colors, while an image with low
contrast has colors concentrated in a specific region. In the second
image, the pixel values are concentrated on a single color, resulting in
image blurring.</p>
<p>Using image histograms, the color distribution of an image can be
clearly understood, providing guidance on how to enhance images and
improve contrast.</p>
<h2 id="histogram-equalization">2. Histogram Equalization</h2>
<p>Histogram equalization, as the name suggests, aims to equalize the
color distribution in an image histogram. Specifically, it redistributes
colors that were previously too concentrated in the histogram, spreading
them out to occupy the appropriate pixel values. The specific method is
as follows (using 3-bit 8-color as an example):</p>
<p>Consider a 64x64 pixel image (M=64, N=64, MN=4096) with 3 bits (L=8)
representing colors, ranging from [0,L-1], i.e., [0,7]. By performing
statistical analysis on the pixel values of the entire image, we obtain
the following statistical data:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><span
class="math inline">\(r_k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(n_k\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(p_r(r_k)=n_k/MN\)</span></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>直方图均衡</tag>
      </tags>
  </entry>
  <entry>
    <title>Digital Image Processing (6) Frequency Domain Filters.</title>
    <url>/en/b8e0d4a2.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/b8e0d4a2.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="introduction-to-frequency-domain-filters">Introduction to
Frequency Domain Filters</h2>
<p>Frequency domain filters are different from spatial domain filters.
Spatial domain filters perform convolution operations between spatial
convolution kernels and spatial images, while frequency domain filters
perform multiplication operations between the frequency domain image
obtained by discrete Fourier transform (DFT) and the filter in the
frequency domain, and then perform inverse Fourier transform (IDFT) to
obtain the filtered image.</p>
<p>The basic steps of using frequency domain filters to filter images
are as follows:</p>
<ul>
<li>Perform DFT on the image to obtain the frequency domain image of the
original image.</li>
<li>Multiply the frequency domain image by the frequency domain filter
to obtain a new frequency domain image.</li>
<li>Perform IDFT on the new frequency domain image to obtain a new image
in the spatial domain.</li>
</ul>
<span id="more"></span>
<blockquote>
<p>There are several things to note:</p>
<ul>
<li>When performing DFT, the original image is extended periodically in
the spatial domain. If the original image is directly used for DFT, the
DFT result will be calculated based on the original image surrounding
the four sides. Therefore, to eliminate the edge effects of the filtered
result, the image can be transformed to four times the size of the
original image, and the original image is placed in the upper left
corner of the four times image, with zero padding in other places.</li>
<li>For convenience of calculation, the origin (0,0) of the frequency
domain image is generally placed at the center of the image. However,
the (0,0) point of the frequency domain image obtained by directly
performing DFT on the image is located at the four corners of the image.
To move the (0,0) point of the frequency domain image, each pixel of the
spatial domain image should be multiplied by <span
class="math inline">\((-1)^{i+j}\)</span> before DFT (<span
class="math inline">\(i\)</span> and <span
class="math inline">\(j\)</span> are the horizontal and vertical
coordinates with the upper left corner of the image as the origin and
the right and down directions as positive directions). Of course, this
operation is performed during the transformation, and it should be
restored after the inverse transformation.</li>
</ul>
</blockquote>
<p>The function for zero-padding the image, performing DFT, and
transforming the center of the frequency domain image is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fft</span>(<span class="params">img</span>):       <span class="comment"># Perform 2D fast Fourier transform on the image</span></span><br><span class="line">    shape = img.shape</span><br><span class="line">    new_img = np.zeros((shape[<span class="number">0</span>]*<span class="number">2</span>, shape[<span class="number">1</span>]*<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            new_img[i][j] = img[i][j] * (-<span class="number">1</span>)**(i+j)</span><br><span class="line">    fimg = np.fft.fft2(new_img)</span><br><span class="line">    <span class="keyword">return</span> fimg</span><br></pre></td></tr></table></figure>
<p>The function for performing the corresponding inverse transformation
on the frequency domain image is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ifft</span>(<span class="params">f_img</span>):    <span class="comment"># Perform 2D inverse Fourier transform</span></span><br><span class="line">    img = np.real(np.fft.ifft2(f_img))</span><br><span class="line">    shape = img.shape</span><br><span class="line">    new_img = np.zeros((shape[<span class="number">0</span>]//<span class="number">2</span>, shape[<span class="number">1</span>]//<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]//<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]//<span class="number">2</span>):</span><br><span class="line">            new_img[i][j] = img[i][j] * (-<span class="number">1</span>)**(i+j)</span><br><span class="line">    new_img = new_img - np.<span class="built_in">min</span>(new_img)</span><br><span class="line">    new_img = new_img / np.<span class="built_in">max</span>(new_img) * <span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> new_img.astype(np.uint8)</span><br></pre></td></tr></table></figure>
<h2 id="frequency-domain-low-pass-filters">Frequency Domain Low Pass
Filters</h2>
<p>As the name suggests, a low pass filter allows low frequencies to
pass through and blocks high frequencies. If the origin of the frequency
domain is placed at the center of the image, the ideal low pass filter
is represented as:</p>
<p><img src="https://download.kezhi.tech/img/20200508194306.bmp" /></p>
<p>However, this filter is discontinuous at the boundaries, making it
impossible to implement with physical devices. Even if it is simulated
on a computer, it will still have some impact on the image. Therefore,
this ideal filter is generally not used.</p>
<h3 id="gaussian-low-pass-filter">Gaussian Low Pass Filter</h3>
<p>The Gaussian low pass filter (GLPF) is one of the most commonly used
low pass filters. It is generated by a two-dimensional Gaussian
function, and its mathematical expression is: <span
class="math display">\[
H(u,v)=e^{-D^2(u,v)/2D_0 ^2}
\]</span> where <span class="math inline">\(D(u,v)\)</span> is the
distance from a point in the image to the center of the image, and <span
class="math inline">\(D_0\)</span> is the cutoff frequency. When <span
class="math inline">\(D(u,v)=D_0\)</span>, the GLPF drops to 0.607,
which is its maximum value. The filter is represented by the following
images (with cutoff frequencies of 10, 30, and 60):</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508195417.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508195511.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508195551.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>The function for generating the Gaussian filter is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">shape, D0</span>):    <span class="comment"># Generate a Gaussian low pass filter with a cutoff frequency of D0</span></span><br><span class="line">    filt = np.zeros(shape)</span><br><span class="line">    P, Q = shape[<span class="number">0</span>], shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D2 = (i - P//<span class="number">2</span>)**<span class="number">2</span> + (j - Q//<span class="number">2</span>)**<span class="number">2</span></span><br><span class="line">            filt[i][j] = math.exp(-D2 / (<span class="number">2</span> * D0**<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>The filtered image using the Gaussian low pass filter is as follows
(original image, Gaussian filters with radii of 10 and 20):</p>
<table>
<tr>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195837.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195909.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195923.jpg?x-oss-process=style/webp"></cneter>
</td>
</tr>
</table>
<p>The function for filtering the image using the Gaussian low pass
filter is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gaussian</span>(<span class="params">img, D0</span>):  <span class="comment"># Filter the image using a Gaussian low pass filter of order n and cutoff frequency D0</span></span><br><span class="line">    f_img = fft(img)</span><br><span class="line">    shape = f_img.shape</span><br><span class="line">    f_result = f_img * gauss_filter(shape, D0)</span><br><span class="line">    <span class="keyword">return</span> ifft(f_result)</span><br></pre></td></tr></table></figure>
<h3 id="butterworth-low-pass-filter">Butterworth Low Pass Filter</h3>
<p>The transfer function of an <span class="math inline">\(n\)</span>-th
order Butterworth low pass filter (BLPF) with a cutoff frequency at a
distance of <span class="math inline">\(D_0\)</span> from the origin is
defined as: <span class="math display">\[
H(u,v)=\frac 1{1+[D(u,v)/D_0]^{2n}}
\]</span> The Butterworth filter is represented by the following images
(with <span class="math inline">\(n=1,2,5\)</span>):</p>
<table>
<tr>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508203825.bmp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508203838.bmp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508203853.bmp"></cneter>
</td>
</tr>
</table>
<p>The function for generating the Butterworth filter is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">butter_filter</span>(<span class="params">shape, n, D0</span>):   <span class="comment"># Generate an n-th order Butterworth low pass filter with a radius of D0</span></span><br><span class="line">    filt = np.zeros(shape)</span><br><span class="line">    P, Q = shape[<span class="number">0</span>], shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D = math.sqrt((i - P//<span class="number">2</span>)**<span class="number">2</span> + (j - Q//<span class="number">2</span>)**<span class="number">2</span>)</span><br><span class="line">            filt[i][j] = <span class="number">1</span> / (<span class="number">1</span> + (D / D0)**(<span class="number">2</span> * n))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>The filtered image using the Butterworth low pass filter is as
follows (original image, Butterworth filters with orders of 3 and radii
of 10 and 20):</p>
<table>
<tr>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508195837.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508204916.jpg?x-oss-process=style/webp"></cneter>
</td>
<td>
<cneter><img src="https://download.kezhi.tech/img/20200508204931.jpg?x-oss-process=style/webp"></cneter>
</td>
</tr>
</table>
<p>The function for filtering the image using the Butterworth low pass
filter is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">butterwroth</span>(<span class="params">img, n, D0</span>):  <span class="comment"># Filter the image using an n-th order Butterworth filter with a cutoff frequency D0</span></span><br><span class="line">    f_img = fft(img)</span><br><span class="line">    shape = f_img.shape</span><br><span class="line">    f_result = f_img * butter_filter(shape, n, D0)</span><br><span class="line">    <span class="keyword">return</span> ifft(f_result)</span><br></pre></td></tr></table></figure>
<h2 id="frequency-domain-high-pass-filters">Frequency Domain High Pass
Filters</h2>
<p>In contrast to low pass filters, high pass filters block low
frequencies and allow high frequencies to pass through. The ideal high
pass filter is represented as:</p>
<p><img src="https://download.kezhi.tech/img/20200508205640.bmp" /></p>
<h3 id="gaussian-high-pass-filter">Gaussian High Pass Filter</h3>
<p>The Gaussian high pass filter (GHPF) with a cutoff frequency of <span
class="math inline">\(D_0\)</span> is defined as: <span
class="math display">\[
H(u,v)=1-e^{-D^2(u,v)/2D_0 ^2}
\]</span> The filter is represented by the following images (with image
size of 200*200 and cutoff frequencies of 5, 10, and 30):</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210105.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210119.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210127.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>The function for generating the Gaussian high pass filter is as
follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">shape, D0</span>):    <span class="comment"># Generate an n-th order Gaussian high pass filter with a cutoff frequency of D0</span></span><br><span class="line">    filt = np.zeros(shape)</span><br><span class="line">    P, Q = shape[<span class="number">0</span>], shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D2 = (i - P//<span class="number">2</span>)**<span class="number">2</span> + (j - Q//<span class="number">2</span>)**<span class="number">2</span></span><br><span class="line">            filt[i][j] = <span class="number">1</span> - math.exp(-D2 / (<span class="number">2</span> * D0**<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>The filtered image using the Gaussian high pass filter is as follows
(original image, Gaussian filters with radii of 10 and 30):</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210619.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210648.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210700.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h3 id="butterworth-high-pass-filter">Butterworth High Pass Filter</h3>
<p>The <span class="math inline">\(n\)</span>-th order Butterworth high
pass filter (BHPF) with a cutoff frequency at a distance of <span
class="math inline">\(D_0\)</span> from the origin is defined as: <span
class="math display">\[
H(u,v)=\frac 1{1+[D_0/D(u,v)]^{2n}}
\]</span> The filter is represented by the following images (with image
size of 200*200, cutoff frequency of 10, and orders of 1, 2, and 4):</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211205.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211217.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211330.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>The function for generating the Butterworth high pass filter is as
follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">butter_filter</span>(<span class="params">shape, n, D0</span>):   <span class="comment"># Generate an n-th order Butterworth high pass filter with a radius of D0</span></span><br><span class="line">    filt = np.zeros(shape)</span><br><span class="line">    P, Q = shape[<span class="number">0</span>], shape[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            D = math.sqrt((i - P//<span class="number">2</span>)**<span class="number">2</span> + (j - Q//<span class="number">2</span>)**<span class="number">2</span>) + <span class="number">0.01</span></span><br><span class="line">            filt[i][j] = <span class="number">1</span> / (<span class="number">1</span> + (D0 / D)**(<span class="number">2</span> * n))</span><br><span class="line">    <span class="keyword">return</span> filt</span><br></pre></td></tr></table></figure>
<p>The filtered image using the Butterworth high pass filter is as
follows (original image, Butterworth filters with orders of 3 and radii
of 10 and 30):</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508210619.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211615.jpg?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200508211630.jpg?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h2 id="references">References</h2>
<p>[1] Rafael C. Gonzalez and Richard E. Woods, "Digital Image
Processing", 3rd Edition, Beijing: Publishing House of Electronics
Industry, 2017.5</p>
<p>[2] lcxxcl_1234, "numpy中的fft和scipy中的fft，fftshift以及fftfreq"
[Online]. CSDN: 2018-07-02 [2020-04-05]. Available:
https://blog.csdn.net/lcxxcl_1234/article/details/80889783</p>
<p>[3] Ke Ming Fang, "The Difference Between Power Spectrum and
Frequency Spectrum" [Online]. CSDN: 2017-08-10 [2020-04-06]. Available:
https://blog.csdn.net/godloveyuxu/article/details/77030793</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>滤波器</tag>
        <tag>频域</tag>
      </tags>
  </entry>
  <entry>
    <title>Spatial High-pass Filters.</title>
    <url>/en/bbc72bae.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/bbc72bae.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>High-pass filters are often used to enhance images and extract edge
information. They have a wide range of applications in image processing
and image recognition. The main types of high-pass filters are as
follows: unsharp mask, Sobel operator, Laplacian operator, and Canny
algorithm.</p>
<h2 id="unsharp-mask">Unsharp Mask</h2>
<p>This algorithm is often used for image enhancement and is not
commonly used for edge extraction. The implementation method is as
follows:</p>
<ul>
<li>For the original image <span class="math inline">\(f(x,y)\)</span>,
apply Gaussian blur to obtain the smoothed image <span
class="math inline">\(\overline{f(x,y)}\)</span>.</li>
<li>Take the difference between the original image and the smoothed
image to obtain the mask <span
class="math inline">\(g_{mask}(x,y)=f(x,y)-\overline{f(x,y)}\)</span>.</li>
<li>Add the original image and k times the mask to obtain the enhanced
image <span
class="math inline">\(g(x,y)=f(x,y)+k*g_{mask}(x,y)\)</span>.</li>
<li>Generally, the value of k is set to 1 for image enhancement. If k is
greater than 1, it is a high-boost image.</li>
</ul>
<p>The image processing effect of this algorithm is as follows:</p>
<blockquote>
<p>From left to right: original image, obtained mask (normalized to
0-255), enhanced image</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141251.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141327.bmp">
</center>
</td>
</tr>
</table>
<p>From the results in the above figure, it can be seen that the mask
image has high brightness at the edges and low brightness elsewhere.
After overlaying with the original image, the brightness of the original
image's edges becomes larger. In this case, the method used here is to
normalize the overlaid image as a whole and then multiply it by 255 to
obtain an integer value. Because the brightness of the original image's
edges is large after overlaying with the mask, the bright parts in the
original image become darker after normalization. If another method is
used, such as treating values greater than 255 as 255 and values less
than 0 as 0, it can effectively solve this problem, but the edges of the
image will not be as obvious as the previous method. The specific method
to be used depends on the actual situation.</p>
<h2 id="sobel-operator">Sobel Operator</h2>
<p>The Sobel operator is often used for edge extraction in images. It
uses the first-order derivative of the image to extract edges, which is
denoted as <span class="math inline">\(\nabla f\)</span>.</p>
<p>We know that the gradient of a binary function consists of the
directional derivatives in the x and y directions. The Sobel operator is
the same, with two operators for the x and y directions, respectively,
as follows: <span class="math display">\[
\begin{bmatrix}-1&amp;0&amp;1\\-1&amp;0&amp;2\\-1&amp;0&amp;1\end{bmatrix}
~~~~~~~~~~\begin{bmatrix}-1&amp;-2&amp;-1\\0&amp;0&amp;0\\1&amp;2&amp;1\end{bmatrix}
\]</span></p>
<ul>
<li>Convolve the image with the above two operators separately to obtain
the x-direction and y-direction edges <span
class="math inline">\(G_x\)</span> and <span
class="math inline">\(G_y\)</span>.</li>
<li>The first-order derivative of the image <span
class="math inline">\(G\)</span> can be calculated using <span
class="math inline">\(G_x\)</span> and <span
class="math inline">\(G_y\)</span>, which is <span
class="math inline">\(G=\sqrt{G_x^2+G_y^2}\)</span>. Sometimes, for fast
calculation, <span class="math inline">\(G=|G_x|+|G_y|\)</span> or <span
class="math inline">\(G=max\{|G_x|,|G_y|\}\)</span> can be used.</li>
<li>Normalize G to the range of 0-255 to obtain the Sobel edges of the
image.</li>
</ul>
<blockquote>
<p>From left to right: original image, x-direction edges, y-direction
edges, Sobel edges</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330143516.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330143622.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330143708.bmp">
</center>
</td>
</tr>
</table>
<p>The Sobel operator performs well in extracting obvious edges in
images and also performs well in extracting detailed edges in images.
This can be illustrated by the processing results of another image:</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330144324.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330144413.bmp">
</center>
</td>
</tr>
</table>
<p>It can be seen that even the small edge contours on the chimney are
well represented by the edges extracted by the Sobel operator.</p>
<h2 id="laplacian-operator">Laplacian Operator</h2>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172117.bmp">
</center>
</td>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172117.bmp" >
</center>
</td>
</center>
</td>
</tr>
</table>
<p><span class="math display">\[
[f(x+1)-f(x)]-[f(x)-f(x-1)]=f(x+1)+f(x-1)-2f(x)
\]</span> From this, the Laplacian operator can be derived as: <span
class="math display">\[
\begin{bmatrix}0&amp;1&amp;0\\1&amp;-4&amp;1\\0&amp;1&amp;0\end{bmatrix}
\]</span> Sometimes, the second-order derivative in the diagonal
direction is also added, and the operator becomes: <span
class="math display">\[
\begin{bmatrix}1&amp;1&amp;1\\1&amp;-8&amp;1\\1&amp;1&amp;1\end{bmatrix}
\]</span> In practice, the following two operators are often used: <span
class="math display">\[
\begin{bmatrix}0&amp;-1&amp;0\\-1&amp;4&amp;-1\\0&amp;-1&amp;0\end{bmatrix}
\begin{bmatrix}-1&amp;-1&amp;-1\\-1&amp;8&amp;-1\\-1&amp;-1&amp;-1\end{bmatrix}
\]</span></p>
<blockquote>
<p>Assuming that the extracted image edges are <span
class="math inline">\(L(x,y)\)</span>, the algorithm for image
enhancement is <span
class="math inline">\(g(x,y)=f(x,y)+c*L(x,y)\)</span></p>
<p>If the above two operators are used to extract the edges, c=-1; if
the following two operators are used, c=1.</p>
</blockquote>
<p>The image edge information extracted using the Laplacian operator is
as follows:</p>
<blockquote>
<p>From left to right: original image, Laplacian edges without diagonal,
Laplacian edges with diagonal</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330145641.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330145657.bmp">
</center>
</td>
</tr>
</table>
<p>The edges extracted by the Laplacian operator have two edge lines at
each edge, which is determined by the properties of its second-order
derivative. Compared with the edges extracted by the Sobel operator, the
Laplacian edges are more detailed and capture the "edges of edges". This
can be seen more clearly from the comparison in the following
figure:</p>
<blockquote>
<p>The left side is the result of the Sobel operator, and the right side
is the result of the Laplacian operator</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330144413.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330150103.bmp">
</center>
</td>
</tr>
</table>
<p>For slightly more complex images, the edges extracted by the
Laplacian operator are too detailed, making it difficult to see many
areas clearly, which poses some difficulties for human visual
perception. However, in some image recognition fields, such as using
satellite images to identify ground vehicles, the vehicles on the ground
are often small color blocks, and the Laplacian operator can well
outline the edge contours and some details inside these vehicles. The
Sobel operator is not as effective in capturing these internal details.
At the same time, the property of "edges of edges" makes the edges
extracted by the Laplacian operator suitable for image enhancement.</p>
<h2 id="canny-algorithm">Canny Algorithm</h2>
<p>The Canny algorithm is an optimization of the Sobel edge extraction.
The Sobel operator represents all edges in the final image, regardless
of their strength. This results in many invalid edges being extracted
and displayed in the resulting image. The basic idea of the Canny
algorithm is to filter out these edge information and only keep the
pixels that are most likely to be edges. The implementation method is as
follows:</p>
<ul>
<li>Similar to the Sobel operator, calculate <span
class="math inline">\(G_x\)</span> and <span
class="math inline">\(G_y\)</span>.</li>
<li>Calculate the weight <span
class="math inline">\(weight=\sqrt{G_x^2+G_y^2}\)</span> and the angle
<span class="math inline">\(angle=atan\frac{G_y}{G_x}\)</span> for each
pixel based on <span class="math inline">\(G_x\)</span> and <span
class="math inline">\(G_y\)</span>.</li>
<li>Discretize the angle to the nearest multiple of <span
class="math inline">\(45^o\)</span>.</li>
<li>For each pixel <span class="math inline">\((x,y)\)</span> in the
image, compare its weight <span
class="math inline">\(weight(x,y)\)</span> with the weights of the two
pixels in the <span class="math inline">\(angle(x,y)\)</span> direction
and <span class="math inline">\(-angle(x,y)\)</span> direction. If the
weight of the pixel is not the largest, set it to 0.</li>
<li>Double threshold detection: set upper and lower thresholds for the
brightness of the edges, and perform another filtering on the edges of
the image. Finally, normalize the edge information to the range of
0-255. The thresholds can be manually set.</li>
</ul>
<blockquote>
<p>From left to right: original image, edges without double threshold
detection, edges with lower threshold of 150, edges with lower threshold
of 200</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330141032.bmp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330151754.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330151852.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200330151924.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<h2 id="appendix">Appendix</h2>
<h3 id="references">References</h3>
<p>[1] Rafael C. Gonzalez and Richard E. Woods, "Digital Image
Processing", 3rd Edition, Beijing: Publishing House of Electronics
Industry, 2017.</p>
<p>[2] Brook_icv, "Image Processing Basics (4): Gaussian Filter Detailed
Explanation" [Online]. Available:
https://www.cnblogs.com/wangguchangqing/p/6407717.html#autoid-4-1-0</p>
<p>[3] Naughty Stone 7788121, "Image Edge Detection: Canny Operator,
Prewitt Operator, and Sobel Operator" [Online]. Available:
https://www.jianshu.com/p/bed4ffe996a1</p>
<h3 id="source-code">Source Code</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">sigma=<span class="number">1.5</span>   <span class="comment"># Parameter of the Gaussian filter</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_zeros</span>(<span class="params">img,edge</span>):    <span class="comment"># Add zeros to the edges of the image</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=np.zeros((shape[<span class="number">0</span>]+<span class="number">2</span>*edge,shape[<span class="number">1</span>]+<span class="number">2</span>*edge))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            temp[i+edge][j+edge]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):     <span class="comment"># Define the 2D Gaussian distribution function</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(math.pi*sigma**<span class="number">2</span>)*math.exp(-(x**<span class="number">2</span>+y**<span class="number">2</span>)/(<span class="number">2</span>*sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">n</span>):   <span class="comment"># Generate an n*n Gaussian filter</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    filt=np.zeros((n,n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            filt[i][j]=f(i-mid,j-mid)/f(-mid,-mid)</span><br><span class="line">    <span class="keyword">return</span> filt.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">img,n</span>):    <span class="comment"># Apply n*n convolutional blocks of Gaussian filtering to the image</span></span><br><span class="line">    filt=gauss(n)</span><br><span class="line">    con=<span class="number">1</span>/np.<span class="built_in">sum</span>(filt)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=add_zeros(img,n//<span class="number">2</span>)</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>],<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            tmp=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    tmp+=filt[k][l]*temp[i+k][j+l]</span><br><span class="line">            result[i][j][<span class="number">0</span>]=con*tmp</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unsharp_mask</span>(<span class="params">img,n,is_mask=<span class="number">0</span></span>):        <span class="comment"># Unsharp mask using n*n Gaussian blur, return the mask if is_mask=1</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    new_img=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>],<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            new_img[i][j][<span class="number">0</span>]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    mask=new_img-gauss_filter(img,n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                mask[i][j][<span class="number">0</span>]=<span class="number">0</span></span><br><span class="line">    result=new_img+mask</span><br><span class="line">    result=result-np.<span class="built_in">min</span>(result)</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    mask=mask-np.<span class="built_in">min</span>(mask)</span><br><span class="line">    mask=mask/np.<span class="built_in">max</span>(mask)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">if</span> is_mask:</span><br><span class="line">        <span class="keyword">return</span> mask.astype(np.uint8)</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line">sobelx=[[-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[-<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>],[-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line">sobely=[[-<span class="number">1</span>,-<span class="number">2</span>,-<span class="number">1</span>],[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>]]</span><br><span class="line">laplace4=[[<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>],[-<span class="number">1</span>,<span class="number">4</span>,-<span class="number">1</span>],[<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>]]</span><br><span class="line">laplace8=[[-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>],[-<span class="number">1</span>,<span class="number">8</span>,-<span class="number">1</span>],[-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filt_3</span>(<span class="params">img,filt</span>):          <span class="comment"># Arbitrary 3*3 filter (image, operator)</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=add_zeros(img,<span class="number">1</span>)</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>],<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            tmp=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                    tmp+=filt[k][l]*temp[i+k][j+l]</span><br><span class="line">            result[i][j][<span class="number">0</span>]=tmp</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">laplace_edge</span>(<span class="params">img,filt</span>): <span class="comment"># Laplacian edges after normalization</span></span><br><span class="line">    tmp=filt_3(img,filt)</span><br><span class="line">    tmp=tmp-np.<span class="built_in">min</span>(tmp)</span><br><span class="line">    shape=tmp.shape</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span> (shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                tmp[i][j][<span class="number">0</span>]=<span class="number">0</span></span><br><span class="line">    tmp=tmp/np.<span class="built_in">max</span>(tmp)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> tmp.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">laplace</span>(<span class="params">img,filt</span>):  <span class="comment"># Overlay of the original image and the Laplacian edges</span></span><br><span class="line">    tmp=filt_3(img,filt)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            result[i][j]=tmp[i][j][<span class="number">0</span>]+img[i][j][<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                result[i][j]=<span class="number">0</span></span><br><span class="line">    result-=np.<span class="built_in">min</span>(result)</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sobel</span>(<span class="params">img</span>):     <span class="comment"># Extract Sobel edges of the image</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    sobx=filt_3(img,sobelx)</span><br><span class="line">    soby=filt_3(img,sobely)</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">or</span> j==<span class="number">0</span> <span class="keyword">or</span> i==shape[<span class="number">0</span>]-<span class="number">1</span> <span class="keyword">or</span> j==shape[<span class="number">1</span>]-<span class="number">1</span>:</span><br><span class="line">                result[i][j]=<span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result[i][j]=math.sqrt(sobx[i][j][<span class="number">0</span>]**<span class="number">2</span>+soby[i][j][<span class="number">0</span>]**<span class="number">2</span>)</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">canny</span>(<span class="params">img,n=<span class="number">3</span></span>):     <span class="comment"># Extract image edges using the Canny algorithm (blur operation using an n*n Gaussian filter)</span></span><br><span class="line">    de=[[<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>],[-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>]]</span><br><span class="line">    shape=img.shape</span><br><span class="line">    tmp=gauss_filter(img,n)</span><br><span class="line">    sobx=filt_3(tmp,sobelx)</span><br><span class="line">    soby=filt_3(tmp,sobely)</span><br><span class="line">    weight,angle,result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>])),np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>])),np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    angle=angle.astype(np.<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            weight[i][j]=math.sqrt(sobx[i][j][<span class="number">0</span>]**<span class="number">2</span>+soby[i][j][<span class="number">0</span>]**<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> sobx[i][j][<span class="number">0</span>]:</span><br><span class="line">                angle[i][j]=<span class="built_in">round</span>((math.atan(soby[i][j][<span class="number">0</span>]/sobx[i][j][<span class="number">0</span>])/(math.pi/<span class="number">4</span>)-<span class="number">0.5</span>))%<span class="number">4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]-<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]-<span class="number">2</span>):</span><br><span class="line">            tmp_i,tmp_j=i+<span class="number">1</span>,j+<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> weight[tmp_i][tmp_j]&lt;=weight[tmp_i+de[angle[tmp_i][tmp_j]][<span class="number">0</span>]][tmp_j+de[angle[tmp_i][tmp_j]][<span class="number">1</span>]] <span class="keyword">and</span> weight[tmp_i][tmp_j]&lt;=weight[tmp_i+de[angle[tmp_i][tmp_j]][<span class="number">2</span>]][tmp_j+de[angle[tmp_i][tmp_j]][<span class="number">3</span>]]:</span><br><span class="line">                result[tmp_i][tmp_j]=<span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result[tmp_i][tmp_j]=weight[tmp_i][tmp_j]</span><br><span class="line">    result=result/np.<span class="built_in">max</span>(result)*<span class="number">255</span></span><br><span class="line">    mean=np.mean(img)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> result[i][j]&lt;<span class="number">100</span>:</span><br><span class="line">                result[i][j]=<span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename=[<span class="string">&quot;test3_corrupt.pgm&quot;</span>,<span class="string">&quot;test4.tif&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_mask.bmp&quot;</span>,unsharp_mask(img,<span class="number">3</span>,<span class="number">1</span>))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_unsharp_mask.bmp&quot;</span>,unsharp_mask(img,<span class="number">3</span>))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_sobel.bmp&quot;</span>,sobel(img))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;_canny.bmp&quot;</span>,canny(img,<span class="number">3</span>))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;laplace4_edge.bmp&quot;</span>,laplace_edge(img,laplace4))</span><br><span class="line">    cv.imwrite(i+<span class="string">&quot;laplace8_edge.bmp&quot;</span>,laplace_edge(img,laplace8))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>空域滤波器</tag>
      </tags>
  </entry>
  <entry>
    <title>Choose an avatar.</title>
    <url>/en/ca112d32.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/ca112d32.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>System: Translate the following text into English:</p>
<iframe src="//kezhi.tech/avatar/" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<span id="more"></span>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a href="https://www.pixiv.net/users/6657532">#Genshin Impact Avatar
- QuAn_'s Illustration - pixiv</a></li>
</ol>
]]></content>
      <categories>
        <category>Collection</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Digital Image Processing (Part 4) Spatial Domain Low-pass Filters.</title>
    <url>/en/29443507.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/29443507.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Low-pass filters are very useful in our daily lives. Image blurring,
image denoising, and image recognition all require the use of low-pass
filters. Low-pass filtering means removing the high-frequency components
(rapidly changing parts) from an image and leaving the low-frequency
components (parts with less noticeable changes). There are two
implementations of filters: spatial domain and frequency domain. Spatial
domain filters operate directly on the spatial image, convolving the
image matrix with the filter kernel to obtain the filtered output.
Frequency domain filters transform the image to the frequency domain
using the Fourier transform and then multiply it with the filter to
obtain the output.</p>
<p>This article mainly introduces spatial domain low-pass filters and
their implementations.</p>
<p>Commonly used spatial domain filters include average filtering,
median filtering, and Gaussian filtering. Here, we mainly introduce
median filtering and Gaussian filtering.</p>
<h2 id="median-filtering">Median Filtering</h2>
<p>As the name suggests, median filtering is a filter based on
statistical methods. The specific implementation method is as follows:
for an n*n median filter, the pixel value of the output image at (x, y)
is equal to the median of all pixel values in the n*n image area
centered at (x, y) in the input image.</p>
<p>The size of the filter can be selected according to different
needs.</p>
<p>The effect of the median filter is as follows:</p>
<blockquote>
<p>The original image, 3*3 median filter, 5*5 median filter, and 7*7
median filter, respectively.</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/tmp.bmp">Original Image
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/test1.pgmcenter-3.bmp" >3*3
Median Filter
</center>
</td>
</tr>
</table>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/test1.pgmcenter-5.bmp">5*5
Median Filter
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/test1.pgmcenter-7.bmp">7*7
Median Filter
</center>
</td>
</tr>
</table>
<p>The original image contains a lot of irregularly distributed noise,
some of which are salt noise, but most of them are sudden impulse noise.
When using a 3*3 median filter, the salt noise has been removed well,
but the impulse noise is still obvious. When using a 5*5 median filter,
the situation of impulse noise has been greatly improved. The 7*7 filter
almost completely removes the noise, but the image is also severely
blurred.</p>
<h2 id="gaussian-filtering">Gaussian Filtering</h2>
<p>Gaussian filtering is a commonly used blurring method in some image
processing software. It is generated by the two-dimensional normal
distribution function: <span
class="math inline">\(p(x,y)=\frac1{2\pi\sigma^2}e^{-\frac{x^2+y^2}{2\sigma^2}}\)</span>.
The specific steps are as follows:</p>
<ul>
<li>To generate an n*n Gaussian filter, set the center of the n-order
simulation to (0,0) and generate the coordinates of other positions in
the matrix.</li>
<li>Substitute the coordinates of each position in the n*n matrix into
the two-dimensional normal distribution function to obtain the value of
each position.</li>
<li>Scale the values in the matrix based on the value of 1 in the upper
left corner of the matrix.</li>
<li>Round the matrix to obtain the n*n Gaussian filter.</li>
</ul>
<blockquote>
<p>The function for generating a Gaussian filter is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">sigma=<span class="number">1.5</span>   <span class="comment"># Parameter of the Gaussian filter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):     <span class="comment"># Define the two-dimensional normal distribution function</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(math.pi*sigma**<span class="number">2</span>)*math.exp(-(x**<span class="number">2</span>+y**<span class="number">2</span>)/(<span class="number">2</span>*sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">n</span>):   <span class="comment"># Generate an n*n Gaussian filter</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    filt=np.zeros((n,n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            filt[i][j]=f(i-mid,j-mid)/f(-mid,-mid)</span><br><span class="line">    <span class="keyword">return</span> filt.astype(np.uint8)</span><br></pre></td></tr></table></figure>
<p>The Gaussian filters of size 3*3, 5*5, and 7*7 are as follows:</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170522.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170620.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170658.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>Their images in the two-dimensional coordinate system are as
follows:</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170756.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170817.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327170835.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
</blockquote>
<p>After obtaining the operator of the Gaussian filter, convolve it with
the input image to obtain the result of the Gaussian filter.</p>
<p>The effect is as follows:</p>
<blockquote>
<p>The original image, 3*3, 5*5, and 7*7 Gaussian filtering results:</p>
</blockquote>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/tmp.bmp">Original Image
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172117.bmp" >3*3
Gaussian
</center>
</td>
</tr>
</table>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172156.bmp">5*5
Gaussian
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20200327172217.bmp">7*7
Gaussian
</center>
</td>
</tr>
</table>
<p>Gaussian blur is more effective in removing salt noise in the image,
but it is more difficult to remove impulse noise. The 7*7 Gaussian
filter still cannot remove the impulse noise in the image. On the other
hand, compared with Gaussian blur, Gaussian blur retains more
information of the image and preserves more details.</p>
<h2 id="appendix">Appendix</h2>
<h3 id="references">References</h3>
<p>[1] Digital Image Processing, Third Edition / (Rafael C. Gonzalez),
translated by Ruan Qiuqi, et al. - Beijing: Electronic Industry Press,
2017.5</p>
<p>[2] Brook_icv. Basic Image Processing (4): Detailed Explanation of
Gaussian Filters [G/OL]. Blog Garden: 2017-02-16 [2020-03-23].
https://www.cnblogs.com/wangguchangqing/p/6407717.html#autoid-4-1-0</p>
<p>[3] Yu Ni Xin An. Methods for Calculating Mean, Median, and Mode in
Numpy [G/OL]. Blog Garden: 2018-11-04 [2020-03-23].
https://www.cnblogs.com/lijinze-tsinghua/p/9905882.html</p>
<h3 id="source-code">Source Code</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">img=cv.imread(<span class="string">&quot;test1.pgm&quot;</span>)</span><br><span class="line"></span><br><span class="line">sigma=<span class="number">1.5</span>   <span class="comment"># Parameter of the Gaussian filter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):     <span class="comment"># Define the two-dimensional normal distribution function</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(math.pi*sigma**<span class="number">2</span>)*math.exp(-(x**<span class="number">2</span>+y**<span class="number">2</span>)/(<span class="number">2</span>*sigma**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss</span>(<span class="params">n</span>):   <span class="comment"># Generate an n*n Gaussian filter</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    filt=np.zeros((n,n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            filt[i][j]=f(i-mid,j-mid)/f(-mid,-mid)</span><br><span class="line">    <span class="keyword">return</span> filt.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gauss_filter</span>(<span class="params">img,n</span>):    <span class="comment"># Perform Gaussian filtering on the image img with an n*n convolution block</span></span><br><span class="line">    filt=gauss(n)</span><br><span class="line">    con=<span class="number">1</span>/np.<span class="built_in">sum</span>(filt)</span><br><span class="line">    shape=img.shape</span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    temp=np.zeros((shape[<span class="number">0</span>]+n-<span class="number">1</span>,shape[<span class="number">1</span>]+n-<span class="number">1</span>))   <span class="comment"># Pad the edges with zeros</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            temp[i+mid][j+mid]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            tmp=<span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    tmp+=filt[k][l]*temp[i+k][j+l]</span><br><span class="line">            result[i][j]=con*tmp</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">center_filter</span>(<span class="params">img, n</span>):  <span class="comment"># Perform low-pass filtering on the image using an n*n median filter</span></span><br><span class="line">    mid=n//<span class="number">2</span></span><br><span class="line">    shape=img.shape</span><br><span class="line">    temp=np.zeros((shape[<span class="number">0</span>]+n-<span class="number">1</span>,shape[<span class="number">1</span>]+n-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            temp[i+mid][j+mid]=img[i][j][<span class="number">0</span>]</span><br><span class="line">    result=np.zeros((shape[<span class="number">0</span>],shape[<span class="number">1</span>]))</span><br><span class="line">    tmp=np.zeros(n*n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    tmp[k*n+l]=temp[i+k][j+l]</span><br><span class="line">            result[i][j]=np.median(tmp)</span><br><span class="line">    <span class="keyword">return</span> result.astype(np.uint8)</span><br><span class="line"></span><br><span class="line">filename=[<span class="string">&quot;test1.pgm&quot;</span>,<span class="string">&quot;test2.tif&quot;</span>]</span><br><span class="line">size=[<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    img=cv.imread(i)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> size:</span><br><span class="line">        cv.imwrite(i+<span class="string">&#x27;gauss-&#x27;</span>+<span class="built_in">str</span>(j)+<span class="string">&#x27;.bmp&#x27;</span>,gauss_filter(img,j))</span><br><span class="line">        cv.imwrite(i+<span class="string">&#x27;center-&#x27;</span>+<span class="built_in">str</span>(j)+<span class="string">&#x27;.bmp&#x27;</span>,center_filter(img,j))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>数字图像</tag>
        <tag>图像处理</tag>
        <tag>空域滤波器</tag>
      </tags>
  </entry>
  <entry>
    <title>Talking About Trust.</title>
    <url>/en/190fc18.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/190fc18.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>It has to be said that trust is something extremely precious and
rare. The reason for its preciousness and rarity is simple - doubt is
easy.</p>
<p><img src="https://download.kezhi.tech/img/202403251731371.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<p>This article defines trust in a simple and intuitive way: for any two
individuals A and B, A trusts that B will/will not do something. For the
sake of simplicity in the following discussion, we will analyze the
scenario of "A trusts that B will not do something," with other
scenarios being similar.</p>
<p>In addition, we make the following assumptions:</p>
<ol type="1">
<li>B doing something will have a significant negative impact on A.</li>
<li>A finds it difficult to directly confirm whether B has done
something.</li>
<li>A cannot determine whether B's statements to A are factual.</li>
<li>A cannot obtain sufficient information to judge whether B has the
motivation to do something.</li>
</ol>
<p>These three assumptions may seem difficult to meet, but in reality,
there are too many similar situations that satisfy these conditions
(e.g., infidelity, betrayal, leaks, PUA, misleading opinions, etc.).</p>
<p>Under the above conditions, we can draw the following
conclusions:</p>
<p>If B has done the event:</p>
<ul>
<li>A will suffer objective harm.</li>
<li>If A trusts B, there will be no subjective harm to trust; if A
suspects B and ultimately believes that B has done something, there will
be subjective harm to trust.</li>
<li>If A suspects B and questions B, then B:
<ul>
<li>Admitting to having done something will lead to a breakdown or
precariousness of the trust relationship.</li>
<li>Not admitting to having done something, A's trust in B will
ultimately depend on A's subjective inference.</li>
</ul></li>
</ul>
<p>If B has not done the event:</p>
<ul>
<li>A will not suffer objective harm.</li>
<li>If A trusts B, there will be no subjective harm to trust; if A
suspects B and ultimately believes that B has done something, there will
be subjective harm to trust.</li>
<li>If A suspects B and questions B, then B:
<ul>
<li>Not admitting to having done something, A's trust in B will
ultimately depend on A's subjective inference.</li>
</ul></li>
</ul>
<p>From the above conclusions, regardless of whether B has done
something, except for B admitting it to A, in all other cases, A's trust
in B mainly depends on A's final subjective inference. This can be
summed up in two common sayings:</p>
<ul>
<li>Trust those who are trustworthy, distrust those who are
suspicious.</li>
<li>Judge actions, not intentions; no one is perfect.</li>
</ul>
<p>Nevertheless, sustainable unconditional trust still exists in the
world. If you have such trust, cherish it and maintain it. However, even
if you don't have it, it's normal and there's no need to worry, because
it's okay to deal with most people in life without trust. So, to hell
with trust!</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
  </entry>
  <entry>
    <title>Alchemy Industrialization - Introduction to mlflow.</title>
    <url>/en/b01892d.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/b01892d.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Dan medicine management is a crucial part of alchemy. After all, when
batches of pills are produced through different materials and firing
processes, we always have the following needs:</p>
<ul>
<li>Evaluate the effects of the pills and select the good ones</li>
<li>Compare the effects of batches of pills to discover good material
ratios (hyperparameters)</li>
<li>Reproduce the production process of a pill with good effects</li>
<li>......</li>
</ul>
<p><img src="https://download.kezhi.tech/img/202403212027204.png?x-oss-process=style/webp" style="width:67%;" /></p>
<p>To meet these needs, we need alchemy management technology. In simple
terms, we need to establish mappings and alignments between
<code>code</code>, <code>hyperparameters</code>, and <code>models</code>
for storage, in order to support subsequent analysis and training
process tracing. As a result, many machine learning lifecycle management
software have been developed. This article mainly introduces an
open-source software called <code>MLflow</code> and its simple usage
process.</p>
<span id="more"></span>
<h2 id="installation">Installation</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install mlflow</span><br></pre></td></tr></table></figure>
<h2 id="management-panel">Management Panel</h2>
<p>Start the management panel:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow ui --host=127.0.0.1 --port 8000 </span><br></pre></td></tr></table></figure>
<p>The structure of the management panel is simple, so you can explore
it on your own.</p>
<p>Here, let's talk about the storage scheme for datasets. When running
the same experiment on multiple machines, the usual approach is to
download all the <code>logs</code> to one machine for comparison. This
manual management is cumbersome and error-prone. <code>mlflow</code>
adopts a <code>client-server</code> structure, so one machine can be
used as the server, and other machines can push data to the server by
accessing the <code>uri</code> when running experiments. Finally, the
data can be viewed and compared on the server.</p>
<p>One implementation approach is to deploy <code>mlflow</code> on a
server and open access to it:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow ui --host=0.0.0.0 --port 8000 </span><br></pre></td></tr></table></figure>
<p>Assuming the IP address of this machine is <code>192.168.1.12</code>,
modify the <code>uri</code> on other machines accordingly:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mlflow.set_tracking_uri(uri=<span class="string">&quot;http://192.168.1.12:8000&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>In addition, you can also add authentication:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow server --app-name basic-auth</span><br></pre></td></tr></table></figure>
<p>For more detailed information about authentication, see <a
href="https://www.mlflow.org/docs/latest/auth/index.html#">MLflow
Authentication — MLflow 2.11.2 documentation</a></p>
<h2 id="introduction-to-mlflow-structure">Introduction to MLflow
Structure</h2>
<p>MLflow is mainly divided into the following modules:</p>
<ul>
<li><p>MLflow Tracking: Used to log experiment information, including
parameters and metrics.</p></li>
<li><p>System Metrics: Records system status during program execution
(CPU usage, memory usage, etc.).</p></li>
<li><p>MLflow Models: Saves trained models.</p></li>
<li><p>MLflow Model Registry: Manages registered models.</p></li>
<li><p>MLflow Projects: Manages projects by recording runtime
environments and program entry points.</p></li>
<li><p>MLflow Plugins: Supports third-party plugins.</p></li>
</ul>
<h2 id="instructions-for-using-mlflow">Instructions for Using
MLflow</h2>
<p>MLflow can support the entire lifecycle of a machine learning
project, as shown in the following diagram:</p>
<p><img
src="https://download.kezhi.tech/img/202403211850657.png?x-oss-process=style/webp" /><a
href="https://mlflow.org/docs/latest/introduction/index.html">What is
MLflow? — MLflow 2.11.2 documentation</a></p>
<p>Next, we will introduce the usage of each part of <code>MLflow</code>
one by one.</p>
<h3 id="mlflow-tracking">MLflow Tracking</h3>
<p>The main function of Tracking is similar to <code>tensorboard</code>,
which is to log hyperparameters and process data during training. Here
is an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set our tracking server uri for logging</span></span><br><span class="line">mlflow.set_tracking_uri(uri=<span class="string">&quot;http://127.0.0.1:8000&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new MLflow Experiment</span></span><br><span class="line">mlflow.set_experiment(<span class="string">&quot;MLflow Quickstart&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> mlflow.start_run():</span><br><span class="line">    <span class="comment"># log parameters</span></span><br><span class="line">    mlflow.log_param(<span class="string">&quot;lr&quot;</span>, <span class="number">0.001</span>)</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;epoch&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;hidden_size&quot;</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">&quot;is_truncated&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    mlflow:log_params(params)</span><br><span class="line">    <span class="comment"># Your ml code</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># log metric</span></span><br><span class="line">    mlflow.log_metric(<span class="string">&quot;val_loss&quot;</span>, val_loss, step)</span><br><span class="line">    metric = &#123;</span><br><span class="line">        <span class="string">&quot;policy_loss&quot;</span>: policy_loss,</span><br><span class="line">        <span class="string">&quot;critic_loss&quot;</span>: critic_loss,</span><br><span class="line">    &#125;</span><br><span class="line">    mlflow.log_metrics(metric, step)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Where:</p>
<ul>
<li><code>mlflow.set_tracking_uri</code> specifies the location where
<code>mlflow</code> data is stored. If not specified, it defaults to the
local folder.</li>
<li><code>mlflow.set_experiment</code> defines the experiment name,
which can be considered as corresponding to a <code>project</code>.
Different algorithm versions and different hyperparameter selections of
the same <code>project</code> should use the same experiment name.</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_param"><code>mlflow.log_param</code></a>:
Logs a hyperparameter.</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_params"><code>mlflow.log_params</code></a>:
Logs multiple hyperparameters using a dictionary.</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_metric"><code>mlflow.log_metric</code></a>:
Logs a process metric.</li>
<li><a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_metrics"><code>mlflow.log_metrics</code></a>:
Logs multiple process metrics using a dictionary.</li>
</ul>
<p>In addition, there are many other functions to achieve tasks such as
logging images, logging figures plotted with <code>matplotlib</code>,
and logging files. Here, we won't list them one by one. You can refer to
the official documentation: <a
href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_artifact">mlflow
— MLflow 2.11.2 documentation</a></p>
<h4 id="auto-logging">Auto Logging</h4>
<p>In addition, <code>MLflow</code> also supports automatic tracking of
process data. Here is an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"></span><br><span class="line">mlflow.autolog()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Your training code...</span></span><br></pre></td></tr></table></figure>
<p>I haven't tried automatic tracking yet, so here is an illustration
from the official documentation:</p>
<p><img
src="https://download.kezhi.tech/img/202403211923270.png?x-oss-process=style/webp" /></p>
<p><a
href="https://mlflow.org/docs/latest/getting-started/index.html">Getting
Started with MLflow — MLflow 2.11.2 documentation</a></p>
<p>For further information on Auto Logging, refer to: <a
href="https://mlflow.org/docs/latest/tracking/autolog.html">Automatic
Logging with MLflow Tracking — MLflow 2.11.2 documentation</a></p>
<h3 id="system-metrics">System Metrics</h3>
<p>The System Metrics module is used to monitor various system status
indicators during the training process. Here is an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable automatic logging of system metrics (e.g., CPU and memory usage)</span></span><br><span class="line">mlflow.enable_system_metrics_logging()</span><br><span class="line"><span class="comment"># Set the sampling interval for system metrics to 1 second</span></span><br><span class="line">mlflow.set_system_metrics_sampling_interval(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>System monitoring is not enabled by default. Execute the above code
to enable it if you want to record system metrics.</p>
<h3 id="mlflow-models">MLflow Models</h3>
<p>The MLflow Models module is mainly used to store models trained by
code. It has different implementations for different deep learning
libraries. Taking <code>pytorch</code> as an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> mlflow</span><br><span class="line"><span class="keyword">from</span> mlflow.models <span class="keyword">import</span> infer_signature</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net = nn.Linear(<span class="number">6</span>, <span class="number">1</span>)</span><br><span class="line">loss_function = nn.L1Loss()</span><br><span class="line">optimizer = torch.optim.Adam(net.parameters(), lr=<span class="number">1e-4</span>)</span><br><span class="line"></span><br><span class="line">X = torch.randn(<span class="number">6</span>)</span><br><span class="line">y = torch.randn(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">epochs = <span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    outputs = net(X)</span><br><span class="line"></span><br><span class="line">    loss = loss_function(outputs, y)</span><br><span class="line">    loss.backward()</span><br><span class="line"></span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> mlflow.start_run() <span class="keyword">as</span> run:</span><br><span class="line">    signature = infer_signature(X.numpy(), net(X).detach().numpy())</span><br><span class="line">    model_info = mlflow.pytorch.log_model(net, <span class="string">&quot;model&quot;</span>, signature=signature)</span><br><span class="line"></span><br><span class="line">pytorch_pyfunc = mlflow.pyfunc.load_model(model_uri=model_info.model_uri)</span><br><span class="line"><span class="comment"># model_uri can be found in the UI panel</span></span><br><span class="line">predictions = pytorch_pyfunc.predict(torch.randn(<span class="number">6</span>).numpy())</span><br><span class="line"><span class="built_in">print</span>(predictions)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>For more details, see: <a
href="https://mlflow.org/docs/latest/models.html">MLflow Models — MLflow
2.11.2 documentation</a></p>
<h3 id="mlflow-model-registry">MLflow Model Registry</h3>
<p>The Model Registry is used to version control the models produced in
production. It can be operated on the UI panel. For the specific
process, see <a
href="https://mlflow.org/docs/latest/model-registry.html">MLflow Model
Registry — MLflow 2.11.2 documentation</a></p>
<h3 id="mlflow-projects">MLflow Projects</h3>
<p>MLflow Projects records the runtime environment and program entry
points through a configuration file, making it easy to distribute
programs.</p>
<p>It mainly consists of three parts:</p>
<ul>
<li>Name: Project name</li>
<li>Entry Points: Program entry points, which can take parameters and
can be used to compose pipelines with multiple entry points</li>
<li>Environment: Runtime environment configuration, supporting
<code>conda</code>, <code>Vitrualenv</code>, and
<code>Docker</code></li>
</ul>
<p>Create an <code>MLproject</code> file in the root directory of the
project and write the configuration, for example:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">My</span> <span class="string">Project</span></span><br><span class="line"></span><br><span class="line"><span class="attr">python_env:</span> <span class="string">python_env.yaml</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="comment"># conda_env: my_env.yaml</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="comment"># docker_env:</span></span><br><span class="line"><span class="comment">#    image:  mlflow-docker-example</span></span><br><span class="line"></span><br><span class="line"><span class="attr">entry_points:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="attr">data_file:</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">regularization:</span> &#123;<span class="attr">type:</span> <span class="string">float</span>, <span class="attr">default:</span> <span class="number">0.1</span>&#125;</span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;python train.py -r &#123;regularization&#125; &#123;data_file&#125;&quot;</span></span><br><span class="line">  <span class="attr">validate:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="attr">data_file:</span> <span class="string">path</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;python validate.py &#123;data_file&#125;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>After creating the configuration file, you can use
<code>mlflow</code> to run it automatically:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow run /path/to/project --env-manager=conda</span><br></pre></td></tr></table></figure>
<p>In addition, you can also specify a <code>Github</code> repository to
run the project:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mlflow run git@github.com:mlflow/mlflow-example.git -P alpha=0.5</span><br></pre></td></tr></table></figure>
<p>For more information about <code>mlflow run</code>, use
<code>mlflow run --help</code> to view it.</p>
<p>For more detailed information about <code>MLflow Project</code>, see
<a href="https://mlflow.org/docs/latest/projects.html#overview">MLflow
Projects — MLflow 2.11.2 documentation</a></p>
<h3 id="mlflow-plugins">MLflow Plugins</h3>
<p>MLflow is an open-source project and supports various plugins. You
can also develop your own plugins to meet your personalized needs. For
information about plugin development, installation, and popular plugins
in the community, see <a
href="https://mlflow.org/docs/latest/plugins.html">MLflow Plugins —
MLflow 2.11.2 documentation</a></p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>deep learning</tag>
        <tag>mlflow</tag>
      </tags>
  </entry>
  <entry>
    <title>Crawling all anime data from Bilibili and conducting data analysis.</title>
    <url>/en/6b2dc3cb.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/6b2dc3cb.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="introduction">Introduction</h2>
<p>Bilibili (referred to as B station) has a large number of anime
copyrights, with a total of 3161 as of now. Each anime can be found with
its <mark class="label primary">play count</mark>, <mark class="label success">follow count</mark>, <mark class="label info">barrage count</mark>, and other playback
data. In addition, each anime has its corresponding tags (such as "comic
adaptation", "hot-blooded", "comedy"). This project aims to analyze the
relationship between anime playback data and anime tags, and it is also
a data analysis project that uses APriori frequent itemset mining for
analysis.</p>
<p>GitHub address: <a
href="https://github.com/KezhiAdore/BilibiliAnimeData_Analysis">https://github.com/KezhiAdore/BilibiliAnimeData_Analysis</a></p>
<p>Gitee address: <a
href="https://gitee.com/KezhiAdore/BilibiliAnimeData_Analysis">https://gitee.com/KezhiAdore/BilibiliAnimeData_Analysis</a></p>
<span id="more"></span>
<h2 id="data-collection">Data Collection</h2>
<p>First, we need to obtain all the data we need, which are all the
anime playback information and tag information on B station. We use web
crawlers to crawl the data, and here we use <code>scrapy</code> in
Python to write the crawler to crawl the data.</p>
<h3 id="page-analysis">Page Analysis</h3>
<p>First, go to the anime index page on B station<img
src="https://download.kezhi.tech/img/20201014232024.png?x-oss-process=style/webp" /></p>
<p>Click on a certain anime on this page to enter its details page</p>
<p><img
src="https://download.kezhi.tech/img/20201014232257.png?x-oss-process=style/webp" /></p>
<p>You can see that the required anime playback data and anime tags are
available on this page.</p>
<p>Analyze the HTML of this page to find the xpath path where the data
is located, taking tags as an example:</p>
<p><img
src="https://download.kezhi.tech/img/20201014232605.png?x-oss-process=style/webp" /></p>
<p>The xpath paths corresponding to all the data are:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Tags: //span[@class=&quot;media-tag&quot;]</span><br><span class="line">Total Plays: //span[@class=&quot;media-info-count-item media-info-count-item-play&quot;]/em</span><br><span class="line">Follow Count: //span[@class=&quot;media-info-count-item media-info-count-item-fans&quot;]/em</span><br><span class="line">Barrage Count: //span[@class=&quot;media-info-count-item media-info-count-item-review&quot;]/em</span><br></pre></td></tr></table></figure>
<p>So far, we can loop through all the anime list pages, enter the
details page from this page, and parse each anime details page to save
the data. However, there is a problem at this point. After crawling the
anime list page, the corresponding place in the web page data is:</p>
<p><img
src="https://download.kezhi.tech/img/20201014233531.png?x-oss-process=style/webp" /></p>
<p>Directly accessing this page cannot obtain detailed anime list
information. Therefore, we need to analyze the files received by the
page and find the anime list information obtained by this page.</p>
<p><img
src="https://download.kezhi.tech/img/20201014235022.png?x-oss-process=style/webp" /></p>
<p>Accessing this URL will get the following information:</p>
<p><img
src="https://download.kezhi.tech/img/20201014235127.png?x-oss-process=style/webp" /></p>
<p>Analyzing this API URL, it can be found that the <code>page=1</code>
controls the page number information, and by changing this information,
different anime list pages can be accessed.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://api.bilibili.com/pgc/season/index/result?season_version=-1&amp;area=-1&amp;is_finish=-1&amp;copyright=-1&amp;season_status=-1&amp;season_month=-1&amp;year=-1&amp;style_id=-1&amp;order=3&amp;st=1&amp;sort=0&amp;page=1&amp;season_type=1&amp;pagesize=20&amp;type=1</span><br></pre></td></tr></table></figure>
<p>The information obtained from this page is a JSON file, and the
information format is as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20201014235500.png?x-oss-process=style/webp" /></p>
<p>By comparing with the URL of the anime details page <a
href="https://www.bilibili.com/bangumi/media/md22718131">https://www.bilibili.com/bangumi/media/md22718131</a>,
it can be found that the <code>media_id</code> data in the JSON file is
the identifier of each anime details page. Therefore, the logic of
crawling information is basically established.</p>
<ol type="1">
<li>Access the initial API page (page=1), parse its content, and get the
<code>media_id</code> of all anime on this page.</li>
<li>Use <code>media_id</code> to construct the link to access the anime
details page, crawl this page for parsing, and get the data of an
anime.</li>
<li>Access the next API page and repeat the above steps.</li>
</ol>
<h3 id="spider-construction">Spider Construction</h3>
<p>First, initialize the spider</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy startproject anime_data</span><br><span class="line">scrapy genspider anime &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>The file tree is as follows</p>
<p><img
src="https://download.kezhi.tech/img/20201015000820.png?x-oss-process=style/webp" /></p>
<p>Open <code>items.py</code> and create the data object that needs to
be saved</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimeDataItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    name = scrapy.Field()   <span class="comment"># Anime name</span></span><br><span class="line">    play=scrapy.Field()     <span class="comment"># Total play count</span></span><br><span class="line">    fllow=scrapy.Field()    <span class="comment"># Follow count</span></span><br><span class="line">    barrage=scrapy.Field()  <span class="comment"># Barrage count</span></span><br><span class="line">    tags=scrapy.Field()     <span class="comment"># Anime tags, in list format</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>Then open the newly created <code>anime.py</code>, access the page,
parse it, and save the data as follows</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> anime_data.items <span class="keyword">import</span> AnimeDataItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimeSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;anime&#x27;</span></span><br><span class="line">    <span class="comment">#allowed_domains = [&#x27;https://www.bilibili.com&#x27;]</span></span><br><span class="line">    <span class="comment"># Anime information table API</span></span><br><span class="line">    url_head=<span class="string">&quot;https://api.bilibili.com/pgc/season/index/result?season_version=-1&amp;area=-1&amp;is_finish=-1&amp;copyright=-1&amp;season_status=-1&amp;season_month=-1&amp;year=-1&amp;style_id=-1&amp;order=3&amp;st=1&amp;sort=0&amp;season_type=1&amp;pagesize=20&amp;type=1&quot;</span></span><br><span class="line">    start_urls = [url_head+<span class="string">&quot;&amp;page=1&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## Recursive parsing of anime information table</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        data=json.loads(response.text)</span><br><span class="line">        next_index=<span class="built_in">int</span>(response.url[response.url.rfind(<span class="string">&quot;=&quot;</span>)+<span class="number">1</span>:])+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]==<span class="number">20</span>:</span><br><span class="line">            next_url=self.url_head+<span class="string">&quot;&amp;page=&quot;</span>+<span class="built_in">str</span>(next_index)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(next_url,callback=self.parse)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">            media_id=i[<span class="string">&#x27;media_id&#x27;</span>]</span><br><span class="line">            detail_url=(<span class="string">&quot;https://www.bilibili.com/bangumi/media/md&quot;</span>+<span class="built_in">str</span>(media_id))</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(detail_url,callback=self.parse_detail)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Parse anime details page</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">self,response</span>):</span><br><span class="line">        item=AnimeDataItem()</span><br><span class="line">        <span class="comment"># Anime name</span></span><br><span class="line">        item[<span class="string">&#x27;name&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-title-t&quot;]/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># Play count</span></span><br><span class="line">        item[<span class="string">&#x27;play&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-count-item media-info-count-item-play&quot;]/em/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># Follow count</span></span><br><span class="line">        item[<span class="string">&#x27;fllow&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-count-item media-info-count-item-fans&quot;]/em/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># Barrage count</span></span><br><span class="line">        item[<span class="string">&#x27;barrage&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-info-count-item media-info-count-item-review&quot;]/em/text()&#x27;</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># Anime tags</span></span><br><span class="line">        item[<span class="string">&#x27;tags&#x27;</span>]=response.xpath(<span class="string">&#x27;//span[@class=&quot;media-tag&quot;]/text()&#x27;</span>).extract()</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<h2 id="data-analysis">Data Analysis</h2>
<h3 id="data-cleaning-and-filtering">Data Cleaning and Filtering</h3>
<p>The collected data cannot be used directly and needs to be cleaned
and filtered, which can be divided into two steps:</p>
<ol type="1">
<li>Remove data without tag information</li>
<li>Convert quantity information in the data to numbers (e.g., convert
"10,000" to "10000")</li>
</ol>
<p>For the first step, since the data volume is small, you can quickly
complete it using the filtering function in Excel.</p>
<p>For the second step, write the following function to convert the
data:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Convert text data to numbers</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="keyword">if</span> string[-<span class="number">1</span>]==<span class="string">&#x27;万&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">float</span>(string[<span class="number">0</span>:-<span class="number">1</span>])*<span class="number">1e4</span>)</span><br><span class="line">    <span class="keyword">elif</span> string[-<span class="number">1</span>]==<span class="string">&#x27;亿&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">float</span>(string[<span class="number">0</span>:-<span class="number">1</span>])*<span class="number">1e8</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(string)</span><br></pre></td></tr></table></figure>
<h3 id="frequent-itemset-mining-using-apriori-algorithm">Frequent
Itemset Mining using Apriori Algorithm</h3>
<blockquote>
<ol type="1">
<li>Itemsets and Datasets</li>
</ol>
<p>Let the set of all items appearing in the data be <span
class="math inline">\(U=\left\{I_1,I_2,...,I_n\right\}\)</span>, and let
the data to be mined for frequent itemsets be the set of transactions in
the database <span class="math inline">\(D\)</span>. The data in <span
class="math inline">\(D\)</span> are itemsets, and each itemset <span
class="math inline">\(T\subseteq U\)</span>.</p>
<ol start="2" type="1">
<li>Association Rules (Support and Confidence)</li>
</ol>
<p>Let <span class="math inline">\(A\)</span> and <span
class="math inline">\(B\)</span> be two itemsets, <span
class="math inline">\(A\subset U,B\subset U, A\neq \emptyset，B\neq
\emptyset，A\cap B=\emptyset\)</span>.</p>
<p>An association rule is in the form of <span
class="math inline">\(A\Rightarrow B\)</span>, and its
<strong>support</strong> in the transaction set <span
class="math inline">\(D\)</span> is denoted as <span
class="math inline">\(s\)</span>, where <span
class="math inline">\(s\)</span> is the percentage of transactions in
the transaction set <span class="math inline">\(D\)</span> that contain
<span class="math inline">\(A\cup B\)</span>.</p>
<p>Its <strong>confidence</strong> in the transaction set <span
class="math inline">\(D\)</span> is denoted as <span
class="math inline">\(c\)</span>, which is the percentage of
transactions in the transaction set <span
class="math inline">\(D\)</span> that contain <span
class="math inline">\(B\)</span> among the transactions that contain
<span class="math inline">\(A\)</span>, i.e., <span
class="math inline">\(P(A|B)\)</span>. <span class="math display">\[
c=P(B|A)=\frac{P(A\cup B)}{P(A)}=\frac{support(A\cup
B)}{support(A)}=\frac{support\text{_}count(A\cup
B)}{support\text{_}count(A)}
\]</span></p>
<ol start="3" type="1">
<li>Frequent Itemsets</li>
</ol>
<p>When mining frequent itemsets, set the minimum confidence and minimum
support, and rules that satisfy both the minimum support and minimum
confidence are called strong rules, and itemsets that satisfy such
strong rules are called frequent itemsets.</p>
</blockquote>
<h4 id="association-rules">Association Rules</h4>
<p>Each anime has a certain number of <code>tags</code> to roughly
describe its content. The tags used to describe the same anime are
usually descriptions in different dimensions. Taking "Miss Kobayashi's
Dragon Maid" as an example, its tags are
<code>[moe, comedy, daily life, comic adaptation]</code>, and the four
tags describe four different characteristics of this anime. By analyzing
the anime <code>tag</code> data on B station, find the combinations of
<code>tags</code> with the highest relevance.</p>
<h4 id="algorithm-flow">Algorithm Flow</h4>
<p>Data set: The <code>tag</code> data set of all anime, each data is
the <code>tag</code> of an anime</p>
<p>The flow of the Apriori algorithm is as follows:</p>
<ol type="1">
<li><p>Construct 1-itemsets -&gt; Count the frequency of 1-itemsets
-&gt; Calculate support and confidence -&gt; Pruning -&gt; Frequent
1-itemsets</p></li>
<li><p>Construct k-itemsets using k-1-itemsets -&gt; Count the frequency
of k-itemsets -&gt; Calculate support and confidence -&gt; Pruning -&gt;
Frequent k-itemsets</p></li>
<li><p>Repeat step 2 until there are no itemsets that meet the strong
rules</p></li>
</ol>
<h4 id="programming-implementation">Programming Implementation</h4>
<p>First, read the processed data and convert the <code>tag</code> data,
which is originally a string, into a list:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">filepath=<span class="string">&#x27;data_processed.csv&#x27;</span></span><br><span class="line">df=pd.read_csv(filepath)</span><br><span class="line">tags=df[<span class="string">&#x27;tags&#x27;</span>].to_list()</span><br></pre></td></tr></table></figure>
<p>The data in <code>tags</code> is a string rather than a list, such
as: <code>"恋爱,推理,校园,日常"</code>, which needs to be converted into
a list. The implementation is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Convert comma-separated strings to lists using commas as separators</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_to_list</span>(<span class="params">str_data</span>):</span><br><span class="line">    <span class="keyword">for</span> index,data <span class="keyword">in</span> <span class="built_in">enumerate</span>(str_data):</span><br><span class="line">        tmp,start,end=[],<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> end!=<span class="built_in">len</span>(data):</span><br><span class="line">            <span class="keyword">if</span> data[start:].find(<span class="string">&#x27;,&#x27;</span>)==-<span class="number">1</span>:</span><br><span class="line">                end=<span class="built_in">len</span>(data)</span><br><span class="line">                tmp.append(data[start:end])</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            end=start+data[start:].find(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            tmp.append(data[start:end])</span><br><span class="line">            start=end+<span class="number">1</span></span><br><span class="line">        str_data[index]=tmp</span><br></pre></td></tr></table></figure>
<p>Construct k-itemsets using k-1-itemsets:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Apriori algorithm connection step, implemented step by step</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_list</span>(<span class="params">l1,l2</span>):</span><br><span class="line">    length=<span class="built_in">len</span>(l1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> l1[i]!=l2[i]:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;nope&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> l1[-<span class="number">1</span>]&lt;l2[-<span class="number">1</span>]:</span><br><span class="line">        l=l1.copy()</span><br><span class="line">        l.append(l2[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> l</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;nope&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Determine the inclusion relationship between lists:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Determine if l2 is included in l1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_exist</span>(<span class="params">l1,l2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l2:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> l1:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>Pruning operation:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Prune using min_sup and min_conf, that is, minimum support and minimum confidence, L_last is the frequent k-1-itemset</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prune</span>(<span class="params">L=[],L_last=<span class="number">0</span>,min_sup=<span class="number">0</span>,min_conf=<span class="number">0</span></span>):</span><br><span class="line">    tmp_L=[]</span><br><span class="line">    <span class="keyword">if</span> L_last==<span class="number">0</span> <span class="keyword">or</span> min_conf==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">            <span class="keyword">if</span> l[<span class="number">1</span>]&lt;min_sup:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            tmp_L.append(l)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">            <span class="keyword">if</span> l[<span class="number">1</span>]&lt;min_sup:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> ll <span class="keyword">in</span> L_last:</span><br><span class="line">                <span class="keyword">if</span> l[<span class="number">0</span>][:-<span class="number">1</span>]==ll[<span class="number">0</span>]:</span><br><span class="line">                    <span class="keyword">if</span> l[<span class="number">1</span>]/ll[<span class="number">1</span>]&gt;=min_conf:</span><br><span class="line">                        tmp_L.append(l)</span><br><span class="line">    <span class="keyword">return</span> tmp_L</span><br></pre></td></tr></table></figure>
<p>Apriori algorithm main body:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Apriori</span>(<span class="params">data,min_sup,min_conf</span>):</span><br><span class="line">    <span class="comment"># C: Temporary storage for k-itemsets  L: Temporary storage for frequent k-itemsets  L_save: Save frequent 1-k-itemsets</span></span><br><span class="line">    C,L,L_save=[],[],[]</span><br><span class="line">    <span class="comment"># Use support count instead of support for calculation</span></span><br><span class="line">    min_sup_count=min_sup*<span class="built_in">len</span>(data)</span><br><span class="line">    <span class="comment"># Initialize 1-itemsets</span></span><br><span class="line">    <span class="keyword">for</span> tags <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">for</span> tag <span class="keyword">in</span> tags:</span><br><span class="line">            <span class="keyword">if</span> C==[] <span class="keyword">or</span> [tag] <span class="keyword">not</span> <span class="keyword">in</span>[x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> C]:</span><br><span class="line">                C.append([[tag],<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># Filter out frequent 1-itemsets</span></span><br><span class="line">    L=C.copy()</span><br><span class="line">    <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">        <span class="keyword">for</span> tags <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">if</span> is_exist(tags,l[<span class="number">0</span>]):</span><br><span class="line">                L[index][<span class="number">1</span>]+=<span class="number">1</span></span><br><span class="line">    L=prune(L,min_sup=min_sup)</span><br><span class="line">    L_save.append(L)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># Construct k-itemsets using k-1-itemsets</span></span><br><span class="line">        C=[]</span><br><span class="line">        <span class="keyword">for</span> l1 <span class="keyword">in</span> L:</span><br><span class="line">            <span class="keyword">for</span> l2 <span class="keyword">in</span> L:</span><br><span class="line">                list_merge=merge_list(l1[<span class="number">0</span>],l2[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> list_merge!=<span class="string">&#x27;nope&#x27;</span>:</span><br><span class="line">                    C.append([list_merge,<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># Count frequency and prune</span></span><br><span class="line">        L=C.copy()</span><br><span class="line">        <span class="keyword">for</span> index,l <span class="keyword">in</span> <span class="built_in">enumerate</span>(L):</span><br><span class="line">            <span class="keyword">for</span> tags <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">if</span> is_exist(tags,l[<span class="number">0</span>]):</span><br><span class="line">                    L[index][<span class="number">1</span>]+=<span class="number">1</span></span><br><span class="line">        L=prune(L,L_save[-<span class="number">1</span>],min_sup,min_conf)</span><br><span class="line">        <span class="comment"># End the loop when L is an empty set</span></span><br><span class="line">        <span class="keyword">if</span> L==[]:</span><br><span class="line">            <span class="keyword">return</span> L_save</span><br><span class="line">        L_save.append(L)</span><br></pre></td></tr></table></figure>
<h3 id="k-means-clustering-algorithm">K-means Clustering Algorithm</h3>
<h4 id="algorithm-introduction">Algorithm Introduction</h4>
<p>K-means is an unsupervised clustering algorithm. The algorithm is
simple and easy to implement, but it may produce empty clusters or
converge to local optima.</p>
<p>The algorithm flow is as follows:</p>
<ol type="1">
<li>Randomly select k points from the samples as initial centroids.</li>
<li>Calculate the distance from each sample to these k centroids and
assign the sample to the cluster whose centroid is closest to it.</li>
<li>Recalculate the centroids of each cluster.</li>
<li>Repeat steps 2 and 3 until the centroids do not change.</li>
</ol>
<h4 id="data-mapping">Data Mapping</h4>
<p>Use K-means to cluster the anime based on the three-dimensional
coordinates formed by the three types of data
<code>[play count, follow count, barrage count]</code>. However, the
values of these three data range from thousands to billions, so they
cannot be used directly. Apply a logarithmic function to compress the
data: <span class="math display">\[
[x,y,z]=[ln\ x,ln\ y,ln\ z]
\]</span> After the logarithmic transformation, in order to ensure that
each type of data has the same range to ensure that they have the same
weight, normalize the data: <span class="math display">\[
x=\frac{x-min}{max-min}
\]</span> The implementation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trans_data</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> index,item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        data[index]=math.log(item)</span><br><span class="line">    Max=<span class="built_in">max</span>(data)</span><br><span class="line">    Min=<span class="built_in">min</span>(data)</span><br><span class="line">    <span class="keyword">for</span> index,item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        data[index]=(item-Min)/(Max-Min)</span><br></pre></td></tr></table></figure>
<h4 id="k-means-programming-implementation">K-means Programming
Implementation</h4>
<p>In clustering, the distance measure used is the Euclidean distance,
which is: <span class="math display">\[
distance=\sqrt{(x_{1}-y_{1})^2+...+(x_{i}-y_{i})^2+...+(x_{n}-y_{n})^2}
\]</span> The implementation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">point1,point2</span>):</span><br><span class="line">    dim=<span class="built_in">len</span>(point1)</span><br><span class="line">    <span class="keyword">if</span> dim != <span class="built_in">len</span>(point2):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error! dim of point1 and point2 is not same&#x27;</span>)</span><br><span class="line">    dist=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        dist+=(point1[i]-point2[i])*(point1[i]-point2[i])</span><br><span class="line">    <span class="keyword">return</span> math.sqrt(dist)</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>Randomly select k points as centroids</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shape=np.array(dire).shape</span><br><span class="line">    k_center_index=[]</span><br><span class="line">    k_center=[]</span><br><span class="line">    temp_k=k</span><br><span class="line">    <span class="keyword">while</span>(temp_k):</span><br><span class="line">        temp=random.randrange(<span class="number">0</span>,shape[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> temp <span class="keyword">not</span> <span class="keyword">in</span> k_center_index:</span><br><span class="line">            k_center_index.append(temp)</span><br><span class="line">            k_center.append(<span class="built_in">list</span>(dire[temp]))</span><br><span class="line">            temp_k-=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>Cluster all the data</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_category</span>(<span class="params">dire,k,k_center</span>):</span><br><span class="line">    shape=np.array(dire).shape</span><br><span class="line">    k_categories=[[] <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">0</span>]):</span><br><span class="line">        Min=<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            dist=distance(dire[i],k_center[j])</span><br><span class="line">            <span class="keyword">if</span> dist&lt;Min:</span><br><span class="line">                Min=dist</span><br><span class="line">                MinNum=j</span><br><span class="line">        k_categories[MinNum].append(i)</span><br><span class="line">    <span class="keyword">return</span> k_categories</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>Calculate new centroids and repeat</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Maximum number of iterations</span></span><br><span class="line">    Maxloop=<span class="number">500</span></span><br><span class="line">    k_center_new=k_center</span><br><span class="line">    k_center=[]</span><br><span class="line">    count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(k_center!=k_center_new <span class="keyword">and</span> count&lt;Maxloop):</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        k_center=copy.deepcopy(k_center_new)</span><br><span class="line">        k_categories=get_category(dire,k,k_center_new)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">                temp=<span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> k_categories[j]:</span><br><span class="line">                    temp+=dire[w][i]</span><br><span class="line">                k_center_new[j][i]=temp/<span class="built_in">len</span>(k_categories[j])</span><br></pre></td></tr></table></figure>
<p>The complete K-means algorithm main body is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">k_means</span>(<span class="params">dire,k</span>):</span><br><span class="line">    <span class="comment"># Randomly select k points as centroids</span></span><br><span class="line">    shape=np.array(dire).shape</span><br><span class="line">    k_center_index=[]</span><br><span class="line">    k_center=[]</span><br><span class="line">    temp_k=k</span><br><span class="line">    <span class="keyword">while</span>(temp_k):</span><br><span class="line">        temp=random.randrange(<span class="number">0</span>,shape[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> temp <span class="keyword">not</span> <span class="keyword">in</span> k_center_index:</span><br><span class="line">            k_center_index.append(temp)</span><br><span class="line">            k_center.append(<span class="built_in">list</span>(dire[temp]))</span><br><span class="line">            temp_k-=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Maximum number of iterations</span></span><br><span class="line">    Maxloop=<span class="number">500</span></span><br><span class="line">    k_center_new=k_center</span><br><span class="line">    k_center=[]</span><br><span class="line">    count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(k_center!=k_center_new <span class="keyword">and</span> count&lt;Maxloop):</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        k_center=copy.deepcopy(k_center_new)</span><br><span class="line">        k_categories=get_category(dire,k,k_center_new)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">                temp=<span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> k_categories[j]:</span><br><span class="line">                    temp+=dire[w][i]</span><br><span class="line">                k_center_new[j][i]=temp/<span class="built_in">len</span>(k_categories[j])</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;k_center&#x27;</span>:k_center,<span class="string">&#x27;k_categories&#x27;</span>:k_categories,<span class="string">&#x27;dire&#x27;</span>:dire,<span class="string">&#x27;k&#x27;</span>:k&#125;</span><br></pre></td></tr></table></figure>
<h4 id="algorithm-results-and-evaluation">Algorithm Results and
Evaluation</h4>
<p>To visually see the clustering results, plot the clustered points in
three-dimensional space, using different colors to represent different
categories.</p>
<blockquote>
<p>The plotting function is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_k_means</span>(<span class="params">k_result</span>):</span><br><span class="line">    k,k_categories,dire=k_result[<span class="string">&#x27;k&#x27;</span>],k_result[<span class="string">&#x27;k_categories&#x27;</span>],k_result[<span class="string">&#x27;dire&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        x,y,z=[],[],[]</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> k_categories[i]:</span><br><span class="line">            x.append(dire[index][<span class="number">0</span>])</span><br><span class="line">            y.append(dire[index][<span class="number">1</span>])</span><br><span class="line">            z.append(dire[index][<span class="number">2</span>])</span><br><span class="line">        fig = plt.gcf()</span><br><span class="line">        ax = fig.gca(projection=<span class="string">&#x27;3d&#x27;</span>)</span><br><span class="line">        ax.scatter(x,y,z)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
</blockquote>
<p>The clustering results are as follows:</p>
<table>
<tr>
<td>
<center>
k=2
</center>
</td>
<td>
<center>
k=5
</center>
</td>
<td>
<center>
k=10
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/20201124160340.png?x-oss-process=style/webp" width='300'>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20201124160804.png?x-oss-process=style/webp" width='300'>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/20201124160900.png?x-oss-process=style/webp" width='300'>
</center>
</td>
</tr>
</table>
<p>To evaluate the clustering effect, select the Davies-Bouldin Index
(DBI) to evaluate the clustering effect. The algorithm and method of DBI
are as follows:</p>
<ul>
<li>Suppose there are k clusters, and the center point of each cluster
is <span class="math inline">\(u_i\)</span>, and the points in the
cluster are represented by <span
class="math inline">\(x_{ij}\)</span></li>
<li>Calculate the average distance within each cluster <span
class="math inline">\(\mu_i\)</span>, which is the average distance from
all points in the cluster to the cluster center</li>
<li>Calculate the distance between centroids <span
class="math inline">\(d(u_i,u_j)\)</span></li>
<li>Calculate DBI:</li>
</ul>
<p><span class="math display">\[
DB=\frac1k\sum_{i=1}^k\mathop{max}\limits_{i\neq
j}(\frac{\mu_i+\mu_j}{d(u_i,u_j)})
\]</span></p>
<p>The implementation code is as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dbi</span>(<span class="params">k_result</span>):</span><br><span class="line">    k_center,k_categories,dire,k=k_result[<span class="string">&#x27;k_center&#x27;</span>],k_result[<span class="string">&#x27;k_categories&#x27;</span>],k_result[<span class="string">&#x27;dire&#x27;</span>],k_result[<span class="string">&#x27;k&#x27;</span>]</span><br><span class="line">    <span class="comment"># Average distance within clusters</span></span><br><span class="line">    k_ave_dist=[<span class="number">0</span> <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        temp=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> k_categories[i]:</span><br><span class="line">            temp+=distance(k_center[i],dire[item])</span><br><span class="line">        k_ave_dist[i]=temp/<span class="built_in">len</span>(k_categories[i])</span><br><span class="line">    <span class="comment"># Distance between cluster centers</span></span><br><span class="line">    k_center_dist=[[<span class="number">0</span> <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(k)] <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            k_center_dist[i][j]=distance(k_center[i],k_center[j])</span><br><span class="line">    <span class="comment"># Calculate DBI</span></span><br><span class="line">    DB=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        Max=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            <span class="keyword">if</span> i !=j:</span><br><span class="line">                temp=(k_ave_dist[i]+k_ave_dist[j])/k_center_dist[i][j]</span><br><span class="line">                <span class="keyword">if</span> temp&gt;Max:</span><br><span class="line">                    Max=temp</span><br><span class="line">        DB+=Max</span><br><span class="line">    <span class="keyword">return</span> DB/k</span><br></pre></td></tr></table></figure>
<p>The evaluation results of clustering when k=2-10 are as follows:</p>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">k</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">DBI</td>
<td style="text-align: center;">0.7028</td>
<td style="text-align: center;">0.7851</td>
<td style="text-align: center;">0.8324</td>
<td style="text-align: center;">0.9075</td>
<td style="text-align: center;">0.9267</td>
<td style="text-align: center;">0.9927</td>
<td style="text-align: center;">0.9242</td>
<td style="text-align: center;">0.9123</td>
<td style="text-align: center;">0.8849</td>
</tr>
</tbody>
</table>
<center>
<img src="https://download.kezhi.tech/img/20201124162738.png?x-oss-process=style/webp" height='300'>
</center>
<p>The evaluation results of k=2-50 are as follows:</p>
<center>
<img src="https://download.kezhi.tech/img/20201124163322.png?x-oss-process=style/webp" height='300'>
</center>
<p>From the above results, it can be seen that the clustering effect is
best when k=2 or 3. Analyzing from the data used and the characteristics
of the k-means algorithm, the k-means algorithm uses Euclidean distance
for clustering, and the regions divided are spherical. From the
three-dimensional image, the data used does not have a clear boundary to
separate the data. When k=2 or 3, each cluster is concentrated in a
sphere, showing better clustering results. As k continues to increase,
the clustering effect gradually deteriorates due to the influence of
isolated points around the data.</p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Crawler</tag>
        <tag>Big Data</tag>
        <tag>Aprior Algorithm</tag>
        <tag>K-Means</tag>
      </tags>
  </entry>
  <entry>
    <title>King Glory Target Detection - Yolov5 Implementation.</title>
    <url>/en/86b4b2c0.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/86b4b2c0.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h1
id="intelligent-agent-for-target-detection-in-game-battles">Intelligent
Agent for Target Detection in Game Battles</h1>
<p>Manual annotation dataset and video segmentation program download can
be found at the end of the article.</p>
<figure>
<img
src="https://download.kezhi.tech/img/202211291652294.jpg?x-oss-process=style/webp"
alt="Image" />
<figcaption aria-hidden="true">Image</figcaption>
</figure>
<span id="more"></span>
<p>Demo video:</p>
<iframe src="//player.bilibili.com/player.html?aid=210959614&amp;bvid=BV1Ya411m7mx&amp;cid=490755155&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
</iframe>
<h2 id="introduction">1. Introduction</h2>
<h3 id="problem-background">1.1 Problem Background</h3>
<p>Reinforcement learning has achieved great success in the field of
games in the past. For example, AlphaGo defeated human players in the
game of Go (Silver, D. et al., 2016), Alpha Zero defeated top human
players in various board games after several days of self-play (Silver,
D. et al., 2018), and Alpha Star defeated human players in the game
StarCraft II (Vinyals, O. et al., 2019). There is also the case of the
AI "Juewu" in the game "King of Glory" reaching the level of
professional players (Wu, B., 2019). The development of reinforcement
learning has led to increasingly better performance of artificial
intelligence in game battles.</p>
<p>However, in the problems solved by the above intelligent agents,
either the environment is relatively simple (such as board games like Go
and chess), or the input to the agent's decision-making process has
undergone specific processing. For example, the input to Alpha Star
contains a lot of data that cannot be directly observed from the screen
(Vinyals, O. et al., 2019). To train a more general intelligent agent,
the input to the environment needs to be more general and universal.
Computer vision has become a good choice.</p>
<p>In many game battle scenarios, visual information is the most
important and information-rich. In games, visual information is the main
information that players obtain. In board games, the situation on the
board and the opponent's facial expressions are all visual information.
In military combat environments, a large number of sensors capture
visual-like information. Therefore, it is of great practical
significance to convert visual information into environmental
description information and send it to the intelligent agent for
decision-making.</p>
<p>Among them, target detection is an important part of visual
information conversion. Whether in virtual game environments or real
environments, it is crucial to identify the terrain, friendly positions,
and enemy positions. This is important for the subsequent action
decisions of the intelligent agent. Therefore, starting from target
detection in game battle scenarios, this article trains a neural network
model that can detect enemy and friendly intelligent units, neutral
units, and environmental features in the game environment, and achieve
the detection of important subjects in the scene.</p>
<h2 id="methodology">2. Methodology</h2>
<p>In this article, YOLOv5 (Ultralytics) is used to build the target
detection network for identifying subjects in game scenes.</p>
<p>The network structure of YOLOv5 is shown in the following figure:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231231485.png?x-oss-process=style/webp"
alt="Figure 2-1 YOLOv5 Network Structure" />
<figcaption aria-hidden="true">Figure 2-1 YOLOv5 Network
Structure</figcaption>
</figure>
<p>From the network structure diagram of YOLOv5, it can be seen that it
is still divided into four parts: <strong>Input, Backbone, Neck, and
Prediction</strong>. Next, we will introduce this network from these
four parts.</p>
<h3 id="input">2.1 Input</h3>
<p>YOLOv5 uses the Mosaic data augmentation method, which is the same as
YOLOv4. The Mosaic data augmentation method was proposed by a member of
the YOLOv5 team. It combines random scaling, random cropping, and random
arrangement to splice images together, which works well for detecting
small objects.</p>
<p>In the YOLO algorithm, different datasets have anchor boxes with
initial settings for width and height. During network training, the
network outputs predicted boxes based on the initial anchor boxes, and
then compares them with the ground truth boxes to calculate the
difference between them, and updates the network parameters in a
backward manner. In YOLOv3 and YOLOv4, when training different datasets,
the calculation of the initial anchor box values is performed by a
separate program. However, YOLOv5 embeds this function into the code,
and calculates the optimal anchor box values for different training sets
adaptively each time during training.</p>
<h3 id="backbone">2.2 Backbone</h3>
<h4 id="focus-structure">2.2.1 Focus Structure</h4>
<p>The Focus module in YOLOv5 slices the image before it enters the
backbone. The specific operation is to take a value every other pixel in
an image, similar to nearest neighbor downsampling. In this way, four
images are obtained from one image, and these four images complement
each other. They have similar sizes but no information loss. In this
way, the width and height information is concentrated in the channel
space, and the input channels are expanded by 4 times. The concatenated
image has 12 channels compared to the original RGB three-channel mode,
and then the obtained new image is convolved to obtain a downsampling
feature map without information loss. The network structure is as
follows:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231315193.png?x-oss-process=style/webp"
alt="Figure 2-2 Focus Structure in YOLOv5" />
<figcaption aria-hidden="true">Figure 2-2 Focus Structure in
YOLOv5</figcaption>
</figure>
<p>Taking YOLOv5s as an example, the original 640 × 640 × 3 image is
input to the Focus structure. After the slicing operation, it becomes a
320 × 320 × 12 feature map, and then it undergoes another convolution
operation to finally become a 320 × 320 × 32 feature map. The slicing
operation is as follows:</p>
<figure>
<img
src="https://img-blog.csdnimg.cn/2021011616173324.png?x-oss-process=style/webp"
alt="Figure 2-3 Slicing Operation" />
<figcaption aria-hidden="true">Figure 2-3 Slicing Operation</figcaption>
</figure>
<h4 id="csp-structure">2.2.2 CSP Structure</h4>
<p>In the YOLOv4 network structure, the design idea of CSPNet is
borrowed, and the CSP structure is designed in the backbone network. The
difference between YOLOv5 and YOLOv4 is that only the backbone network
uses the CSP structure in YOLOv4. In YOLOv5, two CSP structures are
designed. Taking the YOLOv5s network as an example, the CSP1_X structure
is applied to the backbone network, and the other CSP2_X structure is
applied to the Neck. The network structure is as follows:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231322235.png?x-oss-process=style/webp"
alt="Figure 2-4 CSP Structure in YOLOv5" />
<figcaption aria-hidden="true">Figure 2-4 CSP Structure in
YOLOv5</figcaption>
</figure>
<p>The CBL structure and Resunit structure are shown in the following
figure:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231322633.png?x-oss-process=style/webp"
alt="Figure 2-5 CBL Structure and Resunit" />
<figcaption aria-hidden="true">Figure 2-5 CBL Structure and
Resunit</figcaption>
</figure>
<h4 id="spp-structure">2.2.3 SPP Structure</h4>
<p>The SPP module is inspired by SPPNet (Spatial Pyramid Pooling
Network) and consists of four parallel branches. It uses convolution
with multiple different-sized kernels to convolve the image and then
merges the convolution results. This effectively expands the receptive
field of the model, allowing the model to handle images with large
differences in size. The network structure is as follows:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231326040.png?x-oss-process=style/webp"
alt="Figure 2-6 SPP Structure in YOLOv5" />
<figcaption aria-hidden="true">Figure 2-6 SPP Structure in
YOLOv5</figcaption>
</figure>
<h3 id="neck">2.3 Neck</h3>
<p>The Neck part of YOLOv5 uses the PANet structure, which is mainly
used to generate a feature pyramid. The feature pyramid enhances the
model's detection of objects at different scales, allowing it to
recognize the same object of different sizes and scales.</p>
<p>The PANet structure is based on FPN and introduces the Bottom-up path
augmentation structure. FPN mainly improves the effect of object
detection by fusing high-level and low-level features, especially
improving the detection effect of small objects. The Bottom-up path
augmentation structure can make full use of shallow features in the
network for segmentation. Shallow features are very important for object
detection because object detection is a pixel-level classification, and
shallow features are mostly edge shape features. PANet adds an
enhancement in the bottom-up direction based on FPN, allowing the
top-level feature map to also benefit from the rich position information
brought by the bottom-level feature map, thereby improving the detection
effect of large objects.</p>
<p>In addition, YOLOv5's Neck structure uses the CSP2 structure designed
based on CSPnet to enhance the network's feature fusion capability.</p>
<h3 id="prediction">2.4 Prediction</h3>
<h4 id="bounding-box-loss-function">2.4.1 Bounding Box Loss
Function</h4>
<p>YOLOv5 uses GIOU Loss as the bounding box loss function. GIOU not
only focuses on the overlapping area but also considers other
non-overlapping areas, which better reflects the degree of overlap
between the two.</p>
<h4 id="weighted-non-maximum-suppression-nms">2.4.2 Weighted Non-Maximum
Suppression (NMS)</h4>
<p>In the post-processing of object detection, NMS is usually required
for filtering many bounding boxes. YOLOv5 uses weighted NMS to remove
bounding boxes. Compared with traditional non-maximum suppression,
weighted non-maximum suppression does not directly compare the bounding
boxes with a threshold for filtering. Instead, it calculates the final
object detection bounding box based on the confidence of the network's
prediction results.</p>
<h2 id="dataset-and-evaluation-metrics">3. Dataset and Evaluation
Metrics</h2>
<h3 id="dataset-preparation">3.1 Dataset Preparation</h3>
<p>In this article, a manually annotated game screen dataset is used.
The game screens are obtained by randomly sampling frames from a match
of the game "King of Glory". A total of 8 classes of subjects are
annotated, and their categories and labels are shown in the following
table:</p>
<center>
Table 3-1 Categories of the Annotated Game Screen Dataset
</center>
<table style="width:100%;">
<colgroup>
<col style="width: 15%" />
<col style="width: 7%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 11%" />
<col style="width: 7%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Category</th>
<th style="text-align: center;">Hero</th>
<th style="text-align: center;">Dogface</th>
<th style="text-align: center;">Monster</th>
<th style="text-align: center;">Tower</th>
<th style="text-align: center;">Grass</th>
<th style="text-align: center;">Dragon</th>
<th style="text-align: center;">Buff</th>
<th style="text-align: center;">Blood</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Label</td>
<td style="text-align: center;">hero</td>
<td style="text-align: center;">dogface</td>
<td style="text-align: center;">monster</td>
<td style="text-align: center;">tower</td>
<td style="text-align: center;">grass</td>
<td style="text-align: center;">dragon</td>
<td style="text-align: center;">buff</td>
<td style="text-align: center;">blood</td>
</tr>
</tbody>
</table>
<p>The number of annotated samples for each category is shown in the
following table:</p>
<table style="width:100%;">
<colgroup>
<col style="width: 15%" />
<col style="width: 7%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 11%" />
<col style="width: 7%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Category</th>
<th style="text-align: center;">Hero</th>
<th style="text-align: center;">Dogface</th>
<th style="text-align: center;">Monster</th>
<th style="text-align: center;">Tower</th>
<th style="text-align: center;">Grass</th>
<th style="text-align: center;">Dragon</th>
<th style="text-align: center;">Buff</th>
<th style="text-align: center;">Blood</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Training</td>
<td style="text-align: center;">319</td>
<td style="text-align: center;">101</td>
<td style="text-align: center;">83</td>
<td style="text-align: center;">58</td>
<td style="text-align: center;">353</td>
<td style="text-align: center;">48</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td style="text-align: center;">Validation</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">91</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<h3 id="evaluation-metrics">3.2 Evaluation Metrics</h3>
<p>The evaluation metrics of the model mainly consist of two parts:
precision and recall. Specifically: <span class="math display">\[
Precision = \frac{TP}{TP+TN}\\
Recall = \frac{TP}{TP+FP}
\]</span> In object detection, the average precision (AP) of each
category is usually used to measure the performance of the algorithm.
Its value is determined by both precision and recall. The precision and
recall calculated by the formula can be used to draw a precision-recall
(P-R) curve, and the area enclosed by the curve and the X-axis is the AP
value. The formula is as follows: <span class="math display">\[
AP = \sum_{i=1}^{n-1}(Recall_{i+1}-Recall_{i})*Precision(Recall_{i+1})
\]</span> In this article, the AP value is used to measure the detection
performance of the network for each category of objects, and the mAP
value indicates the overall detection performance of the network on this
dataset.</p>
<h2 id="experimental-results-analysis">4. Experimental Results
Analysis</h2>
<h3 id="analysis-of-experimental-metrics-results">4.1 Analysis of
Experimental Metrics Results</h3>
<p>In this article, the YOLOv5 network is trained for 300 epochs on the
dataset mentioned above, and the final detection performance for each
category is shown in the following table:</p>
<center>
Table 4-1 Performance on the Test Set
</center>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Class</th>
<th style="text-align: center;">Labels</th>
<th style="text-align: center;">P</th>
<th style="text-align: center;">R</th>
<th style="text-align: center;">mAP@.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">all</td>
<td style="text-align: center;">256</td>
<td style="text-align: center;">0.928</td>
<td style="text-align: center;">0.758</td>
<td style="text-align: center;">0.887</td>
</tr>
<tr class="even">
<td style="text-align: center;">hero</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">0.959</td>
<td style="text-align: center;">0.789</td>
<td style="text-align: center;">0.926</td>
</tr>
<tr class="odd">
<td style="text-align: center;">grass</td>
<td style="text-align: center;">91</td>
<td style="text-align: center;">0.828</td>
<td style="text-align: center;">0.637</td>
<td style="text-align: center;">0.775</td>
</tr>
<tr class="even">
<td style="text-align: center;">dogface</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">0.839</td>
<td style="text-align: center;">0.688</td>
<td style="text-align: center;">0.824</td>
</tr>
<tr class="odd">
<td style="text-align: center;">tower</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">0.988</td>
<td style="text-align: center;">0.667</td>
<td style="text-align: center;">0.833</td>
</tr>
<tr class="even">
<td style="text-align: center;">buff</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.916</td>
<td style="text-align: center;">0.995</td>
</tr>
<tr class="odd">
<td style="text-align: center;">monster</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0.997</td>
<td style="text-align: center;">0.667</td>
<td style="text-align: center;">0.851</td>
</tr>
<tr class="even">
<td style="text-align: center;">blood</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.935</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.995</td>
</tr>
<tr class="odd">
<td style="text-align: center;">dragon</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">0.875</td>
<td style="text-align: center;">0.701</td>
<td style="text-align: center;">0.899</td>
</tr>
</tbody>
</table>
<p>The model's test results are shown in the following figures:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231714177.png?x-oss-process=style/webp"
alt="Figure 4-1 Model Prediction Accuracy and Confidence Curve" />
<figcaption aria-hidden="true">Figure 4-1 Model Prediction Accuracy and
Confidence Curve</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/202201231717272.png?x-oss-process=style/webp"
alt="Figure 4-2 Model Recall and Confidence Curve" />
<figcaption aria-hidden="true">Figure 4-2 Model Recall and Confidence
Curve</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/202201231718078.png?x-oss-process=style/webp"
alt="Figure 4-3 Model P-R Curve" />
<figcaption aria-hidden="true">Figure 4-3 Model P-R Curve</figcaption>
</figure>
<p>From the above experimental results, it can be seen that the overall
detection accuracy of the model is 92.8%, the recall rate is 75.8%, and
the average precision is 88.7%. The performance is good. However, there
are significant differences in the target detection performance among
specific categories. Specifically, the recognition ability is better for
subjects with more obvious features and relatively large amounts of
data, such as heroes, towers, red and blue buffs, and monsters.</p>
<p>In addition, overall, the model has good recognition accuracy but
poor recall. That is, it rarely misidentifies the types of detected
targets, but not all targets can be recognized. Combining the visual
results, it is initially inferred that this is due to the uneven
distribution of the annotated dataset and insufficient data. In the
future, it is possible to improve the detection performance of the model
by supplementing the dataset.</p>
<h3 id="visualization-of-experimental-results">4.2 Visualization of
Experimental Results</h3>
<p>Some detection results and annotated data on the validation set are
shown in the following figures:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202201231725232.jpg?x-oss-process=style/webp"
alt="Figure 4-4 Model Prediction Results on the Validation Set" />
<figcaption aria-hidden="true">Figure 4-4 Model Prediction Results on
the Validation Set</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/202201231725560.jpg?x-oss-process=style/webp"
alt="Figure 4-5 Manually Annotated Data on the Validation Set" />
<figcaption aria-hidden="true">Figure 4-5 Manually Annotated Data on the
Validation Set</figcaption>
</figure>
<p>In addition, the trained model was tested on a different game video
with different heroes, and the final test result video link is as
follows:</p>
<p>https://www.bilibili.com/video/BV1Ya411m7mx?share_source=copy_web</p>
<p>From the video, it can be seen that although the heroes in this game
video did not appear in the training set, the model can still locate and
identify the corresponding subjects as hero category. This indicates
that the model has good generalization performance on game art
materials, and it can recognize the corresponding subjects even for
textures that have not been trained.</p>
<h2 id="conclusion">5. Conclusion</h2>
<p>In this article, the YOLOv5 network is used to build target detection
in game scenes. The important subjects in the game screens are
successfully located and identified through image recognition. The model
trained with a small amount of data achieves an average precision of
over 80%. If more data can be collected, the final detection performance
can be further improved. With the continuous development of target
detection technology, the accuracy of image object detection is
constantly improving, and the detection time is also getting shorter.
This provides new data processing methods and ideas for intelligent
decision-making and combat of intelligent agents. In the future,
intelligent agents may be able to achieve high levels of intelligence
based on this technology, mainly relying on direct image input rather
than manually converted data.</p>
<h2 id="references">References</h2>
<ol type="1">
<li>Silver, D., Huang, A., Maddison, C.J., Guez, A., Sifre, L., Van Den
Driessche, G., Schrittwieser, J., Antonoglou, I., Panneershelvam, V.,
Lanctot, M. and Dieleman, S., 2016. Mastering the game of Go with deep
neural networks and tree search. <em>nature</em>, <em>529</em>(7587),
pp.484-489.</li>
<li>Silver, D., Hubert, T., Schrittwieser, J., Antonoglou, I., Lai, M.,
Guez, A., Lanctot, M., Sifre, L., Kumaran, D., Graepel, T. and
Lillicrap, T., 2018. A general reinforcement learning algorithm that
masters chess, shogi, and Go through self-play. <em>Science</em>,
<em>362</em>(6419), pp.1140-1144.</li>
<li>Vinyals, O., Babuschkin, I., Czarnecki, W.M., Mathieu, M., Dudzik,
A., Chung, J., Choi, D.H., Powell, R., Ewalds, T., Georgiev, P. and Oh,
J., 2019. Grandmaster level in StarCraft II using multi-agent
reinforcement learning. <em>Nature</em>, <em>575</em>(7782),
pp.350-354.</li>
<li>Wu, B., 2019, July. Hierarchical macro strategy model for moba game
ai. In <em>Proceedings of the AAAI Conference on Artificial
Intelligence</em> (Vol. 33, No. 01, pp. 1206-1213).</li>
<li>Ultralytics. (n.d.). <em>Ultralytics</em>. [online] Available at:
https://ultralytics.com/yolov5.</li>
<li>Bochkovskiy, A., Wang, C.Y. and Liao, H.Y.M., 2020. Yolov4: Optimal
speed and accuracy of object detection. <em>arXiv preprint
arXiv:2004.10934</em>.</li>
</ol>
<h2 id="appendix-download">Appendix Download</h2>
<p>Manual annotation dataset and video segmentation program:
<a class="btn" href="https://server.kezhi.tech:9160/f/9c47b7368cde4dcdbae5/?dl=1"><i class="fa fa-download fa-lg fa-fw"></i>video2img.zip</a></p>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Computer Vision</tag>
        <tag>Target Detection</tag>
      </tags>
  </entry>
  <entry>
    <title>Computer Software Configuration List.</title>
    <url>/en/f9af8ec4.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/f9af8ec4.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>I used to help my friends around me with computer hardware
configurations. However, for personal computers, if you install software
randomly or use inappropriate software, it will greatly reduce the
efficiency of computer usage. At the same time, when I get a new
computer, I also need to initialize and configure many software
according to my habits. Therefore, I had the idea of writing a software
configuration checklist, which can not only provide software
recommendations for everyone, but also serve as a reference for
myself.</p>
<p><img src="https://download.kezhi.tech/img/202311061722807.png?x-oss-process=style/webp" style="width:67%;" /></p>
<span id="more"></span>
<h2 id="tools">Tools</h2>
<ul>
<li><p>Huorong Security Software: Can be installed on desktop computers,
it is convenient for intercepting pop-ups. <a
href="https://www.huorong.cn/">Huorong Security (huorong.cn)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061657296.svg" style="width:30%;" /></p></li>
<li><p>DaVinci Resolve: A user-friendly video editing and color grading
software. <a
href="https://www.blackmagicdesign.com/products/davinciresolve">DaVinci
Resolve 18 | Blackmagic Design</a></p>
<p><img src="https://download.kezhi.tech/img/202311061659458.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>OBS Studio: An extremely useful open-source screen recording
software. <a href="https://obsproject.com/">Open Broadcaster Software |
OBS (obsproject.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061701825.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>NetEase Mail Master: An email management software. <a
href="https://dashi.163.com/">NetEase Mail Master - Efficient and
Powerful Cross-platform Email Client (163.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061702553.svg" style="width:50%;" /></p></li>
<li><p>BandZip: Compression and decompression tool, now with ads. <a
href="https://www.bandisoft.com/bandizip/">Bandizip for Windows -
Leading Compression Software Solution (bandisoft.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061712628.png?x-oss-process=style/webp" style="width:10%;" /></p></li>
<li><p>Geek Uninstaller, <a
href="https://geekuninstaller.com/download">Geek Uninstaller -
Download</a></p>
<p><img src="https://download.kezhi.tech/img/202311061716309.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>PotPlayer: Free and powerful open-source video player. <a
href="https://potplayer.daum.net/">Global Potplayer (daum.net)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061714968.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>SeaDrive: Seafile cloud drive mounting tool. <a
href="https://www.seafile.com/download/">Download - Seafile</a></p>
<p><img src="https://download.kezhi.tech/img/202311061717524.png?x-oss-process=style/webp" style="width:33%;" /></p></li>
<li><p>MemReduct: Recommended for Win10+ systems, used to clean up
memory. <a href="https://mem-reduct.updatestar.com/">Mem Reduct 3.4 -
Download (updatestar.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202312201630287.png" style="width:25%;" /></p></li>
</ul>
<h2 id="learning">Learning</h2>
<ul>
<li><p>Zotero: An extremely useful reference management tool. <a
href="https://www.zotero.org/">Zotero | Your personal research
assistant</a>, for plugins, please visit <a
href="https://kezhi.tech/b2344ef.html">Zotero Plugin Recommendations and
Downloads | Kezhi's Blog</a></p>
<p><img src="https://download.kezhi.tech/img/202311061647205.png?x-oss-process=style/webp" style="width:50%;" /></p></li>
<li><p>Typora: An extremely useful Markdown editing tool. <a
href="https://typora.io/">Typora — a markdown editor, markdown
reader.</a></p>
<p><img src="https://download.kezhi.tech/img/202311061651956.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>PicGo: Used in conjunction with Typora to manage image hosting.
<a href="https://molunerfinn.com/PicGo/">PicGo (molunerfinn.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061651551.png?x-oss-process=style/webp" alt="PicGo" style="width:20%;" /></p></li>
<li><p>Pandoc: A useful Markdown rendering tool, used in conjunction
with Typora. <a href="https://pandoc.org/">Pandoc - index</a></p>
<p><img src="https://download.kezhi.tech/img/202311061719162.png?x-oss-process=style/webp" style="width:33%;" /></p></li>
<li><p>NetEase Youdao Dictionary: Not a very useful translation tool,
but I couldn't find a better one. <a
href="https://www.youdao.com/">NetEase Youdao (youdao.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061654361.png?x-oss-process=style/webp" style="width: 33%;" /></p></li>
<li><p>Pot: A relatively useful translation software that allows custom
translation sources. <a href="https://pot-app.com/">Pot | Cross-platform
Word Translation and OCR (pot-app.com)</a></p>
<p><img src="https://pot-app.com/logo/icon.svg" alt="img" style="width:25%;" /></p></li>
</ul>
<h2 id="development">Development</h2>
<ul>
<li><p>Visual Studio Code: <del>The best</del> code editor. <a
href="https://code.visualstudio.com/">Visual Studio Code - Code Editing.
Redefined</a></p>
<p><img src="https://download.kezhi.tech/img/202311061708754.png?x-oss-process=style/webp" style="width:33%;" /></p></li>
<li><p>Git: Version control tool. <a href="https://git-scm.com/">Git
(git-scm.com)</a></p>
<p><img src="https://download.kezhi.tech/img/202311061709133.png?x-oss-process=style/webp" style="width:20%;" /></p></li>
<li><p>Anaconda3: A useful Python environment management tool. <a
href="https://www.anaconda.com/download">Free Download |
Anaconda</a></p>
<p><img src="https://download.kezhi.tech/img/202311061710853.svg" style="width:33%;" /></p></li>
</ul>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>List</tag>
      </tags>
  </entry>
  <entry>
    <title>Social Psychology (Part One).</title>
    <url>/en/1eea1e9f.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/1eea1e9f.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="the-self-in-society">The Self in Society</h2>
<h3 id="self-concept-who-am-i">Self-concept: Who am I</h3>
<ol type="1">
<li>People often see themselves as the center of everything,
overestimating how much others pay attention to us. This is known as the
<strong>spotlight effect</strong>.</li>
<li>We are sensitive to changes in our emotions and believe that others
also notice them clearly. However, the number of people who actually
notice us is often fewer than we think. This is known as the
<strong>transparency illusion</strong>.</li>
<li>Social environment influences self-perception, and our understanding
of ourselves in different environments is influenced by the differences
in those environments. For example, when abroad, we may identify
ourselves as Chinese, but when in our home country, we may identify more
with a specific region (e.g. being from Shaanxi or Xi'an).</li>
<li>Self-perception is often biased towards self-interest. When problems
arise, people tend to blame others, while when achievements are made,
people often feel that their contributions are underestimated.</li>
<li>We define ourselves in social relationships. Our behavior may vary
when interacting with different people, and these variations help us
understand and define our own roles.</li>
<li><strong>Self-schemas</strong> play a significant role in our
self-perception and information processing. They determine how we
perceive, remember, and evaluate others and ourselves. For example, a
professional athlete may pay particular attention to others' bodies and
skills.</li>
<li>The <strong>self-reference effect</strong> leads us to have a
stronger memory for things related to ourselves. Because we see
ourselves as the center of the world, we tend to overestimate the extent
to which events are directed towards us (we always believe that we are
the central figure in accomplishing something).</li>
</ol>
<h3 id="self-awareness">Self-awareness</h3>
<ol type="1">
<li>When explaining our own behavior, we tend to overestimate the role
of our thoughts and consciousness while underestimating the influence of
external factors. For example, people often believe that they are not
influenced by the media and think that the media only affects
others.</li>
<li>Others can often predict our behavior more accurately than we can
predict it ourselves. This is because when making self-predictions, we
tend to focus on prominent factors in the present and overlook important
but unnoticed factors. This leads to errors in future expectations.</li>
<li>In negative events, we tend to exhibit impact bias, overestimating
the lasting impact of the events and underestimating our own resilience.
Moreover, significant negative events can trigger our psychological
defense mechanisms, which may result in shorter durations of distress
compared to minor emotional fluctuations.</li>
<li>One viewpoint suggests that our actual thinking process and our
explanations of our thinking are two different things. For example, when
asked to explain why they like a particular painting, participants who
were required to provide reasons showed lower satisfaction with the
painting several weeks later compared to those who did not provide
attributions. This suggests that rational attributions of our mental
processes can render our future predictions invalid, indicating that
there are many aspects of our actual thinking process that cannot be
captured when analyzing our own thoughts.</li>
</ol>
<h3 id="self-control">Self-control</h3>
<ol type="1">
<li>Self-control is a depletable resource, similar to muscle strength.
It becomes weaker after being used and recovers after rest, and it can
be strengthened through continuous training. Self-control is limited,
and when we expend a significant amount of energy on self-control in
daily life (e.g. resisting food or suppressing thoughts), we may become
powerless when facing challenges.</li>
<li><strong>Self-efficacy</strong>, the optimistic belief in one's own
abilities and efficiency, can lead to greater rewards. Individuals with
high self-efficacy are more resilient and live healthier lives.</li>
<li>Locus of control refers to whether we believe that we control our
own destiny (internal locus of control) or that external forces control
it (external locus of control). Whether we feel that we have control
over our destiny depends on how we interpret setbacks. Individuals with
an internal locus of control tend to attribute failures to unexpected
circumstances or the need to try new approaches. On the other hand,
individuals with an external locus of control attribute failures to
factors they believe they cannot control (e.g. attributing poor academic
performance to being dumb or disliking the teacher).</li>
<li><strong>Learned helplessness</strong> occurs when individuals feel
that they have no control over their own actions or the actions of
others, leading to a loss of control over events. In contrast,
self-determination involves having some control over oneself and the
environment. Learned helplessness often leads to increased stress,
weakness, and rapid aging. Increasing self-control can enhance
individual happiness and health. However, excessive freedom and
self-determination can also lead to decreased life satisfaction and
increased rates of depression. Having too many choices can leave
individuals feeling overwhelmed.</li>
</ol>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>心理学</tag>
      </tags>
  </entry>
  <entry>
    <title>Research problem record.</title>
    <url>/en/4efb358.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/4efb358.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="introduction">Introduction</h2>
<p>In the process of scientific research and engineering practice, the
solution to a problem often comes with the emergence of new problems.
These problems often occur in specific scenarios, but their abstractions
have a certain universality, making them the starting point for
scientific research.</p>
<p><img src="https://download.kezhi.tech/img/202207200159235.jpg?x-oss-process=style/webp" width=30%></p>
<span id="more"></span>
<h2 id="game-theory-related-problem-records">Game Theory Related Problem
Records</h2>
<ol type="1">
<li><p>Counterfactual Regret Minimization (CFR) algorithms are often
used to solve discrete problems that can be modeled using game trees.
However, in real-world problems, the state transitions often take the
form of a cyclic graph rather than a tree. If historical information is
included, the resulting tree would be very large and similar states
cannot be efficiently processed. How can we use the regret minimization
approach in such problems?</p></li>
<li><p>In game theory, discrete problems are usually represented in the
form of game trees. By iteratively computing on the game tree, the
optimal solution or approximate Nash equilibrium solution can be
obtained. However, solving continuous problems is often more difficult.
How can continuous problems be transformed into problems that can be
modeled using game trees, so that iterative algorithms for discrete
problems can be applied? This is a question worth pondering.</p></li>
</ol>
<h2 id="reinforcement-learning-related-problem-records">Reinforcement
Learning Related Problem Records</h2>
<ol type="1">
<li>In multi-agent reinforcement learning, one solution is to adopt a
hierarchical approach. The upper level makes macro decisions based on
global information, while the lower level performs micro operations
based on the macro decisions provided by the upper level. In this
process, there will inevitably be numerous small teams collaborating to
perform various tasks. These teams may have varying numbers of members,
heterogeneity, and cooperative properties. How can we cleverly handle
the self-organizing heterogeneous team problem in this reinforcement
learning architecture?</li>
</ol>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>强化学习</tag>
        <tag>博弈论</tag>
        <tag>多智能体</tag>
      </tags>
  </entry>
  <entry>
    <title>Naming and Scope in Programs.</title>
    <url>/en/48242c23.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/48242c23.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Recently, I have been reading "The Essence of Code", which explains
the concepts behind many programming languages. This note mainly refers
to Chapter 7 of the book: Names and Scopes.</p>
<figure>
<img
src="https://download.kezhi.tech/img/202211261934570.png?x-oss-process=style/webp"
alt="转自:米游社@战小医仙" />
<figcaption aria-hidden="true">转自:米游社@战小医仙</figcaption>
</figure>
<span id="more"></span>
<h2 id="naming">Naming</h2>
<p>When a computer executes a program, it does so based on the
information in memory addresses, without needing to know the names of
each variable. Therefore, early programming did not have the concept of
naming. Later, in order to facilitate programmers in remembering the
meanings and types represented by variables, names were given to
variables and functions. For example, compared to "Longitude:
108.654519, Latitude: 34.255314", "China Western Science and Technology
Innovation Port" is easier to understand and remember. Similarly,
compared to "8.7.198.46", the description "a non-existent website" is
more memorable.</p>
<p>So how does a computer associate names with variables and functions?
The answer is by using a lookup table. This is similar to finding a book
in a library by searching the database, converting the book title into a
classification number, and then using the classification number to
locate the desired book. Taking the library of the Innovation Port as an
example:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;The Essence of Code&quot; =&gt; TP312/159, &quot;The First Volume of Ancient and Modern Mathematical Thoughts&quot; =&gt; O11/510-1/C.1</span><br></pre></td></tr></table></figure>
<p>With such a lookup table, when the computer processes the command
"find 'The Essence of Code'", it can be translated into "find the book
with the number TP312/159" for execution.</p>
<p>Taking Python as an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&#x27;python&#x27;</span></span><br><span class="line">y = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">z = x</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span>(x)	<span class="comment"># =&gt; 2256008235312</span></span><br><span class="line"><span class="built_in">id</span>(y)	<span class="comment"># =&gt; 2256008254512</span></span><br><span class="line"><span class="built_in">id</span>(z)	<span class="comment"># =&gt; 2256008235312</span></span><br></pre></td></tr></table></figure>
<p>In the above program, the computer establishes the following lookup
table:</p>
<pre class="mermaid">graph LR
x[x]-->a[2256008235312]
y[y]-->b[2256008254512]
z[z]-->a</pre>
<p>In the above lookup table, the variable x and the variable z point to
the same memory address. Therefore, when the variable z changes, the
variable x will also change accordingly. <del>It's just that strings in
Python are immutable</del></p>
<h2 id="naming-conflicts">Naming Conflicts</h2>
<p>In early program design, the lookup table was shared by the entire
program. This can lead to some problems, such as the following C++
code:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">		<span class="built_in">print</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This loop should end after running 10 times. However, what if the
variable <code>i</code> is modified in the function
<code>print</code>:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;ok&quot;</span>&lt;&lt;endl;</span><br><span class="line">	i--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Since the variable <code>i</code> is used both inside and outside the
function, it cannot end directly after the expected 10 iterations of the
<code>for</code> loop. It will loop indefinitely.</p>
<p>How to avoid such naming conflicts? One way is to use longer names
and indicate in the name what the variable is used for. For example,
<code>i_in_print</code> and <code>i_in_main</code>, or use a variable
naming policy for management in collaborative development.</p>
<p>Another way is to introduce scopes. The following text will mainly
focus on scopes.</p>
<h2 id="scopes">Scopes</h2>
<p>Scope refers to the range of validity of a name. In order to prevent
the operation of <code>i</code> in the <code>print</code> function from
affecting the outside, its value can be stored before the function is
executed and retrieved after the function is executed. This mechanism is
called dynamic scoping.</p>
<h3 id="dynamic-scoping">Dynamic Scoping</h3>
<p>Taking the <code>Perl</code> language as an example, the variable
value is saved at the entrance of the function and written back at the
end of the function.</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">shori</span></span>&#123;</span><br><span class="line">	$old_i = $i;</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line">	$i = $old_i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>However, this approach has a problem. When a function is called
within another function, the modification of variables will affect the
called function. Take the following two functions as an example:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">$x = <span class="string">&quot;global&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">yobu</span> </span>&#123;</span><br><span class="line">	<span class="keyword">local</span> $x = <span class="string">&quot;yobu&quot;</span>;</span><br><span class="line">	&amp;yobarebu();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">yobarebu</span> </span>&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;$x\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When the function <code>yobu</code> is called, the variable
<code>x</code> is changed to <code>yobu</code>. Before the function is
executed and the value is written back, when the <code>yobarebu</code>
function is called, the value of the variable <code>x</code> used is
<code>yobu</code>. This shows that the modification of variables in the
<code>yobu</code> function affects the execution of the called
function.</p>
<p>The reason for this phenomenon is that in dynamic scoping, all
variables share a global lookup table, and when entering a function, a
dynamic lookup table is created, which is shared by all functions and
can be accessed by all functions. This leads to the occurrence of the
above phenomenon.</p>
<p>In summary, in dynamic scoping, when each variable is searched for
its corresponding address, it is searched in order from the nearest to
the farthest. This causes the phenomenon of mutual influence when
functions are nested. To solve this problem, we can use separate lookup
tables for each function to store variables. This is called static
scoping.</p>
<h3 id="static-scoping">Static Scoping</h3>
<p>Static scoping uses a separate variable table for each function. When
the computer searches for a variable, it first searches in the variable
table of the current function, and if it is not found, it searches in
the global variable table. This effectively solves the problem of mutual
influence when functions are nested in dynamic scoping.</p>
<p>However, static scoping also has some problems. One is the problem of
nested functions. Taking Python as an example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&quot;global&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    x = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bar</span>():</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">    bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>In this nested function, at first glance, the output of the
<code>x</code> in the <code>bar</code> function should be
<code>foo</code>. However, in Python 2, when the <code>bar</code>
function searches for the variable <code>x</code>, it first searches in
the local lookup table, and if it is not found, it directly searches in
the global lookup table. Therefore, the output result is
<code>global</code>. This design brings a lot of misunderstandings to
the program. This problem was not solved until Python 3.</p>
<p>The second problem is rebinding in the outer scope. When we want to
modify a value in an outer scope within a function, a new variable will
be created instead, making it impossible to modify the value in the
outer scope. For example:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&quot;global&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    x = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bar</span>():</span><br><span class="line">        x = <span class="string">&quot;bar&quot;</span></span><br><span class="line">        <span class="comment"># A new x is created</span></span><br><span class="line">        <span class="comment"># Unable to modify the outer x</span></span><br><span class="line">    bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>In Python 3.0, the <code>nonlocal</code> keyword was introduced to
solve this problem:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="string">&quot;global&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    x = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bar</span>():</span><br><span class="line">    	<span class="keyword">nonlocal</span> x</span><br><span class="line">        x = <span class="string">&quot;bar&quot;</span></span><br><span class="line">        <span class="comment"># A new x is created</span></span><br><span class="line">        <span class="comment"># Unable to modify the outer x</span></span><br><span class="line">    bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<h2 id="summary">Summary</h2>
<p>The development of computer technology has brought about more
powerful computing capabilities, resulting in increasingly complex
programs. The development of naming and scoping highlights the
contradiction between humans and computers when naming variables and
functions in large-scale programs. Any feature in a programming language
is not created out of thin air, but appears to solve certain
problems.</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Programming</tag>
      </tags>
  </entry>
  <entry>
    <title>Linear filtering and nonlinear filtering experiments.</title>
    <url>/en/10ee70e7.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/10ee70e7.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>This article presents experiments on linear filtering and nonlinear
filtering for estimating the free fall motion. The following figure is
from Professor Cai Yuanli's course "Random Filtering and Control" at
Xi'an Jiaotong University. The course mainly discusses various filtering
methods related to estimation, smoothing, and prediction.</p>
<figure>
<img
src="https://download.kezhi.tech/img/202211291710418.jpg?x-oss-process=style/webp"
alt="Map of Control Theory" />
<figcaption aria-hidden="true">Map of Control Theory</figcaption>
</figure>
<span id="more"></span>
<h2 id="problem-description">Problem Description</h2>
<ol type="1">
<li><p>A object is in free fall motion, and its height has been measured
20 times. The measurement values are shown in the following table:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202206171143534.png?x-oss-process=style/webp"
alt="image-20220617114332337" />
<figcaption aria-hidden="true">image-20220617114332337</figcaption>
</figure></li>
<li><p>Consider the same object in free fall motion, and use a radar (in
the same horizontal plane as the object) for measurement. The
measurement noise of radar range and angle is a Gaussian white noise
sequence with a mean of 0 and a variance matrix <span
class="math inline">\(R=\begin{bmatrix}0.04
&amp;0\\0&amp;0.01\end{bmatrix}\)</span>. Based on the following
measurement data, determine the estimated values of the object's height
and downward velocity over time:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202206171202388.png?x-oss-process=style/webp"
alt="image-202206171202388" />
<figcaption aria-hidden="true">image-202206171202388</figcaption>
</figure>
<figure>
<img
src="https://download.kezhi.tech/img/202206171212236.png?x-oss-process=style/webp"
alt="image-202206171212236" />
<figcaption aria-hidden="true">image-202206171212236</figcaption>
</figure>
<p>The descent motion and radar detection information are shown in the
following figure:</p>
<figure>
<img
src="https://download.kezhi.tech/img/202206171212177.png?x-oss-process=style/webp"
alt="image-202206171212177" />
<figcaption aria-hidden="true">image-202206171212177</figcaption>
</figure></li>
</ol>
<h2 id="model-introduction">Model Introduction</h2>
<h3 id="linear-estimation-problem">1. Linear Estimation Problem</h3>
<p>Assume that during free fall motion, the object's height is <span
class="math inline">\(h\)</span> and velocity is <span
class="math inline">\(v\)</span> (downward is positive). Let <span
class="math inline">\(x_1=h\)</span> and <span
class="math inline">\(x_2=v\)</span>, then the system's state equation
is:</p>
<p><span class="math display">\[
    \begin{bmatrix}
        \dot x_1\\\dot x_2
    \end{bmatrix}=
    \begin{bmatrix}
        0&amp;-1\\
        0&amp;0\\
    \end{bmatrix}
    \begin{bmatrix}
        x_1\\x_2
    \end{bmatrix}+
    \begin{bmatrix}
        0\\1
    \end{bmatrix}g\ \ (g=9.80m/s^2)
\]</span></p>
<p>The state transfer function of the system can be solved from the
above state equation:</p>
<p><span class="math display">\[
    x(t)=\begin{bmatrix}
        1&amp;-t\\
        0&amp;1
    \end{bmatrix}x(0)
    +\begin{bmatrix}
        -t\\1
    \end{bmatrix}u(t)
\]</span></p>
<p>When the time step is 1s, the state transfer function of the system
is:</p>
<p><span class="math display">\[
\Phi_{k+1,k}=\begin{bmatrix}
        1&amp;-1\\
        0&amp;1
    \end{bmatrix}
    \ \Psi_{k+1,k}=\begin{bmatrix}
        -1\\
        1
    \end{bmatrix}
\]</span></p>
<p>Therefore, the one-step prediction of the system is:</p>
<p><span class="math display">\[
x_{k+1,k}=\Phi_{k+1,k}x_{k|k}+\Psi_{k+1,k}u_k
\]</span></p>
<p>Since the observation is a direct measurement of the object's height,
and assuming the measurement error is a white noise with a mean of 0 and
a variance of 1, the measurement equation is:</p>
<p><span class="math display">\[
    y_k=H_kx_k+v_k
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
H_k\equiv \begin{bmatrix}
    1\\0
\end{bmatrix},
\ v_k \sim N(0,1),
\ R=1
\]</span></p>
<p>In this problem, the measurement height unit is <span
class="math inline">\(km\)</span>, and the acceleration is <span
class="math inline">\(9.8m/s^2\)</span>. For ease of calculation, the
distance unit is unified to <span class="math inline">\(km\)</span>, and
the time unit is unified to <span class="math inline">\(s\)</span>, so
the gravity acceleration <span
class="math inline">\(g=0.0098km/s\)</span>. Since the initial value of
the filter is not given, the initial height is estimated as <span
class="math inline">\(2km\)</span> based on the measurement data, and
the initial velocity is 0, i.e., <span
class="math inline">\(x_{0|0}=\begin{bmatrix}2&amp;0\end{bmatrix}\)</span>.
Since the initial estimate value determined in this way is relatively
rough, the variance is large. Therefore, the initial variance matrix of
the system is set to <span
class="math inline">\(P_{0|0}=\begin{bmatrix}10&amp;0\\0&amp;10\end{bmatrix}\)</span>.</p>
<p>Establish the Kalman filter equations: <span class="math display">\[
x_{k+1,k}=\Phi_{k+1,k}x_{k|k}+\Psi_{k+1,k}u_k\\
P_{k+1|k}=\Phi_{k+1,k}P_{k|k}\Phi^\top_{k+1,k}\\
P_{k+1|k+1}=[P_{k+1|k}^{-1}+H_{k+1}^{\top} R_{k+1}^{-1}H_{k+1}]^{-1}\\
K_{k+1}=P_{k+1|k+1}H_{k+1}^\top R_{k+1}^{-1}\\
\hat x_{k+1|k+1}=\hat x_{k+1|k}+K_{k+1}(y_{k+1}-H_{k+1}\hat x_{k+1|k})
\]</span> Calculate the descent height and velocity of the object, and
the calculation results are shown in the experimental results section
below.</p>
<h3 id="nonlinear-estimation-problem">2. Nonlinear Estimation
Problem</h3>
<p>In the second problem, the measurement and estimation values are
nonlinearly related. Consider using the Extended Kalman Filter (EKF)
algorithm to estimate it. In this report, the Extended Kalman Filter
algorithm is used.</p>
<p>Let the measured slant range be <span
class="math inline">\(l(km)\)</span>, the elevation angle be <span
class="math inline">\(\theta(rad)\)</span>, the height of the object be
<span class="math inline">\(h(km)\)</span>, and the downward velocity be
<span class="math inline">\(v(km/s)\)</span> (downward is positive). The
vertical projection of the object on the ground to the radar is <span
class="math inline">\(d_0\)</span>.</p>
<p>For ease of subsequent linearization calculations, the system state
variables are selected as: <span class="math display">\[
x_1=h,\ x_2=v,\ x_3=d_0
\]</span> Then the system's state equation is: <span
class="math display">\[
\dot x=
\begin{bmatrix}
0&amp;-1&amp;0\\
0&amp;0&amp;0\\
0&amp;0&amp;0
\end{bmatrix}x+
\begin{bmatrix}
0\\
1\\
0
\end{bmatrix}g,\ where\ g=0.0098\ km/s
\]</span> Solving the equation, when the time interval is <span
class="math inline">\(0.5s\)</span>, the discrete state transfer
function of the system is: <span class="math display">\[
\Phi_{k+1,k}=\begin{bmatrix}
1&amp;-0.5&amp;0\\
0&amp;1&amp;0\\
0&amp;0&amp;1
\end{bmatrix},\
\Psi_{k+1,k}=\begin{bmatrix}
-0.125\\
0.5\\
0
\end{bmatrix}
\]</span> The observation of the system is the slant range and elevation
angle measured by the radar, then: <span class="math display">\[
y_1=l=\sqrt{h^2+d_0^2}=\sqrt{x_1^2+x_3^2}\\
y_2=\theta=\arctan(\frac{h}{d_0})=\arctan(\frac{x_1}{x_3})
\]</span> Taking the derivative of the observation with respect to the
state variables, we have: <span class="math display">\[
\frac{\partial y_1}{\partial x_1}=\frac{x_1}{\sqrt{x_1^2+x_3^2}}\\
\frac{\partial y_1}{\partial x_2}=0\\
\frac{\partial y_1}{\partial x_3}=\frac{x_3}{\sqrt{x_1^2+x_3^2}}\\
\frac{\partial y_2}{\partial x_1}=\frac{x_3}{x_1^2+x_3^2}\\
\frac{\partial y_2}{\partial x_2}=0\\
\frac{\partial y_2}{\partial x_3}=-\frac{x_1}{x_1^2+x_3^2}\\
\]</span> Therefore, the local linearization coefficients of the system
are: <span class="math display">\[
H=\begin{bmatrix}
\frac{x_1}{\sqrt{x_1^2+x_3^2}}&amp;0&amp;\frac{x_3}{\sqrt{x_1^2+x_3^2}}\\
\frac{x_3}{x_1^2+x_3^2}&amp;0&amp;-\frac{x_1}{x_1^2+x_3^2}
\end{bmatrix}
\]</span> The calculation process of the Extended Kalman Filter (EKF) is
as follows: <span class="math display">\[
x_{k+1,k}=\Phi_{k+1,k}x_{k|k}+\Psi_{k+1,k}u_k\\
P_{k+1|k}=\Phi_{k+1,k}P_{k|k}\Phi^\top_{k+1,k}\\
P_{k+1|k+1}=[P_{k+1|k}^{-1}+H_{k+1}^{\top} R_{k+1}^{-1}H_{k+1}]^{-1}\\
K_{k+1}=P_{k+1|k+1}H_{k+1}^\top R_{k+1}^{-1}\\
\hat x_{k+1|k+1}=\hat x_{k+1|k}+K_{k+1}(y_{k+1}-H_{k+1}\hat x_{k+1|k})
\]</span> The difference between the Extended Kalman Filter and the
Kalman Filter is that the coefficient matrix <span
class="math inline">\(H\)</span> is obtained by local linearization at
the observation point. With the above steps, the nonlinear observation
can be filtered and estimated.</p>
<h2 id="experimental-results">Experimental Results</h2>
<h3 id="linear-filtering-problem">1. Linear Filtering Problem</h3>
<p>Based on the given height observation data, linear Kalman filtering
is performed, and the calculated results are as follows:</p>
<p>The estimated height data is:</p>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Time</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Height</td>
<td style="text-align: center;">1.9943</td>
<td style="text-align: center;">1.9791</td>
<td style="text-align: center;">1.9550</td>
<td style="text-align: center;">1.9211</td>
<td style="text-align: center;">1.8774</td>
<td style="text-align: center;">1.8244</td>
<td style="text-align: center;">1.7605</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Time</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">12</th>
<th style="text-align: center;">13</th>
<th style="text-align: center;">14</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Height</td>
<td style="text-align: center;">1.6870</td>
<td style="text-align: center;">1.6038</td>
<td style="text-align: center;">1.5103</td>
<td style="text-align: center;">1.4075</td>
<td style="text-align: center;">1.2947</td>
<td style="text-align: center;">1.1723</td>
<td style="text-align: center;">1.0400</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Time</th>
<th style="text-align: center;">15</th>
<th style="text-align: center;">16</th>
<th style="text-align: center;">17</th>
<th style="text-align: center;">18</th>
<th style="text-align: center;">19</th>
<th style="text-align: center;">20</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Height</td>
<td style="text-align: center;">0.8980</td>
<td style="text-align: center;">0.7460</td>
<td style="text-align: center;">0.5845</td>
<td style="text-align: center;">0.4129</td>
<td style="text-align: center;">0.2317</td>
<td style="text-align: center;">0.0405</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>The height change graph is shown below:</p>
<p><img
src="https://download.kezhi.tech/img/202206171314878.png?x-oss-process=style/webp" /></p>
<p>The filtered data of the downward velocity (positive downward) is as
follows:</p>
<div class="line-block">  Time | 1 | 2 | 3 | 4 | 5 | 6 | 7 |<br />
:: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |<br />
Velocity | 0.0078 | 0.0157 | 0.0247 | 0.0343 | 0.0439 | 0.0536 | 0.0635
|</div>
<div class="line-block">  Time | 8 | 9 | 10 | 11 | 12 | 13 | 14 |<br />
:: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |<br />
Velocity | 0.0733 | 0.0831 | 0.0930 | 0.1028 | 0.1126 | 0.1224 | 0.1322
|</div>
<div class="line-block">  Time | 15 | 16 | 17 | 18 | 19 | 20 | |<br />
:: | :-: | :-: | :-: | :-: | :-: | :-: | :--: |<br />
Velocity | 0.1420 | 0.1519 | 0.1616 | 0.1714 | 0.1812 | 0.1911 | |</div>
<p>The velocity change graph is shown below:</p>
<p><img
src="https://download.kezhi.tech/img/202206171354944.png?x-oss-process=style/webp" /></p>
<p>At the same time, the estimated variance of the height and velocity
over time is:</p>
<table>
<tr>
<td>
<center>
Estimated Variance of Height
</center>
</td>
<td>
<center>
Estimated Variance of Velocity
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206171355785.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206171356665.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>From the above figures, it can be seen that the Kalman filter quickly
reduces the estimation of the object's descent height and velocity as
soon as the new information is added, and then gradually decreases to
near 0 without further significant reduction. The height change curve of
the object's free fall is a parabola, and the velocity changes
uniformly, which conforms to the relevant physical laws of free
fall.</p>
<h3 id="nonlinear-filtering-problem">2. Nonlinear Filtering Problem</h3>
<p>Based on the given measurement data and the nonlinear filtering model
mentioned above, the filtered height and velocity of the falling object
are as follows.</p>
<p>The height change is:</p>
<p><img
src="https://download.kezhi.tech/img/202206172029931.png?x-oss-process=style/webp" /></p>
<p>The velocity change is:</p>
<p><img
src="https://download.kezhi.tech/img/202206172029342.png?x-oss-process=style/webp" /></p>
<p>The estimation error of the object's free fall height and velocity
is:</p>
<table>
<tr>
<td>
<center>
Estimated Variance of Height
</center>
</td>
<td>
<center>
Estimated Variance of Velocity
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172030142.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172030896.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>From the above estimated results, it can be seen that the descent
height decreases parabolically with time, and the descent velocity
(downward is positive) increases uniformly with time, which conforms to
the physical laws of free fall.</p>
<h2 id="some-findings-during-the-experiment">Some Findings During the
Experiment</h2>
<p>In the initial programming and experimental process, since the
measurement data given in the problem is in units of <span
class="math inline">\(km\)</span>, for ease of calculation, the distance
unit is converted to <span class="math inline">\(km\)</span>. However,
since the problem does not specify the unit of the measurement variance,
the value is not converted and is treated as <span
class="math inline">\(km\)</span>.</p>
<p>No anomalies were found during the solution of problem 1. However,
when solving problem 2, if the measurement covariance is not converted,
and the unit is treated as <span class="math inline">\(km\)</span>, the
estimated results will be as shown in the following figure:</p>
<table>
<tr>
<td>
<center>
Height Change
</center>
</td>
<td>
<center>
Velocity Change
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172039755.png?x-oss-process=style/webp">
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202206172039518.png?x-oss-process=style/webp">
</center>
</td>
</tr>
</table>
<p>Comparing the calculated results in the above figure with the
calculated results in the experimental results of problem 2, it can be
seen that the nonlinear Kalman filter is more affected by the
measurement error if the measurement covariance is large. This is
because the coefficient matrix <span class="math inline">\(H\)</span> in
the nonlinear filter is obtained by local linearization, and if the
measurement error itself is large, it will affect the calculation
results of the Kalman coefficients, resulting in inaccurate estimation
results.</p>
<h2 id="appendix">Appendix</h2>
<h3 id="constant-configuration">Constant Configuration</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@ Author: Yu Zhao</span></span><br><span class="line"><span class="string">@ Contact: yuzhaokz@163.com</span></span><br><span class="line"><span class="string">@ Date: 2022-06-10 16:59:11</span></span><br><span class="line"><span class="string">@ LastEditors: Yu Zhao</span></span><br><span class="line"><span class="string">@ LastEditTime: 2022-06-17 21:02:09</span></span><br><span class="line"><span class="string">@ Description: 知识因被记录而产生价值</span></span><br><span class="line"><span class="string">@ Website: https://kezhi.tech</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">cache_dir=<span class="string">&quot;cache/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># observation</span></span><br><span class="line"></span><br><span class="line">observation_1=[</span><br><span class="line">    [<span class="number">1.9945</span>],</span><br><span class="line">    [<span class="number">1.9794</span>],</span><br><span class="line">    [<span class="number">1.9554</span>],</span><br><span class="line">    [<span class="number">1.9214</span>],</span><br><span class="line">    [<span class="number">1.8777</span>],</span><br><span class="line">    [<span class="number">1.8250</span>],</span><br><span class="line">    [<span class="number">1.7598</span>],</span><br><span class="line">    [<span class="number">1.6867</span>],</span><br><span class="line">    [<span class="number">1.6036</span>],</span><br><span class="line">    [<span class="number">1.5092</span>],</span><br><span class="line">    [<span class="number">1.4076</span>],</span><br><span class="line">    [<span class="number">1.2944</span>],</span><br><span class="line">    [<span class="number">1.1724</span>],</span><br><span class="line">    [<span class="number">1.0399</span>],</span><br><span class="line">    [<span class="number">0.8980</span>],</span><br><span class="line">    [<span class="number">0.7455</span>],</span><br><span class="line">    [<span class="number">0.5850</span>],</span><br><span class="line">    [<span class="number">0.4125</span>],</span><br><span class="line">    [<span class="number">0.2318</span>],</span><br><span class="line">    [<span class="number">0.0399</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">observation_2=[</span><br><span class="line">    [<span class="number">2.82741643781891</span>,<span class="number">0.00075850435876</span>],</span><br><span class="line">    [<span class="number">2.82519811729771</span>,<span class="number">0.00083282260478</span>],</span><br><span class="line">    [<span class="number">2.82066686966236</span>,<span class="number">0.00067808241639</span>],</span><br><span class="line">    [<span class="number">2.81487233105901</span>,<span class="number">0.00085279036802</span>],</span><br><span class="line">    [<span class="number">2.80671786536244</span>,<span class="number">0.00072900768452</span>],</span><br><span class="line">    [<span class="number">2.79725268974089</span>,<span class="number">0.00080072481819</span>],</span><br><span class="line">    [<span class="number">2.78664273475039</span>,<span class="number">0.00075095576213</span>],</span><br><span class="line">    [<span class="number">2.77320365026313</span>,<span class="number">0.00065762725379</span>],</span><br><span class="line">    [<span class="number">2.75919535464551</span>,<span class="number">0.00081186148545</span>],</span><br><span class="line">    [<span class="number">2.74331288628195</span>,<span class="number">0.00079783727034</span>],</span><br><span class="line">    [<span class="number">2.72538888482812</span>,<span class="number">0.00073060712986</span>],</span><br><span class="line">    [<span class="number">2.70664967712312</span>,<span class="number">0.00063242006530</span>],</span><br><span class="line">    [<span class="number">2.68632403406473</span>,<span class="number">0.00063656524495</span>],</span><br><span class="line">    [<span class="number">2.66386533852220</span>,<span class="number">0.00080659845639</span>],</span><br><span class="line">    [<span class="number">2.64093529707333</span>,<span class="number">0.00067704740069</span>],</span><br><span class="line">    [<span class="number">2.61621111727357</span>,<span class="number">0.00076573767706</span>],</span><br><span class="line">    [<span class="number">2.59038109850785</span>,<span class="number">0.00054955759081</span>],</span><br><span class="line">    [<span class="number">2.56298794272843</span>,<span class="number">0.00058487913971</span>],</span><br><span class="line">    [<span class="number">2.53498317950797</span>,<span class="number">0.00055602747368</span>],</span><br><span class="line">    [<span class="number">2.50647589372246</span>,<span class="number">0.00033550412588</span>],</span><br><span class="line">    [<span class="number">2.47571075016386</span>,<span class="number">0.00056012688452</span>],</span><br><span class="line">    [<span class="number">2.44560676000982</span>,<span class="number">0.00056694491978</span>],</span><br><span class="line">    [<span class="number">2.41403690772088</span>,<span class="number">0.00059380631025</span>],</span><br><span class="line">    [<span class="number">2.38252228611696</span>,<span class="number">0.00053681916544</span>],</span><br><span class="line">    [<span class="number">2.35016501182332</span>,<span class="number">0.00065871960781</span>],</span><br><span class="line">    [<span class="number">2.31790939837137</span>,<span class="number">0.00068598344328</span>],</span><br><span class="line">    [<span class="number">2.28597616656453</span>,<span class="number">0.00060922471348</span>],</span><br><span class="line">    [<span class="number">2.25418431681401</span>,<span class="number">0.00057086018918</span>],</span><br><span class="line">    [<span class="number">2.22259320219535</span>,<span class="number">0.00041308535708</span>],</span><br><span class="line">    [<span class="number">2.19237398969466</span>,<span class="number">0.00047302026281</span>],</span><br><span class="line">    [<span class="number">2.16290177997271</span>,<span class="number">0.00030949309972</span>],</span><br><span class="line">    [<span class="number">2.13441725793706</span>,<span class="number">0.00040552624986</span>],</span><br><span class="line">    [<span class="number">2.10811064690727</span>,<span class="number">0.00037545033142</span>],</span><br><span class="line">    [<span class="number">2.08322179823195</span>,<span class="number">0.00017282319262</span>],</span><br><span class="line">    [<span class="number">2.06148109026767</span>,<span class="number">0.00020758327980</span>],</span><br><span class="line">    [<span class="number">2.04219885094031</span>,<span class="number">0.00037186464579</span>],</span><br><span class="line">    [<span class="number">2.02610235314357</span>,<span class="number">0.00018082163465</span>],</span><br><span class="line">    [<span class="number">2.01290326863579</span>,<span class="number">0.00023323830160</span>],</span><br><span class="line">    [<span class="number">2.00463157388395</span>,-<span class="number">0.00004536186964</span>],</span><br><span class="line">    [<span class="number">2.00058143251913</span>,<span class="number">0.00003246284068</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># dimension transform</span></span><br><span class="line">observation_2=[[observation[<span class="number">0</span>],observation[<span class="number">1</span>]*<span class="number">1000</span>] <span class="keyword">for</span> observation <span class="keyword">in</span> observation_2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the parameters of problem 1</span></span><br><span class="line">param_1=&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Phi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">1</span>,-<span class="number">1</span>],</span><br><span class="line">            [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Psi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [-<span class="number">1</span>],</span><br><span class="line">            [<span class="number">1</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;H&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;R&quot;</span>:np.matrix(</span><br><span class="line">        [<span class="number">1</span>/<span class="number">1000</span>]</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># the parameters of problem 2</span></span><br><span class="line">param_2=&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Phi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">1</span>,-<span class="number">0.5</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;Psi&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [-<span class="number">0.125</span>],</span><br><span class="line">            [<span class="number">0.5</span>],</span><br><span class="line">            [<span class="number">0</span>],</span><br><span class="line">        ]</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;R&quot;</span>:np.matrix(</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">0.04</span>/<span class="number">1000</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">0.01</span>],</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="problem-1-code">Problem 1 Code</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@ Author: Yu Zhao</span></span><br><span class="line"><span class="string">@ Contact: yuzhaokz@163.com</span></span><br><span class="line"><span class="string">@ Date: 2022-06-10 14:44:08</span></span><br><span class="line"><span class="string">@ LastEditors: Yu Zhao</span></span><br><span class="line"><span class="string">@ LastEditTime: 2022-06-17 12:45:17</span></span><br><span class="line"><span class="string">@ Description: 知识因被记录而产生价值</span></span><br><span class="line"><span class="string">@ Website: https://kezhi.tech</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> cache_dir,observation_1,param_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Chinese characters</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  <span class="comment"># Used to display Chinese labels normally</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  <span class="comment"># Used to display negative signs normally</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the cache folder</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(cache_dir):</span><br><span class="line">    os.mkdir(cache_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kalman filter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Kalman_filter</span>(<span class="params">x_0:np.matrix,  <span class="comment"># the status of last step</span></span></span><br><span class="line"><span class="params">                  P_0:np.matrix,  <span class="comment"># the variance of last step</span></span></span><br><span class="line"><span class="params">                  y_1:np.matrix,  <span class="comment"># the observation of this step</span></span></span><br><span class="line"><span class="params">                  u_0:np.matrix=<span class="literal">None</span>, <span class="comment"># the input of system</span></span></span><br><span class="line"><span class="params">                  Phi:np.matrix=<span class="literal">None</span>,  <span class="comment"># the status transform matrix </span></span></span><br><span class="line"><span class="params">                  Psi:np.matrix=<span class="literal">None</span>,  <span class="comment"># coefficient of system input</span></span></span><br><span class="line"><span class="params">                  Gamma:np.matrix=<span class="literal">None</span>,   <span class="comment"># coefficient of observing noise</span></span></span><br><span class="line"><span class="params">                  H:np.matrix=<span class="literal">None</span>,    <span class="comment"># y=Hx+v</span></span></span><br><span class="line"><span class="params">                  R:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of observing noise</span></span></span><br><span class="line"><span class="params">                  Q:np.matrix=<span class="literal">None</span>,    <span class="comment"># the variance of status noise</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># Check variables</span></span><br><span class="line">    <span class="keyword">if</span> u_0 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        u_0=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;u_0 is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(u_0))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Phi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Phi=np.matrix(np.eye(x_0.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Phi is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Phi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Psi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Psi=np.matrix(np.zeros((x_0.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Psi is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Psi))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> Gamma <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Gamma=Psi.copy()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Gamma is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Gamma))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> H <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        H=np.matrix(np.ones((y_1.shape[<span class="number">0</span>],x_0.shape[<span class="number">0</span>])))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;H is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(H))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> R <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        R=np.matrix(np.zeros((y_1.shape[<span class="number">0</span>],<span class="number">1</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;R is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(R))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> Q <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        Q=np.matrix(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Q is missing, use the default value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(Q))</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># One-step prediction</span></span><br><span class="line">    x_10=Phi@x_0+Psi@u_0</span><br><span class="line">    P_10=Phi@P_0@Phi.T+Gamma@Q@Gamma.T</span><br><span class="line">    <span class="comment"># Time update</span></span><br><span class="line">    P_11=(P_10.I+H.T@R.I@H).I</span><br><span class="line">    K_1=P_11@H.T@R.I</span><br><span class="line">    x_11=x_10+K_1@(y_1-H@x_10)</span><br><span class="line">    <span class="keyword">return</span> x_11,P_11,K_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_result</span>(<span class="params">record:<span class="built_in">dict</span>,problem</span>):</span><br><span class="line">    pprint(record)</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> record.items():</span><br><span class="line">        plt.title(key)</span><br><span class="line">        plt.xlabel(<span class="string">&quot;step&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&quot;h&quot;</span>:</span><br><span class="line">            plt.ylabel(<span class="string">&quot;Height: km&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> key==<span class="string">&quot;v&quot;</span>:</span><br><span class="line">            plt.ylabel(<span class="string">&quot;Velocity: km/s (downward is positive)&quot;</span>)</span><br><span class="line">        plt.plot(value)</span><br><span class="line">        plt.savefig(os.path.join(cache_dir,problem+<span class="string">&quot;_&quot;</span>+key+<span class="string">&quot;.png?x-oss-process=style/webp&quot;</span>),dpi=<span class="number">600</span>)</span><br><span class="line">        plt.clf()</span><br><span class="line">        plt.cla()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Solve problem 1</span></span><br><span class="line">    x_0=np.matrix([[<span class="number">2</span>],[<span class="number">0</span>]])</span><br><span class="line">    P_0=np.matrix([[<span class="number">10</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">10</span>]])</span><br><span class="line">    x_record=[x_0]</span><br><span class="line">    P_record=[P_0]</span><br><span class="line">    K_record=[<span class="literal">None</span>]</span><br><span class="line">    <span class="keyword">for</span> obs <span class="keyword">in</span> observation_1:</span><br><span class="line">        y_1=np.matrix(obs).T</span><br><span class="line">        x_1,P_1,K_1=Kalman_filter(</span><br><span class="line">            x_0,</span><br><span class="line">            P_0,</span><br><span class="line">            y_1,</span><br><span class="line">            u_0=np.matrix(<span class="number">9.8</span>/<span class="number">1000</span>),</span><br><span class="line">            Phi=np.matrix(param_1[<span class="string">&quot;Phi&quot;</span>]),</span><br><span class="line">            Psi=np.matrix(param_1[<span class="string">&quot;Psi&quot;</span>]),</span><br><span class="line">            H=np.matrix(param_1[<span class="string">&quot;H&quot;</span>]),</span><br><span class="line">            R=np.matrix(param_1[<span class="string">&quot;R&quot;</span>]),</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        x_record.append(x_1)</span><br><span class="line">        P_record.append(P_1)</span><br><span class="line">        K_record.append(K_1)</span><br><span class="line">        </span><br><span class="line">        x_0=x_1</span><br><span class="line">        P_0=P_1</span><br><span class="line">        </span><br><span class="line">    result_record=&#123;</span><br><span class="line">        <span class="string">&quot;h&quot;</span>:[x[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;v&quot;</span>:[x[<span class="number">1</span>,<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_record],</span><br><span class="line">        <span class="string">&quot;P_0&quot;</span>:[P[<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="string">&quot;P_1&quot;</span>:[P[<span class="number">1</span>,<span class="number">1</span>] <span class="keyword">for</span> P <span class="keyword">in</span> P_record],</span><br><span class="line">        <span class="comment"># &quot;K&quot;:K_record,</span></span><br><span class="line">    &#125;</span><br><span class="line">    show_result(result_record,problem=<span class="string">&quot;p1&quot;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="problem-2-code">Problem 2 Code</h3>
<p>```python ''' @ Author: Yu Zhao @ Contact: yuzhaokz@163.com @ Date:
2022-06-17 16:54:31 @ LastEditors: Yu Zhao @ LastEditTime: 2022-06-17
21:02:28 @ Description: 知识因被记录而产生价值 @ Website:
https://kezhi.tech '''</p>
<p>import os from pprint import pprint from matplotlib import pyplot as
plt import numpy as np</p>
<p>from config import cache_dir,observation_2,param_2</p>
<h1 id="enable-chinese-characters">Enable Chinese characters</h1>
<p>plt.rcParams['font.sans-serif'] = ['SimHei'] # Used to display
Chinese labels normally plt.rcParams['axes.unicode_minus'] = False #
Used to display negative signs normally</p>
<h1 id="create-the-cache-folder">Create the cache folder</h1>
<p>if not os.path.exists(cache_dir): os.mkdir(cache_dir)</p>
<h1 id="compute-h-in-ekf">Compute H in EKF</h1>
<p>def get_H(x): l_2=x[0,0]<strong>2+x[2,0]</strong>2 return np.matrix(
[ [x[0,0]/np.sqrt(l_2),0,x[2,0]/np.sqrt(l_2)],
[x[2,0]/l_2,0,-x[0,0]/l_2], ] )</p>
<h1 id="function-of-observation">Function of observation</h1>
<p>def y(x): return np.matrix( [
[np.sqrt(x[0,0]<strong>2+x[2,0]</strong>2)], [np.arctan(x[0,0]/x[2,0])],
] )</p>
<h1 id="kalman-filter">Kalman filter</h1>
<p>def EKF(x_0:np.matrix, # the status of last step P_0:np.matrix, # the
variance of last step y_1:np.matrix, # the observation of this step
u_0:np.matrix=None, # the input of system Phi:np.matrix=None, # the
status transform matrix Psi:np.matrix=None, # coefficient of system
input Gamma:np.matrix=None, # coefficient of observing noise
R:np.matrix=None, # the variance of observing noise Q:np.matrix=None, #
the variance of status noise ): # Check variables if u_0 is None:
u_0=np.matrix(0) print("u_0 is missing, use the default value:
{}".format(u_0))</p>
<pre><code>if Phi is None:
    Phi=np.matrix(np.eye(x_0.shape[0]))
    print(&quot;Phi is missing, use the default value: &#123;&#125;&quot;.format(Phi))

if Psi is None:
    Psi=np.matrix(np.zeros((x_0.shape[0],1)))
    print(&quot;Psi is missing, use the default value: &#123;&#125;&quot;.format(Psi))

if Gamma is None:
    Gamma=np.matrix(np.zeros((x_0.shape[0],1)))
    print(&quot;Gamma is missing, use the default value: &#123;&#125;&quot;.format(Gamma))
    
if R is None:
    R=np.matrix(np.zeros((y_1.shape[0],1)))
    print(&quot;R is missing, use the default value: &#123;&#125;&quot;.format(R))
    
if Q is None:
    Q=np.matrix(0)
    print(&quot;Q is missing, use the default value: &#123;&#125;&quot;.format(Q))
    
# One-step prediction
x_10=Phi@x_0+Psi@u_0
P_10=Phi@P_0@Phi.T+Gamma@Q@Gamma.T
# Local linearization
H=get_H(x_10)
# Time update
P_11=(P_10.I+H.T@R.I@H).I
K_1=P_11@H.T@R.I
x_11=x_10+K_1@(y_1-y(x_10))
return x_11,P_11,K_1</code></pre>
<p>def mse(x_1:np.matrix,x_2:np.matrix): loss=0 for i in
range(x_1.shape[0]): for j in range(x_1.shape[1]):
loss+=(x_1[i,j]-x_2[i,j])**2 loss=loss/(x_1.shape[0]*x_1.shape[0])
return loss</p>
<h1 id="iteration-ekf-which-may-have-a-worse-result-tat">Iteration EKF,
which may have a worse result TAT</h1>
<p>def EKF_iter( x_0:np.matrix, # the status of last step P_0:np.matrix,
# the variance of last step y_1:np.matrix, # the observation of this
step u_0:np.matrix=None, # the input of system Phi:np.matrix=None, # the
status transform matrix Psi:np.matrix=None,</p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Kalman Filter</tag>
        <tag>Linear Filter</tag>
        <tag>Nonlinear Filter</tag>
      </tags>
  </entry>
  <entry>
    <title>After the completion of the first paper.</title>
    <url>/en/437bf60f.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/437bf60f.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Recently, I completed my first research paper, going through the
entire process from topic selection to experiments, result analysis, and
paper writing. Although I took some detours along the way, I gained new
insights into the methodology of scientific research and writing. This
article will outline the general process of scientific research and
discuss some of the details, providing reference for future research and
for those who want to publish articles.</p>
<blockquote>
<p>Acknowledgments: Thanks to the teachers who guided me during the
experiments and paper writing, as well as friends who discussed with
me.</p>
</blockquote>
<p><img src="https://download.kezhi.tech/img/202403072120342.webp" alt="Generated by ChatGPT-4" style="width:75%;" /></p>
<span id="more"></span>
<h2 id="why-publish-a-paper">Why Publish a Paper?</h2>
<p>In my opinion, the purpose of doing something directly determines
whether it can be done well and sustained. Therefore, before engaging in
scientific research, it is important to clarify your purpose in order to
have better guidance for future work.</p>
<p>Firstly, publishing a paper is not the ultimate goal of research. If
publishing a paper is seen as the focus of scientific research, it will
not be sustainable. In my view, the core purposes of writing and
publishing a paper are:</p>
<ol type="1">
<li>Summarizing and consolidating research achievements at a certain
stage.</li>
<li>Sharing one's work with other researchers.</li>
</ol>
<p>Of course, besides these two core purposes, publishing a paper
inevitably comes with practical benefits (academic influence, industry
salary, academic assessment, etc.). Therefore, in the process of
scientific research, one needs to consider both the academic attributes
and the practical benefits. Striking a balance between the two may be a
satisfactory solution in today's academic environment.</p>
<blockquote>
<p>However, scientific research papers are primarily academic in nature
and should adhere to academic norms and ethics. The core attributes
should not be abandoned for the sake of practical benefits.</p>
</blockquote>
<h2 id="paper-writing-process">Paper Writing Process</h2>
<p>A research cycle can be roughly divided into the following parts:</p>
<ol type="1">
<li>Topic selection: Choose a problem that you are interested in and
that has not been well solved.</li>
<li>Method proposal: Propose a method that you believe can better solve
the problem.</li>
<li>Experimentation and recording: Conduct experiments based on your
method and record the results.</li>
<li>Analysis and organization of results: Analyze the experimental
results. If there are shortcomings, go back to step 2 and improve the
method. Otherwise, proceed to step 5.</li>
<li>Paper writing: Complete the research paper and share your method and
results.</li>
</ol>
<p>The general direction of topic selection is usually fixed, but it is
important to determine the specific research questions. This step
requires extensive reading of relevant literature. There are two
purposes: ① Understand what others have done and have not done, and have
a general grasp of the current research progress. ② Reflect and select
the problems you want to solve while reading the literature. In a
nutshell, "Learning without thinking is labor lost; thinking without
learning is perilous." Only reading literature without thinking will not
yield valuable questions, while only thinking without reading literature
may lead to researching a problem that has already been solved. When I
completed my first work, I did not read enough relevant literature,
which led to some minor issues in the paper writing process.</p>
<p>When proposing a method, it is important to consider both innovation
and practical significance. If the extension from "stir-fried tomatoes
and eggs" to "stir-fried cherry tomatoes and quail eggs" only focuses on
the taste and nutritional value, it may not be considered innovative,
and it would be meaningless. However, if the research explores the
scalability of cooking methods in different forms and provides insights
for future cooking, it would be highly valuable. In addition, the
proposal of a good method usually requires an iterative process of
"proposal -&gt; experiment -&gt; problems -&gt; re-proposal" to
continuously refine and improve the method. Therefore, one should not be
discouraged by the initial poor performance of the method, but rather
repeat the above iteration process quickly to enhance the effectiveness
of the method.</p>
<p>Experimentation and recording usually take up the largest portion of
time, and this part of the process has a lower limit due to objective
constraints and no upper limit influenced by subjective initiative. The
experimental part does not need to be elaborated on, as it should be the
basic skill of every researcher. Here, I would like to emphasize the
management of experiments and the recording of results. In my opinion,
good experiment management and result recording should have the
following characteristics:</p>
<ul>
<li>Easy traceability: When you want to retrieve and view specific
experimental results, you can quickly and accurately find them.</li>
<li>Reproducibility: This refers not only to reproducibility in the
sense of academic ethics, but also to recording the experimental
configuration (including code versions, parameters, etc.) at that time,
ensuring that the experiment can be reproduced quickly by retracing the
experimental state at that time.</li>
<li>Multiple backups: Experimental data is hard-earned, and if data is
lost due to unforeseen circumstances, it can be devastating. Therefore,
it is necessary to make multiple backups to ensure data security.</li>
</ul>
<p>Result analysis is crucial and should be given due attention.
Experimental data only represents certain facts, and it is through
analysis and interpretation of these facts that meaningful patterns can
be discovered. Various visualization methods can be used to make the
hidden patterns in the data more intuitive. In addition, I personally
like to pay attention to outliers generated during the experimental
process and analyze the reasons behind them. Behind these anomalies,
there are usually things we have not noticed before (experimental
issues, unfamiliar theories, or even new discoveries...).</p>
<p>Finally, there is the paper writing stage. To be honest, I don't have
much experience, and it is already a challenge for me to complete each
section of the content. If I become more proficient in the future, I can
discuss this part further.</p>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>research</tag>
        <tag>总结</tag>
      </tags>
  </entry>
  <entry>
    <title>Website bookmark.</title>
    <url>/en/16fab331.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/16fab331.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<h2 id="practical-software">Practical Software</h2>
<ul>
<li><a href="https://geekuninstaller.com/">Geek Uninstaller - the best
FREE uninstaller</a></li>
<li><a href="https://www.bandisoft.com/bandizip/">Bandizip for Windows -
the leading compression software</a></li>
<li><a href="https://www.7-zip.org/">7-Zip</a></li>
</ul>
<h2 id="text-to-speech">Text-to-Speech</h2>
<ul>
<li>Free TTS <a
href="https://freetts.com/">https://freetts.com/</a></li>
<li>Balabolka <a
href="http://balabolka.site/balabolka.htm">http://balabolka.site/balabolka.htm</a></li>
</ul>
<h2 id="data-source">Data Source</h2>
<h3 id="defi">Defi</h3>
<ul>
<li><a
href="https://www.cryptodatadownload.com/">cryptodatadownload.com</a> -
Download historical data from Defi exchanges</li>
<li><a href="https://www.coinario.com/">Cryptocurrency -
Coinario.com</a> - Query basic information about exchanges</li>
<li><a href="https://nomics.com/">Nomics: Crypto Market Caps - Prices,
All-Time Highs, Charts</a></li>
</ul>
<h3 id="transportation">Transportation</h3>
<ul>
<li><a href="https://www.transtats.bts.gov/">OST_R | BTS | Transtats</a>
- U.S. transportation data</li>
</ul>
<h3 id="weather">Weather</h3>
<ul>
<li><a href="https://openweathermap.org/">Сurrent weather and forecast -
OpenWeatherMap</a></li>
</ul>
<h2 id="api">API</h2>
<ul>
<li><a href="https://api.muxiaoguo.cn/">木小果API - Free API
platform</a></li>
</ul>
<h2 id="standard-information-lookup">Standard Information Lookup</h2>
<ul>
<li>Mac Vendor Lookup Table: <a
href="https://standards-oui.ieee.org/oui/oui.txt">https://standards-oui.ieee.org/oui/oui.txt</a></li>
</ul>
]]></content>
      <categories>
        <category>Collection</category>
      </categories>
      <tags>
        <tag>软件</tag>
        <tag>网站</tag>
        <tag>收藏</tag>
      </tags>
  </entry>
  <entry>
    <title>Party Mutual Recognition Issues Brief.</title>
    <url>/en/244334e3.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/244334e3.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>A few days ago, the first "Game in Chang'an" event organized by four
rotating chairpersons officially came to an end. There was a grouping
problem in a small game during the event, and I will record it here.</p>
<p><img src="https://download.kezhi.tech/img/202307011126365.png?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="background-of-the-name-calling-game">Background of the Name
Calling Game</h2>
<p>Here's the situation: the event was organized by four rotating
chairpersons, who invited their first-degree friends (direct friends)
and second-degree friends (friends of friends) to participate.
Therefore, for each participant, there were always some people they
didn't know. And the number of unknown people for each person was
different. The total number of participants in the event was about
14.</p>
<p>Therefore, we used the following process to help everyone remember
each other's names:</p>
<ol type="1">
<li>All participants were divided into two groups equally.</li>
<li>The name calling game was played within each group.</li>
<li>All participants were divided into two groups equally again.</li>
<li>The name calling game was played within each group.</li>
</ol>
<blockquote>
<p>Name calling game<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>:</p>
<ol type="1">
<li>Choose a wide and flat game field.</li>
<li>The team members stand in a circle as a group. Each person is about
an arm's length apart. You, as the training instructor, are no
exception.</li>
<li>Tell the group that the game will start from you. Shout out your own
name and then pass the ball to the person on your left. The teammate who
receives the ball should do the same, shout out their own name, and then
pass the ball to the person on their left. This continues until the ball
returns to your hands.</li>
<li>After you get the ball back, tell everyone that we are going to
change the rules now. The teammate who receives the ball must shout out
another teammate's name and then throw the ball to that teammate.</li>
<li>After the game ends, before disbanding the group, invite a volunteer
to walk around the group and say the name of each person.</li>
</ol>
</blockquote>
<p>Initially, we hoped that by optimizing the grouping in these two
rounds, everyone would get to know each other. However, during the
optimization process, we found that this problem was not as simple as we
expected. Therefore, in the practical process, we added another step:
all participants played the name calling game together to achieve the
goal of getting to know each other.</p>
<h2 id="the-name-calling-problem">The Name Calling Problem</h2>
<p>The problem described above is what I call the "name calling problem"
during the gathering. It can be abstracted as a graph theory problem in
mathematics, described as follows:</p>
<blockquote>
<p>Given an initial graph with <span class="math inline">\(2n\)</span>
vertices, we can perform a <span class="math inline">\(\Gamma\)</span>
operation (dividing the <span class="math inline">\(2n\)</span> vertices
into two parts and fully connecting the <span
class="math inline">\(n\)</span> vertices in each part). If we want to
fully connect the <span class="math inline">\(2n\)</span> vertices after
two <span class="math inline">\(\Gamma\)</span> operations, how should
we group them in these two <span class="math inline">\(\Gamma\)</span>
operations?</p>
</blockquote>
<h3 id="does-a-solution-exist">Does a Solution Exist?</h3>
<p>Of course, the above description is a mathematical description of the
problem we encountered. Obviously, whether this problem has a solution
depends on the initial graph formed by these <span
class="math inline">\(n\)</span> vertices. Therefore, we need to explore
the existence of a solution:</p>
<blockquote>
<p>Given an initial graph with <span class="math inline">\(2n\)</span>
vertices, we can perform a <span class="math inline">\(\Gamma\)</span>
operation (dividing the <span class="math inline">\(2n\)</span> vertices
into two parts and fully connecting the <span
class="math inline">\(n\)</span> vertices in each part). If there exist
two <span class="math inline">\(\Gamma\)</span> operations that fully
connect the <span class="math inline">\(2n\)</span> vertices after the
two operations, what conditions should the initial graph satisfy?</p>
</blockquote>
<p>Firstly, a fully connected graph formed by <span
class="math inline">\(2n\)</span> vertices contains <span
class="math inline">\(\frac{2n(2n-1)}{2}=2n^2-n\)</span> edges. Each
<span class="math inline">\(\Gamma\)</span> operation establishes a full
connection between the <span class="math inline">\(n\)</span> vertices
divided into two groups, which means adding no more than <span
class="math inline">\(\frac{n(n-1)}{2}*2=n^2-n\)</span> edges.
Performing two <span class="math inline">\(\Gamma\)</span> operations
adds no more than <span class="math inline">\(2n^2-2n\)</span> edges.
From this, we obtain a necessary but not sufficient condition for an
optimal initial graph:</p>
<ul>
<li>The initial number of edges should be no less than <span
class="math inline">\(n\)</span>.</li>
</ul>
<h3
id="if-two-operations-are-not-enough-how-many-gamma-operations-are-needed-at-least">If
Two Operations Are Not Enough, How Many <span
class="math inline">\(\Gamma\)</span> Operations Are Needed at
Least?</h3>
<p>In addition, in this scenario, due to time constraints, only a small
number of games can be played to establish edges in the graph. If there
were no time constraints, it would be worth discussing how many such
games are needed at least to establish a full connection among any
arbitrary graph:</p>
<blockquote>
<p>Given an initial graph with <span class="math inline">\(n\)</span>
vertices, we can perform a <span class="math inline">\(\Gamma\)</span>
operation: dividing the <span class="math inline">\(n\)</span> vertices
into two parts and fully connecting the <span
class="math inline">\(n/2\)</span> vertices in each part. How many <span
class="math inline">\(\Gamma\)</span> operations are needed at least to
establish a full connection among these <span
class="math inline">\(n\)</span> vertices?</p>
</blockquote>
<h3 id="how-are-the-groups-formed-in-each-gamma-operation">How Are the
Groups Formed in Each <span class="math inline">\(\Gamma\)</span>
Operation?</h3>
<p>Finally, the fundamental problem is the algorithm for solving
this:</p>
<blockquote>
<p>Given an initial graph with <span class="math inline">\(n\)</span>
vertices, we can perform a <span class="math inline">\(\Gamma\)</span>
operation: dividing the <span class="math inline">\(n\)</span> vertices
into two parts and fully connecting the <span
class="math inline">\(n/2\)</span> vertices in each part. How many <span
class="math inline">\(\Gamma\)</span> operations are needed at least to
establish a full connection among these <span
class="math inline">\(n\)</span> vertices? And provide all the groupings
in each <span class="math inline">\(\Gamma\)</span> operation.</p>
</blockquote>
<h2 id="reference">Reference</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p><a
href="https://www.xiaohongshu.com/explore/637068d80000000015017520?app_platform=android&amp;app_version=7.85.0&amp;author_share=2&amp;share_from_user_hidden=true&amp;type=normal&amp;xhsshare=WeixinSession&amp;appuid=5a17ada911be1028e2ac1c42&amp;apptime=1687706419">心理团体破冰游戏之直呼其名
(xiaohongshu.com)</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>Contrast.</title>
    <url>/en/36e895f1.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/36e895f1.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>Now it is 00:57 on May 17, 2023. I still can't fall asleep, maybe
because of the latte I had in the afternoon or because of what has
happened in the past few days. My mind is filled with thoughts and
debates. Instead of lying in bed and overthinking or relying on alcohol
to fall asleep, I decided to write an article at my desk to organize my
thoughts and turn the chaotic ideas into logical and organized text.</p>
<blockquote class="blockquote-center">
<p>Red beans grow in the southern land, how many branches bloom in
spring?</p>
<p>May you pick many, for this is the most lovesick thing.</p>

</blockquote>
<span id="more"></span>
<p>The title of this article was decided without much thought - Turning
Point. My life has undergone significant changes this year, with the
passing of my father, the breakup with my loved one, and the transition
to a doctoral student. These series of events have caused my emotions to
fluctuate greatly within a few months. I can say that my emotions after
the age of 20 are more intense than all the emotions I had before.</p>
<p>One thing that has always confused me is who I am and what I want to
do.</p>
<p>I can barely remember what happened in kindergarten. I only remember
that I was one of the top students in the class and always stood at the
back of the line. When it was time to enroll in the senior kindergarten,
there were no available spots in the kindergartens in town. My
grandfather didn't want me to stay at home, so he arranged for me to go
to the elementary school behind the village to join the first grade.
That's how I skipped senior kindergarten and preschool and went straight
to elementary school.</p>
<p>Elementary school was a simple and pure time for me. From first to
fifth grade, I was always the top student in my grade. However, since I
was raised by my grandparents, I didn't pay much attention to personal
hygiene, and I was often criticized and educated by my teachers for
this. I had a few good friends in my class, mostly smart boys. I didn't
have any close relationships with girls because they would always pull
down my pants from behind on the way home from school. Even now, I still
can't figure out why they did that. In sixth grade, my father arranged
for me to transfer to Xi'an. Before that, I was mostly raised by my
grandparents, and I would only go to Xi'an to stay with my parents for a
period of time during summer vacation. During winter vacation, my
parents would come back for the Lunar New Year. Every time I said
goodbye to my parents, I would watch them leave and then cry alone in my
room. That was probably the strongest emotion I had at that time.</p>
<p>After transferring to the elementary school in Xi'an, my grades
remained good, except for Chinese and English, which were slightly
worse. But that didn't stop me from becoming the center of attention in
the class. Being young and good at math compared to other students in my
grade, I would always be the first to finish the tasks assigned by the
teacher during math class and then go to the computer room to play (a
small benefit of having the math teacher also be the computer teacher).
Later on, the math teacher stopped letting me go to the computer room
and instead asked me to tutor my classmates in the classroom or gave me
more difficult exercises to do.</p>
<p>In junior high school, I transferred to Far East No. 2 Middle School.
The only subject I took the entrance exam for was math, and when the
results came out, my parents saw that I got the highest score and paid a
few thousand yuan less for the tuition. That was the first time I
realized the practical value of having good grades. When I first arrived
at Far East No. 2, I felt like I didn't fit in. Most of the students at
Far East No. 2 were from Far East No. 2 Elementary School, and they had
many common topics to talk about and were familiar with the surroundings
of the school. On the other hand, I came from the countryside to the
city and had no concept of many things. Moreover, I was introverted and
lacked strong social skills. However, my good grades helped me in two
ways. First, I could easily integrate into some circles by discussing
academics. Second, I didn't need to be too proactive in social
interactions. Of course, these are conclusions I have drawn looking back
now. At that time, I probably wasn't aware of these things.</p>
<p>In the second year of junior high school, I had a relationship, which
ended with me gradually ignoring the other person. There was no formal
breakup process, which I now realize was not good. The reason for the
breakup was because several of my friends told me multiple times, "She's
only with you because she wants you to help her with her homework."
After realizing the absurdity of this, I told myself that when it comes
to matters of the heart, it's enough to know how I feel, and other
people's opinions are not important.</p>
<p>By the third year of junior high school, especially before the high
school entrance exam, I began to feel lost about my own worth for the
first time. In the past, almost all of my positive feedback came from my
academic performance, while in terms of interpersonal relationships, I
usually received more negative evaluations. At that time, I gradually
didn't know how to interact with my classmates, and I would be very
sensitive when interacting with most of them, except for a few good
friends. At that time, I didn't know how to confide in others or seek
help, so I kept these thoughts to myself, waiting for a new change when
I entered high school. In the end, under the pressure of emotions and
not paying enough attention to the high school entrance exam, my exam
results were disappointing.</p>
<p>602 points, which basically meant I had no chance of getting into the
top five prestigious schools. For the first time, I saw disappointment
and seriousness on my father's face. That day, he took me to consult at
Xi'an No. 3 Middle School, and he said a lot while I remained
silent.</p>
<p>After that, I went to No. 3 Middle School, but my school records were
kept at Zunde Middle School. The only difference was that I had to pay a
few thousand more in tuition fees each year. I came to this high school
with a sense of dissatisfaction, and later I found that many others felt
the same way. Some went to Xi'an Jiaotong University Affiliated Middle
School, and some went to Tieyi Middle School. Compared to students who
graduated from the junior high school of the same school, we had more in
common. It wasn't just because of our similar backgrounds, but more
likely because we had a reverence for certain things that other students
didn't have.</p>
<p>During these three years of high school, I experienced the fastest
mental growth and also did the dumbest things. I won't go into the
specifics here because I will probably never forget them in my life. The
most impactful relationship in my life also started during this time. It
started with frequent conversations, then my confession, followed by
frequent phone calls, and then we agreed to be together. The date was
March 12, 2017, my birthday during the year of the college entrance
exam. I heard the confession while lying in bed with a high fever, and I
was really happy. The period of time after that was the happiest time
for me. Just like any couple in love, we had endless sweet words, didn't
want to hang up the phone, and had infinite expectations for our future
together. However, as the college entrance exam approached, this passion
gradually cooled down, and both of us focused most of our energy on
studying.</p>
<p>These are the most memorable moments for me before college. I won't
talk about my university life for now. Overall, it hasn't been smooth
sailing. I'll stop here with the memories and talk about the future.</p>
<p>The first thing is about sensibility and rationality. In my mind,
there are mainly two types of consciousness. One contains all kinds of
emotions: love, family, desire, laziness, cowardice, etc. The other
contains most of my rationality: logic, reasoning, knowledge,
fearlessness, prudence, etc. These two consciousnesses often argue when
faced with issues related to myself, resulting in indecisiveness and
easy changes of mind. Relatively speaking, the emotional part is weaker
and less frequent, but once it acts impulsively, it can cause
significant damage. The rational part is stronger and can support me in
accomplishing many things, but it lacks empathy. Striking a balance
between the two is an important task for the future.</p>
<p>The second thing is about the inner self. Every man has a little boy
in his heart, and even now, sometimes I still think about things as a
child. This is understandable as long as it doesn't have a negative
impact on others, especially those close to me. This is important.</p>
<p>The third thing is about my life path. After sharing so many
experiences from the past, it is to understand who I really am and what
I want to do. In the past, I was usually defined by the environment and
people around me. "A sensible child," "not talkative," "young," "poor
understanding," "good grades without parents worrying," and so on.
Sometimes I would get trapped in these definitions and live up to the
descriptions of others, chasing after their definition of "good."
However, these evaluations, although somewhat valuable, are ultimately
derived from my own perspective. I, myself, am the most fundamental
thing, not any other evaluation. Therefore, I now believe that what I
think in my heart constitutes who I am. As for what I want to do, in my
professional field, I will become a person who is valuable and
contributes to society and the people. In my personal life, health is
the top priority, and on this basis, I can pursue anything I like. In
terms of family, communication, trust, and tolerance are the three most
important things.</p>
<p>My growth in the past was passive and helpless. This turning point is
active and no longer evasive.</p>
<p>Written at 02:30 on May 17, 2023.</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>心情</tag>
      </tags>
  </entry>
  <entry>
    <title>The magnificent Taiyuan young doctors journey.</title>
    <url>/en/35bdcdc0.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/35bdcdc0.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>24th May 28th - 31st, 24th, I participated in the Youth Doctor
Taiyuan Tour with Guoguo. Overall, the trip to Taiyuan gave me the
biggest surprise.</p>
<p><img src="https://download.kezhi.tech/img/202405311453559.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<span id="more"></span>
<h2 id="arrival-in-taiyuan-opening-ceremony">Arrival in Taiyuan &amp;
Opening Ceremony</h2>
<p>This Taiyuan tour was organized by the Taiyuan Municipal Government,
with 2048 Ph.D. scholars from various places participating. This was my
first time in Taiyuan, and to be honest, I hadn't paid much attention to
this city before, nor did I have any plans to visit or work here. For
me, this trip to Taiyuan provided an opportunity to get to know this
city.</p>
<p>On the evening of the 28th, we arrived in Taiyuan and were taken to
the hotel by a special car. The organizers prepared a gift bag with some
snacks, event culture shirts, Shanxi travel guides, and... a bottle of
health vinegar.</p>
<p>To be honest, the taste of this health vinegar was very... vinegary.
When you drink it, you can taste the unique aroma of vinegar, but it's
really too sour.</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302237334.jpg?x-oss-process=style/webp" style="width:75%"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302230788.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302233834.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>At night, Guoguo and I walked along the Fen River near the hotel, and
on the bridge, we saw a welcome message projected onto the theater on
the opposite bank. In addition, many buildings along the river were
displaying related slogans on their screens. This made me feel like the
whole city was welcoming us. This feeling quickly brought us closer to
the city and made us feel very comfortable.</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302232982.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302235305.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302236006.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>The next morning after breakfast, we set off at 7:40 for the
<code>Shanxi Xiahe International Conference Center</code> to attend the
opening ceremony. <del>To be honest, getting up so early is really
difficult for a Ph.D.</del></p>
<p>There were many snacks prepared outside the venue, which suited the
academic gourmands' taste very well^_^</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307315.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307821.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302314259.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307205.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302311640.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302307916.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>The mayor presided over the opening ceremony, and speeches were given
by the governor, the secretary of the municipal party committee, the
mayor, and the minister of the municipal party committee organization
department. After the opening ceremony, there were roadshow activities
in various halls. <del>However, Guoguo and I wandered around the halls
eating snacks.</del></p>
<h2 id="visiting-universities-research-institutes">Visiting Universities
&amp; Research Institutes</h2>
<p>After the opening ceremony, the afternoon was dedicated to visiting
activities. We chose the route of visiting universities and research
institutes, specifically the Institute of Coal Chemistry of the Chinese
Academy of Sciences and Taiyuan University of Technology.</p>
<p>First was the Institute of Coal Chemistry. To be honest, this was not
very relevant to my field, so I took a quick look to understand. The
carbon fibers and various catalysts they produced, such as
<code>T800</code> and <code>T1000</code>, looked impressive.</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302327776.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302327443.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p><img src="https://download.kezhi.tech/img/202405302327070.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>This is a pilot-scale equipment for testing, and after verification
on this, the next step would be production. Research institutes are
ahead of universities in terms of technology transfer.</p>
<p><img src="https://download.kezhi.tech/img/202405302327829.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>After a quick visit to the Institute of Coal Chemistry, we took a car
to Taiyuan University of Technology. Upon arrival, Guoguo went straight
to the library for an online meeting (typical Ph.D. life).</p>
<p><img src="https://download.kezhi.tech/img/202405302328079.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>I must say, the library at Taiyuan University of Technology is really
well-built, much better than the library at a certain unnamed top
university in the northwest. I suggest that the top university in the
northwest learn from Taiyuan University of Technology in this
aspect.</p>
<p><img src="https://download.kezhi.tech/img/202405302327398.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p><img src="https://download.kezhi.tech/img/202405302328527.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302328093.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302343056.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>Finally, here are some of the faculty benefits at Taiyuan University
of Technology for those who are interested:</p>
<p><img src="https://download.kezhi.tech/img/202405302327783.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p><img src="https://download.kezhi.tech/img/202405302328993.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<h2 id="jinci-tianmen-mountain">Jinci &amp; Tianmen Mountain</h2>
<p>The itinerary for the next morning was to visit Jinci and the Tianmen
Mountain Grottoes, and we had to wake up even earlier, meeting at 7:20.
<del>This was really difficult for me QAQ</del></p>
<p><img
src="https://download.kezhi.tech/img/202405310005086.jpg?x-oss-process=style/webp" /></p>
<p>I must say, the Tianmen Mountain Grottoes are quite impressive, built
into the mountains with exquisite carvings. Despite the ravages of time,
they still appear magnificent and spectacular.</p>
<p><img
src="https://download.kezhi.tech/img/202405310005430.jpg?x-oss-process=style/webp" /></p>
<p>However, the despicable looters took away most of the Buddha statues
over a hundred years ago, and now there are hardly any intact statues
left. Ugh.</p>
<p><img
src="https://download.kezhi.tech/img/202405310005499.jpg?x-oss-process=style/webp" /></p>
<p>After coming down from Tianlong Mountain, we headed to Jinci.</p>
<p><img
src="https://download.kezhi.tech/img/202405310005968.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405311317988.jpg?x-oss-process=style/webp" /></p>
<p>Jinci has three wonders: ancient cypress trees, colored sculptures,
and the Nanyao Spring. The ancient cypress trees have survived for over
three thousand years, the colored sculptures have remained vivid since
the Song Dynasty, and the Nanyao Spring flows continuously.</p>
<p>There are three treasures: the Hall of the Holy Mother, the Fish Pond
Flying Beam, and the Offering Hall. For me, the most impressive and
favorite is the Hall of the Holy Mother. The grand hall houses the
statue of Yi Jiang, the daughter of Jiang Ziya, and the wife of King Wu
of Zhou.</p>
<p><img
src="https://download.kezhi.tech/img/202405310003973.jpg?x-oss-process=style/webp" /></p>
<p>The dragon sculptures on each pillar outside the Hall of the Holy
Mother are quite unique, especially the dragon making a peace sign.
Originally with four claws, two were lost over the years, giving it the
appearance of a peace sign.</p>
<figure>
<img
src="https://download.kezhi.tech/img/202405310003109.jpg?x-oss-process=style/webp"
alt="IMG_20240530_115159" />
<figcaption aria-hidden="true">IMG_20240530_115159</figcaption>
</figure>
<p>The carvings on the roof of the main hall are also exquisite,
showcasing the artistic skills and craftsmanship of our ancestors. With
the development of society and my own age, I can increasingly appreciate
the brilliance, continuity, and diversity of our ancient civilization. I
remember in middle school, the phrase <strong>"Chinese civilization has
a long history and is profound"</strong> was just a summary in history
textbooks, a test point. But here, this phrase is manifested in time and
space.</p>
<p><img
src="https://download.kezhi.tech/img/202405310005930.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405310003658.jpg?x-oss-process=style/webp" /></p>
<p>Upon entering the Hall of the Holy Mother, there are statues of Yi
Jiang and her maids inside the vast hall, which has no columns,
providing a good spatial setting for the statues. Once again, I couldn't
help but marvel at the craftsmanship of the ancients.</p>
<p><img src="https://download.kezhi.tech/img/202405311329642.jpg" /></p>
<p>At Jinci, we also encountered some children who came to play, dressed
in unique styles of clothing from different eras, including modern,
Republican, and some Hanfu styles that I couldn't recognize. For them,
the brilliance of Chinese civilization is gradually integrating into
their lives, and the inheritance of ancient culture and its fusion with
modern culture will undoubtedly provide answers that we cannot
predict.</p>
<figure>
<img
src="https://download.kezhi.tech/img/202405310005270.jpg?x-oss-process=style/webp"
alt="IMG_20240530_112026" />
<figcaption aria-hidden="true">IMG_20240530_112026</figcaption>
</figure>
<p>Outside the hall, there are some other clay sculptures, which look
familiar. Later, I learned from others that this was the filming
location for the part of Benbo in the 1986 TV series "Journey to the
West." I can only say that I was so focused on the Monkey King as a
child that I missed out on the beautiful women, sets, and historical
sites in the show 😂</p>
<figure>
<img src="https://download.kezhi.tech/img/202405311329778.jpg"
alt="IMG_20240530_113403" />
<figcaption aria-hidden="true">IMG_20240530_113403</figcaption>
</figure>
<h2 id="bell-tower-street-ancient-county-town">Bell Tower Street &amp;
Ancient County Town</h2>
<p>Bell Tower Street is a popular street in Taiyuan centered around the
bell tower, offering a mix of tourism, leisure, entertainment, and
dining experiences. Upon entering, the bell tower also welcomed us,
which was really surprising.</p>
<p><img
src="https://download.kezhi.tech/img/202405310008414.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405310008807.jpg?x-oss-process=style/webp" /></p>
<p>The commercial screens at the intersection were also displaying
welcome messages for the Ph.D. scholars.</p>
<p><img
src="https://download.kezhi.tech/img/202405310008475.jpg?x-oss-process=style/webp" /></p>
<p>The sea buckthorn juice was delicious, said to lower blood lipids,
bringing some comfort to my not-so-healthy body.</p>
<p><img
src="https://download.kezhi.tech/img/202405310008247.jpg?x-oss-process=style/webp" /></p>
<p>There isn't much to say about Bell Tower Street, so I'll end this
part with a very satisfying night view of the bell tower that I took.
The <code>Mate40 Pro</code> is still leading the way.</p>
<p><img
src="https://download.kezhi.tech/img/202405310006497.jpg?x-oss-process=style/webp" /></p>
<p>Compared to Bell Tower Street, the overall impression of the ancient
county town in Taiyuan is better. Built around the city wall of the
county, it is laid out with four main streets running north, south,
east, and west, lined with shops, performance venues, and attractions on
both sides of the four main streets. For me, as someone from Shaanxi,
this layout is very familiar, almost like a miniature version of Xi'an's
city area. However, unlike Xi'an's city area, there are no motor
vehicles crisscrossing everywhere, no hurried pedestrians, and no tall
buildings that compromise the city's landscape. Instead, there is a
unified architectural style and an immersive experience for
visitors.</p>
<p><img
src="https://download.kezhi.tech/img/202405302359380.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405302359391.jpg?x-oss-process=style/webp" /></p>
<p>I wonder if it should be pronounced KFC or CKF.</p>
<p><img
src="https://download.kezhi.tech/img/202405311358035.jpg?x-oss-process=style/webp" /></p>
<p>The ancient county yamen, where the Ph.D. job fair was held, is quite
spacious. If ancient county yamens were really of this standard, then
being a county magistrate would indeed be quite comfortable.</p>
<p><img
src="https://download.kezhi.tech/img/202405302359859.jpg?x-oss-process=style/webp" /></p>
<p>Just saying, Ph.D. scholars are not idle during their trips (Guoguo
and I also had various meetings and code reviews).</p>
<table>
<tr>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302359035.jpg?x-oss-process=style/webp"/>
</center>
</td>
<td>
<center>
<img src="https://download.kezhi.tech/img/202405302359905.jpg?x-oss-process=style/webp"/>
</center>
</td>
</tr>
</table>
<p>The drum tower and Confucius Temple in the ancient county town, where
photography is not allowed inside the Confucius Temple, so here's an
image of the entrance.</p>
<p><img
src="https://download.kezhi.tech/img/202405310000218.jpg?x-oss-process=style/webp" /></p>
<p><img
src="https://download.kezhi.tech/img/202405310000697.jpg?x-oss-process=style/webp" /></p>
<p>There is also a stone exhibition hall in the ancient county town,
showcasing various stones and exquisite crafts made from them.</p>
<p><img src="https://download.kezhi.tech/img/202405310002112.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>Why does the phoenix crown look so much better than the crown?</p>
<p><img
src="https://download.kezhi.tech/img/202405310002857.jpg?x-oss-process=style/webp" /></p>
<p>The stone-made Manchu Han Imperial Feast is truly lifelike.</p>
<p><img
src="https://download.kezhi.tech/img/202405310001241.jpg?x-oss-process=style/webp" /></p>
<p><img src="https://download.kezhi.tech/img/202405310001789.jpg?x-oss-process=style/webp" style="width:50%;" /></p>
<p>This large piece of turquoise could enchant the entire body with
enchantments!</p>
<p><img
src="https://download.kezhi.tech/img/202405310003823.jpg?x-oss-process=style/webp" /></p>
<p>The natural copper ore looks quite beautiful.</p>
<p><img
src="https://download.kezhi.tech/img/202405310002939.jpg?x-oss-process=style/webp" /></p>
<p>Before leaving, we tried the local specialties of aged vinegar, sea
buckthorn, and baijiu ice cream. The aged vinegar ice cream was
unexpectedly delicious. It retained the rich aroma and gentle acidity of
the vinegar, combined with the texture of ice cream, making it a
delightful treat.</p>
<p><img
src="https://download.kezhi.tech/img/202405310003733.jpg?x-oss-process=style/webp" /><img
src="https://download.kezhi.tech/img/202405302359776.jpg?x-oss-process=style/webp" /></p>
<p>After enjoying the ice cream, Guoguo and I left the ancient county
town of Taiyuan and returned to the hotel by car. This marked the end of
the Youth Doctor Taiyuan Tour. Although it was short, it left me with
many thoughts, prompting me to write this conclusion to share my
reflections.</p>
<p><img src="https://download.kezhi.tech/img/202405302358571.jpg?x-oss-process=style/webp" style="width:75%;" /></p>
<h2 id="conclusion">Conclusion</h2>
<p>The biggest impression I had during my trip to Taiyuan this time was
surprise. Surprised by the hospitality, surprised by the city's
development, surprised by its cultural heritage, and surprised by its
talent policies. It is evident that the Taiyuan municipal government
places great emphasis on attracting talent. This is reflected not only
in financial investments but also in the meticulous planning of the
entire event. Accurate scheduling of activities, thoughtful welcome
messages designed with different styles but all showing careful
consideration, and the excellent organizers and staff selected from
various units all demonstrate the level of importance Taiyuan attaches
to this event.</p>
<p>Now, let me share my impressions of Taiyuan as a city. Just as it is
promoted, Taiyuan is a livable city with distinct four seasons and
pleasant weather, making it a fitting description. The city's
infrastructure and commercial areas are relatively well-developed.
However, a prominent issue is the lack of people. Whether due to
weekdays or other reasons, the flow of people in malls, commercial
streets, and ancient towns is quite low. In 2022, Taiyuan's secondary
industry accounted for 44.2%, while the tertiary industry accounted for
54.9%<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>. Among these, the tourism operating
income was only 337 million yuan<a href="#fn2" class="footnote-ref"
id="fnref2" role="doc-noteref"><sup>2</sup></a>, indicating significant
room for growth.</p>
<p>Lastly, I would like to offer a small suggestion to the Taiyuan
municipal government. From the perspective of an out-of-town visitor,
Taiyuan's cultural and creative products are scarce. Cultural and
creative products with Shanxi characteristics mainly focus on noodles,
vinegar, and coal, which are modern items. Without the activities of
this trip to Taiyuan, I wouldn't have considered Taiyuan as a
destination in the current circumstances. However, upon visiting, I
discovered that Taiyuan's cultural and tourism resources are rich, with
sites like Jinci, Tianlongshan Grottoes, Qiao's Grand Courtyard, and the
ancient county town all having unique cultural characteristics. Yet,
when I wanted to bring souvenirs back for my friends, I found very few
cultural and creative products available. Less than 20% of the products
in cultural and creative stores feature Shanxi characteristics, with the
rest being national accessories or products from other provinces and
cities. In the end, I brought back two decent-looking coal keychains.
While I wanted to convey Taiyuan's historical background to my friends
when I returned home, it seemed challenging without physical objects.
Honestly, I didn't want to give coal or vinegar-related souvenirs, as
this would reinforce stereotypes about Shanxi. As a consumer, my choices
were rather limited.</p>
<p>In my opinion, the future development of cities is not just about
economic competition, talent attraction, but also about cultural and
image competition. With the transformation of our country's economic
structure and the changing demands of the people, there will inevitably
be changes in the choice of places to live. More and more people are
choosing to leave Beijing, Shanghai, and Guangzhou, either returning to
their hometowns, seeking beautiful landscapes, or traveling around the
country. In the new era, as Chinese people have more diverse choices due
to economic development, why can't our vast and resource-rich land meet
the needs of these hardworking individuals? Taiyuan has a pleasant
climate, well-developed infrastructure, dedicated individuals, rich
historical and cultural resources, and good resource endowments. All of
these need to be promoted through various channels to let more people
hear Taiyuan's voice, understand its past, present, and future. This not
only attracts more people to Taiyuan but also offers another lifestyle
choice for the people of our country.</p>
<h2 id="references">References</h2>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Economic Operation of Taiyuan City in 2022 - Taiyuan
Municipal Bureau of Statistics Website (<a
href="https://stats.taiyuan.gov.cn/sjjd/20230201/30018602.html#:~:text=三次产业占GDP,%、54.9%.">taiyuan.gov.cn)</a><a
href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Economic Operation of Taiyuan City in 2022 - Taiyuan
Municipal Bureau of Statistics Website (<a
href="https://stats.taiyuan.gov.cn/sjjd/20230201/30018602.html#:~:text=三次产业占GDP,%、54.9%.">taiyuan.gov.cn)</a><a
href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
      <tags>
        <tag>太原</tag>
        <tag>博士行</tag>
      </tags>
  </entry>
  <entry>
    <title>Limit WSL memory usage.</title>
    <url>/en/a587561c.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/a587561c.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>When using WSL2, the Linux subsystem will continuously allocate
system memory while running, as long as there is available memory in the
system. As it continues to run, it will occupy more and more memory, and
may even fill up the memory of the Windows system. Therefore, it is
necessary to limit its memory usage when running WSL.</p>
<p>The operation process is as follows:</p>
<ol type="1">
<li><p>Create a <code>.wslconfig</code> configuration file in the user
directory.</p>
<ul>
<li>Open the command line.</li>
<li>Enter the command <code>notepad .wslconfig</code> to create and edit
the configuration file.</li>
</ul></li>
<li><p>Write the WSL configuration:</p>
<p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[wsl2]</span><br><span class="line">memory=2GB</span><br><span class="line">swap=8GB</span><br><span class="line">localhostForwarding=true</span><br></pre></td></tr></table></figure></p></li>
<li><p>Restart WSL using <code>wsl --shutdown</code>.</p></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>WSL</tag>
      </tags>
  </entry>
  <entry>
    <title>The derivation of Gaussian distribution entropy.</title>
    <url>/en/80e25821.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/80e25821.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>This article mainly derives the entropy of a univariate Gaussian
distribution:</p>
<p><img src="https://download.kezhi.tech/img/202312051655209.jpg?x-oss-process=style/webp" alt="113646456_p0" style="width:33%;" /></p>
<span id="more"></span>
<p><span class="math display">\[
\begin{equation}
p(x) = \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma}}
\end{equation}
\]</span></p>
<p><span class="math display">\[
\begin{align}
H(x) &amp; = -\int p(x) \ln p(x) \mathrm{d}x \notag \\
&amp; = -\int
\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}} \cdot \ln
\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\mathrm{d}x \notag \\
&amp; = -\int
\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}} \cdot
(-\ln {\sqrt{2\pi\sigma^2}}-\frac{(x-\mu)^2}{2\sigma^2}) \mathrm{d}x
\notag \\
&amp; = \int \frac{\ln
{\sqrt{2\pi\sigma^2}}}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\cdot
\mathrm{d}x+\int\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\cdot\frac{(x-\mu)^2}{2\sigma^2} \mathrm{d}x \notag \\
&amp; = \ln\sqrt{2\pi\sigma^2}+\frac {1}{\sqrt{\pi}}\int e^{-t^2}\cdot
t^2\mathrm{d}t \notag \\
&amp; = \ln\sqrt{2\pi\sigma^2}+\frac 12 \notag \\
&amp; = \frac 12(\ln(2\pi\sigma^2)+1)
\end{align}
\]</span> where: <span class="math display">\[
\begin{equation}
\int e^{-x^2}\mathrm{d}x = \sqrt\pi
\end{equation}
\]</span></p>
<p><span class="math display">\[
\begin{align}
\int x^2\cdot e^{-x^2}\mathrm{d}x &amp; = -\frac12 \int
x(-2x)e^{-x^2}\mathrm{d}x \notag \\
&amp;=-\frac12 \int x\mathrm{d}e^{-x^2} \notag \\
&amp;=-\frac12 (x\cdot e^{-x^2}\Big|_{-\infty}^{+\infty}-\int
e^{-x^2}\mathrm{d}x) \notag \\
&amp;=\frac12 \int e^{-x^2}\mathrm{d}x) \notag \\
&amp;=\frac {\sqrt{\pi}}{2}
\end{align}
\]</span></p>
]]></content>
      <categories>
        <category>Study</category>
      </categories>
      <tags>
        <tag>Math</tag>
      </tags>
  </entry>
  <entry>
    <title>Improved multi-robot area coverage using the Bee Algorithm.</title>
    <url>/en/623a6b90.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/623a6b90.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>GitHub link: <a
href="https://github.com/KezhiAdore/MultiRobots_CoverMap">https://github.com/KezhiAdore/MultiRobots_CoverMap</a></p>
<p>Gitee link: <a
href="https://gitee.com/KezhiAdore/MultiRobots_CoverMap">https://gitee.com/KezhiAdore/MultiRobots_CoverMap</a></p>
<h2 id="introduction">1. Introduction</h2>
<h3 id="background">1. Background</h3>
<p>Robots are increasingly being used in industries, defense, and
scientific and technological fields. They can work in complex and
dangerous environments that are monotonous and unstructured. The use of
robots greatly improves work efficiency, changes people's lifestyles,
brings enormous economic and social benefits, and promotes the
development of related disciplines and technologies.</p>
<p>Area coverage refers to the process of exploring and accessing the
entire area with robots carrying sensors with a certain detection range,
such as lasers and sonars, and completing corresponding tasks. Area
coverage is a fundamental task of autonomous mobile robots.</p>
<span id="more"></span>
<p><img src="https://download.kezhi.tech/img/20200622224835.gif" /></p>
<center>
Figure 1.1 Example of a floor cleaning robot - a case of robot area
coverage problem
</center>
<h3 id="problem-definition">2. Problem Definition:</h3>
<ol type="1">
<li><p>A group of autonomous mobile robots with limited sensing
capabilities collaboratively cover a bounded connected area.</p></li>
<li><p>Robots can repeatedly cover a certain position in the area, and
the goal is to achieve a certain coverage rate of the area.</p></li>
<li><p>Robots complete the task in a distributed and non-centralized
manner, determining their actions based on the locally detected
information without relying on external control.</p></li>
<li><p>The coverage speed should be as fast as possible.</p></li>
</ol>
<h3 id="complexity-analysis-of-the-problem">3. Complexity Analysis of
the Problem</h3>
<p>Compared to general intelligent optimization problems, the swarm
robot area coverage problem is more complex in the following
aspects:</p>
<ul>
<li><p>Dynamics: The problem introduces the time dimension, and the
solution obtained is a sequence of robot paths (point sequences),
resulting in an extremely large solution space.</p></li>
<li><p>Distributed: The execution center of the algorithm is on a single
robot, without external host for unified control. The computational and
sensing capabilities of a single robot are limited, and the computing
power and information used for decision-making are limited.</p></li>
<li><p>Large-scale: In order to ensure the accuracy of map
representation, the number of grid cells in the grid map must be large.
At the same time, the actual environment map is complex and variable,
and the area is large, with a large number of robots.</p></li>
</ul>
<h2 id="preliminary-model-construction">2. Preliminary Model
Construction</h2>
<h3 id="modeling-the-environment">1. Modeling the Environment</h3>
<p>Gridify the map to form a grid map as the environment for robot
movement and obstacle placement.</p>
<p>The grid map divides the environment into rectangular grid cells,
with each grid cell serving as the smallest unit for robot movement and
coverage. Each grid cell has certain attributes, such as the
concentration of pheromones, whether it has been covered, and whether it
is empty or an obstacle.</p>
<p><img
src="https://download.kezhi.tech/img/20200622225508.png?x-oss-process=style/webp" /></p>
<center>
Figure 2.1 Example of gridification
</center>
<p>There are obstacles distributed in the map, and the robots cannot
pass through the obstacle grid cells, but they can be detected by the
robots.</p>
<h3 id="modeling-the-robots">2. Modeling the Robots</h3>
<h4 id="modeling-the-robots-as-particles">2.1 Modeling the Robots as
Particles</h4>
<p>Ignore the physical shape of the robots and treat them as
collision-free particles without volume. The robots can only be in one
grid cell of the grid map, and multiple robots can exist in the same
grid cell.</p>
<h4 id="modeling-the-detection-range-of-robots">2.2 Modeling the
Detection Range of Robots</h4>
<p>Due to the limitation of the distributed robot's power supply, its
detection range is also limited. To simplify the calculation on the grid
map, the detection range of the robot's pheromones is defined as four
units in the up, down, left, and right directions.</p>
<p><img
src="https://download.kezhi.tech/img/20200622225820.png?x-oss-process=style/webp" /></p>
<center>
Figure 2.2 Detection range of robots
</center>
<h4 id="functions-of-robots">2.3 Functions of Robots</h4>
<p>Robots can perform the following operations: move to one of the four
directions of up, down, left, and right or stay still, perceive the grid
cells in the up, down, left, right, and current positions, and modify
the concentration of pheromones in the grid cell they are in.</p>
<p>We focus more on the influence of pheromones on robot behavior rather
than studying the specific pheromones used for communication in physical
terms. Therefore, the concentration of pheromones at each position is
abstracted as a number, and the robot can modify the concentration of
pheromones when it reaches that position.</p>
<h3 id="modeling-time">3. Modeling Time</h3>
<p>Discretize time into units called "rounds". In each round, each robot
performs the following actions:</p>
<p>Step 1: Achieve coverage of the current grid cell.</p>
<p>Step 2: Modify the concentration of pheromones in the current grid
cell.</p>
<p>Step 3: Perform a movement or choose to stay still.</p>
<p>All robots perform these three actions synchronously in each
round.</p>
<h3 id="modeling-the-solution-to-the-problem">4. Modeling the Solution
to the Problem</h3>
<h4 id="representation-of-the-solution">4.1 Representation of the
Solution</h4>
<p>For a grid cell, it can be represented by a pair of coordinates <span
class="math inline">\((x, y)\)</span>. If the coverage process lasts for
t rounds and involves n robots, the solution can be represented by a
sequence of grid cells with a length of t for each robot, representing
the movement trajectory of each robot. The valid solution should not
include obstacle grid cells. The set of all grid cells forms the covered
grid cells.</p>
<h4 id="evaluation-of-the-solution">4.2 Evaluation of the Solution</h4>
<p>We define coverage rate as the ratio of covered grid cells to all
grid cells. The target coverage rate is denoted as α. When the current
coverage rate exceeds α or the time exceeds the upper limit, the
coverage process stops. The quality of the solution is measured by the
coverage time t. For maps of the same size and the same number of
robots, the shorter the time to achieve the given coverage rate, the
better the solution. Multiple experiments are conducted, and the shorter
the average time to achieve the given coverage rate, the better the
algorithm performance, and the smaller the standard deviation of the
average time, the better the algorithm performance.</p>
<h2 id="algorithm-design-and-improvement">3. Algorithm Design and
Improvement</h2>
<h3 id="common-description-of-the-map-and-robots">1. Common Description
of the Map and Robots</h3>
<p>For this problem, different coverage algorithms have different rules
for robot operation. However, the establishment and description of the
map are the same and can be reused in different algorithms. The
description of the map is as follows: - The map size is M*N, and the
total number of robots is n, denoted as r1, r2, ..., ri, ..., rn. - The
concentration of pheromones at a point (i, j) on the map is denoted as
sij, and the initial concentration of pheromones at each point is 1.</p>
<h3 id="basic-bee-algorithm">2. Basic Bee Algorithm</h3>
<p>The rules for robot operation are as follows:</p>
<ol type="1">
<li>The response threshold of each robot is θ.</li>
<li>For a robot ri at position (xi, yi), first update the concentration
of pheromones at its current position:</li>
</ol>
<p><span class="math display">\[
s_{xiyi} = s_{xiyi} \times \alpha (\alpha \in (0, 1))
\]</span></p>
<ol start="3" type="1">
<li>Detect the concentration of pheromones in the surrounding cells: up:
s1, down: s2, left: s3, right: s4.</li>
<li>The probability of robot choosing direction k is:</li>
</ol>
<p><span class="math display">\[
\frac{s_k^2}{\theta^2 + \sum_{k=1}^{4} s_k^2}
\]</span></p>
<ol start="5" type="1">
<li>The probability of robot staying still is:</li>
</ol>
<p><span class="math display">\[
\frac{\theta_i^2}{\theta^2 + \sum_{k=1}^{4} s_k^2}
\]</span></p>
<ol start="6" type="1">
<li>Use roulette wheel selection to choose the next movement direction
or stay still.</li>
</ol>
<p>The above algorithm is the most basic bee algorithm in the
literature, with two parameters θ and α that affect the robot's
movement. Through simulation experiments, the influence of these two
parameters on map coverage is explored. All simulation maps in this
experiment are of size 100*100, with 50 robots randomly distributed on
the map.</p>
<p><img
src="https://download.kezhi.tech/img/20200623002730.png?x-oss-process=style/webp" /></p>
<center>
Figure 3.1 Influence of θ on coverage results
</center>
<p>From the above experimental results, it can be seen that as θ
increases, the coverage time and time variance increase rapidly. From
the perspective of the algorithm, when θ is larger, the robot is more
likely to stay still after exploring the surrounding area.</p>
<p><img
src="https://download.kezhi.tech/img/20200623002917.png?x-oss-process=style/webp" /></p>
<p>When θ is very small, even if the surrounding cells have been visited
multiple times, the robot still has a high probability of moving instead
of staying still.</p>
<p><img
src="https://download.kezhi.tech/img/20200623002947.png?x-oss-process=style/webp" /></p>
<p>When θ is not much different from the initial concentration of
pheromones, such as in the above figure where θ is 1/10 of the initial
concentration, in this case, if all four surrounding cells have been
visited more than twice, the probability of the robot moving is greatly
reduced. This leads to a sharp increase in the average coverage time and
variance. Considering the above experimental results and the actual
situation, since the effect of the robot staying still when θ is very
small is negligible, and when θ is large, it will seriously affect the
map coverage speed, in practical applications, we hope that the swarm
robots can complete the coverage as quickly as possible rather than
saving energy. Therefore, we choose to remove the rule of robots staying
still, that is, θ=0. After the above modification, further experiments
are conducted to explore the influence of α on the coverage time of
swarm robots.</p>
<p><img
src="https://download.kezhi.tech/img/20200623003121.png?x-oss-process=style/webp" /></p>
<center>
Figure 3.2 Influence of α on coverage results
</center>
<p>From the above experimental data, it can be seen that with the change
of α, the coverage time and coverage time variance do not change much,
and there is a trend of increasing and then decreasing. This is because
when α is small, the concentration of pheromones in the explored area
changes rapidly, effectively preventing repeated exploration. When α is
large, there is a certain tolerance for returning to previously explored
areas, allowing robots to return to the original area to cover the
missed area. Both have their advantages and disadvantages, but overall,
the value of α has little impact on coverage efficiency.</p>
<h3 id="bee-algorithm-with-adaptive-pheromone-release">3. Bee Algorithm
with Adaptive Pheromone Release</h3>
<p>Through the analysis of the above bee algorithm, we found that the
following two situations have the same change in the concentration of
pheromones in the central area under the bee algorithm.</p>
<p><img
src="https://download.kezhi.tech/img/20200623003224.png?x-oss-process=style/webp" /></p>
<center>
Figure 3.3 Different scenarios of map exploration
</center>
<p>However, in reality, for the scenario on the right, in order to
explore the blank cells around the central node, we hope that some
robots can return to the central node. For the scenario on the left,
since its surroundings have been mostly explored, it is not meaningful
for robots to return to the central node, and we hope that robots will
try to avoid returning to that area. Therefore, we propose an adaptive
pheromone release method, where the modification of pheromones is small
when there are many unexplored cells around, and the modification of
pheromones is large when there are few unexplored cells. At the same
time, we hope that this change is nonlinear. The new pheromone release
method is as follows:</p>
<ul>
<li>The basic update of pheromones is still: <span
class="math display">\[
s = s \times \alpha
\]</span></li>
<li>Let m be the number of empty cells around a certain cell, then the
weight exponent to be added is: <span class="math display">\[
k = 1 + \frac{4-m}{4}
\]</span></li>
<li>Then the way robots update pheromones in a certain cell becomes:
<span class="math display">\[
s = s \times \alpha^k
\]</span></li>
</ul>
<h3 id="bee-algorithm-with-memory-backtracking">4. Bee Algorithm with
Memory Backtracking</h3>
<p>In obstacle map coverage tests, we found the following phenomenon:
robots are trapped in a small enclosed area with a small entrance and
cannot get out. This leads to robots being trapped and unable to work
properly.</p>
<p><img
src="https://download.kezhi.tech/img/20200623003821.png?x-oss-process=style/webp" /></p>
<center>
Figure 3.4 Robots being trapped
</center>
<p>To avoid this situation, we consider the backtracking feature of
depth-first search (DFS) and perform backtracking when there is no way
out. The algorithm flow combining memory backtracking with the bee
algorithm is as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623003850.png?x-oss-process=style/webp" /></p>
<center>
Figure 3.5 Bee algorithm with memory backtracking
</center>
<p>Using this algorithm, even if the robot enters a local obstacle area,
it can use the memory path to backtrack and walk out of the local
environment, which has good reliability and robustness.</p>
<h2 id="performance-testing-and-improvement-direction">4. Performance
Testing and Improvement Direction</h2>
<h3 id="testing-on-open-maps">1. Testing on Open Maps</h3>
<p>Open maps are the simplest and most convenient maps to test, and the
test results on these maps can well reflect the time and time stability
of the algorithms mentioned above. At the same time, in this experiment,
the number of tests is increased, with each map and each algorithm
tested 500 times to avoid randomness. The test results on open maps are
as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623004514.png?x-oss-process=style/webp" /></p>
<p>From the above experimental results, it can be seen that the adaptive
pheromone release bee algorithm has the shortest exploration time and
the best time stability. The other two algorithms have similar coverage
times, and the time stability of the memory backtracking bee algorithm
is slightly worse.</p>
<h3 id="testing-on-maps-with-simple-obstacles">2. Testing on Maps with
Simple Obstacles</h3>
<p><img
src="https://download.kezhi.tech/img/20200623012150.png?x-oss-process=style/webp" /></p>
<center>
Figure 4.1 Map with simple obstacles
</center>
<p>The test results on the above map are as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623012213.png?x-oss-process=style/webp" /></p>
<p>The test results are significantly different from those on open maps.
The memory backtracking bee algorithm performs the best in terms of the
two evaluation metrics, followed by the adaptive pheromone release bee
algorithm. The basic bee algorithm takes longer and has worse time
stability.</p>
<h3 id="testing-on-real-terrain">3. Testing on Real Terrain</h3>
<h4 id="hot-spring-bathroom">3.1 Hot Spring Bathroom</h4>
<p>The map of the hot spring bathroom is as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623012251.png?x-oss-process=style/webp" /></p>
<center>
Figure 4.2 Floor plan of the hot spring bathroom
</center>
<p>The most notable feature of this map is the presence of many small
rooms with small entrances, making it easy for robots to get trapped and
unable to get out. The results of the three algorithms on this map are
as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623012321.png?x-oss-process=style/webp" /></p>
<p>Due to the influence of the terrain and in order to test the actual
environment, all robots start from the top left corner of the map
instead of being randomly distributed initially, resulting in a
significant increase in the time required for the three algorithms to
cover the map.</p>
<p>From the three sets of results, the memory backtracking bee algorithm
has the highest efficiency, followed by the adaptive pheromone release
bee algorithm, and the basic bee algorithm takes the longest time and
has the worst time stability.</p>
<h4 id="zhongying-college">3.2 Zhongying College</h4>
<p>The terrain of Zhongying College is as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623012351.png?x-oss-process=style/webp" /></p>
<center>
Figure 4.3 Floor plan of Zhongying College
</center>
<p>The test results are as follows:</p>
<p><img
src="https://download.kezhi.tech/img/20200623012410.png?x-oss-process=style/webp" /></p>
<p>In this map, the memory backtracking bee algorithm is obviously
superior to the other two intelligent algorithms, and the adaptive
pheromone release algorithm is also more efficient than the basic bee
algorithm. The basic bee algorithm takes longer and has worse time
stability.</p>
<h3 id="experimental-conclusion">4. Experimental Conclusion</h3>
<ul>
<li><p>The bee algorithm with heuristic pheromone release is more
time-efficient than the basic bee algorithm in all cases.</p></li>
<li><p>The bee algorithm with memory backtracking performs best in maps
with many obstacles, followed by the adaptive pheromone release bee
algorithm. The basic bee algorithm takes longer and has worse time
stability.</p></li>
</ul>
<h3 id="other-improvement-ideas">5. Other Improvement Ideas</h3>
<p><em>Bee Algorithm with Limited-Length Memory for Depth-First
Search</em></p>
<p>In practical situations, unlimited memory for the DFS algorithm is
difficult to achieve due to movement errors and memory limitations.
Therefore, a length limit can be added to the algorithm.</p>
<ol type="1">
<li>Queue length limit: Use a deque instead of a stack, and pop the last
element when the queue length exceeds the limit.</li>
<li>Stack length limit: Force backtracking when the stack length exceeds
the limit.</li>
</ol>
]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>智能计算</tag>
        <tag>多机器人</tag>
        <tag>覆盖问题</tag>
        <tag>算法改进</tag>
      </tags>
  </entry>
  <entry>
    <title>为什么我并不常用大语言模型</title>
    <url>/a4c87d5f.html</url>
    <content><![CDATA[<p>从 <code>ChatGPT</code>
问世带给人们惊艳的文本生成能力表现之后，各家大模型如雨后春笋般逐渐冒出。开发者们也基于大语言模型的能力，开发出来很多让大模型来赋能生活和工作的功能。然而，大语言模型究其本质，也只是一个文本概率预测模型，而非真正的通用人工智能。尽管它在很多方便表现出很强的智能能力，在一些任务上极大提升了人们的效率。但一味地信任它给出的结果也可能会工作和生活带来副作用。目前也有很多对大语言模型回答幻觉和事实性的研究。本文不从研究的角度出发，仅以个人日常生活中对大模型使用的取舍出发，给出一点使用当前水平大语言模型的一些思考。</p>
<p><img src="https://download.kezhi.tech/img/202407112221297.jpg?x-oss-process=style/webp" style="width:66%;" /></p>
<span id="more"></span>
<h2 id="什么时候我会用大语言模型">什么时候我会用大语言模型</h2>
<p>首先说一下目前使用大语言模型最多的场景以及对应的工具（按照频率从上至下）：
1. 中英文互翻翻译（Pot） 2. 代码快速补全、注释和测试用例生成（VSCode）
3. 论文摘要简记（Zotero） 4. 写无聊的材料（ChatBox）</p>
<h2 id="什么时候我不用大语言模型">什么时候我不用大语言模型</h2>
<p>接着来谈一下在什么时候我选择不使用大预言模型。这里的不用大语言模型可以从两种角度来理解：</p>
<ol type="1">
<li>我工作生活中除了使用大模型之外进行处理的事情之外的其他事情</li>
<li>别人使用大模型来做但我选择在这件事上不用大模型的事情</li>
</ol>
<p>这可以规范化描述为：</p>
<blockquote>
<p>设我日常工作生活中的所有事情构成的集合为 <span
class="math inline">\(U_{me}\)</span>，其中我使用大模型来处理的事情构成的集合标记为
<span
class="math inline">\(U_{me,LLM}\)</span>，其他人日常工作生活中的所有事情构成的集合为
<span
class="math inline">\(U_{other}\)</span>，其中他们使用大模型来处理的事情构成的子集为
<span
class="math inline">\(U_{other,LLM}\)</span>。则上述两种定义可以以差集的形式表示为：</p>
<ol type="1">
<li><span class="math inline">\(U_{me}-U_{me,LLM}\)</span></li>
<li><span class="math inline">\(U_{other,LLM}-U_{me,LLM}\)</span></li>
</ol>
</blockquote>
<p>这里主要讨论第二种理解角度，即别人会使用但我并不会使用大模型来进行处理的事情。就我在实验室的观察来看，这些事情主要包含：</p>
<ol type="1">
<li>提问大模型某个包中函数的作用（如 <code>pytorch</code> 中
<code>squeeze</code> 的作用）</li>
<li>让大模型来完成某个任务代码的编写（如写完成一段机器人控制指令的代码）</li>
<li>让大模型解释某一段代码的作用</li>
<li>让大模型来回答某些具体的科学问题（比如如何提升强化学习模型的泛化性）</li>
</ol>
<h2 id="选择使用大模型的边界是什么">选择使用大模型的边界是什么？</h2>
<p>对上面两节中我选择使用大模型和不使用大模型的任务进行比较可以发现，选择使用大模型的任务通常具备以下属性：</p>
<ul>
<li>易确认：在大模型输出结果之后，我可以以较低的成本来确认结果的正确性。如在翻译软件
<code>Pot</code> 中使用多个翻译 <code>api</code>
（剑桥词典，必应词典，谷歌翻译，OpenAI，智谱AI）进行交叉验证</li>
<li>良好定义：不论是翻译任务，还是代码补全，翻译等任务，任务的输出和任务的输入是高度相关且不需要太多创造性的。</li>
<li>不重要：这一点是专门对材料生成这个任务的，dddd</li>
</ul>
<p>当用大语言模型来解决具备以上这些属性的任务时，我可以不用花费更多的精力来确认生成结果的正确性或事实性。从而其可以几乎没有任何耗费地提高我的生产效率。在目前这个无法保证回答正确性的大模型阶段，我认为可以寻找工作流程中具备上述属性的工作内容，让大模型来为自己提升效率。</p>
<p>再来说说我不使用大模型的任务所具备的一些特性：</p>
<ul>
<li>事实性：需要回答的问题是某种事实。如提问函数的作用，某些具体的有答案的问题</li>
<li>歧义性：给大模型的问题本身存在多种可能的理解，从而导致回答的不准确性。如提问某些函数的作用</li>
<li>创造性：给大模型的问题解空间太大，可能的输出过多，从而导致想要得到一个好的回答需要反复提问。如让大模型写完成某个任务的代码</li>
</ul>
<p>现阶段的<strong>大语言模型本质上只是一个文本概率预测器</strong>，因而，对其进行事实性问题的提问得到的回答依赖于其在训练过程中是否有见过相关的语料。此外，模型经过一些数据集的微调之后可能会产生更严重的幻觉问题
<a href="https://arxiv.org/abs/2405.05904">(Gekhman et al. 2024)</a>
。因此，从使用角度来说，关于事实性的问题我并不建议通过提问大模型来进行解决。</p>
<p>其次，具备上述这些特性的任务还具备一个特性就是难以确认结果的正确性。或者说确认其正确性的成本不亚于不使用大模型。例如，若要确认大模型给出的某个函数作用是否正确，那么可能需要找到相关的文档进行确认，或者写一个简单的测试代码来查看输出结果。而这个确认过程本身就足以完成这些任务。此外，若不对大模型生成的结果进行确认，其出错时候造成的后果往往很严重。例如，若不确认大模型回答的关于强化学习泛化问题的回答，就按照其所述的思路进行后续的工作。那么如果大模型给出的回答中存在谬误，可能会致使大量的无效工作产生。</p>
<p>最后，从个人学习和成长来讲，我也十分不建议在诸如此类任务上使用大模型，其带来的危害如下：</p>
<ol type="1">
<li>缺乏成长性：在不用大模型的情况下，通过尝试解决这些任务可以有效提升个人能力。如查找阅读文档的能力，阅读代码的能力，查找阅读文献的能力等。从而带来个人工作效率的加速度（完成这些任务的速度会越来越快）。而一直使用大模型来完成诸如此类的任务是不能个人能力的提升从而转换为加速度的。</li>
<li>盲目相信：尽管大模型会给出一些事实性错误，但他的语言组织能力太好了。好到会让人对对他所说的一些“谎言”信以为真。若是在自己熟悉的专业领域，那对大语言模型给出的谬误可以一眼甄别。可倘若在并非自己熟悉的领域一直使用大模型来回答问题，这样的便捷性和消息来源的单一性会逐渐导致人失去从搜索引擎得到的众多搜索结果中辨认正确结果的能力，最终只能盲目相信大语言模型回答的结果。</li>
</ol>
<h2 id="结语">结语</h2>
<p>综上所述，我认为首先要摆正对大模型的认识。现阶段的<strong>大语言模型只是一种文本生成的工具</strong>，并非能够回答所有问题的“智者”。要以使用工具的态度来对待大模型，摒弃掉对大模型的神化和盲目相信。让大模型为自己所用，而不是成为大模型的奴隶。</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>大模型</tag>
      </tags>
  </entry>
  <entry>
    <title>Why I dont often use large language models.</title>
    <url>/en/a4c87d5f.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/a4c87d5f.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>After the amazing text generation capabilities brought by the
emergence of <code>ChatGPT</code>, various large models have gradually
emerged like mushrooms after the rain. Developers have also developed
many functions based on the capabilities of large language models to
empower life and work. However, at its core, a large language model is
just a text probability prediction model, not a true general artificial
intelligence. Although it demonstrates strong intelligence in many
aspects and greatly improves efficiency in some tasks, blindly trusting
its results may also bring side effects to work and life. Currently,
there is also a lot of research on the illusion and factual nature of
large language model responses. This article does not start from a
research perspective, but only discusses the considerations of using
large models in daily life.</p>
<p><img src="https://download.kezhi.tech/img/202407112221297.jpg?x-oss-process=style/webp" style="width:66%;" /></p>
<span id="more"></span>
<h2 id="when-do-i-use-large-language-models">When Do I Use Large
Language Models</h2>
<p>First, let's talk about the most common scenarios where I currently
use large language models and the corresponding tools (in order of
frequency from top to bottom): 1. Chinese-English translation (Pot) 2.
Code completion, comments, and test case generation (VSCode) 3.
Summarizing papers (Zotero) 4. Writing boring materials (ChatBox)</p>
<h2 id="when-do-i-not-use-large-language-models">When Do I Not Use Large
Language Models</h2>
<p>Next, let's discuss when I choose not to use large language models.
Not using large language models here can be understood from two
perspectives:</p>
<ol type="1">
<li>Things in my work and life other than those handled by large
models</li>
<li>Things that others use large models for but I choose not to use them
for</li>
</ol>
<p>This can be formalized as:</p>
<blockquote>
<p>Let the set of all things in my daily work and life be denoted as
<span class="math inline">\(U_{me}\)</span>, where the set of things I
use large models to handle is denoted as <span
class="math inline">\(U_{me,LLM}\)</span>, the set of all things in
other people's daily work and life is denoted as <span
class="math inline">\(U_{other}\)</span>, and the subset of things they
use large models to handle is denoted as <span
class="math inline">\(U_{other,LLM}\)</span>. The two definitions above
can be represented as the difference of sets:</p>
<ol type="1">
<li><span class="math inline">\(U_{me}-U_{me,LLM}\)</span></li>
<li><span class="math inline">\(U_{other,LLM}-U_{me,LLM}\)</span></li>
</ol>
</blockquote>
<p>This mainly discusses the second perspective, that is, things that
others use large models for but I choose not to use them for. From my
observations in the lab, these things mainly include:</p>
<ol type="1">
<li>Asking the function of a function in a large model package (such as
the function of <code>squeeze</code> in <code>pytorch</code>)</li>
<li>Letting the large model write a piece of code for a specific task
(such as writing code for a robot control command)</li>
<li>Asking the large model to explain the function of a piece of
code</li>
<li>Asking the large model to answer specific scientific questions (such
as how to improve the generalization of reinforcement learning
models)</li>
</ol>
<h2 id="what-are-the-boundaries-for-choosing-to-use-large-models">What
Are the Boundaries for Choosing to Use Large Models?</h2>
<p>Comparing the tasks where I choose to use large models and those I
choose not to use, we can find that tasks where I choose to use large
models typically have the following attributes:</p>
<ul>
<li>Easy to confirm: After the large model outputs results, I can
confirm the correctness of the results at a low cost. For example, in
the translation software <code>Pot</code>, cross-validation is performed
using multiple translation APIs (Cambridge Dictionary, Bing Dictionary,
Google Translate, OpenAI, SmartAI).</li>
<li>Well-defined: Whether it is a translation task or code completion,
the output of the task is highly related to the input and does not
require too much creativity.</li>
<li>Not important: This is specifically for material generation tasks,
dddd</li>
</ul>
<p>When using large language models to solve tasks with the above
attributes, I can improve my productivity almost without any cost of
confirming the correctness or factual nature of the generated results.
In the current stage where the correctness of large models cannot be
guaranteed, I believe it is possible to find work content in the
workflow that has the above attributes and let the large model improve
efficiency.</p>
<p>Furthermore, tasks that I choose not to use large models for have
some characteristics:</p>
<ul>
<li>Factual: Questions that need to be answered are facts. For example,
asking about the function of a function, specific questions with
answers</li>
<li>Ambiguity: The question given to the large model itself has multiple
possible interpretations, leading to inaccurate answers. For example,
asking about the function of certain functions</li>
<li>Creativity: The question given to the large model has too large a
solution space, resulting in too many possible outputs, requiring
repeated questioning to get a good answer. For example, letting the
large model write code for a specific task</li>
</ul>
<p>At the current stage, <strong>large language models are essentially
just text probability predictors</strong>. Therefore, asking factual
questions to them depends on whether they have seen relevant corpus
during training. In addition, after fine-tuning on some datasets, the
model may produce more serious illusion problems <a
href="https://arxiv.org/abs/2405.05904">(Gekhman et al. 2024)</a>.
Therefore, from a practical perspective, I do not recommend using large
models to solve factual questions.</p>
<p>Moreover, tasks with the above characteristics are also difficult to
confirm the correctness of the results. Or the cost of confirming their
correctness is not less than not using large models. For example, if you
need to confirm whether the function given by the large model is
correct, you may need to find relevant documents for confirmation or
write a simple test code to check the output. This confirmation process
itself is enough to complete these tasks. In addition, if the results
generated by the large model are not confirmed, the consequences of
errors can be severe. For example, if you do not confirm the answer
given by the large model about improving the generalization of
reinforcement learning, and then proceed with the work according to its
proposed approach. If there are errors in the answer given by the large
model, it may lead to a lot of invalid work.</p>
<p>Finally, from the perspective of personal learning and growth, I
strongly do not recommend using large models for tasks like these, which
bring the following harms:</p>
<ol type="1">
<li>Lack of growth: Without using large models, trying to solve these
tasks can effectively improve personal abilities. For example, the
ability to find and read documents, read code, find and read literature,
etc. This will accelerate personal work efficiency (the speed of
completing these tasks will become faster and faster). Using large
models to complete such tasks continuously does not contribute to the
improvement of personal abilities and the acceleration of work
efficiency.</li>
<li>Blind belief: Although large models may provide some factual errors,
their language organization ability is too good. It is so good that it
can make people believe some "lies" he says. If in a field that one is
not familiar with, it is easy to distinguish the errors in the answers
given by large language models. But if one keeps using large models to
answer questions in a field that is not familiar, the convenience and
singularity of information sources will gradually lead to the loss of
the ability to distinguish correct results from the many search results
obtained from search engines, and ultimately can only blindly believe in
the results given by large language models.</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>In conclusion, I believe that it is important to have a correct
understanding of large models. At the current stage, <strong>large
language models are just a tool for text generation</strong>, not a
"wise man" who can answer all questions. We should treat large models
with the attitude of using tools, abandon the deification and blind
belief in large models. Let the large models work for us, rather than
becoming slaves to large models.</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>大模型</tag>
      </tags>
  </entry>
  <entry>
    <title>Zotero7插件推荐及下载</title>
    <url>/fa40cdb1.html</url>
    <content><![CDATA[<p>之前写过一篇<code>Zotero6</code>插件推荐和下载的文章 <a
href="https://kezhi.tech/b2344ef.html">Zotero插件推荐及下载 | Kezhi's
Blog</a>。随着<code>Zotero</code>开发组多年的不懈努力，现在终于迎来了<code>Zotero7</code>。相比于<code>Zotero6</code>，<code>Zotero7</code>基于更新的<code>firefox</code>内核，支持64位，具有更好的性能表现和更美观的界面。但是由于内核的大版本更新，过去<code>Zotero6</code>的插件不再兼容。故再撰写一篇文章用来推荐<code>Zotero7</code>的插件，并提供下载。</p>
<p><img src="https://download.kezhi.tech/img/202408142204527.jpg?x-oss-process=style/webp" style="width:33%;" /></p>
<span id="more"></span>
<h2 id="zotero-style">Zotero Style</h2>
<p>项目地址：<a
href="https://github.com/muisedestiny/zotero-style">MuiseDestiny/zotero-style:
Ethereal Style for Zotero (github.com)</a></p>
<p>下载地址：<a
href="https://server.kezhi.tech:9160/f/cbf604dc25384e1bb32c/?dl=1">zotero-style-4.6.0.xpi</a></p>
<p>介绍：非常好用的插件集合。包含阅读进度，视图组，明暗主题切换，阅读/未阅读标记，#Tag，文献打分等大量实用功能，强烈推荐。（其中有些功能需要付费解锁pro获得，按需付费即可）</p>
<p>评分：⭐⭐⭐⭐⭐</p>
<h2 id="chartero">Chartero</h2>
<p>项目地址：<a
href="https://github.com/volatile-static/Chartero">volatile-static/Chartero:
Chart in Zotero (github.com)</a></p>
<p>下载地址：<a
href="https://server.kezhi.tech:9160/f/50fd1bf16ab441379f9c/?dl=1">chartero-2.9.4.xpi</a></p>
<p>介绍：可视化插件，记录每篇文献的阅读时长并提供统计可视化统计查看。根据文献的元数据绘制文献关系图，作者关系图等，强烈推荐。</p>
<p>评分：⭐⭐⭐⭐⭐</p>
<h2 id="zotero-gpt">Zotero GPT</h2>
<p>项目地址：<a
href="https://github.com/MuiseDestiny/zotero-gpt">MuiseDestiny/zotero-gpt:
GPT Meet Zotero. (github.com)</a></p>
<p>下载地址：<a
href="https://server.kezhi.tech:9160/f/71e285cb71834b0e8320/?dl=1">zotero-gpt-1.1.7.xpi</a></p>
<p>介绍：大模型时代，读文献当然离不开GPT老师了，这个插件在<code>Zotero</code>里面集成了GPT的很多功能，强烈推荐。（其中有些功能需要付费解锁pro获得，按需付费即可）</p>
<p>评分：⭐⭐⭐⭐</p>
<h2 id="zotero-reference">Zotero Reference</h2>
<p>项目地址：<a
href="https://github.com/MuiseDestiny/zotero-reference">MuiseDestiny/zotero-reference:
PDF references add-on for Zotero. (github.com)</a></p>
<p>下载地址：<a
href="https://server.kezhi.tech:9160/f/c8cdc32f516c419485f8/?dl=1">zotero-reference-0.9.4.xpi</a></p>
<p>介绍：根据阅读中文献的参考文献表进行检索，并提供部分文献的下载和关联。但参考文献的抓取和下载因
pdf 文件差异效果各异。一般推荐（先推出一些付费功能，按需付费即可）</p>
<p>评分：⭐⭐⭐</p>
<h2 id="jasminum">Jasminum</h2>
<p>项目地址：<a href="https://github.com/l0o0/jasminum">l0o0/jasminum: A
Zotero add-on to retrive CNKI meta data. 一个简单的Zotero
插件，用于识别中文元数据 (github.com)</a></p>
<p>下载地址：<a
href="https://server.kezhi.tech:9160/f/f7305d39ddc64547a800/?dl=1">jasminum_1.0.0-16.xpi</a></p>
<p>介绍：大名鼎鼎的中文文献插件，看中文文献比较多的话可以下一个</p>
<p>评分：⭐⭐⭐⭐⭐</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Zotero</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>Zotero7 plugin recommendations and downloads.</title>
    <url>/en/fa40cdb1.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/fa40cdb1.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>I have written an article recommending and downloading
<code>Zotero6</code> plugins before. With the unremitting efforts of the
<code>Zotero</code> development team over the years,
<code>Zotero7</code> has finally arrived. Compared to
<code>Zotero6</code>, <code>Zotero7</code> is based on the updated
<code>firefox</code> kernel, supports 64-bit, has better performance and
a more beautiful interface. However, due to the major version update of
the kernel, the plugins for <code>Zotero6</code> are no longer
compatible. Therefore, I am writing another article to recommend
<code>Zotero7</code> plugins and provide downloads.</p>
<p><img src="https://download.kezhi.tech/img/202408142204527.jpg?x-oss-process=style/webp" style="width:33%;" /></p>
<span id="more"></span>
<h2 id="zotero-style">Zotero Style</h2>
<p>Project Link: <a
href="https://github.com/muisedestiny/zotero-style">MuiseDestiny/zotero-style:
Ethereal Style for Zotero (github.com)</a></p>
<p>Download Link: <a
href="https://server.kezhi.tech:9160/f/cbf604dc25384e1bb32c/?dl=1">zotero-style-4.6.0.xpi</a></p>
<p>Introduction: A very useful plugin collection. It includes reading
progress, view groups, light/dark theme switching, read/unread markers,
#Tag, literature scoring, and many other practical functions, highly
recommended. (Some features require payment to unlock the pro version,
pay as you go)</p>
<p>Rating: ⭐⭐⭐⭐⭐</p>
<h2 id="chartero">Chartero</h2>
<p>Project Link: <a
href="https://github.com/volatile-static/Chartero">volatile-static/Chartero:
Chart in Zotero (github.com)</a></p>
<p>Download Link: <a
href="https://server.kezhi.tech:9160/f/50fd1bf16ab441379f9c/?dl=1">chartero-2.9.4.xpi</a></p>
<p>Introduction: A visualization plugin that records the reading time of
each literature and provides visual statistics. Draw literature
relationship diagrams, author relationship diagrams, etc. based on the
metadata of the literature, highly recommended.</p>
<p>Rating: ⭐⭐⭐⭐⭐</p>
<h2 id="zotero-gpt">Zotero GPT</h2>
<p>Project Link: <a
href="https://github.com/MuiseDestiny/zotero-gpt">MuiseDestiny/zotero-gpt:
GPT Meet Zotero. (github.com)</a></p>
<p>Download Link: <a
href="https://server.kezhi.tech:9160/f/71e285cb71834b0e8320/?dl=1">zotero-gpt-1.1.7.xpi</a></p>
<p>Introduction: In the era of large models, reading literature
naturally cannot do without GPT. This plugin integrates many functions
of GPT in <code>Zotero</code>, highly recommended. (Some features
require payment to unlock the pro version, pay as you go)</p>
<p>Rating: ⭐⭐⭐⭐</p>
<h2 id="zotero-reference">Zotero Reference</h2>
<p>Project Link: <a
href="https://github.com/MuiseDestiny/zotero-reference">MuiseDestiny/zotero-reference:
PDF references add-on for Zotero. (github.com)</a></p>
<p>Download Link: <a
href="https://server.kezhi.tech:9160/f/c8cdc32f516c419485f8/?dl=1">zotero-reference-0.9.4.xpi</a></p>
<p>Introduction: Retrieve and download references based on the reference
list of Chinese literature, but the effectiveness of reference retrieval
and download varies due to differences in PDF files. Generally
recommended (some paid features are introduced, pay as you go)</p>
<p>Rating: ⭐⭐⭐</p>
<h2 id="jasminum">Jasminum</h2>
<p>Project Link: <a
href="https://github.com/l0o0/jasminum">l0o0/jasminum: A Zotero add-on
to retrieve CNKI meta data. A simple Zotero plugin for identifying
Chinese metadata (github.com)</a></p>
<p>Download Link: <a
href="https://server.kezhi.tech:9160/f/f7305d39ddc64547a800/?dl=1">jasminum_1.0.0-16.xpi</a></p>
<p>Introduction: A well-known Chinese literature plugin, if you read a
lot of Chinese literature, you can download it.</p>
<p>Rating: ⭐⭐⭐⭐⭐</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Zotero</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>一个简单的故事</title>
    <url>/a0779111.html</url>
    <content><![CDATA[<p>这是一个简单的故事，只有两位主人公。暂且称这两位主人公为小鱼（男）和小萍（女）吧。</p>
<p><img src="https://download.kezhi.tech/img/202408152317646.jpg" style="width:33%;" /></p>
<span id="more"></span>
<p>故事嘛，总是会有个主管视角的。尽管我想尽量客观地讲述这个故事。但很可惜，我只知道小鱼视角的故事。</p>
<p>23年初，小鱼删除了小萍的各种联系方式，给小萍发送了一封邮件，提出了分手。故事结束。</p>
<p>22年，为了避免吵架影响各自的学业，两人之间的聊天越来越少。</p>
<p>22年，两人因为价值观的冲突在各种话题的聊天上都会以吵架收尾。</p>
<p>22年，小萍获得了硕士学位，开始申请攻读博士学位。</p>
<p>22年，小鱼犯了一个重大错误，在帮小萍提交作业时少提交了一个内容，尽管这个作业做的很出彩，但因为这个疏忽最终只有很低的分数。</p>
<p>22年，小鱼帮助小萍完成一些课程作业。</p>
<p>21年，两人就这样通过视频和电话联系着，小鱼觉得这样的陪伴倒也不错</p>
<p>21年，两人开始异国，有时差，小鱼每天晚上两三点睡，早上十一点起，也倒可以在电话里陪小萍一个下午。</p>
<p>21年，临别前，两人一起生活了一段时间，暴露出很多问题。</p>
<p>21年，准备毕业了，小鱼考研上了本校，小萍申请了国外的研究生。</p>
<p>20年，两人的关系开始分崩离析了。小鱼的姐姐结婚，邀请小萍一起去。小鱼记得在婚礼上小萍听着夫妻的故事感动的哭了。婚礼结束后两人压马路聊了很久。</p>
<p>20年，疫情</p>
<p>19年，小鱼打古网去了（笑）</p>
<p>18年，这段时间两人的感情很好，因为都长大了，都相对成熟了，也都对这段感情认真了。小鱼一直记得小萍对他说过的：“你真是我的支柱”。</p>
<p>18年，复合了，两人一起报了辅修，故每周末都有机会在一起。</p>
<p>18年，小鱼想明白了，爱情只是生活中很小的一部分，且并非必要的部分。过去对于长久的幻想是美好的，但同时也是不可强求的。</p>
<p>18年，分手，小鱼很难过，找小汪喝酒，什么都没吃连喝两瓶啤酒，喝到后面边哭边喝。因为饭店没什么人，饭店的阿姨跑过来安慰我别哭坏了身子。最后是被扶着回宿舍的，室友一开宿舍门小鱼就扑倒在地上了。</p>
<p>17年，小鱼和小萍又在一起了，因为上了大学，两人关系有了进一步进展。</p>
<p>17年，小萍周末来小鱼的学校一起学习高数，线代，离散数学。</p>
<p>17年，上大学</p>
<p>17年，分手</p>
<p>17年，报志愿，小萍报了2天半，小鱼报了5分钟</p>
<p>17年，高考</p>
<p>17年，快高考了，两人谈到未来，理性讨论的结果告诉他们，他们不合适。遂商量出结论：高考完就分手。</p>
<p>17年，小萍早上4点起来做一套理综题，小鱼早上实在起不来，陪伴未果。</p>
<p>17年，小鱼到新华书店，找了一本很难（比较有意思）的理综模拟卷，给两人一人买了一本，每天做一套。</p>
<p>17年，小鱼的生日那天，小萍接受了小鱼的表白，两人第一次正式在一起了。</p>
<p>16年，小鱼上学是带着手机的，小鱼和小萍每天放学有机会就会一起回家路上聊天，分开后会一直打电话，一直到很晚。挂断电话之后小鱼会问小周要今天作业的答案。抄完睡觉。（没有比这段时间更幸福的时光了）</p>
<p>16年，两人逐渐亲密，但并没有确立什么关系。而在小鱼心里，已经认定了要和这个女孩一起走未来的路。</p>
<p>16年，小鱼开始尝试陪小萍回家，频遭拒绝。</p>
<p>15年，小鱼渐渐发现，他喜欢上了这个每天有聊不完的话题的女孩子。在他看来，没有人比她更聪明，更真实，更坦诚，更漂亮。两人在很多话题和问题上有着共鸣，相互的观点也对对方有着启发。</p>
<p>15年，尽管去了不同的班级，小鱼和小萍依然有很多可以聊的东西。</p>
<p>15年，分班了，两人去了不同的班级。小鱼去了重点班，小萍去了普通班。</p>
<p>15年，小鱼喜欢上了班上一个叫小宜的女孩，追求未果。在此期间，小鱼和小萍常以此为话题聊天。</p>
<p>14年，两人成为了同班同学并相识。小鱼对小萍的第一印象是她选班长的情形。她看起来漂亮且温柔。但小鱼觉得这么温柔的人并不适合当班长，所以并没有投票给她。</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
  </entry>
  <entry>
    <title>A simple story.</title>
    <url>/en/a0779111.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/a0779111.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>This is a simple story with only two protagonists. Let's call these
two protagonists Xiao Yu (male) and Xiao Ping (female) for now.</p>
<p><img src="https://download.kezhi.tech/img/202408152317646.jpg" style="width:33%;" /></p>
<span id="more"></span>
<p>Stories always have a supervisor's perspective. Although I try to
tell this story as objectively as possible, unfortunately, I only know
Xiao Yu's perspective of the story.</p>
<p>In early 23, Xiao Yu deleted various contact information of Xiao Ping
and sent an email to Xiao Ping, proposing a breakup. The story ends.</p>
<p>In 22, to avoid affecting their studies due to arguments, the
communication between the two became less and less.</p>
<p>In 22, the two would end up arguing in various topics due to
conflicts in values.</p>
<p>In 22, Xiao Ping obtained a master's degree and started applying for
a Ph.D. program.</p>
<p>In 22, Xiao Yu made a major mistake by missing out on submitting a
part of the assignment while helping Xiao Ping, resulting in a low score
despite the excellent work.</p>
<p>In 22, Xiao Yu helped Xiao Ping with some course assignments.</p>
<p>In 21, the two stayed in touch through video calls and phone calls.
Xiao Yu felt that this kind of companionship was not bad.</p>
<p>In 21, the two started a long-distance relationship with a time
difference. Xiao Yu slept at two or three in the morning and woke up at
eleven, which allowed him to spend an afternoon with Xiao Ping over the
phone.</p>
<p>In 21, before parting ways, the two lived together for a period and
exposed many issues.</p>
<p>In 21, as graduation approached, Xiao Yu took the postgraduate
entrance exam at the local university, while Xiao Ping applied for a
graduate program abroad.</p>
<p>In 20, their relationship began to deteriorate. Xiao Yu's sister got
married and invited Xiao Ping to attend. Xiao Yu remembered that Xiao
Ping was moved to tears listening to the couple's story at the wedding.
After the wedding, they walked and talked for a long time.</p>
<p>In 20, the pandemic.</p>
<p>In 19, Xiao Yu went to the ancient internet (laughs).</p>
<p>In 18, during this time, their relationship was good because they had
grown up, matured relatively, and taken their relationship seriously.
Xiao Yu always remembered what Xiao Ping said to him: "You are truly my
pillar."</p>
<p>In 18, they got back together and enrolled in a minor program, giving
them the opportunity to be together every weekend.</p>
<p>In 18, Xiao Yu realized that love is only a small part of life and
not a necessary part. The fantasies of the past about a lasting
relationship were beautiful but not something to be forced.</p>
<p>In 18, they broke up. Xiao Yu was very sad, went to drink with Xiao
Wang, didn't eat anything, just drank two bottles of beer, crying and
drinking towards the end. Because there were not many people in the
restaurant, the waitress came over to comfort him, fearing that he would
cry too much. In the end, he was helped back to the dormitory, and as
soon as his roommate opened the door, Xiao Yu fell to the ground.</p>
<p>In 17, Xiao Yu and Xiao Ping got back together because they entered
university, and their relationship progressed further.</p>
<p>In 17, Xiao Ping came to Xiao Yu's school on weekends to study
calculus, linear algebra, and discrete mathematics together.</p>
<p>In 17, they entered university.</p>
<p>In 17, they broke up.</p>
<p>In 17, they applied for colleges. Xiao Ping applied for two and a
half days, while Xiao Yu applied for five minutes.</p>
<p>In 17, the college entrance examination.</p>
<p>In 17, as the college entrance examination approached, they discussed
their future rationally and realized that they were not suitable for
each other. They decided to break up after the exam.</p>
<p>In 17, Xiao Ping woke up at 4 a.m. to do a set of comprehensive
science questions, but Xiao Yu couldn't get up early and failed to
accompany her.</p>
<p>In 17, Xiao Yu went to Xinhua Bookstore and found a very challenging
(interesting) comprehensive science mock exam, bought one for each of
them, and did one set every day.</p>
<p>On Xiao Yu's birthday that year, Xiao Ping accepted Xiao Yu's
confession, and they officially started dating for the first time.</p>
<p>In 16, Xiao Yu carried his phone to school. Every day after school,
Xiao Yu and Xiao Ping had the opportunity to chat on their way home.
They would continue talking on the phone until late at night. After
hanging up, Xiao Yu would ask Xiao Zhou for the answers to today's
homework. Then he would copy them and go to sleep. (There was no happier
time than this period.)</p>
<p>In 16, they gradually became closer, but they didn't establish a
formal relationship. In Xiao Yu's heart, he had already decided to walk
the future path with this girl.</p>
<p>In 16, Xiao Yu started trying to accompany Xiao Ping home but was
often rejected.</p>
<p>In 15, Xiao Yu gradually realized that he had fallen for this girl
who always had endless topics to talk about every day. In his eyes, no
one was smarter, more genuine, more honest, or more beautiful than her.
They resonated on many topics and issues, inspiring each other with
their viewpoints.</p>
<p>In 15, despite being in different classes, Xiao Yu and Xiao Ping
still had a lot to talk about.</p>
<p>In 15, they were separated into different classes. Xiao Yu went to
the key class, while Xiao Ping went to the regular class.</p>
<p>In 15, Xiao Yu developed a crush on a girl named Xiao Yi in his class
but was unsuccessful in pursuing her. During this time, Xiao Yu and Xiao
Ping often talked about this.</p>
<p>In 14, they became classmates and met each other. Xiao Yu's first
impression of Xiao Ping was when she ran for class monitor. She seemed
beautiful and gentle. However, Xiao Yu didn't think such a gentle person
was suitable for being a class monitor, so he didn't vote for her.</p>
]]></content>
      <categories>
        <category>Journal</category>
      </categories>
  </entry>
  <entry>
    <title>使用RDP在内网远程游戏思路</title>
    <url>/763d29e2.html</url>
    <content><![CDATA[<p>随着网络基础设施的建设和完善，现在已经有了很多远程游戏的解决方案。其主要分为两种类型：局域网串流（<a
href="https://store.steampowered.com/app/353380/Steam_Link/?l=schinese">steam串流</a>，<a
href="https://www.playstation.com/zh-hans-hk/accessories/playstation-portal-remote-player/">PlayStation
Portal</a>）和互联网云游戏（<a
href="https://mhyy.mihoyo.com/">云原神</a>，<a
href="https://cg.163.com/">网易云游戏平台</a>）。前者利用局域网下的高带宽和低延时实现同一局域网下的设备之间完成高速串流，解决了设备放在房间，人去另外一个房间（或者躺在床上）玩游戏的需求。后者利用压缩编码和延时控制技术，实现在互联网下利用中低带宽进行远程游戏，解决了在低性能终端设备上随时随地玩高性能需求游戏的问题。</p>
<p>然而，这两种解决方案也有其固有问题。局域网串流要求设备都处于同一局域网下，这对于串流的空间范围就有了限制。而云游戏存在竞争资源，账号隐私等问题。那么能不能有一个中间方案，扩大局域网串流的空间范围，同时避免云游戏存在的平台问题呢。我选择的解决方案是使用RDP在内网进行远程游戏。</p>
<h2 id="准备">准备</h2>
<p>要实现RDP远程游戏，需要准备：</p>
<ul>
<li>一台高配置的PC主机，用来实际运行游戏。（后文称其为服务主机）</li>
<li>一台随身携带的设备，能够运行RDP协议即可。通常是windows便携笔记本。（后文称其为客户端主机）</li>
<li>服务主机和客户端主机的内网连接，或服务主机有公网IP或内网穿透。（保证客户端主机能够通过IP或域名访问服务主机即可）</li>
</ul>
<h2 id="打开并测试rdp连通性">打开并测试RDP连通性</h2>
<ol type="1">
<li><p>在服务端主机打开远程桌面功能</p>
<p><img src="https://download.kezhi.tech/img/202408221157284.png?x-oss-process=style/webp" style="width:75%;" /></p></li>
<li><p>以windows电脑为例，在客户端主机上打开远程桌面连接，输入服务端主机的IP:端口进行连接，通常端口号为3389。用户名填服务端主机的登录用户名。</p>
<p><img src="https://download.kezhi.tech/img/202408221158944.png?x-oss-process=style/webp" style="width:50%;" /></p></li>
<li><p>点击连接，输入服务端主机的登录密码，能够成功登录到桌面则成功。</p></li>
</ol>
<h2 id="提升rdp性能">提升RDP性能</h2>
<p>RDP是点对点的，没有类似于<a
href="https://sunlogin.oray.com/">向日葵</a>或者<a
href="https://www.todesk.com/">ToDesk</a>这样的远程桌面的带宽瓶颈，所以理论上是可以跑满网络带宽的峰值速度的。但是为了保证使用体验，windows的默认远程桌面设置是对其性能做了一些限制的，接下来在服务端主机进行设置来提升RDP传输画面的性能。</p>
<p>首先在远程主机上打开组策略（搜索找到或者Win+R打开运行，输入gpedit.msc进入）</p>
<p>依次找到
计算机配置-&gt;管理模板-&gt;Windows组件-&gt;远程桌面服务-&gt;远程桌面会话主机-&gt;远程会话环境</p>
<p><img src="https://download.kezhi.tech/img/202408221158969.png?x-oss-process=style/webp" style="width:66%;" /></p>
<p>接下来对远程桌面的性能进行调整：</p>
<ul>
<li><p>开启显卡加速</p>
<p>打开将硬件图形适配器应用于所有远程桌面服务会话，将未配置改为已启用</p>
<p><img src="https://download.kezhi.tech/img/202408221202111.png?x-oss-process=style/webp" style="width:66%;" /></p></li>
<li><p>配置图像传输质量和压缩编码</p>
<p>打开为远程桌面连接设置H.264/AVC444图形模式的优先级，将未配置改为已启用</p>
<p>打开配置远程桌面连接的H.264/AVC硬件编码，将未配置改为已启用</p>
<p>打开配置RemoteFX数据的压缩，将未配置改为已启用，RDP压缩算法选择已优化为使用较少的网络带宽</p>
<p>打开配置RemoteFX自适应图形的图像质量，将未配置改为已启用，图像质量根据网络带宽选择中或者高</p></li>
<li><p>更改图形显示驱动</p>
<p>打开为远程桌面连接使用WDDM图形显示驱动程序，将未配置改为已启用</p></li>
<li><p>提高帧率上限</p>
<ol type="1">
<li><p>打开注册表编辑器</p></li>
<li><p>进入以下路径HKEY_LOCAL_MACHINEServer</p></li>
<li><p>新建名为DWMFRAMEINTERVAL，类型为DWORD(32位)的项</p></li>
<li><p>双击修改DWMFRAMEINTERVAL的数值，进制选择十进制，数值与帧率上限的对应关系为：</p>
<p>15 -&gt; 60fps，8-&gt;120fps</p></li>
</ol></li>
</ul>
<h2 id="解决手柄映射问题">解决手柄映射问题</h2>
<p>玩游戏嘛，那能用手柄就尽量用手柄了。然而RDP本身是不支持手柄信号的传输的。好在有大佬做了补丁来解决这个问题。解决方案：<a
href="https://github.com/microsoft/RdpGamepad">GitHub -
microsoft/RdpGamepad: Remote Desktop Plugin for Xbox Gamepads</a></p>
<h2 id="参考资料">参考资料</h2>
<ol type="1">
<li><a
href="https://blog.csdn.net/csdn_life18/article/details/108250846">RDP
优化操作 微软远程桌面
开启显卡加速、60FPS、USB设备重定向_远程桌面调用独立显卡-CSDN博客</a></li>
<li><a href="https://www.bilibili.com/read/cv19980358/">Microsoft Remote
Desktop（RDP ）优化流程 - 哔哩哔哩 (bilibili.com)</a></li>
<li><a
href="https://blog.csdn.net/skyew/article/details/136534913">Windows远程桌面RDP
mstsc 性能优化用显卡异地玩游戏_rdp 显卡-CSDN博客</a></li>
<li><a href="https://github.com/microsoft/RdpGamepad">GitHub -
microsoft/RdpGamepad: Remote Desktop Plugin for Xbox Gamepads</a></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>RDP</tag>
        <tag>远程游戏</tag>
      </tags>
  </entry>
  <entry>
    <title>Use RDP to remotely play games on the intranet.</title>
    <url>/en/763d29e2.html</url>
    <content><![CDATA[<div class="note info"><p>This is an automatically translated post by LLM. The <a
href="https://kezhi.tech/763d29e2.html">original post</a> is in Chinese.
If you find any translation errors, please leave a comment to help me
improve the translation. Thanks!</p>
</div>
<p>With the construction and improvement of network infrastructure,
there are now many solutions for remote gaming. They are mainly divided
into two types: LAN streaming (<a
href="https://store.steampowered.com/app/353380/Steam_Link/?l=schinese">Steam
Link</a>, <a
href="https://www.playstation.com/zh-hans-hk/accessories/playstation-portal-remote-player/">PlayStation
Portal</a>) and Internet cloud gaming (<a
href="https://mhyy.mihoyo.com/">Genshin Impact Cloud</a>, <a
href="https://cg.163.com/">NetEase Cloud Gaming Platform</a>). The
former uses high bandwidth and low latency in the LAN to achieve
high-speed streaming between devices in the same LAN, solving the need
to play games in a different room (or lying in bed) when the device is
in another room. The latter uses compression encoding and latency
control technology to enable remote gaming over the Internet using
medium to low bandwidth, solving the problem of playing high-performance
demanding games anytime, anywhere on low-performance terminal
devices.</p>
<p>However, these two solutions also have their inherent problems. LAN
streaming requires devices to be on the same LAN, limiting the spatial
range of streaming. Cloud gaming faces issues such as competition for
resources and account privacy. So, is there a middle ground solution
that expands the spatial range of LAN streaming while avoiding the
platform issues of cloud gaming? The solution I choose is to use RDP for
remote gaming within the LAN.</p>
<h2 id="preparation">Preparation</h2>
<p>To implement RDP remote gaming, you need to prepare:</p>
<ul>
<li>A high-configured PC host to actually run the game (referred to as
the server host).</li>
<li>A portable device capable of running the RDP protocol, usually a
Windows laptop (referred to as the client host).</li>
<li>An internal network connection between the server host and client
host, or the server host has a public IP or internal penetration (to
ensure that the client host can access the server host via IP or domain
name).</li>
</ul>
<h2 id="open-and-test-rdp-connectivity">Open and Test RDP
Connectivity</h2>
<ol type="1">
<li><p>Enable Remote Desktop feature on the server host</p>
<figure>
<img
src="https://download.kezhi.tech/img/202408221157284.png?x-oss-process=style/webp"
alt="Remote Desktop Feature" />
<figcaption aria-hidden="true">Remote Desktop Feature</figcaption>
</figure></li>
<li><p>Using a Windows computer as an example, open Remote Desktop
Connection on the client host, enter the IP:port of the server host for
connection, usually port 3389. Enter the login username of the server
host.</p>
<figure>
<img
src="https://download.kezhi.tech/img/202408221158944.png?x-oss-process=style/webp"
alt="Remote Desktop Connection" />
<figcaption aria-hidden="true">Remote Desktop Connection</figcaption>
</figure></li>
<li><p>Click connect, enter the login password of the server host, and
if you can successfully log in to the desktop, it's a success.</p></li>
</ol>
<h2 id="enhance-rdp-performance">Enhance RDP Performance</h2>
<p>RDP is point-to-point and does not have bandwidth bottlenecks like <a
href="https://sunlogin.oray.com/">Sunlogin</a> or <a
href="https://www.todesk.com/">ToDesk</a> remote desktops, so
theoretically, it can run at the peak speed of network bandwidth.
However, to ensure user experience, Windows default Remote Desktop
settings have some performance limitations. Next, adjust the settings on
the server host to improve the performance of RDP screen
transmission.</p>
<p>First, open Group Policy on the remote host (search and find or press
Win+R to open Run, enter gpedit.msc to access).</p>
<p>Navigate to Computer Configuration -&gt; Administrative Templates
-&gt; Windows Components -&gt; Remote Desktop Services -&gt; Remote
Desktop Session Host -&gt; Remote Session Environment</p>
<figure>
<img
src="https://download.kezhi.tech/img/202408221158969.png?x-oss-process=style/webp"
alt="Group Policy" />
<figcaption aria-hidden="true">Group Policy</figcaption>
</figure>
<p>Next, adjust the performance of Remote Desktop:</p>
<ul>
<li><p>Enable GPU Acceleration</p>
<p>Open Apply hardware graphics adapters to all Remote Desktop Services
sessions, change from Not Configured to Enabled</p>
<figure>
<img
src="https://download.kezhi.tech/img/202408221202111.png?x-oss-process=style/webp"
alt="GPU Acceleration" />
<figcaption aria-hidden="true">GPU Acceleration</figcaption>
</figure></li>
<li><p>Configure Image Transmission Quality and Compression Encoding</p>
<p>Open Set the priority of H.264/AVC444 graphics mode for Remote
Desktop connections, change from Not Configured to Enabled</p>
<p>Open Configure H.264/AVC hardware encoding for Remote Desktop
connections, change from Not Configured to Enabled</p>
<p>Open Configure compression of RemoteFX data, change from Not
Configured to Enabled, select RDP compression algorithm optimized to use
less network bandwidth</p>
<p>Open Configure image quality for RemoteFX adaptive graphics, change
from Not Configured to Enabled, select image quality as medium or high
based on network bandwidth</p></li>
<li><p>Change Graphics Display Driver</p>
<p>Open Use WDDM graphics display driver for Remote Desktop connections,
change from Not Configured to Enabled</p></li>
<li><p>Increase Frame Rate Limit</p>
<ol type="1">
<li><p>Open Registry Editor</p></li>
<li><p>Navigate to HKEY_LOCAL_MACHINEServer</p></li>
<li><p>Create a new DWORD (32-bit) item named DWMFRAMEINTERVAL</p></li>
<li><p>Double-click to modify the value of DWMFRAMEINTERVAL, select
Decimal, and the value corresponds to the frame rate limit as
follows:</p>
<p>15 -&gt; 60fps, 8 -&gt; 120fps</p></li>
</ol></li>
</ul>
<h2 id="resolve-gamepad-mapping-issue">Resolve Gamepad Mapping
Issue</h2>
<p>When playing games, using a gamepad is preferred. However, RDP itself
does not support the transmission of gamepad signals. Fortunately, there
are patches available to solve this issue. Solution: <a
href="https://github.com/microsoft/RdpGamepad">GitHub -
microsoft/RdpGamepad: Remote Desktop Plugin for Xbox Gamepads</a></p>
<h2 id="references">References</h2>
<ol type="1">
<li><a
href="https://blog.csdn.net/csdn_life18/article/details/108250846">RDP
Optimization Operations Microsoft Remote Desktop Enable GPU
Acceleration, 60FPS, USB Device Redirection - CSDN Blog</a></li>
<li><a href="https://www.bilibili.com/read/cv19980358/">Microsoft Remote
Desktop (RDP) Optimization Process - Bilibili</a></li>
<li><a
href="https://blog.csdn.net/skyew/article/details/136534913">Windows
Remote Desktop RDP mstsc Performance Optimization for Playing Games
Remotely with Graphics Card - CSDN Blog</a></li>
<li><a href="https://github.com/microsoft/RdpGamepad">GitHub -
microsoft/RdpGamepad: Remote Desktop Plugin for Xbox Gamepads</a></li>
</ol>
]]></content>
      <categories>
        <category>Tips</category>
      </categories>
      <tags>
        <tag>RDP</tag>
        <tag>远程游戏</tag>
      </tags>
  </entry>
</search>
